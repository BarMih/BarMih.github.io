var lF=Object.create;var Mg=Object.defineProperty,cF=Object.defineProperties,uF=Object.getOwnPropertyDescriptor,hF=Object.getOwnPropertyDescriptors,dF=Object.getOwnPropertyNames,Dg=Object.getOwnPropertySymbols,fF=Object.getPrototypeOf,ux=Object.prototype.hasOwnProperty,BM=Object.prototype.propertyIsEnumerable;var zM=(s,a,f)=>a in s?Mg(s,a,{enumerable:!0,configurable:!0,writable:!0,value:f}):s[a]=f,It=(s,a)=>{for(var f in a||={})ux.call(a,f)&&zM(s,f,a[f]);if(Dg)for(var f of Dg(a))BM.call(a,f)&&zM(s,f,a[f]);return s},Wn=(s,a)=>cF(s,hF(a));var hx=(s,a)=>{var f={};for(var d in s)ux.call(s,d)&&a.indexOf(d)<0&&(f[d]=s[d]);if(s!=null&&Dg)for(var d of Dg(s))a.indexOf(d)<0&&BM.call(s,d)&&(f[d]=s[d]);return f};var pF=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports),mF=(s,a)=>{for(var f in a)Mg(s,f,{get:a[f],enumerable:!0})},gF=(s,a,f,d)=>{if(a&&typeof a=="object"||typeof a=="function")for(let _ of dF(a))!ux.call(s,_)&&_!==f&&Mg(s,_,{get:()=>a[_],enumerable:!(d=uF(a,_))||d.enumerable});return s};var _F=(s,a,f)=>(f=s!=null?lF(fF(s)):{},gF(a||!s||!s.__esModule?Mg(f,"default",{value:s,enumerable:!0}):f,s));var dP=pF((nE,rE)=>{"use strict";(function(s,a){typeof nE=="object"&&typeof rE<"u"?rE.exports=a():typeof define=="function"&&define.amd?define(a):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=a())})(nE,function(){"use strict";var s,a,f;function d(r,M){if(!s)s=M;else if(!a)a=M;else{var L="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",B={};s(B),f=M(B),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(f.workerUrl=window.URL.createObjectURL(new Blob([L],{type:"text/javascript"})))}}d(["exports"],function(r){"use strict";var M="3.2.0";let L,B={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(L==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{L=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{L=t}}return L},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!B.API_URL)return null;try{let t=new URL(B.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},X={supported:!1,testSupport:function(t){!Oe&&ge&&(at?Vt(t):se=t)}},se,ge,Oe=!1,at=!1,Dt=typeof self<"u"?self:{};function Vt(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ge),t.isContextLost())return;X.supported=!0}catch{}t.deleteTexture(e),Oe=!0}Dt.document&&(ge=Dt.document.createElement("img"),ge.onload=function(){se&&Vt(se),se=null,at=!0},ge.onerror=function(){Oe=!0,se=null},ge.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let kt="01";function St(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Fn=zn;function zn(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}zn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var l=this.sampleCurveX(n)-t;if(Math.abs(l)<e)return n;var u=this.sampleCurveDerivativeX(n);if(Math.abs(u)<1e-6)break;n-=l/u}var h=0,m=1;for(n=t,i=0;i<20&&(l=this.sampleCurveX(n),!(Math.abs(l-t)<e));i++)t>l?h=n:m=n,n=.5*(m-h)+h;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var An=St(Fn),Pr=tr;function tr(t,e){this.x=t,this.y=e}tr.prototype={clone:function(){return new tr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),l=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=l,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},tr.convert=function(t){return t instanceof tr?t:Array.isArray(t)?new tr(t[0],t[1]):t};var Ue=St(Pr);let js=Math.PI/180,Vs=180/Math.PI;function gt(t){return t*js}function Or(t){return t*Vs}let Vh=[[0,0],[1,0],[1,1],[0,1]];function Uc(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function $c(t,e,n,i){let l=new An(t,e,n,i);return function(u){return l.solve(u)}}let Uh=$c(.25,.1,.25,1);function Bt(t,e,n){return Math.min(n,Math.max(e,t))}function Us(t,e,n){return(n=Bt((n-t)/(e-t),0,1))*n*(3-2*n)}function ci(t,e,n){let i=n-e,l=((t-e)%i+i)%i+e;return l===e?n:l}function vi(t,e,n){if(!t.length)return n(null,[]);let i=t.length,l=new Array(t.length),u=null;t.forEach((h,m)=>{e(h,(y,x)=>{y&&(u=y),l[m]=x,--i==0&&n(u,l)})})}function $s(t){let e=[];for(let n in t)e.push(t[n]);return e}function Tr(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}let Gc=1;function Ra(){return Gc++}function Gs(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Hs(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Hc(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Pa(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Oa(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Sl(t,e,n){let i={};for(let l in t)i[l]=e.call(n||this,t[l],l,t);return i}function qc(t,e,n){let i={};for(let l in t)e.call(n||this,t[l],l,t)&&(i[l]=t[l]);return i}function qi(t){return Array.isArray(t)?t.map(qi):typeof t=="object"&&t?Sl(t,qi):t}let Wc={};function Zn(t){Wc[t]||(typeof console<"u"&&console.warn(t),Wc[t]=!0)}function $e(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function te(t){let e=0;for(let n,i,l=0,u=t.length,h=u-1;l<u;h=l++)n=t[l],i=t[h],e+=(i.x-n.x)*(n.y+i.y);return e}function ie([t,e,n]){let i=gt(e+90),l=gt(n);return{x:t*Math.cos(i)*Math.sin(l),y:t*Math.sin(i)*Math.sin(l),z:t*Math.cos(l),azimuthal:e,polar:n}}function pe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ze(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,l,u)=>{let h=l||u;return e[i]=!h||h.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Fe=null;function lt(t){try{let e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function pt(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function je(t,e,n,i){for(;e<n;){let l=e+n>>1;t[l]<i?e=l+1:n=l}return e}function Tt(t,e,n,i){for(;e<n;){let l=e+n>>1;t[l]<=i?e=l+1:n=l}return e}let Mt="mapbox-tiles",Ct=500,In=50,Bn,pr;function Nn(){try{return caches}catch{}}function jn(){let t=Nn();t&&!Bn&&(Bn=t.open(Mt))}function Dn(t){let e=t.indexOf("?");if(e<0)return t;let n=function(l){let u=l.indexOf("?");return u>0?l.slice(u+1).split("&"):[]}(t),i=n.filter(l=>{let u=l.split("=");return u[0]==="language"||u[0]==="worldview"});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let Ir=1/0,kr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(kr);class Ii extends Error{constructor(e,n,i){n===401&&We(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let Zr=pe()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Ao=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Zr())&&!/^\w+:/.test(n))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(i,l){let u=new AbortController,h=new Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:Zr(),referrerPolicy:i.referrerPolicy,signal:u.signal}),m=!1,y=!1,x=(w=h.url).indexOf("sku=")>0&&We(w);var w;i.type==="json"&&h.headers.set("Accept","application/json");let T=(S,A,P)=>{if(y)return;if(S&&S.message!=="SecurityError"&&Zn(S.toString()),A&&P)return D(A);let k=Date.now();fetch(h).then(N=>{if(N.ok){let H=x?N.clone():null;return D(N,H,k)}return l(new Ii(N.statusText,N.status,i.url))}).catch(N=>{N.name!=="AbortError"&&l(new Error(`${N.message} ${i.url}`))})},D=(S,A,P)=>{(i.type==="arrayBuffer"?S.arrayBuffer():i.type==="json"?S.json():S.text()).then(k=>{y||(A&&P&&function(N,H,q){if(jn(),!Bn)return;let Z={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((le,he)=>Z.headers.set(he,le));let K=ze(H.headers.get("Cache-Control")||"");if(K["no-store"])return;K["max-age"]&&Z.headers.set("Expires",new Date(q+1e3*K["max-age"]).toUTCString());let ee=Z.headers.get("Expires");ee&&(new Date(ee).getTime()-q<42e4||function(le,he){if(pr===void 0)try{new Response(new ReadableStream),pr=!0}catch{pr=!1}pr?he(le.body):le.blob().then(he)}(H,le=>{let he=new Response(le,Z);jn(),Bn&&Bn.then(fe=>fe.put(Dn(N.url),he)).catch(fe=>Zn(fe.message))}))}(h,A,P),m=!0,l(null,k,S.headers.get("Cache-Control"),S.headers.get("Expires")))}).catch(k=>{y||l(new Error(k.message))})};return x?function(S,A){if(jn(),!Bn)return A(null);let P=Dn(S.url);Bn.then(k=>{k.match(P).then(N=>{let H=function(q){if(!q)return!1;let Z=new Date(q.headers.get("Expires")||0),K=ze(q.headers.get("Cache-Control")||"");return Z>Date.now()&&!K["no-cache"]}(N);k.delete(P),H&&k.put(P,N.clone()),A(null,N,H)}).catch(A)}).catch(A)}(h,T):T(null,null),{cancel:()=>{y=!0,m||u.abort()}}}(t,e);if(pe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,l){let u=new XMLHttpRequest;u.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(let h in i.headers)u.setRequestHeader(h,i.headers[h]);return i.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=i.credentials==="include",u.onerror=()=>{l(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(i.type==="json")try{h=JSON.parse(u.response)}catch(m){return l(m)}l(null,h,u.getResponseHeader("Cache-Control"),u.getResponseHeader("Expires"))}else l(new Ii(u.statusText,u.status,i.url))},u.send(i.body),{cancel:()=>u.abort()}}(t,e)},Lr=function(t,e){return Ao(Tr(t,{type:"arrayBuffer"}),e)};function Ro(t){let e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}let os="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Fr,Se;Fr=[],Se=0;let Ae=function(t,e){if(X.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Se>=B.MAX_PARALLEL_IMAGE_REQUESTS){let u={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Fr.push(u),u}Se++;let n=!1,i=()=>{if(!n)for(n=!0,Se--;Fr.length&&Se<B.MAX_PARALLEL_IMAGE_REQUESTS;){let u=Fr.shift(),{requestParameters:h,callback:m,cancelled:y}=u;y||(u.cancel=Ae(h,m).cancel)}},l=Lr(t,(u,h,m,y)=>{i(),u?e(u):h&&(self.createImageBitmap?function(x,w){let T=new Blob([new Uint8Array(x)],{type:"image/png"});createImageBitmap(T).then(D=>{w(null,D)}).catch(D=>{w(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(x,w)=>e(x,w,m,y)):function(x,w){let T=new Image;T.onload=()=>{w(null,T),URL.revokeObjectURL(T.src),T.onload=null,requestAnimationFrame(()=>{T.src=os})},T.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let D=new Blob([new Uint8Array(x)],{type:"image/png"});T.src=x.byteLength?URL.createObjectURL(D):os}(h,(x,w)=>e(x,w,m,y)))});return{cancel:()=>{l.cancel(),i()}}},Ve="NO_ACCESS_TOKEN";function Ge(t){return t.indexOf("mapbox:")===0}function We(t){return B.API_URL_REGEX.test(t)}function Ke(t){return B.API_CDN_URL_REGEX.test(t)}function Qe(t){return B.API_STYLE_REGEX.test(t)&&!Xe(t)}function Xe(t){return B.API_SPRITE_REGEX.test(t)}let ct=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function qe(t){let e=t.match(ct);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Nt(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let pn="mapbox.eventData";function vt(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class vn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=vt(B.ACCESS_TOKEN),i="";return i=n&&n.u?btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(l,u)=>String.fromCharCode(+("0x"+u)))):B.ACCESS_TOKEN||"",e?`${pn}.${e}:${i}`:`${pn}:${i}`}fetchEventData(){let e=lt("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{let l=localStorage.getItem(n);l&&(this.eventData=JSON.parse(l));let u=localStorage.getItem(i);u&&(this.anonId=u)}catch{Zn("Unable to read from LocalStorage")}}saveEventData(){let e=lt("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid"),l=this.anonId;if(e&&l)try{localStorage.setItem(i,l),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Zn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,l){if(!B.EVENTS_URL)return;let u=qe(B.EVENTS_URL);u.params.push(`access_token=${l||B.ACCESS_TOKEN||""}`);let h={event:this.type,created:new Date(e).toISOString()},m=n?Tr(h,n):h,y={url:Nt(u),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(x,w){return Ao(Tr(x,{method:"POST"}),w)}(y,x=>{this.pendingRequest=null,i(x),this.saveEventData(),this.processRequests(l)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Qn=new class extends vn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){B.EVENTS_URL&&B.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Ge(n)||We(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=vt(B.ACCESS_TOKEN),n=e?e.u:B.ACCESS_TOKEN,i=n!==this.eventData.tokenU;Hc(this.anonId)||(this.anonId=Gs(),i=!0);let l=this.queue.shift();if(this.eventData.lastSuccess){let u=new Date(this.eventData.lastSuccess),h=new Date(l),m=(l-this.eventData.lastSuccess)/864e5;i=i||m>=1||m<-1||u.getDate()!==h.getDate()}else i=!0;i?this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:kt,"enabled.telemetry":!1,userId:this.anonId},u=>{u||(this.eventData.lastSuccess=l,this.eventData.tokenU=n)},t):this.processRequests()}},nr=Qn.postTurnstileEvent.bind(Qn),cr=new class extends vn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,B.EVENTS_URL&&(n||B.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ve)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Hc(this.anonId)||(this.anonId=Gs()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:M,skuId:kt,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},Br=cr.postMapLoadEvent.bind(cr),xi=new class extends vn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){B.EVENTS_URL&&(t||B.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),i=function(l){let u=performance.getEntriesByType("resource"),h=performance.getEntriesByType("mark"),m=function(S){let A={};if(S){for(let P in S)if(P!=="other")for(let k of S[P]){let N=`${P}ResolveRangeMin`,H=`${P}ResolveRangeMax`,q=`${P}RequestCount`,Z=`${P}RequestCachedCount`;A[N]=Math.min(A[N]||1/0,k.startTime),A[H]=Math.max(A[H]||-1/0,k.responseEnd);let K=ee=>{A[ee]===void 0&&(A[ee]=0),++A[ee]};k.transferSize!==void 0&&k.transferSize===0&&K(Z),K(q)}}return A}(function(S,A){let P={};if(S)for(let k of S){let N=A(k);P[N]===void 0&&(P[N]=[]),P[N].push(k)}return P}(u,ka)),y=window.devicePixelRatio,x=navigator.connection||navigator.mozConnection||navigator.webkitConnection,w=x?x.effectiveType:void 0,T={counters:[],metadata:[],attributes:[]},D=(S,A,P)=>{P!=null&&S.push({name:A,value:P.toString()})};for(let S in m)D(T.counters,S,m[S]);if(l.interactionRange[0]!==1/0&&l.interactionRange[1]!==-1/0&&(D(T.counters,"interactionRangeMin",l.interactionRange[0]),D(T.counters,"interactionRangeMax",l.interactionRange[1])),h)for(let S of Object.keys(Po)){let A=Po[S],P=h.find(k=>k.name===A);P&&D(T.counters,A,P.startTime)}return D(T.counters,"visibilityHidden",l.visibilityHidden),D(T.attributes,"style",function(S){if(S)for(let A of S){let P=A.name.split("?")[0];if(Qe(P)){let k=P.split("/").slice(-2);if(k.length===2)return`mapbox://styles/${k[0]}/${k[1]}`}}}(u)),D(T.attributes,"terrainEnabled",l.terrainEnabled?"true":"false"),D(T.attributes,"fogEnabled",l.fogEnabled?"true":"false"),D(T.attributes,"projection",l.projection),D(T.attributes,"zoom",l.zoom),D(T.metadata,"devicePixelRatio",y),D(T.metadata,"connectionEffectiveType",w),D(T.metadata,"navigatorUserAgent",navigator.userAgent),D(T.metadata,"screenWidth",window.screen.width),D(T.metadata,"screenHeight",window.screen.height),D(T.metadata,"windowWidth",window.innerWidth),D(T.metadata,"windowHeight",window.innerHeight),D(T.metadata,"mapWidth",l.width/y),D(T.metadata,"mapHeight",l.height/y),D(T.metadata,"webglRenderer",l.renderer),D(T.metadata,"webglVendor",l.vendor),D(T.metadata,"sdkVersion",M),D(T.metadata,"sdkIdentifier","mapbox-gl-js"),T}(n);for(let l of i.metadata);for(let l of i.counters);for(let l of i.attributes);this.postEvent(e,i,()=>{},t)}},Di=xi.postPerformanceEvent.bind(xi),bi=new class extends vn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!B.API_URL||!B.SESSION_PATH)return;let l=qe(B.API_URL+B.SESSION_PATH);l.params.push(`sku=${e||""}`),l.params.push(`access_token=${i||B.ACCESS_TOKEN||""}`);let u={url:Nt(l),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(h,m){return Ao(Tr(h,{method:"GET"}),m)}(u,h=>{this.pendingRequest=null,n(h),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,B.SESSION_PATH&&B.API_URL&&(n||B.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Ve)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},jr=bi.getSessionAPI.bind(bi),ui=new Set,Po={create:"create",load:"load",fullLoad:"fullLoad"};function ka(t){let e=t.name.split("?")[0];return Ke(e)&&e.includes("mapbox-gl.js")?"javascript":Ke(e)&&e.includes("mapbox-gl.css")?"css":function(n){return B.API_FONTS_REGEX.test(n)}(e)?"fontRange":Xe(e)?"sprite":Qe(e)?"style":function(n){return B.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}function $h(t){let e=t?t.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let Zc,Xc,Gh,Cl,qs;function Rp(){return Zc==null&&(Zc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Zc}let Xr={now:()=>Cl!==void 0?Cl:performance.now(),setNow(t){Cl=t},restoreNow(){Cl=void 0},frame(t){let e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:i}=t;qs||(qs=document.createElement("canvas"));let l=qs.getContext("2d",{willReadFrequently:!0});if(!l)throw new Error("failed to create canvas 2d context");return(n>qs.width||i>qs.height)&&(qs.width=n,qs.height=i),l.clearRect(-e,-e,n+2*e,i+2*e),l.drawImage(t,0,0,n,i),l.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(Xc||(Xc=document.createElement("a")),Xc.href=t,Xc.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Gh==null&&(Gh=window.matchMedia("(prefers-reduced-motion: reduce)")),Gh.matches)},hasCanvasFingerprintNoise(){if(!Rp())return!1;let t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let l=0;l<t.width;++l)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(l,0,1,1);let i=e.getImageData(0,0,t.width,t.height);n=0;for(let l=0;l<i.data.length;++l)if(l%4!=3&&n++!==i.data[l])return!0;return!1}};function Yc(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function Ws(t,e,n){if(n&&n[t]){let i=n[t].indexOf(e);i!==-1&&n[t].splice(i,1)}}class Wi{constructor(e,n={}){Tr(this,n),this.type=e}}class Zs extends Wi{constructor(e,n={}){super("error",Tr({error:e},n))}}class uo{on(e,n){return this._listeners=this._listeners||{},Yc(e,n,this._listeners),this}off(e,n){return Ws(e,n,this._listeners),Ws(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Yc(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){typeof e=="string"&&(e=new Wi(e,n||{}));let i=e.type;if(this.listens(i)){e.target=this;let l=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(let m of l)m.call(this,e);let u=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(let m of u)Ws(i,m,this._oneTimeListeners),m.call(this,e);let h=this._eventedParent;h&&(Tr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Zs&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class ut{constructor(e,n,i,l){this.message=(e?`${e}: `:"")+i,l&&(this.identifier=l),n!=null&&n.__line__&&(this.line=n.__line__)}}class ho extends ut{}function Zi(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}function ur(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Oo(t){if(Array.isArray(t))return t.map(Oo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=Oo(t[n]);return e}return ur(t)}class Hy extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Xi=Hy;class Hh{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[i,l]of n)this.bindings[i]=l}concat(e){return new Hh(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var qy=Hh;let Xs={kind:"null"},Pe={kind:"number"},tn={kind:"string"},sn={kind:"boolean"},Mi={kind:"color"},La={kind:"object"},Kt={kind:"value"},Ys={kind:"collator"},ss={kind:"formatted"},Al={kind:"resolvedImage"};function Yr(t,e){return{kind:"array",itemType:t,N:e}}function Mn(t){if(t.kind==="array"){let e=Mn(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let Wy=[Xs,Pe,tn,sn,Mi,ss,La,Yr(Kt),Al];function Js(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Js(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of Wy)if(!Js(n,e))return null}}return`Expected ${Mn(t)} but found ${Mn(e)} instead.`}function qh(t,e){return e.some(n=>n.kind===t.kind)}function Ks(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var Jc,Fa={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Na(t){return(t=Math.round(t))<0?0:t>255?255:t}function Wh(t){return Na(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Kc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Zh(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Jc={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Fa)return Fa[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),l=n.indexOf(")");if(i!==-1&&l+1===n.length){var u=n.substr(0,i),h=n.substr(i+1,l-(i+1)).split(","),m=1;switch(u){case"rgba":if(h.length!==4)return null;m=Kc(h.pop());case"rgb":return h.length!==3?null:[Wh(h[0]),Wh(h[1]),Wh(h[2]),m];case"hsla":if(h.length!==4)return null;m=Kc(h.pop());case"hsl":if(h.length!==3)return null;var y=(parseFloat(h[0])%360+360)%360/360,x=Kc(h[1]),w=Kc(h[2]),T=w<=.5?w*(x+1):w+x-w*x,D=2*w-T;return[Na(255*Zh(D,T,y+1/3)),Na(255*Zh(D,T,y)),Na(255*Zh(D,T,y-1/3)),m];default:return null}}return null}}catch{}class Jr{constructor(e,n,i,l=1){this.r=e,this.g=n,this.b=i,this.a=l}static parse(e){if(!e)return;if(e instanceof Jr)return e;if(typeof e!="string")return;let n=Jc(e);return n?new Jr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,i,l]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${l})`}toArray(){let{r:e,g:n,b:i,a:l}=this;return l===0?[0,0,0,0]:[255*e/l,255*n/l,255*i/l,l]}toArray01(){let{r:e,g:n,b:i,a:l}=this;return l===0?[0,0,0,0]:[e/l,n/l,i/l,l]}toArray01Scaled(e){let{r:n,g:i,b:l,a:u}=this;return u===0?[0,0,0]:[n/u*e,i/u*e,l/u*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:i,a:l}=this;return[e,n,i,l]}toArray01Linear(){let{r:e,g:n,b:i,a:l}=this;return l===0?[0,0,0,0]:[Math.pow(e/l,2.2),Math.pow(n/l,2.2),Math.pow(i/l,2.2),l]}}Jr.black=new Jr(0,0,0,1),Jr.white=new Jr(1,1,1,1),Jr.transparent=new Jr(0,0,0,0),Jr.red=new Jr(1,0,0,1),Jr.blue=new Jr(0,0,1,1);var Vn=Jr;class Xh{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Qs{constructor(e,n,i,l,u){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=l,this.textColor=u}}class Kr{constructor(e){this.sections=e}static fromString(e){return new Kr([new Qs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Kr?e:Kr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}}class Si{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new Si({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Pp(t,e,n,i){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function za(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Vn||t instanceof Xh||t instanceof Kr||t instanceof Si)return!0;if(Array.isArray(t)){for(let e of t)if(!za(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!za(t[e]))return!1;return!0}return!1}function gr(t){if(t===null)return Xs;if(typeof t=="string")return tn;if(typeof t=="boolean")return sn;if(typeof t=="number")return Pe;if(t instanceof Vn)return Mi;if(t instanceof Xh)return Ys;if(t instanceof Kr)return ss;if(t instanceof Si)return Al;if(Array.isArray(t)){let e=t.length,n;for(let i of t){let l=gr(i);if(n){if(n===l)continue;n=Kt;break}n=l}return Yr(n||Kt,e)}return La}function Rl(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Vn||t instanceof Kr||t instanceof Si?t.toString():JSON.stringify(t)}class Yh{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!za(e[1]))return n.error("invalid value");let i=e[1],l=gr(i),u=n.expectedType;return l.kind!=="array"||l.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(l=u),new Yh(l,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vn?["rgba"].concat(this.value.toArray()):this.value instanceof Kr?this.value.serialize():this.value}}var Ba=Yh,hr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let Jh={string:tn,number:Pe,boolean:sn,object:La};class Kh{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,l=1,u=e[0];if(u==="array"){let m,y;if(e.length>2){let x=e[1];if(typeof x!="string"||!(x in Jh)||x==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);m=Jh[x],l++}else m=Kt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);y=e[2],l++}i=Yr(m,y)}else i=Jh[u];let h=[];for(;l<e.length;l++){let m=n.parse(e[l],l,Kt);if(!m)return null;h.push(m)}return new Kh(i,h)}evaluate(e){for(let n=0;n<this.args.length;n++){let i=this.args[n].evaluate(e);if(!Js(this.type,gr(i)))return i;if(n===this.args.length-1)throw new hr(`Expected value to be of type ${Mn(this.type)}, but found ${Mn(gr(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){n.push(i.kind);let l=e.N;(typeof l=="number"||this.args.length>1)&&n.push(l)}}return n.concat(this.args.map(i=>i.serialize()))}}var Yi=Kh;class Pl{constructor(e){this.type=ss,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[1];if(!Array.isArray(i)&&typeof i=="object")return n.error("First argument must be an image or text section.");let l=[],u=!1;for(let h=1;h<=e.length-1;++h){let m=e[h];if(u&&typeof m=="object"&&!Array.isArray(m)){u=!1;let y=null;if(m["font-scale"]&&(y=n.parse(m["font-scale"],1,Pe),!y))return null;let x=null;if(m["text-font"]&&(x=n.parse(m["text-font"],1,Yr(tn)),!x))return null;let w=null;if(m["text-color"]&&(w=n.parse(m["text-color"],1,Mi),!w))return null;let T=l[l.length-1];T.scale=y,T.font=x,T.textColor=w}else{let y=n.parse(e[h],1,Kt);if(!y)return null;let x=y.type.kind;if(x!=="string"&&x!=="value"&&x!=="null"&&x!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,l.push({content:y,scale:null,font:null,textColor:null})}}return new Pl(l)}evaluate(e){return new Kr(this.sections.map(n=>{let i=n.content.evaluate(e);return gr(i)===Al?new Qs("",i,null,null,null):new Qs(Rl(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class Ol{constructor(e,n){this.type=Al,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let i=n.parse(e[1],1,tn);if(!i)return n.error("No image name provided.");if(e.length===2)return new Ol(i);let l=n.parse(e[2],1,tn);return l?new Ol(i,l):n.error("Secondary image variant is not a string.")}evaluate(e){let n=Si.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function dn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let Zy={"to-boolean":sn,"to-color":Mi,"to-number":Pe,"to-string":tn};class Qc{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[0],l=[],u=Xs;if(i==="to-array"){if(!Array.isArray(e[1]))return null;let h=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);u=Yr(n.expectedType.itemType,h)}else{if(!(h>0&&za(e[1][0])))return null;u=Yr(gr(e[1][0]),h)}for(let m=0;m<h;m++){let y=e[1][m],x;if(dn(y)==="array")x=n.parse(y,void 0,u.itemType);else{let w=dn(y);if(w!==u.itemType.kind)return n.error(`Expected ${u.itemType.kind} but found ${w}.`);x=n.registry.literal.parse(["literal",y===void 0?null:y],n)}if(!x)return null;l.push(x)}}else{if((i==="to-boolean"||i==="to-string")&&e.length!==2)return n.error("Expected one argument.");u=Zy[i];for(let h=1;h<e.length;h++){let m=n.parse(e[h],h,Kt);if(!m)return null;l.push(m)}}return new Qc(u,l)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,i;for(let l of this.args){if(n=l.evaluate(e),i=null,n instanceof Vn)return n;if(typeof n=="string"){let u=e.parseColor(n);if(u)return u}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Pp(n[0],n[1],n[2],n[3]),!i))return new Vn(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new hr(i||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let i of this.args){if(n=i.evaluate(e),n===null)return 0;let l=Number(n);if(!isNaN(l))return l}throw new hr(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?Kr.fromString(Rl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Si.fromString(Rl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):Rl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Pl([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ol(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var as=Qc;let Op=["Unknown","Point","LineString","Polygon"];var Qh=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Op[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Vn.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class ls{constructor(e,n,i,l,u){this.name=e,this.type=n,this._evaluate=i,this.args=l,this._overloadIndex=u}evaluate(e){if(!this._evaluate){let n=ls.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let i=e[0],l=ls.definitions[i];if(!l)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);let u=Array.isArray(l)?l[0]:l.type,h=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,m=[],y=null,x=-1;for(let[w,T]of h){if(Array.isArray(w)&&w.length!==e.length-1)continue;m.push(w),x++,y=new pd(n.registry,n.path,null,n.scope,void 0,n._scope,n.options);let D=[],S=!1;for(let A=1;A<e.length;A++){let P=e[A],k=Array.isArray(w)?w[A-1]:w.type,N=y.parse(P,1+D.length,k);if(!N){S=!0;break}D.push(N)}if(!S)if(Array.isArray(w)&&w.length!==D.length)y.error(`Expected ${w.length} arguments, but found ${D.length} instead.`);else{for(let A=0;A<D.length;A++){let P=Array.isArray(w)?w[A]:w.type,k=D[A];y.concat(A+1).checkSubtype(P,k.type)}if(y.errors.length===0)return new ls(i,u,T,D,x)}}if(m.length===1)n.errors.push(...y.errors);else{let w=(m.length?m:h.map(([D])=>D)).map(kp).join(" | "),T=[];for(let D=1;D<e.length;D++){let S=n.parse(e[D],1+T.length);if(!S)return null;T.push(Mn(S.type))}n.error(`Expected arguments of type ${w}, but found (${T.join(", ")}) instead.`)}return null}static register(e,n){ls.definitions=n;for(let i in n)e[i]=ls}}function kp(t){return Array.isArray(t)?`(${t.map(Mn).join(", ")})`:`(${Mn(t.type)}...)`}var Ji=ls;class kl{constructor(e,n,i){this.type=Ys,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let i=e[1];if(typeof i!="object"||Array.isArray(i))return n.error("Collator options argument must be an object.");let l=n.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,sn);if(!l)return null;let u=n.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,sn);if(!u)return null;let h=null;return i.locale&&(h=n.parse(i.locale,1,tn),!h)?null:new kl(l,u,h)}evaluate(e){return new Xh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var ed={exports:{}};ed.exports=function(){function t(i,l,u,h,m){for(;h>u;){if(h-u>600){var y=h-u+1,x=l-u+1,w=Math.log(y),T=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*T*(y-T)/y)*(x-y/2<0?-1:1);t(i,l,Math.max(u,Math.floor(l-x*T/y+D)),Math.min(h,Math.floor(l+(y-x)*T/y+D)),m)}var S=i[l],A=u,P=h;for(e(i,u,l),m(i[h],S)>0&&e(i,u,h);A<P;){for(e(i,A,P),A++,P--;m(i[A],S)<0;)A++;for(;m(i[P],S)>0;)P--}m(i[u],S)===0?e(i,u,P):e(i,++P,h),P<=l&&(u=P+1),l<=P&&(h=P-1)}}function e(i,l,u){var h=i[l];i[l]=i[u],i[u]=h}function n(i,l){return i<l?-1:i>l?1:0}return function(i,l,u,h,m){t(i,l,u||0,h||i.length-1,m||n)}}();var Lp=St(ed.exports);function eu(t){let e=0;for(let n,i,l=0,u=t.length,h=u-1;l<u;h=l++)n=t[l],i=t[h],e+=(i.x-n.x)*(n.y+i.y);return e}function cs(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function us(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fp(t,e,n){let i=t[0]-e[0],l=t[1]-e[1],u=t[0]-n[0],h=t[1]-n[1];return i*h-u*l==0&&i*u<=0&&l*h<=0}function ea(t,e,n=!1){let i=!1;for(let m=0,y=e.length;m<y;m++){let x=e[m];for(let w=0,T=x.length,D=T-1;w<T;D=w++){let S=x[D],A=x[w];if(Fp(t,S,A))return n;(u=S)[1]>(l=t)[1]!=(h=A)[1]>l[1]&&l[0]<(h[0]-u[0])*(l[1]-u[1])/(h[1]-u[1])+u[0]&&(i=!i)}}var l,u,h;return i}function td(t,e,n,i){let l=i[0]-n[0],u=i[1]-n[1],h=(t[0]-n[0])*u-l*(t[1]-n[1]),m=(e[0]-n[0])*u-l*(e[1]-n[1]);return h>0&&m<0||h<0&&m>0}function ko(t,e,n,i){return(l=[i[0]-n[0],i[1]-n[1]])[0]*(u=[e[0]-t[0],e[1]-t[1]])[1]-l[1]*u[0]!=0&&!(!td(t,e,n,i)||!td(n,i,t,e));var l,u}let Yt=8192;function Xy(t,e){let n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,l=Math.pow(2,e.z);return[Math.round(n*l*Yt),Math.round(i*l*Yt)]}function Yy(t,e){for(let n=0;n<e.length;n++)if(ea(t,e[n]))return!0;return!1}function Jy(t,e,n){for(let i of n)for(let l=0,u=i.length,h=u-1;l<u;h=l++)if(ko(t,e,i[h],i[l]))return!0;return!1}function nd(t,e){for(let n=0;n<t.length;++n)if(!ea(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Jy(t[n],t[n+1],e))return!1;return!0}function Ky(t,e){for(let n=0;n<e.length;n++)if(nd(t,e[n]))return!0;return!1}function tu(t,e,n){let i=[];for(let l=0;l<t.length;l++){let u=[];for(let h=0;h<t[l].length;h++){let m=Xy(t[l][h],n);cs(e,m),u.push(m)}i.push(u)}return i}function rd(t,e,n){let i=[];for(let l=0;l<t.length;l++){let u=tu(t[l],e,n);i.push(u)}return i}function id(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){let l=.5*i,u=t[0]-n[0]>l?-i:n[0]-t[0]>l?i:0;u===0&&(u=t[0]-n[2]>l?-i:n[2]-t[0]>l?i:0),t[0]+=u}cs(e,t)}function ta(t,e,n,i){let l=Math.pow(2,i.z)*Yt,u=[i.x*Yt,i.y*Yt],h=[];if(!t)return h;for(let m of t)for(let y of m){let x=[y.x+u[0],y.y+u[1]];id(x,e,n,l),h.push(x)}return h}function od(t,e,n,i){let l=Math.pow(2,i.z)*Yt,u=[i.x*Yt,i.y*Yt],h=[];if(!t)return h;for(let y of t){let x=[];for(let w of y){let T=[w.x+u[0],w.y+u[1]];cs(e,T),x.push(T)}h.push(x)}if(e[2]-e[0]<=l/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(let y of h)for(let x of y)id(x,e,n,l)}var m;return h}class fo{constructor(e,n){this.type=sn,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(za(e[1])){let i=e[1];if(i.type==="FeatureCollection")for(let l=0;l<i.features.length;++l){let u=i.features[l].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new fo(i,i.features[l].geometry)}else if(i.type==="Feature"){let l=i.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new fo(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new fo(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,i){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(i.type==="Polygon"){let m=tu(i.coordinates,u,h),y=ta(n.geometry(),l,u,h);if(!us(l,u))return!1;for(let x of y)if(!ea(x,m))return!1}if(i.type==="MultiPolygon"){let m=rd(i.coordinates,u,h),y=ta(n.geometry(),l,u,h);if(!us(l,u))return!1;for(let x of y)if(!Yy(x,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,i){let l=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=n.canonicalID();if(!h)return!1;if(i.type==="Polygon"){let m=tu(i.coordinates,u,h),y=od(n.geometry(),l,u,h);if(!us(l,u))return!1;for(let x of y)if(!nd(x,m))return!1}if(i.type==="MultiPolygon"){let m=rd(i.coordinates,u,h),y=od(n.geometry(),l,u,h);if(!us(l,u))return!1;for(let x of y)if(!Ky(x,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var nu=fo,sd={exports:{}};sd.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),i=Math.PI/180,l=function(x,w){if(x===void 0)throw new Error("No latitude given.");if(w&&!t[w])throw new Error("Unknown unit "+w+". Use one of: "+Object.keys(t).join(", "));var T=6378.137*i*(w?t[w]:1),D=Math.cos(x*i),S=1/(1-n*(1-D*D)),A=Math.sqrt(S);this.kx=T*A*D,this.ky=T*A*S*(1-n)},u={units:{configurable:!0}};function h(x,w){return x[0]===w[0]&&x[1]===w[1]}function m(x,w,T){var D=y(w[0]-x[0]);return[x[0]+D*T,x[1]+(w[1]-x[1])*T]}function y(x){for(;x<-180;)x+=360;for(;x>180;)x-=360;return x}return l.fromTile=function(x,w,T){var D=Math.PI*(1-2*(x+.5)/Math.pow(2,w)),S=Math.atan(.5*(Math.exp(D)-Math.exp(-D)))/i;return new l(S,T)},u.units.get=function(){return t},l.prototype.distance=function(x,w){var T=y(x[0]-w[0])*this.kx,D=(x[1]-w[1])*this.ky;return Math.sqrt(T*T+D*D)},l.prototype.bearing=function(x,w){var T=y(w[0]-x[0])*this.kx;return Math.atan2(T,(w[1]-x[1])*this.ky)/i},l.prototype.destination=function(x,w,T){var D=T*i;return this.offset(x,Math.sin(D)*w,Math.cos(D)*w)},l.prototype.offset=function(x,w,T){return[x[0]+w/this.kx,x[1]+T/this.ky]},l.prototype.lineDistance=function(x){for(var w=0,T=0;T<x.length-1;T++)w+=this.distance(x[T],x[T+1]);return w},l.prototype.area=function(x){for(var w=0,T=0;T<x.length;T++)for(var D=x[T],S=0,A=D.length,P=A-1;S<A;P=S++)w+=y(D[S][0]-D[P][0])*(D[S][1]+D[P][1])*(T?-1:1);return Math.abs(w)/2*this.kx*this.ky},l.prototype.along=function(x,w){var T=0;if(w<=0)return x[0];for(var D=0;D<x.length-1;D++){var S=x[D],A=x[D+1],P=this.distance(S,A);if((T+=P)>w)return m(S,A,(w-(T-P))/P)}return x[x.length-1]},l.prototype.pointToSegmentDistance=function(x,w,T){var D=w[0],S=w[1],A=y(T[0]-D)*this.kx,P=(T[1]-S)*this.ky,k=0;return A===0&&P===0||((k=(y(x[0]-D)*this.kx*A+(x[1]-S)*this.ky*P)/(A*A+P*P))>1?(D=T[0],S=T[1]):k>0&&(D+=A/this.kx*k,S+=P/this.ky*k)),A=y(x[0]-D)*this.kx,P=(x[1]-S)*this.ky,Math.sqrt(A*A+P*P)},l.prototype.pointOnLine=function(x,w){for(var T,D,S,A,P=1/0,k=0;k<x.length-1;k++){var N=x[k][0],H=x[k][1],q=y(x[k+1][0]-N)*this.kx,Z=(x[k+1][1]-H)*this.ky,K=0;q===0&&Z===0||((K=(y(w[0]-N)*this.kx*q+(w[1]-H)*this.ky*Z)/(q*q+Z*Z))>1?(N=x[k+1][0],H=x[k+1][1]):K>0&&(N+=q/this.kx*K,H+=Z/this.ky*K));var ee=(q=y(w[0]-N)*this.kx)*q+(Z=(w[1]-H)*this.ky)*Z;ee<P&&(P=ee,T=N,D=H,S=k,A=K)}return{point:[T,D],index:S,t:Math.max(0,Math.min(1,A))}},l.prototype.lineSlice=function(x,w,T){var D=this.pointOnLine(T,x),S=this.pointOnLine(T,w);if(D.index>S.index||D.index===S.index&&D.t>S.t){var A=D;D=S,S=A}var P=[D.point],k=D.index+1,N=S.index;!h(T[k],P[0])&&k<=N&&P.push(T[k]);for(var H=k+1;H<=N;H++)P.push(T[H]);return h(T[N],S.point)||P.push(S.point),P},l.prototype.lineSliceAlong=function(x,w,T){for(var D=0,S=[],A=0;A<T.length-1;A++){var P=T[A],k=T[A+1],N=this.distance(P,k);if((D+=N)>x&&S.length===0&&S.push(m(P,k,(x-(D-N))/N)),D>=w)return S.push(m(P,k,(w-(D-N))/N)),S;D>x&&S.push(k)}return S},l.prototype.bufferPoint=function(x,w){var T=w/this.ky,D=w/this.kx;return[x[0]-D,x[1]-T,x[0]+D,x[1]+T]},l.prototype.bufferBBox=function(x,w){var T=w/this.ky,D=w/this.kx;return[x[0]-D,x[1]-T,x[2]+D,x[3]+T]},l.prototype.insideBBox=function(x,w){return y(x[0]-w[0])>=0&&y(x[0]-w[2])<=0&&x[1]>=w[1]&&x[1]<=w[3]},Object.defineProperties(l,u),l}();var ad=St(sd.exports),ru={exports:{}};ru.exports=function(){var t=function(n,i){if(n===void 0&&(n=[]),i===void 0&&(i=e),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var l=(this.length>>1)-1;l>=0;l--)this._down(l)};function e(n,i){return n<i?-1:n>i?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var i=this.data,l=this.compare,u=i[n];n>0;){var h=n-1>>1,m=i[h];if(l(u,m)>=0)break;i[n]=m,n=h}i[n]=u},t.prototype._down=function(n){for(var i=this.data,l=this.compare,u=this.length>>1,h=i[n];n<u;){var m=1+(n<<1),y=i[m],x=m+1;if(x<this.length&&l(i[x],y)<0&&(m=x,y=i[x]),l(y,h)>=0)break;i[n]=y,n=m}i[n]=h},t}();var iu=St(ru.exports),Ze=8192;function Np(t,e){return e.dist-t.dist}let ou=100,ld=50;function zp(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function su(t){return t[1]-t[0]+1}function Lo(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function au(t,e){if(t[0]>t[1])return[null,null];let n=su(t);if(e){if(n===2)return[t,null];let i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(n===1)return[t,null];let i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function hs(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!Lo(e,t.length))return n;for(let i=e[0];i<=e[1];++i)cs(n,t[i]);return n}function lu(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)cs(e,t[n][i]);return e}function na(t,e,n){if(zp(t)||zp(e))return NaN;let i=0,l=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(l=t[1]-e[3]),t[3]<e[1]&&(l=e[1]-t[3]),n.distance([0,0],[i,l])}function cd(t,e){let n=Math.pow(2,e.z);return[(l=(t.x/Ze+e.x)/n,360*l-180),(i=(t.y/Ze+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,l}function Qy(t,e){let n=[];for(let i=0;i<t.length;++i)n.push(cd(t[i],e));return n}function ud(t,e,n){let i=n.pointOnLine(e,t).point;return n.distance(t,i)}function hd(t,e,n,i,l){let u=n.slice(i[0],i[1]+1),h=1/0;for(let m=e[0];m<=e[1];++m)if((h=Math.min(h,ud(t[m],u,l)))===0)return 0;return h}function dd(t,e,n,i,l){let u=Math.min(l.pointToSegmentDistance(t,n,i),l.pointToSegmentDistance(e,n,i)),h=Math.min(l.pointToSegmentDistance(n,t,e),l.pointToSegmentDistance(i,t,e));return Math.min(u,h)}function ev(t,e,n,i,l){if(!Lo(e,t.length)||!Lo(i,n.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let m=i[0];m<i[1];++m){if(ko(t[h],t[h+1],n[m],n[m+1]))return 0;u=Math.min(u,dd(t[h],t[h+1],n[m],n[m+1],l))}return u}function tv(t,e,n,i,l){if(!Lo(e,t.length)||!Lo(i,n.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let m=i[0];m<=i[1];++m)if((u=Math.min(u,l.distance(t[h],n[m])))===0)return u;return u}function Bp(t,e,n){if(ea(t,e,!0))return 0;let i=1/0;for(let l of e){let u=l.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(l[0]!==l[u-1]&&(i=Math.min(i,n.pointToSegmentDistance(t,l[u-1],l[0])))===0||(i=Math.min(i,ud(t,l,n)))===0)return i}return i}function nv(t,e,n,i){if(!Lo(e,t.length))return NaN;for(let u=e[0];u<=e[1];++u)if(ea(t[u],n,!0))return 0;let l=1/0;for(let u=e[0];u<e[1];++u)for(let h of n)for(let m=0,y=h.length,x=y-1;m<y;x=m++){if(ko(t[u],t[u+1],h[x],h[m]))return 0;l=Math.min(l,dd(t[u],t[u+1],h[x],h[m],i))}return l}function jp(t,e){for(let n of t)for(let i=0;i<=n.length-1;++i)if(ea(n[i],e,!0))return!0;return!1}function Vp(t,e,n,i=1/0){let l=lu(t),u=lu(e);if(i!==1/0&&na(l,u,n)>=i)return i;if(us(l,u)){if(jp(t,e))return 0}else if(jp(e,t))return 0;let h=i;for(let m of t)for(let y=0,x=m.length,w=x-1;y<x;w=y++)for(let T of e)for(let D=0,S=T.length,A=S-1;D<S;A=D++){if(ko(m[w],m[y],T[A],T[D]))return 0;h=Math.min(h,dd(m[w],m[y],T[A],T[D],n))}return h}function cu(t,e,n,i,l,u,h){if(u===null||h===null)return;let m=na(hs(i,u),hs(l,h),n);m<e&&t.push({dist:m,range1:u,range2:h})}function rv(t,e,n,i,l=1/0){let u=Math.min(i.distance(t[0],n[0][0]),l);if(u===0)return u;let h=new iu([{dist:0,range1:[0,t.length-1],range2:[0,0]}],Np),m=e?ld:ou,y=lu(n);for(;h.length;){let x=h.pop();if(x.dist>=u)continue;let w=x.range1;if(su(w)<=m){if(!Lo(w,t.length))return NaN;if(e){let T=nv(t,w,n,i);if((u=Math.min(u,T))===0)return u}else for(let T=w[0];T<=w[1];++T){let D=Bp(t[T],n,i);if((u=Math.min(u,D))===0)return u}}else{let T=au(w,e);if(T[0]!==null){let D=na(hs(t,T[0]),y,i);D<u&&h.push({dist:D,range1:T[0],range2:[0,0]})}if(T[1]!==null){let D=na(hs(t,T[1]),y,i);D<u&&h.push({dist:D,range1:T[1],range2:[0,0]})}}}return u}function Up(t,e,n,i,l,u=1/0){let h=Math.min(u,l.distance(t[0],n[0]));if(h===0)return h;let m=new iu([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],Np),y=e?ld:ou,x=i?ld:ou;for(;m.length;){let w=m.pop();if(w.dist>=h)continue;let T=w.range1,D=w.range2;if(su(T)<=y&&su(D)<=x){if(!Lo(T,t.length)||!Lo(D,n.length))return NaN;if(e&&i?h=Math.min(h,ev(t,T,n,D,l)):e||i?e&&!i?h=Math.min(h,hd(n,D,t,T,l)):!e&&i&&(h=Math.min(h,hd(t,T,n,D,l))):h=Math.min(h,tv(t,T,n,D,l)),h===0)return h}else{let S=au(T,e),A=au(D,i);cu(m,h,l,t,n,S[0],A[0]),cu(m,h,l,t,n,S[0],A[1]),cu(m,h,l,t,n,S[1],A[0]),cu(m,h,l,t,n,S[1],A[1])}}return h}function uu(t,e,n,i,l=1/0){let u=l,h=hs(t,[0,t.length-1]);for(let m of n)if(!(u!==1/0&&na(h,hs(m,[0,m.length-1]),i)>=u)&&(u=Math.min(u,Up(t,e,m,!0,i,u)),u===0))return u;return u}function Ll(t,e,n,i,l=1/0){let u=l,h=hs(t,[0,t.length-1]);for(let m of n){if(u!==1/0&&na(h,lu(m),i)>=u)continue;let y=rv(t,e,m,i,u);if(isNaN(y))return y;if((u=Math.min(u,y))===0)return u}return u}function hu(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class Fl{constructor(e,n){this.type=Pe,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(za(e[1])){let i=e[1];if(i.type==="FeatureCollection"){for(let l=0;l<i.features.length;++l)if(hu(i.features[l].geometry.type))return new Fl(i,i.features[l].geometry)}else if(i.type==="Feature"){if(hu(i.geometry.type))return new Fl(i,i.geometry)}else if(hu(i.type))return new Fl(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),i=e.canonicalID();if(n!=null&&i!=null){if(e.geometryType()==="Point")return function(l,u,h){let m=[];for(let x of l)for(let w of x)m.push(cd(w,u));let y=new ad(m[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Up(m,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?uu(m,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?Ll(m,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(n,i,this.geometries);if(e.geometryType()==="LineString")return function(l,u,h){let m=[];for(let x of l){let w=[];for(let T of x)w.push(cd(T,u));m.push(w)}let y=new ad(m[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return uu(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",m,y);if(h.type==="MultiLineString"){let x=1/0;for(let w=0;w<h.coordinates.length;w++){let T=uu(h.coordinates[w],!0,m,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}if(h.type==="Polygon"||h.type==="MultiPolygon"){let x=1/0;for(let w=0;w<m.length;w++){let T=Ll(m[w],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}return null}(n,i,this.geometries);if(e.geometryType()==="Polygon")return function(l,u,h){let m=[];for(let x of function(w,T){let D=w.length;if(D<=1)return[w];let S=[],A,P;for(let k=0;k<D;k++){let N=eu(w[k]);N!==0&&(w[k].area=Math.abs(N),P===void 0&&(P=N<0),P===N<0?(A&&S.push(A),A=[w[k]]):A.push(w[k]))}return A&&S.push(A),S}(l)){let w=[];for(let T=0;T<x.length;++T)w.push(Qy(x[T],u));m.push(w)}let y=new ad(m[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return Ll(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",m,y);if(h.type==="MultiLineString"){let x=1/0;for(let w=0;w<h.coordinates.length;w++){let T=Ll(h.coordinates[w],!0,m,y,x);if(isNaN(T))return T;if((x=Math.min(x,T))===0)return x}return x}return h.type==="Polygon"||h.type==="MultiPolygon"?function(x,w,T){let D=1/0;for(let S of x)for(let A of w){let P=Vp(S,A,T,D);if(isNaN(P))return P;if((D=Math.min(D,P))===0)return D}return D}(h.type==="Polygon"?[h.coordinates]:h.coordinates,m,y):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var fd=Fl;function ja(t){if(t instanceof Ji&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof nu||t instanceof fd)return!1;let e=!0;return t.eachChild(n=>{e&&!ja(n)&&(e=!1)}),e}function Nr(t){if(t instanceof Ji&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!Nr(n)&&(e=!1)}),e}function Nl(t){if(t instanceof Ji&&t.name==="config")return!1;let e=!0;return t.eachChild(n=>{e&&!Nl(n)&&(e=!1)}),e}function ra(t,e){if(t instanceof Ji&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!ra(i,e)&&(n=!1)}),n}class du{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let i=e[1];return n.scope.has(i)?new du(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var $p=du;class Va{constructor(e,n=[],i,l=new qy,u=[],h,m){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=l,this.errors=u,this.expectedType=i,this._scope=h,this.options=m}parse(e,n,i,l,u={}){return n||i?this.concat(n,i,l)._parse(e,u):this._parse(e,u)}_parse(e,n){function i(l,u,h){return h==="assert"?new Yi(u,[l]):h==="coerce"?new as(u,[l]):l}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let l=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(l){let u=l.parse(e,this);if(!u)return null;if(this.expectedType){let h=this.expectedType,m=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||m.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(h,m))return null}else u=i(u,h,n.typeAnnotation||"coerce");else u=i(u,h,n.typeAnnotation||"assert")}if(!(u instanceof Ba)&&u.type.kind!=="resolvedImage"&&fu(u)){let h=new Qh(this._scope,this.options);try{u=new Ba(u.type,u.evaluate(h))}catch(m){return this.error(m.message),null}}return u}return as.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){let l=typeof e=="number"?this.path.concat(e):this.path,u=i?this.scope.concat(i):this.scope;return new Va(this.registry,l,n||null,u,this.errors,this._scope,this.options)}error(e,...n){let i=`${this.key}${n.map(l=>`[${l}]`).join("")}`;this.errors.push(new Xi(i,e))}checkSubtype(e,n){let i=Js(e,n);return i&&this.error(i),i}}var pd=Va;function fu(t){if(t instanceof $p)return fu(t.boundExpression);if(t instanceof Ji&&t.name==="error"||t instanceof Ji&&t.name==="config"||t instanceof kl||t instanceof nu||t instanceof fd)return!1;let e=t instanceof as||t instanceof Yi,n=!0;return t.eachChild(i=>{n=e?n&&fu(i):n&&i instanceof Ba}),!!n&&ja(t)&&ra(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function pu(t,e){let n=t.length-1,i,l,u=0,h=n,m=0;for(;u<=h;)if(m=Math.floor((u+h)/2),i=t[m],l=t[m+1],i<=e){if(m===n||e<l)return m;u=m+1}else{if(!(i>e))throw new hr("Input is not a number.");h=m-1}return 0}class md{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[l,u]of i)this.labels.push(l),this.outputs.push(u)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let i=n.parse(e[1],1,Pe);if(!i)return null;let l=[],u=null;n.expectedType&&n.expectedType.kind!=="value"&&(u=n.expectedType);for(let h=1;h<e.length;h+=2){let m=h===1?-1/0:e[h],y=e[h+1],x=h,w=h+1;if(typeof m!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',x);if(l.length&&l[l.length-1][0]>=m)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',x);let T=n.parse(y,w,u);if(!T)return null;u=u||T.type,l.push([m,T])}return new md(u,i,l)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return i[0].evaluate(e);let u=n.length;return l>=n[u-1]?i[u-1].evaluate(e):i[pu(n,l)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var gd=md;function Wt(t,e,n){return t*(1-n)+e*n}function mu(t,e,n){return t.map((i,l)=>Wt(i,e[l],n))}var zl=Object.freeze({__proto__:null,array:mu,color:function(t,e,n){return new Vn(Wt(t.r,e.r,n),Wt(t.g,e.g,n),Wt(t.b,e.b,n),Wt(t.a,e.a,n))},number:Wt});let Bl=.95047,ia=1.08883,Gp=4/29,Ua=6/29,Hp=3*Ua*Ua,iv=Ua*Ua*Ua,ov=Math.PI/180,sv=180/Math.PI;function _d(t){return t>iv?Math.pow(t,1/3):t/Hp+Gp}function yd(t){return t>Ua?t*t*t:Hp*(t-Gp)}function vd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function xd(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function qp(t){let e=xd(t.r),n=xd(t.g),i=xd(t.b),l=_d((.4124564*e+.3575761*n+.1804375*i)/Bl),u=_d((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*u-16,a:500*(l-u),b:200*(u-_d((.0193339*e+.119192*n+.9503041*i)/ia)),alpha:t.a}}function oa(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*yd(e),n=Bl*yd(n),i=ia*yd(i),new Vn(vd(3.2404542*n-1.5371385*e-.4985314*i),vd(-.969266*n+1.8760108*e+.041556*i),vd(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function Wp(t,e,n){let i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}let $a={forward:qp,reverse:oa,interpolate:function(t,e,n){return{l:Wt(t.l,e.l,n),a:Wt(t.a,e.a,n),b:Wt(t.b,e.b,n),alpha:Wt(t.alpha,e.alpha,n)}}},ds={forward:function(t){let{l:e,a:n,b:i}=qp(t),l=Math.atan2(i,n)*sv;return{h:l<0?l+360:l,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){let e=t.h*ov,n=t.c;return oa({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Wp(t.h,e.h,n),c:Wt(t.c,e.c,n),l:Wt(t.l,e.l,n),alpha:Wt(t.alpha,e.alpha,n)}}};var Zp=Object.freeze({__proto__:null,hcl:ds,lab:$a});class gu{constructor(e,n,i,l,u){this.type=e,this.operator=n,this.interpolation=i,this.input=l,this.labels=[],this.outputs=[];for(let[h,m]of u)this.labels.push(h),this.outputs.push(m)}static interpolationFactor(e,n,i,l){let u=0;if(e.name==="exponential")u=po(n,e.base,i,l);else if(e.name==="linear")u=po(n,1,i,l);else if(e.name==="cubic-bezier"){let h=e.controlPoints;u=new An(h[0],h[1],h[2],h[3]).solve(po(n,1,i,l))}return u}static parse(e,n){let[i,l,u,...h]=e;if(!Array.isArray(l)||l.length===0)return n.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){let x=l[1];if(typeof x!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:x}}else{if(l[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(l[0])}`,1,0);{let x=l.slice(1);if(x.length!==4||x.some(w=>typeof w!="number"||w<0||w>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:x}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(u=n.parse(u,2,Pe),!u)return null;let m=[],y=null;i==="interpolate-hcl"||i==="interpolate-lab"?y=Mi:n.expectedType&&n.expectedType.kind!=="value"&&(y=n.expectedType);for(let x=0;x<h.length;x+=2){let w=h[x],T=h[x+1],D=x+3,S=x+4;if(typeof w!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(m.length&&m[m.length-1][0]>=w)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);let A=n.parse(T,S,y);if(!A)return null;y=y||A.type,m.push([w,A])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new gu(y,i,l,u,m):n.error(`Type ${Mn(y)} is not interpolatable.`)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let l=this.input.evaluate(e);if(l<=n[0])return i[0].evaluate(e);let u=n.length;if(l>=n[u-1])return i[u-1].evaluate(e);let h=pu(n,l),m=gu.interpolationFactor(this.interpolation,l,n[h],n[h+1]),y=i[h].evaluate(e),x=i[h+1].evaluate(e);return this.operator==="interpolate"?zl[this.type.kind.toLowerCase()](y,x,m):this.operator==="interpolate-hcl"?ds.reverse(ds.interpolate(ds.forward(y),ds.forward(x),m)):$a.reverse($a.interpolate($a.forward(y),$a.forward(x),m))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function po(t,e,n,i){let l=i-n,u=t-n;return l===0?0:e===1?u/l:(Math.pow(e,u)-1)/(Math.pow(e,l)-1)}var Ki=gu;class fs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null,l=n.expectedType;l&&l.kind!=="value"&&(i=l);let u=[];for(let m of e.slice(1)){let y=n.parse(m,1+u.length,i,void 0,{typeAnnotation:"omit"});if(!y)return null;i=i||y.type,u.push(y)}let h=l&&u.some(m=>Js(l,m.type));return new fs(h?Kt:i,u)}evaluate(e){let n,i=null,l=0;for(let u of this.args){if(l++,i=u.evaluate(e),i&&i instanceof Si&&!i.available&&(n||(n=i),i=null,l===this.args.length))return n;if(i!==null)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Xp=fs;class bd{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let i=[];for(let u=1;u<e.length-1;u+=2){let h=e[u];if(typeof h!="string")return n.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return n.error("Variable names must contain only alphanumeric characters or '_'.",u);let m=n.parse(e[u+1],u+1);if(!m)return null;i.push([h,m])}let l=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return l?new bd(i,l):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}var Yp=bd;class wd{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Pe),l=n.parse(e[2],2,Yr(n.expectedType||Kt));return i&&l?new wd(l.type.itemType,i,l):null}evaluate(e){let n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new hr(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new hr(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new hr(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var av=wd;class _u{constructor(e,n){this.type=sn,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Kt),l=n.parse(e[2],2,Kt);return i&&l?qh(i.type,[sn,tn,Pe,Xs,Kt])?new _u(i,l):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(i.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!Ks(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(gr(n))} instead.`);if(!Ks(i,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${Mn(gr(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ed=_u;class sa{constructor(e,n,i){this.type=Pe,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Kt),l=n.parse(e[2],2,Kt);if(!i||!l)return null;if(!qh(i.type,[sn,tn,Pe,Xs,Kt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(i.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,Pe);return u?new sa(i,l,u):null}return new sa(i,l)}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!Ks(n,["boolean","string","number","null"]))throw new hr(`Expected first argument to be of type boolean, string, number or null, but found ${Mn(gr(n))} instead.`);if(!Ks(i,["string","array"]))throw new hr(`Expected second argument to be of type array or string, but found ${Mn(gr(i))} instead.`);if(this.fromIndex){let l=this.fromIndex.evaluate(e);return i.indexOf(n,l)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Jp=sa;class jl{constructor(e,n,i,l,u,h){this.inputType=e,this.type=n,this.input=i,this.cases=l,this.outputs=u,this.otherwise=h}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,l;n.expectedType&&n.expectedType.kind!=="value"&&(l=n.expectedType);let u={},h=[];for(let x=2;x<e.length-1;x+=2){let w=e[x],T=e[x+1];Array.isArray(w)||(w=[w]);let D=n.concat(x);if(w.length===0)return D.error("Expected at least one branch label.");for(let A of w){if(typeof A!="number"&&typeof A!="string")return D.error("Branch labels must be numbers or strings.");if(typeof A=="number"&&Math.abs(A)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof A=="number"&&Math.floor(A)!==A)return D.error("Numeric branch labels must be integer values.");if(i){if(D.checkSubtype(i,gr(A)))return null}else i=gr(A);if(u[String(A)]!==void 0)return D.error("Branch labels must be unique.");u[String(A)]=h.length}let S=n.parse(T,x,l);if(!S)return null;l=l||S.type,h.push(S)}let m=n.parse(e[1],1,Kt);if(!m)return null;let y=n.parse(e[e.length-1],e.length-1,l);return y?m.type.kind!=="value"&&n.concat(1).checkSubtype(i,m.type)?null:new jl(i,l,m,u,h,y):null}evaluate(e){let n=this.input.evaluate(e);return(gr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],l={};for(let h of n){let m=l[this.cases[h]];m===void 0?(l[this.cases[h]]=i.length,i.push([this.cases[h],[h]])):i[m][1].push(h)}let u=h=>this.inputType.kind==="number"?Number(h):h;for(let[h,m]of i)e.push(m.length===1?u(m[0]):m.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}var lv=jl;class Ci{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);let l=[];for(let h=1;h<e.length-1;h+=2){let m=n.parse(e[h],h,sn);if(!m)return null;let y=n.parse(e[h+1],h+1,i);if(!y)return null;l.push([m,y]),i=i||y.type}let u=n.parse(e[e.length-1],e.length-1,i);return u?new Ci(i,l,u):null}evaluate(e){for(let[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var cv=Ci;class Vl{constructor(e,n,i,l){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=l}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Kt),l=n.parse(e[2],2,Pe);if(!i||!l)return null;if(!qh(i.type,[Yr(Kt),tn,Kt]))return n.error(`Expected first argument to be of type array or string, but found ${Mn(i.type)} instead`);if(e.length===4){let u=n.parse(e[3],3,Pe);return u?new Vl(i.type,i,l,u):null}return new Vl(i.type,i,l)}evaluate(e){let n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!Ks(n,["string","array"]))throw new hr(`Expected first argument to be of type array or string, but found ${Mn(gr(n))} instead.`);if(this.endIndex){let l=this.endIndex.evaluate(e);return n.slice(i,l)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var uv=Vl;function Kp(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Qp(t,e,n,i){return i.compare(e,n)===0}function Ga(t,e,n){let i=t!=="=="&&t!=="!=";return class hP{constructor(u,h,m){this.type=sn,this.lhs=u,this.rhs=h,this.collator=m,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");let m=u[0],y=h.parse(u[1],1,Kt);if(!y)return null;if(!Kp(m,y.type))return h.concat(1).error(`"${m}" comparisons are not supported for type '${Mn(y.type)}'.`);let x=h.parse(u[2],2,Kt);if(!x)return null;if(!Kp(m,x.type))return h.concat(2).error(`"${m}" comparisons are not supported for type '${Mn(x.type)}'.`);if(y.type.kind!==x.type.kind&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error(`Cannot compare types '${Mn(y.type)}' and '${Mn(x.type)}'.`);i&&(y.type.kind==="value"&&x.type.kind!=="value"?y=new Yi(x.type,[y]):y.type.kind!=="value"&&x.type.kind==="value"&&(x=new Yi(y.type,[x])));let w=null;if(u.length===4){if(y.type.kind!=="string"&&x.type.kind!=="string"&&y.type.kind!=="value"&&x.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(w=h.parse(u[3],3,Ys),!w)return null}return new hP(y,x,w)}evaluate(u){let h=this.lhs.evaluate(u),m=this.rhs.evaluate(u);if(i&&this.hasUntypedArgument){let y=gr(h),x=gr(m);if(y.kind!==x.kind||y.kind!=="string"&&y.kind!=="number")throw new hr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${y.kind}, ${x.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){let y=gr(h),x=gr(m);if(y.kind!=="string"||x.kind!=="string")return e(u,h,m)}return this.collator?n(u,h,m,this.collator.evaluate(u)):e(u,h,m)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){let u=[t];return this.eachChild(h=>{u.push(h.serialize())}),u}}}let em=Ga("==",function(t,e,n){return e===n},Qp),Td=Ga("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!Qp(0,e,n,i)}),tm=Ga("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),hv=Ga(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),hi=Ga("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),dv=Ga(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class Id{constructor(e,n,i,l,u,h){this.type=tn,this.number=e,this.locale=n,this.currency=i,this.unit=l,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let i=n.parse(e[1],1,Pe);if(!i)return null;let l=e[2];if(typeof l!="object"||Array.isArray(l))return n.error("NumberFormat options argument must be an object.");let u=null;if(l.locale&&(u=n.parse(l.locale,1,tn),!u))return null;let h=null;if(l.currency&&(h=n.parse(l.currency,1,tn),!h))return null;let m=null;if(l.unit&&(m=n.parse(l.unit,1,tn),!m))return null;let y=null;if(l["min-fraction-digits"]&&(y=n.parse(l["min-fraction-digits"],1,Pe),!y))return null;let x=null;return l["max-fraction-digits"]&&(x=n.parse(l["max-fraction-digits"],1,Pe),!x)?null:new Id(i,u,h,m,y,x)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Dd{constructor(e){this.type=Pe,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let i=n.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${Mn(i.type)} instead.`):new Dd(i):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new hr(`Expected value to be of type string or array, but found ${Mn(gr(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function Ul(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let Md={"==":em,"!=":Td,">":hv,"<":tm,">=":dv,"<=":hi,array:Yi,at:av,boolean:Yi,case:cv,coalesce:Xp,collator:kl,format:Pl,image:Ol,in:Ed,"index-of":Jp,interpolate:Ki,"interpolate-hcl":Ki,"interpolate-lab":Ki,length:Dd,let:Yp,literal:Ba,match:lv,number:Yi,"number-format":Id,object:Yi,slice:uv,step:gd,string:Yi,"to-boolean":as,"to-color":as,"to-number":as,"to-string":as,var:$p,within:nu,distance:fd};function yu(t,[e,n,i,l]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let u=l?l.evaluate(t):1,h=Pp(e,n,i,u);if(h)throw new hr(h);return new Vn(e/255*u,n/255*u,i/255*u,u)}function nm(t,[e,n,i,l]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let u=l?l.evaluate(t):1,h=function(x,w,T,D){return typeof x=="number"&&x>=0&&x<=360?typeof w=="number"&&w>=0&&w<=100&&typeof T=="number"&&T>=0&&T<=100?D===void 0||typeof D=="number"&&D>=0&&D<=1?null:`Invalid hsla value [${[x,w,T,D].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof D=="number"?[x,w,T,D]:[x,w,T]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof D=="number"?[x,w,T,D]:[x,w,T]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,i,u);if(h)throw new hr(h);let m=`hsla(${e}, ${n}%, ${i}%, ${u})`,y=Vn.parse(m);if(!y)throw new hr(`Failed to parse HSLA color: ${m}`);return y}function rm(t,e){return t in e}function aa(t,e){let n=e[t];return n===void 0?null:n}function im(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return Vn.parse(e)}return e}function om(t,e,n,i){return i!==void 0&&(t=i*Math.round(t/i)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}function Sd(t,e,n){e=[e,n,t.scope].filter(Boolean).join("");let i=t.getConfig(e);if(!i)return null;let{type:l,value:u,values:h,minValue:m,maxValue:y,stepValue:x}=i,w=i.default.evaluate(t),T=w;if(u){let D=t.scope;t.scope=(D||"").split("").slice(1).join(""),T=u.evaluate(t),t.scope=D}return l&&(T=im(l,T)),u!==void 0&&T!==void 0&&h&&!h.includes(T)&&(T=w,l&&(T=im(l,T))),T===void 0||m===void 0&&y===void 0&&x===void 0||(typeof T=="number"?T=om(T,m,y,x):Array.isArray(T)&&(T=T.map(D=>typeof D=="number"?om(D,m,y,x):D))),T}function ps(t){return{type:t}}Ji.register(Md,{error:[{kind:"error"},[tn],(t,[e])=>{throw new hr(e.evaluate(t))}],typeof:[tn,[Kt],(t,[e])=>Mn(gr(e.evaluate(t)))],"to-rgba":[Yr(Pe,4),[Mi],(t,[e])=>e.evaluate(t).toArray()],rgb:[Mi,[Pe,Pe,Pe],yu],rgba:[Mi,[Pe,Pe,Pe,Pe],yu],hsl:[Mi,[Pe,Pe,Pe],nm],hsla:[Mi,[Pe,Pe,Pe,Pe],nm],has:{type:sn,overloads:[[[tn],(t,[e])=>rm(e.evaluate(t),t.properties())],[[tn,La],(t,[e,n])=>rm(e.evaluate(t),n.evaluate(t))]]},get:{type:Kt,overloads:[[[tn],(t,[e])=>aa(e.evaluate(t),t.properties())],[[tn,La],(t,[e,n])=>aa(e.evaluate(t),n.evaluate(t))]]},config:{type:Kt,overloads:[[[tn],(t,[e])=>Sd(t,e.evaluate(t))],[[tn,tn],(t,[e,n])=>Sd(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[Kt,[tn],(t,[e])=>aa(e.evaluate(t),t.featureState||{})],properties:[La,[],t=>t.properties()],"geometry-type":[tn,[],t=>t.geometryType()],id:[Kt,[],t=>t.id()],zoom:[Pe,[],t=>t.globals.zoom],pitch:[Pe,[],t=>t.globals.pitch||0],"distance-from-center":[Pe,[],t=>t.distanceFromCenter()],"measure-light":[Pe,[tn],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Pe,[],t=>t.globals.heatmapDensity||0],"line-progress":[Pe,[],t=>t.globals.lineProgress||0],"raster-value":[Pe,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[Pe,[],t=>t.globals.skyRadialProgress||0],accumulated:[Kt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Pe,ps(Pe),(t,e)=>{let n=0;for(let i of e)n+=i.evaluate(t);return n}],"*":[Pe,ps(Pe),(t,e)=>{let n=1;for(let i of e)n*=i.evaluate(t);return n}],"-":{type:Pe,overloads:[[[Pe,Pe],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Pe],(t,[e])=>-e.evaluate(t)]]},"/":[Pe,[Pe,Pe],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Pe,[Pe,Pe],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Pe,[],()=>Math.LN2],pi:[Pe,[],()=>Math.PI],e:[Pe,[],()=>Math.E],"^":[Pe,[Pe,Pe],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Pe,[Pe],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Pe,[Pe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Pe,[Pe],(t,[e])=>Math.log(e.evaluate(t))],log2:[Pe,[Pe],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Pe,[Pe],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Pe,[Pe],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Pe,[Pe],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Pe,[Pe],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Pe,[Pe],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Pe,[Pe],(t,[e])=>Math.atan(e.evaluate(t))],min:[Pe,ps(Pe),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Pe,ps(Pe),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Pe,[Pe],(t,[e])=>Math.abs(e.evaluate(t))],round:[Pe,[Pe],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Pe,[Pe],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Pe,[Pe],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[sn,[tn,Kt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[sn,[Kt],(t,[e])=>t.id()===e.value],"filter-type-==":[sn,[tn],(t,[e])=>t.geometryType()===e.value],"filter-<":[sn,[tn,Kt],(t,[e,n])=>{let i=t.properties()[e.value],l=n.value;return typeof i==typeof l&&i<l}],"filter-id-<":[sn,[Kt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[sn,[tn,Kt],(t,[e,n])=>{let i=t.properties()[e.value],l=n.value;return typeof i==typeof l&&i>l}],"filter-id->":[sn,[Kt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[sn,[tn,Kt],(t,[e,n])=>{let i=t.properties()[e.value],l=n.value;return typeof i==typeof l&&i<=l}],"filter-id-<=":[sn,[Kt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[sn,[tn,Kt],(t,[e,n])=>{let i=t.properties()[e.value],l=n.value;return typeof i==typeof l&&i>=l}],"filter-id->=":[sn,[Kt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[sn,[Kt],(t,[e])=>e.value in t.properties()],"filter-has-id":[sn,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[sn,[Yr(tn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[sn,[Yr(Kt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[sn,[tn,Yr(Kt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[sn,[tn,Yr(Kt)],(t,[e,n])=>function(i,l,u,h){for(;u<=h;){let m=u+h>>1;if(l[m]===i)return!0;l[m]>i?h=m-1:u=m+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:sn,overloads:[[[sn,sn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[ps(sn),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:sn,overloads:[[[sn,sn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[ps(sn),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[sn,[sn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[sn,[tn],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[tn,[tn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[tn,[tn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[tn,ps(Kt),(t,e)=>e.map(n=>Rl(n.evaluate(t))).join("")],"resolved-locale":[tn,[Ys],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Pe,[Pe,Pe,Kt],(t,e)=>{let[n,i,l]=e.map(h=>h.evaluate(t));if(n>i||n===i)return n;let u;if(typeof l=="string")u=function(h){let m=0;if(h.length===0)return m;for(let y=0;y<h.length;y++)m=(m<<5)-m+h.charCodeAt(y),m&=m;return m}(l);else{if(typeof l!="number")throw new hr(`Invalid seed input: ${l}`);u=l}return n+Ul(u)()*(i-n)}]});var $l=Md;function Ai(t){return{result:"success",value:t}}function ms(t){return{result:"error",value:t}}function sm(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function gs(t){return t["property-type"]==="data-driven"}function Gl(t){return sm(t.expression,"measure-light")}function Cd(t){return sm(t.expression,"zoom")}function Ad(t){return!!t.expression&&t.expression.interpolated}function vu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function fv(t){return t}function am(t,e){let n=e.type==="color",i=t.stops&&typeof t.stops[0][0]=="object",l=i||!(i||t.property!==void 0),u=t.type||(Ad(e)?"exponential":"interval");if(n&&((t=Zi({},t)).stops&&(t.stops=t.stops.map(x=>[x[0],Vn.parse(x[1])])),t.default=Vn.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Zp[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let h,m,y;if(u==="exponential")h=Hl;else if(u==="interval")h=wi;else if(u==="categorical"){h=xu,m=Object.create(null);for(let x of t.stops)m[x[0]]=x[1];y=typeof t.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=pv}if(i){let x={},w=[];for(let S=0;S<t.stops.length;S++){let A=t.stops[S],P=A[0].zoom;x[P]===void 0&&(x[P]={zoom:P,type:t.type,property:t.property,default:t.default,stops:[]},w.push(P)),x[P].stops.push([A[0].value,A[1]])}let T=[];for(let S of w)T.push([x[S].zoom,am(x[S],e)]);let D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:Ki.interpolationFactor.bind(void 0,D),zoomStops:T.map(S=>S[0]),evaluate:({zoom:S},A)=>Hl({stops:T,base:t.base},e,S).evaluate(S,A)}}if(l){let x=u==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:x,interpolationFactor:Ki.interpolationFactor.bind(void 0,x),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>h(t,e,w,m,y)}}return{kind:"source",evaluate(x,w){let T=w&&w.properties?w.properties[t.property]:void 0;return T===void 0?_s(t.default,e.default):h(t,e,T,m,y)}}}function _s(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function xu(t,e,n,i,l){return _s(typeof n===l?i[n]:void 0,t.default,e.default)}function wi(t,e,n){if(dn(n)!=="number")return _s(t.default,e.default);let i=t.stops.length;if(i===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];let l=pu(t.stops.map(u=>u[0]),n);return t.stops[l][1]}function Hl(t,e,n){let i=t.base!==void 0?t.base:1;if(dn(n)!=="number")return _s(t.default,e.default);let l=t.stops.length;if(l===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[l-1][0])return t.stops[l-1][1];let u=pu(t.stops.map(w=>w[0]),n),h=function(w,T,D,S){let A=S-D,P=w-D;return A===0?0:T===1?P/A:(Math.pow(T,P)-1)/(Math.pow(T,A)-1)}(n,i,t.stops[u][0],t.stops[u+1][0]),m=t.stops[u][1],y=t.stops[u+1][1],x=zl[e.type]||fv;if(t.colorSpace&&t.colorSpace!=="rgb"){let w=Zp[t.colorSpace];x=(T,D)=>w.reverse(w.interpolate(w.forward(T),w.forward(D),h))}return typeof m.evaluate=="function"?{evaluate(...w){let T=m.evaluate.apply(void 0,w),D=y.evaluate.apply(void 0,w);if(T!==void 0&&D!==void 0)return x(T,D,h)}}:x(m,y,h)}function pv(t,e,n){return e.type==="color"?n=Vn.parse(n):e.type==="formatted"?n=Kr.fromString(n.toString()):e.type==="resolvedImage"?n=Si.fromString(n.toString()):dn(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),_s(n,t.default,e.default)}class Rd{constructor(e,n,i,l){this.expression=e,this._warningHistory={},this._evaluator=new Qh(i,l),this._defaultValue=n?function(u){return u.type==="color"&&(vu(u.default)||Array.isArray(u.default))?new Vn(0,0,0,0):u.type==="color"?Vn.parse(u.default)||null:u.default===void 0?null:u.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,i,l,u,h,m,y){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,l,u,h,m,y){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=l||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=y||null;try{let x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new hr(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(x)} instead.`);return x}catch(x){return this._warningHistory[x.message]||(this._warningHistory[x.message]=!0,typeof console<"u"&&console.warn(x.message)),this._defaultValue}}}function bu(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in $l}function ql(t,e,n,i){let l=new pd($l,[],e?function(h){let m={color:Mi,string:tn,number:Pe,enum:tn,boolean:sn,formatted:ss,resolvedImage:Al};return h.type==="array"?Yr(m[h.value]||Kt,h.length):m[h.type]}(e):void 0,void 0,void 0,n,i),u=l.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return u?Ai(new Rd(u,e,n,i)):ms(l.errors)}class Wl{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent=e!=="constant"&&!Nr(n.expression),this.isConfigDependent=!Nl(n.expression)}evaluateWithoutErrorHandling(e,n,i,l,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,l,u,h)}evaluate(e,n,i,l,u,h){return this._styleExpression.evaluate(e,n,i,l,u,h)}}class Zl{constructor(e,n,i,l,u){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!Nr(n.expression),this.isLightConstant=u,this.isConfigDependent=!Nl(n.expression),this.interpolationType=l}evaluateWithoutErrorHandling(e,n,i,l,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,l,u,h)}evaluate(e,n,i,l,u,h){return this._styleExpression.evaluate(e,n,i,l,u,h)}interpolationFactor(e,n,i){return this.interpolationType?Ki.interpolationFactor(this.interpolationType,e,n,i):0}}function Xl(t,e,n,i){if((t=ql(t,e,n,i)).result==="error")return t;let l=t.value.expression,u=ja(l);if(!u&&!gs(e))return ms([new Xi("","data expressions not supported")]);let h=ra(l,["zoom","pitch","distance-from-center"]);if(!h&&!Cd(e))return ms([new Xi("","zoom expressions not supported")]);let m=ra(l,["measure-light"]);if(!m&&!Gl(e))return ms([new Xi("","measure-light expression not supported")]);let y=e.expression&&e.expression.relaxZoomRestriction,x=Eu(l);return x||h||y?x instanceof Xi?ms([x]):x instanceof Ki&&!Ad(e)?ms([new Xi("",'"interpolate" expressions cannot be used with this property')]):Ai(x?new Zl(u?"camera":"composite",t.value,x.labels,x instanceof Ki?x.interpolation:void 0,m):new Wl(u?"constant":"source",t.value,m)):ms([new Xi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class wu{constructor(e,n){this._parameters=e,this._specification=n,Zi(this,am(this._parameters,this._specification))}static deserialize(e){return new wu(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Eu(t){let e=null;if(t instanceof Yp)e=Eu(t.result);else if(t instanceof Xp){for(let n of t.args)if(e=Eu(n),e)break}else(t instanceof gd||t instanceof Ki)&&t.input instanceof Ji&&t.input.name==="zoom"&&(e=t);return e instanceof Xi||t.eachChild(n=>{let i=Eu(n);i instanceof Xi?e=i:e&&i&&e!==i&&(e=new Xi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function di(t){let e=t.key,n=t.value,i=t.valueSpec||{},l=t.objectElementValidators||{},u=t.style,h=t.styleSpec,m=[],y=dn(n);if(y!=="object")return[new ut(e,n,`object expected, ${y} found`)];for(let x in n){let w=x.split(".")[0],T;l[w]?T=l[w]:i[w]?T=_r:l["*"]?T=l["*"]:i["*"]&&(T=_r),T?m=m.concat(T({key:(e&&`${e}.`)+x,value:n[x],valueSpec:i[w]||i["*"],style:u,styleSpec:h,object:n,objectKey:x},n)):m.push(new ho(e,n[x],`unknown property "${x}"`))}for(let x in i)l[x]||i[x].required&&i[x].default===void 0&&n[x]===void 0&&m.push(new ut(e,n,`missing required property "${x}"`));return m}function lm(t){let e=t.value,n=t.valueSpec,i=t.style,l=t.styleSpec,u=t.key,h=t.arrayElementValidator||_r;if(dn(e)!=="array")return[new ut(u,e,`array expected, ${dn(e)} found`)];if(n.length&&e.length!==n.length)return[new ut(u,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new ut(u,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let m={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};l.$version<7&&(m.function=n.function),dn(n.value)==="object"&&(m=n.value);let y=[];for(let x=0;x<e.length;x++)y=y.concat(h({array:e,arrayIndex:x,value:e[x],valueSpec:m,style:i,styleSpec:l,key:`${u}[${x}]`},!0));return y}function Pd(t){let e=t.key,n=t.value,i=t.valueSpec,l=dn(n);if(l==="number"&&n!=n&&(l="NaN"),l!=="number")return[new ut(e,n,`number expected, ${l} found`)];if("minimum"in i){let u=i.minimum;if(dn(i.minimum)==="array"&&(u=i.minimum[t.arrayIndex]),n<u)return[new ut(e,n,`${n} is less than the minimum value ${u}`)]}if("maximum"in i){let u=i.maximum;if(dn(i.maximum)==="array"&&(u=i.maximum[t.arrayIndex]),n>u)return[new ut(e,n,`${n} is greater than the maximum value ${u}`)]}return[]}function Od(t){let e=t.valueSpec,n=ur(t.value.type),i,l,u,h={},m=n!=="categorical"&&t.value.property===void 0,y=!m,x=dn(t.value.stops)==="array"&&dn(t.value.stops[0])==="array"&&dn(t.value.stops[0][0])==="object",w=di({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(S){if(n==="identity")return[new ut(S.key,S.value,'identity function may not have a "stops" property')];let A=[],P=S.value;return A=A.concat(lm({key:S.key,value:P,valueSpec:S.valueSpec,style:S.style,styleSpec:S.styleSpec,arrayElementValidator:T})),dn(P)==="array"&&P.length===0&&A.push(new ut(S.key,P,"array must have at least one stop")),A},default:function(S){return _r({key:S.key,value:S.value,valueSpec:e,style:S.style,styleSpec:S.styleSpec})}}});return n==="identity"&&m&&w.push(new ut(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||w.push(new ut(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!Ad(t.valueSpec)&&w.push(new ut(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(y&&!gs(t.valueSpec)?w.push(new ut(t.key,t.value,"property functions not supported")):m&&!Cd(t.valueSpec)&&w.push(new ut(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!x||t.value.property!==void 0||w.push(new ut(t.key,t.value,'"property" property is required')),w;function T(S){let A=[],P=S.value,k=S.key;if(dn(P)!=="array")return[new ut(k,P,`array expected, ${dn(P)} found`)];if(P.length!==2)return[new ut(k,P,`array length 2 expected, length ${P.length} found`)];if(x){if(dn(P[0])!=="object")return[new ut(k,P,`object expected, ${dn(P[0])} found`)];if(P[0].zoom===void 0)return[new ut(k,P,"object stop key must have zoom")];if(P[0].value===void 0)return[new ut(k,P,"object stop key must have value")];let N=ur(P[0].zoom);if(typeof N!="number")return[new ut(k,P[0].zoom,"stop zoom values must be numbers")];if(u&&u>N)return[new ut(k,P[0].zoom,"stop zoom values must appear in ascending order")];N!==u&&(u=N,l=void 0,h={}),A=A.concat(di({key:`${k}[0]`,value:P[0],valueSpec:{zoom:{}},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{zoom:Pd,value:D}}))}else A=A.concat(D({key:`${k}[0]`,value:P[0],valueSpec:{},style:S.style,styleSpec:S.styleSpec},P));return bu(Oo(P[1]))?A.concat([new ut(`${k}[1]`,P[1],"expressions are not allowed in function stops.")]):A.concat(_r({key:`${k}[1]`,value:P[1],valueSpec:e,style:S.style,styleSpec:S.styleSpec}))}function D(S,A){let P=dn(S.value),k=ur(S.value),N=S.value!==null?S.value:A;if(i){if(P!==i)return[new ut(S.key,N,`${P} stop domain type must match previous stop domain type ${i}`)]}else i=P;if(P!=="number"&&P!=="string"&&P!=="boolean"&&typeof k!="number"&&typeof k!="string"&&typeof k!="boolean")return[new ut(S.key,N,"stop domain value must be a number, string, or boolean")];if(P!=="number"&&n!=="categorical"){let H=`number expected, ${P} found`;return gs(e)&&n===void 0&&(H+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ut(S.key,N,H)]}return n!=="categorical"||P!=="number"||typeof k=="number"&&isFinite(k)&&Math.floor(k)===k?n!=="categorical"&&P==="number"&&typeof k=="number"&&typeof l=="number"&&l!==void 0&&k<l?[new ut(S.key,N,"stop domain values must appear in ascending order")]:(l=k,n==="categorical"&&k in h?[new ut(S.key,N,"stop domain values must be unique")]:(h[k]=!0,[])):[new ut(S.key,N,`integer expected, found ${String(k)}`)]}}function la(t){let e=(t.expressionContext==="property"?Xl:ql)(Oo(t.value),t.valueSpec);if(e.result==="error")return e.value.map(i=>new ut(`${t.key}${i.key}`,t.value,i.message));let n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new ut(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Nr(n))return[new ut(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return Tu(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ra(n,["zoom","feature-state"]))return[new ut(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!ja(n))return[new ut(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Tu(t,e){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let l of e.valueSpec.expression.parameters)n.delete(l);if(n.size===0)return[];let i=[];return t instanceof Ji&&n.has(t.name)?[new ut(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(l=>{i.push(...Tu(l,e))}),i)}function ca(t){let e=t.key,n=t.value,i=t.valueSpec,l=[];return Array.isArray(i.values)?i.values.indexOf(ur(n))===-1&&l.push(new ut(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(i.values).indexOf(ur(n))===-1&&l.push(new ut(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),l}function Iu(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!Iu(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Du(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Iu(t)||(t=Mu(t));let n=t,i=!0;try{i=function(x){if(!ys(x))return x;let w=Oo(x);return cm(w),w=kd(w),w}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let l=ye[`filter_${e}`],u=ql(i,l),h=null;if(u.result==="error")throw new Error(u.value.map(x=>`${x.key}: ${x.message}`).join(", "));h=(x,w,T)=>u.value.evaluate(x,w,{},T);let m=null,y=null;if(i!==n){let x=ql(n,l);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,T,D,S,A)=>x.value.evaluate(w,T,{},D,void 0,void 0,S,A),y=!ja(x.value.expression)}return{filter:h,dynamicFilter:m||void 0,needGeometry:um(i),needFeature:!!y}}function kd(t){if(!Array.isArray(t))return t;let e=function(n){if(mv.has(n[0])){for(let i=1;i<n.length;i++)if(ys(n[i]))return!0}return n}(t);return e===!0?e:e.map(n=>kd(n))}function cm(t){let e=!1,n=[];if(t[0]==="case"){for(let i=1;i<t.length-1;i+=2)e=e||ys(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||ys(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||ys(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)cm(t[i])}function ys(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(ys(t[n]))return!0;return!1}let mv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function gv(t,e){return t<e?-1:t>e?1:0}function um(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(um(t[e]))return!0;return!1}function Mu(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?Su(t[1],t[2],"=="):e==="!="?Cu(Su(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Su(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Mu))):e==="all"?["all"].concat(t.slice(1).map(Mu)):e==="none"?["all"].concat(t.slice(1).map(Mu).map(Cu)):e==="in"?hm(t[1],t.slice(2)):e==="!in"?Cu(hm(t[1],t.slice(2))):e==="has"?dm(t[1]):e!=="!has"||Cu(dm(t[1]));var n}function Su(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function hm(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(gv)]]:["filter-in-small",t,["literal",e]]}}function dm(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Cu(t){return["!",t]}function Ld(t){return Iu(Oo(t.value))?la(Zi({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):fm(t)}function fm(t){let e=t.value,n=t.key;if(dn(e)!=="array")return[new ut(n,e,`array expected, ${dn(e)} found`)];let i=t.styleSpec,l,u=[];if(e.length<1)return[new ut(n,e,"filter array must have at least 1 element")];switch(u=u.concat(ca({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),ur(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ur(e[1])==="$type"&&u.push(new ut(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&u.push(new ut(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(l=dn(e[1]),l!=="string"&&u.push(new ut(`${n}[1]`,e[1],`string expected, ${l} found`)));for(let h=2;h<e.length;h++)l=dn(e[h]),ur(e[1])==="$type"?u=u.concat(ca({key:`${n}[${h}]`,value:e[h],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):l!=="string"&&l!=="number"&&l!=="boolean"&&u.push(new ut(`${n}[${h}]`,e[h],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let h=1;h<e.length;h++)u=u.concat(fm({key:`${n}[${h}]`,value:e[h],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":l=dn(e[1]),e.length!==2?u.push(new ut(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):l!=="string"&&u.push(new ut(`${n}[1]`,e[1],`string expected, ${l} found`))}return u}function pm(t,e){let n=t.key,i=t.style,l=t.layer,u=t.styleSpec,h=t.value,m=t.objectKey,y=u[`${e}_${t.layerType}`];if(!y)return[];let x=m.match(/^(.*)-transition$/);if(e==="paint"&&x&&y[x[1]]&&y[x[1]].transition)return _r({key:n,value:h,valueSpec:u.transition,style:i,styleSpec:u});let w=t.valueSpec||y[m];if(!w)return[new ho(n,h,`unknown property "${m}"`)];let T;if(dn(h)==="string"&&gs(w)&&!w.tokens&&(T=/^{([^}]+)}$/.exec(h))){let S=`\`{ "type": "identity", "property": ${T?JSON.stringify(T[1]):'"_"'} }\``;return[new ut(n,h,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${S}.`)]}let D=[];if(t.layerType==="symbol")m!=="text-field"||!i||i.glyphs||i.imports||D.push(new ut(n,h,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&vu(Oo(h))&&ur(h.type)==="identity"&&D.push(new ut(n,h,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&l&&l.layout&&l.layout.hasOwnProperty("model-id")&&gs(w)&&(Gl(w)||Cd(w))){let S=Xl(Oo(h),w),A=S.value.expression||S.value._styleExpression.expression;A&&!ra(A,["measure-light"])&&(m==="model-emissive-strength"&&ja(A)&&Nr(A)||D.push(new ut(n,h,`${m} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return D.concat(_r({key:t.key,value:h,valueSpec:w,style:i,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function mm(t){return pm(t,"paint")}function Yl(t){return pm(t,"layout")}function gm(t){let e=[],n=t.value,i=t.key,l=t.style,u=t.styleSpec;n.type||n.ref||e.push(new ut(i,n,'either "type" or "ref" is required'));let h=ur(n.type),m=ur(n.ref);if(n.id){let y=ur(n.id);for(let x=0;x<t.arrayIndex;x++){let w=l.layers[x];ur(w.id)===y&&e.push(new ut(i,n.id,`duplicate layer id "${n.id}", previously used at line ${w.id.__line__}`))}}if("ref"in n){let y;["type","source","source-layer","filter","layout"].forEach(x=>{x in n&&e.push(new ut(i,n[x],`"${x}" is prohibited for ref layers`))}),l.layers.forEach(x=>{ur(x.id)===m&&(y=x)}),y?y.ref?e.push(new ut(i,n.ref,"ref cannot reference another ref layer")):h=ur(y.type):typeof m=="string"&&e.push(new ut(i,n.ref,`ref layer "${m}" not found`))}else if(h!=="background"&&h!=="sky"&&h!=="slot")if(n.source){let y=l.sources&&l.sources[n.source],x=y&&ur(y.type);y?x==="vector"&&h==="raster"?e.push(new ut(i,n.source,`layer "${n.id}" requires a raster source`)):x==="raster"&&h!=="raster"?e.push(new ut(i,n.source,`layer "${n.id}" requires a vector source`)):x!=="vector"||n["source-layer"]?x==="raster-dem"&&h!=="hillshade"?e.push(new ut(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):h!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||x==="geojson"&&y.lineMetrics||e.push(new ut(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ut(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new ut(i,n.source,`source "${n.source}" not found`))}else e.push(new ut(i,n,'missing required property "source"'));return e=e.concat(di({key:i,value:n,valueSpec:u.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_r({key:`${i}.type`,value:n.type,valueSpec:u.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:y=>Ld(Zi({layerType:h},y)),layout:y=>di({layer:n,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>Yl(Zi({layerType:h},x))}}),paint:y=>di({layer:n,key:y.key,value:y.value,valueSpec:{},style:y.style,styleSpec:y.styleSpec,objectElementValidators:{"*":x=>mm(Zi({layerType:h,layer:n},x))}})}})),e}function Ha(t){let e=t.value,n=t.key,i=dn(e);return i!=="string"?[new ut(n,e,`string expected, ${i} found`)]:[]}let Jl={promoteId:function({key:t,value:e}){if(dn(e)==="string")return Ha({key:t,value:e});{let n=[];for(let i in e)n.push(...Ha({key:`${t}.${i}`,value:e[i]}));return n}}};function _m(t){let e=t.value,n=t.key,i=t.styleSpec,l=t.style;if(!e.type)return[new ut(n,e,'"type" is required')];let u=ur(e.type),h=[];switch(["vector","raster","raster-dem"].includes(u)&&(e.url||e.tiles||h.push(new ho(n,e,'Either "url" or "tiles" is required.'))),u){case"vector":case"raster":case"raster-dem":return h=h.concat(di({key:n,value:e,valueSpec:i[`source_${u.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:Jl})),h;case"geojson":if(h=di({key:n,value:e,valueSpec:i.source_geojson,style:l,styleSpec:i,objectElementValidators:Jl}),e.cluster)for(let m in e.clusterProperties){let[y,x]=e.clusterProperties[m],w=typeof y=="string"?[y,["accumulated"],["get",m]]:y;h.push(...la({key:`${n}.${m}.map`,value:x,expressionContext:"cluster-map"})),h.push(...la({key:`${n}.${m}.reduce`,value:w,expressionContext:"cluster-reduce"}))}return h;case"video":return di({key:n,value:e,valueSpec:i.source_video,style:l,styleSpec:i});case"image":return di({key:n,value:e,valueSpec:i.source_image,style:l,styleSpec:i});case"canvas":return[new ut(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ca({key:`${n}.type`,value:e.type,valueSpec:{values:ym(i)},style:l,styleSpec:i})}}function ym(t){return t.source.reduce((e,n)=>{let i=t[n];return i.type.type==="enum"&&(e=e.concat(Object.keys(i.type.values))),e},[])}function vm(t){let e=t.value,n=[];if(!e)return n;let i=dn(e);return i!=="string"?(n=n.concat([new ut(t.key,e,`string expected, "${i}" found`)]),n):(function(l){let u=l.indexOf("://")===-1;try{return new URL(l,u?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new ut(t.key,e,`invalid url "${e}"`)])),n)}function Fd(t){let e=t.value,n=t.styleSpec,i=n.light,l=t.style,u=[],h=dn(e);if(e===void 0)return u;if(h!=="object")return u=u.concat([new ut("light",e,`object expected, ${h} found`)]),u;for(let m in e){let y=m.match(/^(.*)-transition$/);u=u.concat(y&&i[y[1]]&&i[y[1]].transition?_r({key:m,value:e[m],valueSpec:n.transition,style:l,styleSpec:n}):i[m]?_r({key:m,value:e[m],valueSpec:i[m],style:l,styleSpec:n}):[new ut(m,e[m],`unknown property "${m}"`)])}return u}function Nd(t){let e=t.value,n=[];if(!e)return n;let i=dn(e);if(i!=="object")return n=n.concat([new ut("light-3d",e,`object expected, ${i} found`)]),n;let l=t.styleSpec,u=l["light-3d"],h=t.key,m=t.style,y=t.style.lights;for(let T of["type","id"])if(!(T in e))return n=n.concat([new ut("light-3d",e,`missing property ${T} on light`)]),n;if(e.type&&y)for(let T=0;T<t.arrayIndex;T++){let D=ur(e.type),S=y[T];ur(S.type)===D&&n.push(new ut(h,e.id,`duplicate light type "${e.type}", previously defined at line ${S.id.__line__}`))}let x=`properties_light_${e.type}`;if(!(x in l))return n=n.concat([new ut("light-3d",e,`Invalid light type ${e.type}`)]),n;let w=l[x];for(let T in e)if(T==="properties"){let D=e[T],S=dn(D);if(S!=="object")return n=n.concat([new ut("properties",D,`object expected, ${S} found`)]),n;for(let A in D)n=n.concat(w[A]?_r({key:A,value:D[A],valueSpec:w[A],style:m,styleSpec:l}):[new ho(t.key,D[A],`unknown property "${A}"`)])}else{let D=T.match(/^(.*)-transition$/);n=n.concat(D&&u[D[1]]&&u[D[1]].transition?_r({key:T,value:e[T],valueSpec:l.transition,style:m,styleSpec:l}):u[T]?_r({key:T,value:e[T],valueSpec:u[T],style:m,styleSpec:l}):[new ho(T,e[T],`unknown property "${T}"`)])}return n}function zd(t){let e=t.value,n=t.key,i=t.style,l=t.styleSpec,u=l.terrain,h=[],m=dn(e);if(e===void 0||m==="null")return h;if(m!=="object")return h=h.concat([new ut("terrain",e,`object expected, ${m} found`)]),h;for(let y in e){let x=y.match(/^(.*)-transition$/);h=h.concat(x&&u[x[1]]&&u[x[1]].transition?_r({key:y,value:e[y],valueSpec:l.transition,style:i,styleSpec:l}):u[y]?_r({key:y,value:e[y],valueSpec:u[y],style:i,styleSpec:l}):[new ho(y,e[y],`unknown property "${y}"`)])}if(e.source){let y=i.sources&&i.sources[e.source],x=y&&ur(y.type);y?x!=="raster-dem"&&h.push(new ut(n,e.source,`terrain cannot be used with a source of type ${String(x)}, it only be used with a "raster-dem" source type`)):h.push(new ut(n,e.source,`source "${e.source}" not found`))}else h.push(new ut(n,e,'terrain is missing required property "source"'));return h}function Bd(t){let e=t.value,n=t.style,i=t.styleSpec,l=i.fog,u=[],h=dn(e);if(e===void 0)return u;if(h!=="object")return u=u.concat([new ut("fog",e,`object expected, ${h} found`)]),u;for(let m in e){let y=m.match(/^(.*)-transition$/);u=u.concat(y&&l[y[1]]&&l[y[1]].transition?_r({key:m,value:e[m],valueSpec:i.transition,style:n,styleSpec:i}):l[m]?_r({key:m,value:e[m],valueSpec:l[m],style:n,styleSpec:i}):[new ho(m,e[m],`unknown property "${m}"`)])}return u}let Au={"*":()=>[],array:lm,boolean:function(t){let e=t.value,n=t.key,i=dn(e);return i!=="boolean"?[new ut(n,e,`boolean expected, ${i} found`)]:[]},number:Pd,color:function(t){let e=t.key,n=t.value,i=dn(n);return i!=="string"?[new ut(e,n,`color expected, ${i} found`)]:Jc(n)===null?[new ut(e,n,`color expected, "${n}" found`)]:[]},enum:ca,filter:Ld,function:Od,layer:gm,object:di,source:_m,model:vm,light:Fd,"light-3d":Nd,terrain:zd,fog:Bd,string:Ha,formatted:function(t){return Ha(t).length===0?[]:la(t)},resolvedImage:function(t){return Ha(t).length===0?[]:la(t)},projection:function(t){let e=t.value,n=t.styleSpec,i=n.projection,l=t.style,u=[],h=dn(e);if(h==="object")for(let m in e)u=u.concat(_r({key:m,value:e[m],valueSpec:i[m],style:l,styleSpec:n}));else h!=="string"&&(u=u.concat([new ut("projection",e,`object or string expected, ${h} found`)]));return u},import:function(t){let{value:e,styleSpec:n}=t,h=e,{data:i}=h,l=hx(h,["data"]);Object.defineProperty(l,"__line__",{value:e.__line__,enumerable:!1});let u=di(Zi({},t,{value:l,valueSpec:n.import}));return ur(l.id)===""&&u.push(new ut(`${t.key}.id`,l,"import id can't be an empty string")),i&&(u=u.concat(xm(i,n,{key:`${t.key}.data`}))),u}};function _r(t,e=!1){let n=t.value,i=t.valueSpec,l=t.styleSpec;if(i.expression&&vu(ur(n)))return Od(t);if(i.expression&&bu(Oo(n)))return la(t);if(i.type&&Au[i.type]){let u=Au[i.type](t);return e===!0&&u.length>0&&dn(t.value)==="array"?la(t):u}return di(Zi({},t,{valueSpec:i.type?l[i.type]:i}))}function _v(t){let e=t.value,n=t.key,i=Ha(t);return i.length||(e.indexOf("{fontstack}")===-1&&i.push(new ut(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&i.push(new ut(n,e,'"glyphs" url must include a "{range}" token'))),i}function xm(t,e=ye,n={}){return _r({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:_v,"*":()=>[]}})}function jd(t,e=ye){return Qi(xm(t,e))}let yv=t=>Qi(mm(t)),vv=t=>Qi(Yl(t));function Qi(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function bm(t,e){let n=!1;if(e&&e.length)for(let i of e)i instanceof ho?Zn(i.message):(t.fire(new Zs(new Error(i.message))),n=!0);return n}var xv=mo,vs=3;function mo(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var l=new Int32Array(this.arrayBuffer);t=l[0],this.d=(e=l[1])+2*(n=l[2]);for(var u=0;u<this.d*this.d;u++){var h=l[vs+u],m=l[vs+u+1];i.push(h===m?null:l.subarray(h,m))}var y=l[vs+i.length+1];this.keys=l.subarray(l[vs+i.length],y),this.bboxes=l.subarray(y),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var x=0;x<this.d*this.d;x++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var w=n/e*t;this.min=-w,this.max=t+w}mo.prototype.insert=function(t,e,n,i,l){this._forEachCell(e,n,i,l,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(l)},mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},mo.prototype._insertCell=function(t,e,n,i,l,u){this.cells[l].push(u)},mo.prototype.query=function(t,e,n,i,l){var u=this.min,h=this.max;if(t<=u&&e<=u&&h<=n&&h<=i&&!l)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,n,i,this._queryCell,m,{},l),m},mo.prototype._queryCell=function(t,e,n,i,l,u,h,m){var y=this.cells[l];if(y!==null)for(var x=this.keys,w=this.bboxes,T=0;T<y.length;T++){var D=y[T];if(h[D]===void 0){var S=4*D;(m?m(w[S+0],w[S+1],w[S+2],w[S+3]):t<=w[S+2]&&e<=w[S+3]&&n>=w[S+0]&&i>=w[S+1])?(h[D]=!0,u.push(x[D])):h[D]=!1}}},mo.prototype._forEachCell=function(t,e,n,i,l,u,h,m){for(var y=this._convertToCellCoord(t),x=this._convertToCellCoord(e),w=this._convertToCellCoord(n),T=this._convertToCellCoord(i),D=y;D<=w;D++)for(var S=x;S<=T;S++){var A=this.d*S+D;if((!m||m(this._convertFromCellCoord(D),this._convertFromCellCoord(S),this._convertFromCellCoord(D+1),this._convertFromCellCoord(S+1)))&&l.call(this,t,e,n,i,A,u,h,m))return}},mo.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},mo.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=vs+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var l=new Int32Array(e+n+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;for(var u=e,h=0;h<t.length;h++){var m=t[h];l[vs+h]=u,l.set(m,u),u+=m.length}return l[vs+t.length]=u,l.set(this.keys,u),l[vs+t.length+1]=u+=this.keys.length,l.set(this.bboxes,u),u+=this.bboxes.length,l.buffer};var qa=St(xv);let Ru={};function it(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),Ru[e]={klass:t,omit:n.omit||[]}}it(Object,"Object"),qa.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},qa.deserialize=function(t){return new qa(t.buffer)},Object.defineProperty(qa,"name",{value:"Grid"}),it(qa,"Grid"),it(Vn,"Color"),it(Error,"Error"),it(Kr,"Formatted"),it(Qs,"FormattedSection"),it(Ii,"AJAXError"),it(Si,"ResolvedImage"),it(wu,"StylePropertyFunction"),it(Rd,"StyleExpression",{omit:["_evaluator"]}),it(Zl,"ZoomDependentExpression"),it(Wl,"ZoomConstantExpression"),it(Ji,"CompoundExpression",{omit:["_evaluate"]});for(let t in $l)Ru[$l[t]._classRegistryKey]||it($l[t],`Expression${t}`);function p(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function o(t){return self.ImageBitmap&&t instanceof ImageBitmap}function c(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(p(t)||o(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let i of t)n.push(c(i,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[i,l]of t.entries())n[i]=c(l);return n}if(typeof t=="object"){let n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);let l=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let u in t)t.hasOwnProperty(u)&&(Ru[i].omit.indexOf(u)>=0||(l[u]=c(t[u],e)));t instanceof Error&&(l.message=t.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(l.$name=i),l}throw new Error("can't serialize object of type "+typeof t)}function g(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||p(t)||o(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(g);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let l=new Map;for(let u of Object.keys(t))u!=="$name"&&l.set(u,g(t[u]));return l}let{klass:n}=Ru[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let i=Object.create(n.prototype);for(let l of Object.keys(t))l!=="$name"&&(i[l]=g(t[l]));return i}throw new Error("can't deserialize object of type "+typeof t)}let v={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function b(t){for(let e of t)if(C(e.charCodeAt(0)))return!0;return!1}function E(t){for(let e of t)if(!I(e.charCodeAt(0)))return!1;return!0}function I(t){return!(v.Arabic(t)||v["Arabic Supplement"](t)||v["Arabic Extended-A"](t)||v["Arabic Presentation Forms-A"](t)||v["Arabic Presentation Forms-B"](t))}function C(t){return!(t!==746&&t!==747&&(t<4352||!(v["Bopomofo Extended"](t)||v.Bopomofo(t)||v["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||v["CJK Compatibility Ideographs"](t)||v["CJK Compatibility"](t)||v["CJK Radicals Supplement"](t)||v["CJK Strokes"](t)||!(!v["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||v["CJK Unified Ideographs Extension A"](t)||v["CJK Unified Ideographs"](t)||v["Enclosed CJK Letters and Months"](t)||v["Hangul Compatibility Jamo"](t)||v["Hangul Jamo Extended-A"](t)||v["Hangul Jamo Extended-B"](t)||v["Hangul Jamo"](t)||v["Hangul Syllables"](t)||v.Hiragana(t)||v["Ideographic Description Characters"](t)||v.Kanbun(t)||v["Kangxi Radicals"](t)||v["Katakana Phonetic Extensions"](t)||v.Katakana(t)&&t!==12540||!(!v["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!v["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||v["Unified Canadian Aboriginal Syllabics"](t)||v["Unified Canadian Aboriginal Syllabics Extended"](t)||v["Vertical Forms"](t)||v["Yijing Hexagram Symbols"](t)||v["Yi Syllables"](t)||v["Yi Radicals"](t))))}function R(t){return!(C(t)||function(e){return!!(v["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||v["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||v["Letterlike Symbols"](e)||v["Number Forms"](e)||v["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||v["Control Pictures"](e)&&e!==9251||v["Optical Character Recognition"](e)||v["Enclosed Alphanumerics"](e)||v["Geometric Shapes"](e)||v["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||v["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||v["CJK Symbols and Punctuation"](e)||v.Katakana(e)||v["Private Use Area"](e)||v["CJK Compatibility Forms"](e)||v["Small Form Variants"](e)||v["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function O(t){return t>=1424&&t<=2303||v["Arabic Presentation Forms-A"](t)||v["Arabic Presentation Forms-B"](t)}function F(t,e){return!(!e&&O(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||v.Khmer(t))}function z(t){for(let e of t)if(O(e.charCodeAt(0)))return!0;return!1}let j="deferred",U="loading",G="loaded",$=null,V="unavailable",Y=null,ne=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(V="error"),$&&$(t)};function re(){W.fire(new Wi("pluginStateChange",{pluginStatus:V,pluginURL:Y}))}let W=new uo,J=function(){return V},oe=function(){if(V!==j||!Y)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");V=U,re(),Y&&Lr({url:Y},t=>{t?ne(t):(V=G,re())})},ce={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>V===G||ce.applyArabicShaping!=null,isLoading:()=>V===U,setState(t){V=t.pluginStatus,Y=t.pluginURL},isParsed:()=>ce.applyArabicShaping!=null&&ce.processBidirectionalText!=null&&ce.processStyledBidirectionalText!=null,getPluginURL:()=>Y};class ae{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(let l of n)if(!F(l.charCodeAt(0),i))return!1;return!0}(e,ce.isLoaded())}}class ue{constructor(e,n,i,l){this.property=e,this.value=n,this.expression=function(u,h,m,y){if(vu(u))return new wu(u,h);if(bu(u)||Array.isArray(u)&&u.length>0){let x=Xl(u,h,m,y);if(x.result==="error")throw new Error(x.value.map(w=>`${w.key}: ${w.message}`).join(", "));return x.value}{let x=u;return typeof u=="string"&&h.type==="color"&&(x=Vn.parse(u)),{kind:"constant",isConfigDependent:!1,evaluate:()=>x}}}(n===void 0?e.specification.default:n,e.specification,i,l)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class De{constructor(e,n,i){this.property=e,this.value=new ue(e,void 0,n,i)}transitioned(e,n){return new we(this.property,this.value,n,Tr({},e.transition,this.transition),e.now)}untransitioned(){return new we(this.property,this.value,null,{},0)}}class ve{constructor(e,n,i){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=n,this._options=i,this.isConfigDependent=!1}getValue(e){return qi(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new De(this._values[e].property,this._scope,this._options)),this._values[e].value=new ue(this._values[e].property,n===null?void 0:qi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let i=this._properties.properties;if(e)for(let l in e){let u=e[l];if(Oa(l,"-transition")){let h=l.slice(0,-11);i[h]&&this.setTransition(h,u)}else i[l]&&this.setValue(l,u)}}getTransition(e){return qi(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new De(this._values[e].property)),this._values[e].transition=qi(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i);let l=this.getTransition(n);l!==void 0&&(e[`${n}-transition`]=l)}return e}transitioned(e,n){let i=new de(this._properties);for(let l of Object.keys(this._values))i._values[l]=this._values[l].transitioned(e,n._values[l]);return i}untransitioned(){let e=new de(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class we{constructor(e,n,i,l,u){let h=l.delay||0,m=l.duration||0;u=u||0,this.property=e,this.value=n,this.begin=u+h,this.end=this.begin+m,e.specification.transition&&(l.delay||l.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){let l=e.now||0,u=this.value.possiblyEvaluate(e,n,i),h=this.prior;if(h){if(l>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(l<this.begin)return h.possiblyEvaluate(e,n,i);{let m=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,n,i),u,Uc(m))}}return u}}class de{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){let l=new Ce(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,n,i);return l}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ie{constructor(e,n,i){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=n,this._options=i,this.isConfigDependent=!1}getValue(e){return qi(this._values[e].value)}setValue(e,n){this._values[e]=new ue(this._values[e].property,n===null?void 0:qi(n),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){let l=new Ce(this._properties);for(let u of Object.keys(this._values))l._values[u]=this._values[u].possiblyEvaluate(e,n,i);return l}}class be{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,i,l){return this.property.evaluate(this.value,this.parameters,e,n,i,l)}}class Ce{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Q{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){let l=zl[this.specification.type];return l?l(e,n,i):e}}class me{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,l){return new be(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},i,l)}:e.expression,n)}interpolate(e,n,i){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new be(this,{kind:"constant",value:void 0},e.parameters);let l=zl[this.specification.type];return l?new be(this,{kind:"constant",value:l(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,l,u,h){return e.kind==="constant"?e.value:e.evaluate(n,i,l,u,h)}}class Le{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,l){return!!e.expression.evaluate(n,null,{},i,l)}interpolate(){return!1}}class Re{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new ae(0,{});for(let i in e){let l=e[i];l.specification.overridable&&this.overridableProperties.push(i);let u=this.defaultPropertyValues[i]=new ue(l,void 0),h=this.defaultTransitionablePropertyValues[i]=new De(l);this.defaultTransitioningPropertyValues[i]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=u.possiblyEvaluate(n)}}}it(me,"DataDrivenProperty"),it(Q,"DataConstantProperty"),it(Le,"ColorRampProperty");let ot="";function et(t,e){return e?`${t}${ot}${e}`:t}let mt="-transition";class tt extends uo{constructor(e,n,i,l){if(super(),this.id=e.id,this.fqid=et(this.id,i),this.type=e.type,this.scope=i,this.options=l,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new Ie(n.layout,this.scope,l),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new ve(n.paint,this.scope,l);for(let u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(let u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ce(n.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,i={}){if(n!=null&&this._validate(vv,`layers.${this.id}.layout.${e}`,e,n,i))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,n),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Oa(e,mt)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,i={}){if(n!=null&&this._validate(yv,`layers.${this.id}.paint.${e}`,e,n,i))return!1;let l=this._transitionablePaint,u=l._properties.properties;if(Oa(e,mt)){let D=e.slice(0,-11);return u[D]&&l.setTransition(D,n||void 0),!1}if(!u[e])return!1;let h=l._values[e],m=h.value.isDataDriven(),y=h.value;l.setValue(e,n),this.isConfigDependent=this.isConfigDependent||l.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let x=l._values[e].value,w=x.isDataDriven(),T=Oa(e,"pattern")||e==="line-dasharray";return w||m||T||this._handleOverridablePaintPropertyUpdate(e,y,x)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return qc({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}_validate(e,n,i,l,u={}){return(!u||u.validate!==!1)&&bm(this,e.call(jd,{key:n,layerType:this.type,objectKey:i,value:l,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof be&&gs(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Du(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}let xt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class bt{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ht{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function dt(t,e=1){let n=0,i=0;return{members:t.map(l=>{let u=xt[l.type].BYTES_PER_ELEMENT,h=n=nn(n,Math.max(e,u)),m=l.components||1;return i=Math.max(i,u),n+=u*m,{name:l.name,type:l.type,components:m,offset:h}}),size:nn(n,Math.max(i,e)),alignment:e}}function nn(t,e){return Math.ceil(t/e)*e}class Lt extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let l=2*e;return this.int16[l+0]=n,this.int16[l+1]=i,e}}Lt.prototype.bytesPerElement=4,it(Lt,"StructArrayLayout2i4");class Rn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i)}emplace(e,n,i,l){let u=3*e;return this.int16[u+0]=n,this.int16[u+1]=i,this.int16[u+2]=l,e}}Rn.prototype.bytesPerElement=6,it(Rn,"StructArrayLayout3i6");class xn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,l)}emplace(e,n,i,l,u){let h=4*e;return this.int16[h+0]=n,this.int16[h+1]=i,this.int16[h+2]=l,this.int16[h+3]=u,e}}xn.prototype.bytesPerElement=8,it(xn,"StructArrayLayout4i8");class Qr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,l,u)}emplace(e,n,i,l,u,h){let m=5*e;return this.int16[m+0]=n,this.int16[m+1]=i,this.int16[m+2]=l,this.int16[m+3]=u,this.int16[m+4]=h,e}}Qr.prototype.bytesPerElement=10,it(Qr,"StructArrayLayout5i10");class Ri extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,i,l,u,h,m)}emplace(e,n,i,l,u,h,m,y){let x=6*e,w=12*e,T=3*e;return this.int16[x+0]=n,this.int16[x+1]=i,this.uint8[w+4]=l,this.uint8[w+5]=u,this.uint8[w+6]=h,this.uint8[w+7]=m,this.float32[T+2]=y,e}}Ri.prototype.bytesPerElement=12,it(Ri,"StructArrayLayout2i4ub1f12");class mn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,l)}emplace(e,n,i,l,u){let h=4*e;return this.float32[h+0]=n,this.float32[h+1]=i,this.float32[h+2]=l,this.float32[h+3]=u,e}}mn.prototype.bytesPerElement=16,it(mn,"StructArrayLayout4f16");class an extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,l,u)}emplace(e,n,i,l,u,h){let m=6*e,y=3*e;return this.uint16[m+0]=n,this.uint16[m+1]=i,this.uint16[m+2]=l,this.uint16[m+3]=u,this.float32[y+2]=h,e}}an.prototype.bytesPerElement=12,it(an,"StructArrayLayout4ui1f12");class cn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,l)}emplace(e,n,i,l,u){let h=4*e;return this.uint16[h+0]=n,this.uint16[h+1]=i,this.uint16[h+2]=l,this.uint16[h+3]=u,e}}cn.prototype.bytesPerElement=8,it(cn,"StructArrayLayout4ui8");class Un extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,l,u,h)}emplace(e,n,i,l,u,h,m){let y=6*e;return this.int16[y+0]=n,this.int16[y+1]=i,this.int16[y+2]=l,this.int16[y+3]=u,this.int16[y+4]=h,this.int16[y+5]=m,e}}Un.prototype.bytesPerElement=12,it(Un,"StructArrayLayout6i12");class Dr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m,y,x,w,T,D){let S=this.length;return this.resize(S+1),this.emplace(S,e,n,i,l,u,h,m,y,x,w,T,D)}emplace(e,n,i,l,u,h,m,y,x,w,T,D,S){let A=12*e;return this.int16[A+0]=n,this.int16[A+1]=i,this.int16[A+2]=l,this.int16[A+3]=u,this.uint16[A+4]=h,this.uint16[A+5]=m,this.uint16[A+6]=y,this.uint16[A+7]=x,this.int16[A+8]=w,this.int16[A+9]=T,this.int16[A+10]=D,this.int16[A+11]=S,e}}Dr.prototype.bytesPerElement=24,it(Dr,"StructArrayLayout4i4ui4i24");class kn extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h){let m=this.length;return this.resize(m+1),this.emplace(m,e,n,i,l,u,h)}emplace(e,n,i,l,u,h,m){let y=10*e,x=5*e;return this.int16[y+0]=n,this.int16[y+1]=i,this.int16[y+2]=l,this.float32[x+2]=u,this.float32[x+3]=h,this.float32[x+4]=m,e}}kn.prototype.bytesPerElement=20,it(kn,"StructArrayLayout3i3f20");class Vr extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Vr.prototype.bytesPerElement=4,it(Vr,"StructArrayLayout1ul4");class ei extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let l=2*e;return this.uint16[l+0]=n,this.uint16[l+1]=i,e}}ei.prototype.bytesPerElement=4,it(ei,"StructArrayLayout2ui4");class Ur extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m,y,x,w,T,D,S){let A=this.length;return this.resize(A+1),this.emplace(A,e,n,i,l,u,h,m,y,x,w,T,D,S)}emplace(e,n,i,l,u,h,m,y,x,w,T,D,S,A){let P=20*e,k=10*e;return this.int16[P+0]=n,this.int16[P+1]=i,this.int16[P+2]=l,this.int16[P+3]=u,this.int16[P+4]=h,this.float32[k+3]=m,this.float32[k+4]=y,this.float32[k+5]=x,this.float32[k+6]=w,this.int16[P+14]=T,this.uint32[k+8]=D,this.uint16[P+18]=S,this.uint16[P+19]=A,e}}Ur.prototype.bytesPerElement=40,it(Ur,"StructArrayLayout5i4f1i1ul2ui40");class Pi extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,i,l,u,h,m)}emplace(e,n,i,l,u,h,m,y){let x=8*e;return this.int16[x+0]=n,this.int16[x+1]=i,this.int16[x+2]=l,this.int16[x+4]=u,this.int16[x+5]=h,this.int16[x+6]=m,this.int16[x+7]=y,e}}Pi.prototype.bytesPerElement=16,it(Pi,"StructArrayLayout3i2i2i16");class Fo extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,l,u)}emplace(e,n,i,l,u,h){let m=4*e,y=8*e;return this.float32[m+0]=n,this.float32[m+1]=i,this.float32[m+2]=l,this.int16[y+6]=u,this.int16[y+7]=h,e}}Fo.prototype.bytesPerElement=16,it(Fo,"StructArrayLayout2f1f2i16");class eo extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,l)}emplace(e,n,i,l,u){let h=12*e,m=3*e;return this.uint8[h+0]=n,this.uint8[h+1]=i,this.float32[m+1]=l,this.float32[m+2]=u,e}}eo.prototype.bytesPerElement=12,it(eo,"StructArrayLayout2ub2f12");class En extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i)}emplace(e,n,i,l){let u=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=i,this.uint16[u+2]=l,e}}En.prototype.bytesPerElement=6,it(En,"StructArrayLayout3ui6");class to extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K){let ee=this.length;return this.resize(ee+1),this.emplace(ee,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K)}emplace(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K,ee){let le=30*e,he=15*e,fe=60*e;return this.int16[le+0]=n,this.int16[le+1]=i,this.int16[le+2]=l,this.float32[he+2]=u,this.float32[he+3]=h,this.uint16[le+8]=m,this.uint16[le+9]=y,this.uint32[he+5]=x,this.uint32[he+6]=w,this.uint32[he+7]=T,this.uint16[le+16]=D,this.uint16[le+17]=S,this.uint16[le+18]=A,this.float32[he+10]=P,this.float32[he+11]=k,this.uint8[fe+48]=N,this.uint8[fe+49]=H,this.uint8[fe+50]=q,this.uint32[he+13]=Z,this.int16[le+28]=K,this.uint8[fe+58]=ee,e}}to.prototype.bytesPerElement=60,it(to,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class go extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K,ee,le,he,fe,xe,_e,Me,Be,Te,ke,Ee){let Je=this.length;return this.resize(Je+1),this.emplace(Je,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K,ee,le,he,fe,xe,_e,Me,Be,Te,ke,Ee)}emplace(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K,ee,le,he,fe,xe,_e,Me,Be,Te,ke,Ee,Je){let rt=20*e,Ne=40*e,wt=80*e;return this.float32[rt+0]=n,this.float32[rt+1]=i,this.int16[Ne+4]=l,this.int16[Ne+5]=u,this.int16[Ne+6]=h,this.int16[Ne+7]=m,this.int16[Ne+8]=y,this.int16[Ne+9]=x,this.int16[Ne+10]=w,this.int16[Ne+11]=T,this.int16[Ne+12]=D,this.uint16[Ne+13]=S,this.uint16[Ne+14]=A,this.uint16[Ne+15]=P,this.uint16[Ne+16]=k,this.uint16[Ne+17]=N,this.uint16[Ne+18]=H,this.uint16[Ne+19]=q,this.uint16[Ne+20]=Z,this.uint16[Ne+21]=K,this.uint16[Ne+22]=ee,this.uint16[Ne+23]=le,this.uint16[Ne+24]=he,this.uint16[Ne+25]=fe,this.uint16[Ne+26]=xe,this.uint16[Ne+27]=_e,this.uint32[rt+14]=Me,this.float32[rt+15]=Be,this.float32[rt+16]=Te,this.float32[rt+17]=ke,this.float32[rt+18]=Ee,this.uint8[wt+76]=Je,e}}go.prototype.bytesPerElement=80,it(go,"StructArrayLayout2f9i15ui1ul4f1ub80");class No extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}No.prototype.bytesPerElement=4,it(No,"StructArrayLayout1f4");class Kl extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,l,u)}emplace(e,n,i,l,u,h){let m=5*e;return this.float32[m+0]=n,this.float32[m+1]=i,this.float32[m+2]=l,this.float32[m+3]=u,this.float32[m+4]=h,e}}Kl.prototype.bytesPerElement=20,it(Kl,"StructArrayLayout5f20");class bv extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,i,l,u,h,m)}emplace(e,n,i,l,u,h,m,y){let x=7*e;return this.float32[x+0]=n,this.float32[x+1]=i,this.float32[x+2]=l,this.float32[x+3]=u,this.float32[x+4]=h,this.float32[x+5]=m,this.float32[x+6]=y,e}}bv.prototype.bytesPerElement=28,it(bv,"StructArrayLayout7f28");class wv extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,l)}emplace(e,n,i,l,u){let h=6*e;return this.uint32[3*e+0]=n,this.uint16[h+2]=i,this.uint16[h+3]=l,this.uint16[h+4]=u,e}}wv.prototype.bytesPerElement=12,it(wv,"StructArrayLayout1ul3ui12");class Vd extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Vd.prototype.bytesPerElement=2,it(Vd,"StructArrayLayout1ui2");class Ql extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i)}emplace(e,n,i,l){let u=3*e;return this.float32[u+0]=n,this.float32[u+1]=i,this.float32[u+2]=l,e}}Ql.prototype.bytesPerElement=12,it(Ql,"StructArrayLayout3f12");class Ud extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let l=2*e;return this.float32[l+0]=n,this.float32[l+1]=i,e}}Ud.prototype.bytesPerElement=8,it(Ud,"StructArrayLayout2f8");class Ev extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k){let N=this.length;return this.resize(N+1),this.emplace(N,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k)}emplace(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N){let H=16*e;return this.float32[H+0]=n,this.float32[H+1]=i,this.float32[H+2]=l,this.float32[H+3]=u,this.float32[H+4]=h,this.float32[H+5]=m,this.float32[H+6]=y,this.float32[H+7]=x,this.float32[H+8]=w,this.float32[H+9]=T,this.float32[H+10]=D,this.float32[H+11]=S,this.float32[H+12]=A,this.float32[H+13]=P,this.float32[H+14]=k,this.float32[H+15]=N,e}}Ev.prototype.bytesPerElement=64,it(Ev,"StructArrayLayout16f64");class wm extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,l,u,h,m){let y=this.length;return this.resize(y+1),this.emplace(y,e,n,i,l,u,h,m)}emplace(e,n,i,l,u,h,m,y){let x=10*e,w=5*e;return this.uint16[x+0]=n,this.uint16[x+1]=i,this.uint16[x+2]=l,this.uint16[x+3]=u,this.float32[w+2]=h,this.float32[w+3]=m,this.float32[w+4]=y,e}}wm.prototype.bytesPerElement=20,it(wm,"StructArrayLayout4ui3f20");class Tv extends ht{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}Tv.prototype.bytesPerElement=1,it(Tv,"StructArrayLayout1ub1");class sE extends bt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}sE.prototype.size=40;class Iv extends Ur{get(e){return new sE(this,e)}}it(Iv,"CollisionBoxArray");class aE extends bt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}aE.prototype.size=60;class lE extends to{get(e){return new aE(this,e)}}it(lE,"PlacedSymbolArray");class cE extends bt{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}cE.prototype.size=80;class uE extends go{get(e){return new cE(this,e)}}it(uE,"SymbolInstanceArray");class hE extends No{getoffsetX(e){return this.float32[1*e+0]}}it(hE,"GlyphOffsetArray");class dE extends Lt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}it(dE,"SymbolLineVertexArray");class fE extends bt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}fE.prototype.size=12;class pE extends wv{get(e){return new fE(this,e)}}it(pE,"FeatureIndexArray");class mE extends ei{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}it(mE,"FillExtrusionCentroidArray");let MP=dt([{name:"a_pos",components:2,type:"Int16"}],4),SP=dt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Xn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,l){let u=this.segments[this.segments.length-1];return e>Xn.MAX_VERTEX_ARRAY_LENGTH&&Zn(`Max vertices per segment is ${Xn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Xn.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==l)&&(u={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},l!==void 0&&(u.sortKey=l),this.segments.push(u)),u}prepareSegment(e,n,i,l){return this._prepareSegment(e,n.length,i.length,l)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,l){return new Xn([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:l,vaos:{},sortKey:0}])}}function gE(t,e){return 256*(t=Bt(Math.floor(t),0,255))+Bt(Math.floor(e),0,255)}Xn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,it(Xn,"SegmentVector");let CP=dt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),AP=dt([{name:"a_dash",components:4,type:"Uint16"}]);var Em={exports:{}},_E={exports:{}};(function(t){t.exports=function(e,n){var i,l,u,h,m,y,x,w;for(l=e.length-(i=3&e.length),u=n,m=3432918353,y=461845907,w=0;w<l;)x=255&e.charCodeAt(w)|(255&e.charCodeAt(++w))<<8|(255&e.charCodeAt(++w))<<16|(255&e.charCodeAt(++w))<<24,++w,u=27492+(65535&(h=5*(65535&(u=(u^=x=(65535&(x=(x=(65535&x)*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(h>>>16)&65535)<<16);switch(x=0,i){case 3:x^=(255&e.charCodeAt(w+2))<<16;case 2:x^=(255&e.charCodeAt(w+1))<<8;case 1:u^=x=(65535&(x=(x=(65535&(x^=255&e.charCodeAt(w)))*m+(((x>>>16)*m&65535)<<16)&4294967295)<<15|x>>>17))*y+(((x>>>16)*y&65535)<<16)&4294967295}return u^=e.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0}})(_E);var RP=_E.exports,yE={exports:{}};(function(t){t.exports=function(e,n){for(var i,l=e.length,u=n^l,h=0;l>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(h)|(255&e.charCodeAt(++h))<<8|(255&e.charCodeAt(++h))<<16|(255&e.charCodeAt(++h))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++h;switch(l){case 3:u^=(255&e.charCodeAt(h+2))<<16;case 2:u^=(255&e.charCodeAt(h+1))<<8;case 1:u=1540483477*(65535&(u^=255&e.charCodeAt(h)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0}})(yE);var vE=RP,PP=yE.exports;Em.exports=vE,Em.exports.murmur3=vE,Em.exports.murmur2=PP;var Dv=St(Em.exports);class $d{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,l){this.ids.push(xE(e)),this.positions.push(n,i,l)}eachPosition(e,n){let i=xE(e),l=0,u=this.ids.length-1;for(;l<u;){let h=l+u>>1;this.ids[h]>=i?u=h:l=h+1}for(;this.ids[l]===i;)n(this.positions[3*l],this.positions[3*l+1],this.positions[3*l+2]),l++}static serialize(e,n){let i=new Float64Array(e.ids),l=new Uint32Array(e.positions);return Mv(i,l,0,i.length-1),n&&(n.add(i.buffer),n.add(l.buffer)),{ids:i,positions:l}}static deserialize(e){let n=new $d,i;n.ids=e.ids,n.positions=e.positions;for(let l of n.ids)l!==i&&n.uniqueIds.push(l),i=l;return n.indexed=!0,n}}function xE(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Dv(String(t))}function Mv(t,e,n,i){for(;n<i;){let l=t[n+i>>1],u=n-1,h=i+1;for(;;){do u++;while(t[u]<l);do h--;while(t[h]>l);if(u>=h)break;Tm(t,u,h),Tm(e,3*u,3*h),Tm(e,3*u+1,3*h+1),Tm(e,3*u+2,3*h+2)}h-n<i-h?(Mv(t,e,n,h),n=h+1):(Mv(t,e,h+1,i),i=h)}}function Tm(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}it($d,"FeaturePositionMap");class ua{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Im extends ua{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class fi extends ua{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class ec extends ua{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class Sv extends ua{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class bE extends ua{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class wE extends ua{constructor(e){super(e),this.current=Vn.transparent}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}let OP=new Float32Array(16);class Gd extends ua{constructor(e){super(e),this.current=OP}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}let kP=new Float32Array(9),LP=new Float32Array(4);class Cv extends ua{constructor(e){super(e),this.current=LP}set(e,n,i){if(this.fetchUniformLocation(e,n)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}}function Av(t){return[gE(255*t.r,255*t.g),gE(255*t.b,255*t.a)]}class Hd{constructor(e,n,i){this.value=e,this.uniformNames=n.map(l=>`u_${l}`),this.type=i}setUniform(e,n,i,l,u){n.set(e,u,l.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new wE(e):new fi(e)}}class Pu{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,l,u){let h=u==="u_pattern"||u==="u_dash"?this.pattern:u==="u_pixel_ratio"?this.pixelRatio:null;h&&n.set(e,u,h)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new bE(e):new fi(e)}}class ha{constructor(e,n,i,l){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:i==="color"?2:1,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,i,l,u,h,m){let y=this.paintVertexArray.length,x=this.expression.evaluate(new ae(0,{brightness:h}),n,{},u,l,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,x)}updatePaintArray(e,n,i,l,u,h,m){let y=this.expression.evaluate({zoom:0,brightness:m},i,l,void 0,u);this._setPaintValue(e,n,y)}_setPaintValue(e,n,i){if(this.type==="color"){let l=Av(i);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,l[0],l[1])}else{for(let l=e;l<n;l++)this.paintVertexArray.emplace(l,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class zo{constructor(e,n,i,l,u,h){this.expression=e,this.uniformNames=n.map(m=>`u_${m}_t`),this.type=i,this.useIntegerZoom=l,this.zoom=u,this.maxValue=0,this.paintVertexAttributes=n.map(m=>({name:`a_${m}`,type:"Float32",components:i==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,i,l,u,h,m){let y=this.expression.evaluate(new ae(this.zoom,{brightness:h}),n,{},u,l,m),x=this.expression.evaluate(new ae(this.zoom+1,{brightness:h}),n,{},u,l,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,y,x)}updatePaintArray(e,n,i,l,u,h,m){let y=this.expression.evaluate({zoom:this.zoom,brightness:m},i,l,void 0,u),x=this.expression.evaluate({zoom:this.zoom+1,brightness:m},i,l,void 0,u);this._setPaintValue(e,n,y,x)}_setPaintValue(e,n,i,l){if(this.type==="color"){let u=Av(i),h=Av(l);for(let m=e;m<n;m++)this.paintVertexArray.emplace(m,u[0],u[1],h[0],h[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,i,l);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,l,u){let h=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,m=Bt(this.expression.interpolationFactor(h,this.zoom,this.zoom+1),0,1);n.set(e,u,m)}getBinding(e,n){return new fi(e)}}class Wa{constructor(e,n,i,l,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(i==="array"?AP:CP).members;for(let h=0;h<n.length;++h);this.paintVertexArray=new l}populatePaintArray(e,n,i){let l=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(l,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,l,u,h,m){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],h)}_setPaintValues(e,n,i,l){if(!l||!i)return;let u=l[i];if(!u)return;let{tl:h,br:m,pixelRatio:y}=u;for(let x=e;x<n;x++)this.paintVertexArray.emplace(x,h[0],h[1],m[0],m[1],y)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tc{constructor(e,n,i=()=>!0){this.binders={},this._buffers=[];let l=[];for(let u in e.paint._values){let h=e.paint.get(u);if(!i(u)||!(h instanceof be&&gs(h.property.specification)))continue;let m=NP(u,e.type),y=h.value,x=h.property.specification.type,w=!!h.property.useIntegerZoom,T=u==="line-dasharray"||u.endsWith("pattern"),D=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(y.kind!=="constant"||D)if(y.kind==="source"||D||T){let S=EE(u,x,"source");this.binders[u]=T?new Wa(y,m,x,S,e.id):new ha(y,m,x,S),l.push(`/a_${u}`)}else{let S=EE(u,x,"composite");this.binders[u]=new zo(y,m,x,w,n,S),l.push(`/z_${u}`)}else this.binders[u]=T?new Pu(y.value,m):new Hd(y.value,m,x),l.push(`/u_${u}`)}this.cacheKey=l.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof ha||n instanceof zo?n.maxValue:0}populatePaintArrays(e,n,i,l,u,h,m){for(let y in this.binders){let x=this.binders[y];(x instanceof ha||x instanceof zo||x instanceof Wa)&&x.populatePaintArray(e,n,i,l,u,h,m)}}setConstantPatternPositions(e){for(let n in this.binders){let i=this.binders[n];i instanceof Pu&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,l,u,h,m,y){let x=!1,w=Object.keys(e),T=w.length!==0,D=T?w:n.uniqueIds;for(let S in this.binders){let A=this.binders[S];if((A instanceof ha||A instanceof zo||A instanceof Wa)&&(A.expression.isStateDependent===!0||A.expression.isLightConstant===!1)){let P=u.paint.get(S);A.expression=P.value;for(let k of D){let N=e[k.toString()];n.eachPosition(k,(H,q,Z)=>{let K=l.feature(H);A.updatePaintArray(q,Z,K,N,h,m,y)})}if(!T)for(let k of i.uniqueIds){let N=e[k.toString()];i.eachPosition(k,(H,q,Z)=>{let K=l.feature(H);A.updatePaintArray(q,Z,K,N,h,m,y)})}x=!0}}return x}defines(){let e=[];for(let n in this.binders){let i=this.binders[n];(i instanceof Hd||i instanceof Pu)&&e.push(...i.uniformNames.map(l=>`#define HAS_UNIFORM_${l}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof ha||i instanceof zo||i instanceof Wa)for(let l=0;l<i.paintVertexAttributes.length;l++)e.push(i.paintVertexAttributes[l].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof Hd||i instanceof Pu||i instanceof zo)for(let l of i.uniformNames)e.push(l)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let i in this.binders){let l=this.binders[i];if(l instanceof Hd||l instanceof Pu||l instanceof zo)for(let u of l.uniformNames)n.push({name:u,property:i,binding:l.getBinding(e,u)})}return n}setUniforms(e,n,i,l,u){for(let{name:h,property:m,binding:y}of i)this.binders[m].setUniform(e,y,u,l.get(m),h)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof ha||n instanceof zo||n instanceof Wa)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let i=this.binders[n];(i instanceof ha||i instanceof zo||i instanceof Wa)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof ha||n instanceof zo||n instanceof Wa)&&n.destroy()}}}class Za{constructor(e,n,i=()=>!0){this.programConfigurations={};for(let l of e)this.programConfigurations[l.id]=new tc(l,n,i);this.needsUpload=!1,this._featureMap=new $d,this._featureMapWithoutIds=new $d,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,l,u,h,m,y){for(let x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,n,l,u,h,m,y);n.id!==void 0?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,l,u,h){for(let m of i)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,m,l,u,h||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let FP={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function NP(t,e){return FP[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let zP={"line-pattern":{source:an,composite:an},"fill-pattern":{source:an,composite:an},"fill-extrusion-pattern":{source:an,composite:an},"line-dasharray":{source:cn,composite:cn}},BP={color:{source:Ud,composite:mn},number:{source:No,composite:Ud}};function EE(t,e,n){let i=zP[t];return i&&i[n]||BP[e][n]}it(Hd,"ConstantBinder"),it(Pu,"PatternConstantBinder"),it(ha,"SourceExpressionBinder"),it(Wa,"PatternCompositeBinder"),it(zo,"CompositeExpressionBinder"),it(tc,"ProgramConfiguration",{omit:["_buffers"]}),it(Za,"ProgramConfigurationSet");class Xa{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof gn?new gn(e.lng,e.lat):gn.convert(e),this}setSouthWest(e){return this._sw=e instanceof gn?new gn(e.lng,e.lat):gn.convert(e),this}extend(e){let n=this._sw,i=this._ne,l,u;if(e instanceof gn)l=e,u=e;else{if(!(e instanceof Xa))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Xa.convert(e)):this.extend(gn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(gn.convert(e)):this;if(l=e._sw,u=e._ne,!l||!u)return this}return n||i?(n.lng=Math.min(l.lng,n.lng),n.lat=Math.min(l.lat,n.lat),i.lng=Math.max(u.lng,i.lng),i.lat=Math.max(u.lat,i.lat)):(this._sw=new gn(l.lng,l.lat),this._ne=new gn(u.lng,u.lat)),this}getCenter(){return new gn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new gn(this.getWest(),this.getNorth())}getSouthEast(){return new gn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:i}=gn.convert(e),l=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(l=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&l}static convert(e){return!e||e instanceof Xa?e:new Xa(e)}}var Mr={},Sr={};Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.setMatrixArrayType=function(t){Sr.ARRAY_TYPE=IE=t},Sr.toRadian=function(t){return t*VP},Sr.equals=function(t,e){return Math.abs(t-e)<=TE*Math.max(1,Math.abs(t),Math.abs(e))},Sr.RANDOM=Sr.ARRAY_TYPE=Sr.EPSILON=void 0;var TE=1e-6;Sr.EPSILON=TE;var IE=typeof Float32Array<"u"?Float32Array:Array;Sr.ARRAY_TYPE=IE;var jP=Math.random;Sr.RANDOM=jP;var VP=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Yn={};function Rv(t){return Rv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rv(t)}Object.defineProperty(Yn,"__esModule",{value:!0}),Yn.create=function(){var t=new Ya.ARRAY_TYPE(4);return Ya.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Yn.clone=function(t){var e=new Ya.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Yn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Yn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Yn.fromValues=function(t,e,n,i){var l=new Ya.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=i,l},Yn.set=function(t,e,n,i,l){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t},Yn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Yn.invert=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=n*u-l*i;return h?(t[0]=u*(h=1/h),t[1]=-i*h,t[2]=-l*h,t[3]=n*h,t):null},Yn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Yn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Yn.multiply=ME,Yn.rotate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=i*y+u*m,t[1]=l*y+h*m,t[2]=i*-m+u*y,t[3]=l*-m+h*y,t},Yn.scale=function(t,e,n){var i=e[1],l=e[2],u=e[3],h=n[0],m=n[1];return t[0]=e[0]*h,t[1]=i*h,t[2]=l*m,t[3]=u*m,t},Yn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},Yn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Yn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Yn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Yn.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},Yn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Yn.subtract=SE,Yn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Yn.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=e[0],m=e[1],y=e[2],x=e[3];return Math.abs(n-h)<=Ya.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-m)<=Ya.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(l-y)<=Ya.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-x)<=Ya.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Yn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Yn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Yn.sub=Yn.mul=void 0;var Ya=function(t,e){if(t&&t.__esModule)return t;if(t===null||Rv(t)!=="object"&&typeof t!="function")return{default:t};var n=DE(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function DE(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(DE=function(i){return i?n:e})(t)}function ME(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],w=n[3];return t[0]=i*m+u*y,t[1]=l*m+h*y,t[2]=i*x+u*w,t[3]=l*x+h*w,t}function SE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Yn.mul=ME,Yn.sub=SE;var Kn={};function Pv(t){return Pv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pv(t)}Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.create=function(){var t=new xs.ARRAY_TYPE(6);return xs.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Kn.clone=function(t){var e=new xs.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Kn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Kn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Kn.fromValues=function(t,e,n,i,l,u){var h=new xs.ARRAY_TYPE(6);return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=l,h[5]=u,h},Kn.set=function(t,e,n,i,l,u,h){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t[4]=u,t[5]=h,t},Kn.invert=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=n*u-i*l;return y?(t[0]=u*(y=1/y),t[1]=-i*y,t[2]=-l*y,t[3]=n*y,t[4]=(l*m-u*h)*y,t[5]=(i*h-n*m)*y,t):null},Kn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Kn.multiply=AE,Kn.rotate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=Math.sin(n),w=Math.cos(n);return t[0]=i*w+u*x,t[1]=l*w+h*x,t[2]=i*-x+u*w,t[3]=l*-x+h*w,t[4]=m,t[5]=y,t},Kn.scale=function(t,e,n){var i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=n[0],x=n[1];return t[0]=e[0]*y,t[1]=i*y,t[2]=l*x,t[3]=u*x,t[4]=h,t[5]=m,t},Kn.translate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=n[0],w=n[1];return t[0]=i,t[1]=l,t[2]=u,t[3]=h,t[4]=i*x+u*w+m,t[5]=l*x+h*w+y,t},Kn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},Kn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Kn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Kn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Kn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Kn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Kn.subtract=RE,Kn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Kn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},Kn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Kn.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=t[4],m=t[5],y=e[0],x=e[1],w=e[2],T=e[3],D=e[4],S=e[5];return Math.abs(n-y)<=xs.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-x)<=xs.EPSILON*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(l-w)<=xs.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(u-T)<=xs.EPSILON*Math.max(1,Math.abs(u),Math.abs(T))&&Math.abs(h-D)<=xs.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(m-S)<=xs.EPSILON*Math.max(1,Math.abs(m),Math.abs(S))},Kn.sub=Kn.mul=void 0;var xs=function(t,e){if(t&&t.__esModule)return t;if(t===null||Pv(t)!=="object"&&typeof t!="function")return{default:t};var n=CE(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function CE(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(CE=function(i){return i?n:e})(t)}function AE(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=n[0],w=n[1],T=n[2],D=n[3],S=n[4],A=n[5];return t[0]=i*x+u*w,t[1]=l*x+h*w,t[2]=i*T+u*D,t[3]=l*T+h*D,t[4]=i*S+u*A+m,t[5]=l*S+h*A+y,t}function RE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Kn.mul=AE,Kn.sub=RE;var Tn={};function Ov(t){return Ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ov(t)}Object.defineProperty(Tn,"__esModule",{value:!0}),Tn.create=function(){var t=new no.ARRAY_TYPE(9);return no.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},Tn.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},Tn.clone=function(t){var e=new no.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},Tn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Tn.fromValues=function(t,e,n,i,l,u,h,m,y){var x=new no.ARRAY_TYPE(9);return x[0]=t,x[1]=e,x[2]=n,x[3]=i,x[4]=l,x[5]=u,x[6]=h,x[7]=m,x[8]=y,x},Tn.set=function(t,e,n,i,l,u,h,m,y,x){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t[8]=x,t},Tn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],l=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=l}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},Tn.invert=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],w=e[8],T=w*h-m*x,D=-w*u+m*y,S=x*u-h*y,A=n*T+i*D+l*S;return A?(t[0]=T*(A=1/A),t[1]=(-w*i+l*x)*A,t[2]=(m*i-l*h)*A,t[3]=D*A,t[4]=(w*n-l*y)*A,t[5]=(-m*n+l*u)*A,t[6]=S*A,t[7]=(-x*n+i*y)*A,t[8]=(h*n-i*u)*A,t):null},Tn.adjoint=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],w=e[8];return t[0]=h*w-m*x,t[1]=l*x-i*w,t[2]=i*m-l*h,t[3]=m*y-u*w,t[4]=n*w-l*y,t[5]=l*u-n*m,t[6]=u*x-h*y,t[7]=i*y-n*x,t[8]=n*h-i*u,t},Tn.determinant=function(t){var e=t[3],n=t[4],i=t[5],l=t[6],u=t[7],h=t[8];return t[0]*(h*n-i*u)+t[1]*(-h*e+i*l)+t[2]*(u*e-n*l)},Tn.multiply=OE,Tn.translate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=e[8],D=n[0],S=n[1];return t[0]=i,t[1]=l,t[2]=u,t[3]=h,t[4]=m,t[5]=y,t[6]=D*i+S*h+x,t[7]=D*l+S*m+w,t[8]=D*u+S*y+T,t},Tn.rotate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=e[8],D=Math.sin(n),S=Math.cos(n);return t[0]=S*i+D*h,t[1]=S*l+D*m,t[2]=S*u+D*y,t[3]=S*h-D*i,t[4]=S*m-D*l,t[5]=S*y-D*u,t[6]=x,t[7]=w,t[8]=T,t},Tn.scale=function(t,e,n){var i=n[0],l=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=l*e[3],t[4]=l*e[4],t[5]=l*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},Tn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},Tn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},Tn.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},Tn.fromQuat=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=n+n,m=i+i,y=l+l,x=n*h,w=i*h,T=i*m,D=l*h,S=l*m,A=l*y,P=u*h,k=u*m,N=u*y;return t[0]=1-T-A,t[3]=w-N,t[6]=D+k,t[1]=w+N,t[4]=1-x-A,t[7]=S-P,t[2]=D-k,t[5]=S+P,t[8]=1-x-T,t},Tn.normalFromMat4=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],w=e[8],T=e[9],D=e[10],S=e[11],A=e[12],P=e[13],k=e[14],N=e[15],H=n*m-i*h,q=n*y-l*h,Z=n*x-u*h,K=i*y-l*m,ee=i*x-u*m,le=l*x-u*y,he=w*P-T*A,fe=w*k-D*A,xe=w*N-S*A,_e=T*k-D*P,Me=T*N-S*P,Be=D*N-S*k,Te=H*Be-q*Me+Z*_e+K*xe-ee*fe+le*he;return Te?(t[0]=(m*Be-y*Me+x*_e)*(Te=1/Te),t[1]=(y*xe-h*Be-x*fe)*Te,t[2]=(h*Me-m*xe+x*he)*Te,t[3]=(l*Me-i*Be-u*_e)*Te,t[4]=(n*Be-l*xe+u*fe)*Te,t[5]=(i*xe-n*Me-u*he)*Te,t[6]=(P*le-k*ee+N*K)*Te,t[7]=(k*Z-A*le-N*q)*Te,t[8]=(A*ee-P*Z+N*H)*Te,t):null},Tn.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},Tn.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},Tn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},Tn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},Tn.subtract=kE,Tn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},Tn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},Tn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},Tn.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],w=t[8],T=e[0],D=e[1],S=e[2],A=e[3],P=e[4],k=e[5],N=e[6],H=e[7],q=e[8];return Math.abs(n-T)<=no.EPSILON*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(i-D)<=no.EPSILON*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(l-S)<=no.EPSILON*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(u-A)<=no.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(h-P)<=no.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(m-k)<=no.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-N)<=no.EPSILON*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(x-H)<=no.EPSILON*Math.max(1,Math.abs(x),Math.abs(H))&&Math.abs(w-q)<=no.EPSILON*Math.max(1,Math.abs(w),Math.abs(q))},Tn.sub=Tn.mul=void 0;var no=function(t,e){if(t&&t.__esModule)return t;if(t===null||Ov(t)!=="object"&&typeof t!="function")return{default:t};var n=PE(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function PE(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(PE=function(i){return i?n:e})(t)}function OE(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=e[8],D=n[0],S=n[1],A=n[2],P=n[3],k=n[4],N=n[5],H=n[6],q=n[7],Z=n[8];return t[0]=D*i+S*h+A*x,t[1]=D*l+S*m+A*w,t[2]=D*u+S*y+A*T,t[3]=P*i+k*h+N*x,t[4]=P*l+k*m+N*w,t[5]=P*u+k*y+N*T,t[6]=H*i+q*h+Z*x,t[7]=H*l+q*m+Z*w,t[8]=H*u+q*y+Z*T,t}function kE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}Tn.mul=OE,Tn.sub=kE;var jt={};function kv(t){return kv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kv(t)}Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=function(){var t=new rr.ARRAY_TYPE(16);return rr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},jt.clone=function(t){var e=new rr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},jt.fromValues=function(t,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P){var k=new rr.ARRAY_TYPE(16);return k[0]=t,k[1]=e,k[2]=n,k[3]=i,k[4]=l,k[5]=u,k[6]=h,k[7]=m,k[8]=y,k[9]=x,k[10]=w,k[11]=T,k[12]=D,k[13]=S,k[14]=A,k[15]=P,k},jt.set=function(t,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t[8]=x,t[9]=w,t[10]=T,t[11]=D,t[12]=S,t[13]=A,t[14]=P,t[15]=k,t},jt.identity=FE,jt.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],l=e[3],u=e[6],h=e[7],m=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=u,t[11]=e[14],t[12]=l,t[13]=h,t[14]=m}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},jt.invert=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],w=e[8],T=e[9],D=e[10],S=e[11],A=e[12],P=e[13],k=e[14],N=e[15],H=n*m-i*h,q=n*y-l*h,Z=n*x-u*h,K=i*y-l*m,ee=i*x-u*m,le=l*x-u*y,he=w*P-T*A,fe=w*k-D*A,xe=w*N-S*A,_e=T*k-D*P,Me=T*N-S*P,Be=D*N-S*k,Te=H*Be-q*Me+Z*_e+K*xe-ee*fe+le*he;return Te?(t[0]=(m*Be-y*Me+x*_e)*(Te=1/Te),t[1]=(l*Me-i*Be-u*_e)*Te,t[2]=(P*le-k*ee+N*K)*Te,t[3]=(D*ee-T*le-S*K)*Te,t[4]=(y*xe-h*Be-x*fe)*Te,t[5]=(n*Be-l*xe+u*fe)*Te,t[6]=(k*Z-A*le-N*q)*Te,t[7]=(w*le-D*Z+S*q)*Te,t[8]=(h*Me-m*xe+x*he)*Te,t[9]=(i*xe-n*Me-u*he)*Te,t[10]=(A*ee-P*Z+N*H)*Te,t[11]=(T*Z-w*ee-S*H)*Te,t[12]=(m*fe-h*_e-y*he)*Te,t[13]=(n*_e-i*fe+l*he)*Te,t[14]=(P*q-A*K-k*H)*Te,t[15]=(w*K-T*q+D*H)*Te,t):null},jt.adjoint=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=e[4],m=e[5],y=e[6],x=e[7],w=e[8],T=e[9],D=e[10],S=e[11],A=e[12],P=e[13],k=e[14],N=e[15];return t[0]=m*(D*N-S*k)-T*(y*N-x*k)+P*(y*S-x*D),t[1]=-(i*(D*N-S*k)-T*(l*N-u*k)+P*(l*S-u*D)),t[2]=i*(y*N-x*k)-m*(l*N-u*k)+P*(l*x-u*y),t[3]=-(i*(y*S-x*D)-m*(l*S-u*D)+T*(l*x-u*y)),t[4]=-(h*(D*N-S*k)-w*(y*N-x*k)+A*(y*S-x*D)),t[5]=n*(D*N-S*k)-w*(l*N-u*k)+A*(l*S-u*D),t[6]=-(n*(y*N-x*k)-h*(l*N-u*k)+A*(l*x-u*y)),t[7]=n*(y*S-x*D)-h*(l*S-u*D)+w*(l*x-u*y),t[8]=h*(T*N-S*P)-w*(m*N-x*P)+A*(m*S-x*T),t[9]=-(n*(T*N-S*P)-w*(i*N-u*P)+A*(i*S-u*T)),t[10]=n*(m*N-x*P)-h*(i*N-u*P)+A*(i*x-u*m),t[11]=-(n*(m*S-x*T)-h*(i*S-u*T)+w*(i*x-u*m)),t[12]=-(h*(T*k-D*P)-w*(m*k-y*P)+A*(m*D-y*T)),t[13]=n*(T*k-D*P)-w*(i*k-l*P)+A*(i*D-l*T),t[14]=-(n*(m*k-y*P)-h*(i*k-l*P)+A*(i*y-l*m)),t[15]=n*(m*D-y*T)-h*(i*D-l*T)+w*(i*y-l*m),t},jt.determinant=function(t){var e=t[0],n=t[1],i=t[2],l=t[3],u=t[4],h=t[5],m=t[6],y=t[7],x=t[8],w=t[9],T=t[10],D=t[11],S=t[12],A=t[13],P=t[14],k=t[15];return(e*h-n*u)*(T*k-D*P)-(e*m-i*u)*(w*k-D*A)+(e*y-l*u)*(w*P-T*A)+(n*m-i*h)*(x*k-D*S)-(n*y-l*h)*(x*P-T*S)+(i*y-l*m)*(x*A-w*S)},jt.multiply=NE,jt.translate=function(t,e,n){var i,l,u,h,m,y,x,w,T,D,S,A,P=n[0],k=n[1],N=n[2];return e===t?(t[12]=e[0]*P+e[4]*k+e[8]*N+e[12],t[13]=e[1]*P+e[5]*k+e[9]*N+e[13],t[14]=e[2]*P+e[6]*k+e[10]*N+e[14],t[15]=e[3]*P+e[7]*k+e[11]*N+e[15]):(l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=e[8],D=e[9],S=e[10],A=e[11],t[0]=i=e[0],t[1]=l,t[2]=u,t[3]=h,t[4]=m,t[5]=y,t[6]=x,t[7]=w,t[8]=T,t[9]=D,t[10]=S,t[11]=A,t[12]=i*P+m*k+T*N+e[12],t[13]=l*P+y*k+D*N+e[13],t[14]=u*P+x*k+S*N+e[14],t[15]=h*P+w*k+A*N+e[15]),t},jt.scale=function(t,e,n){var i=n[0],l=n[1],u=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*l,t[5]=e[5]*l,t[6]=e[6]*l,t[7]=e[7]*l,t[8]=e[8]*u,t[9]=e[9]*u,t[10]=e[10]*u,t[11]=e[11]*u,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},jt.rotate=function(t,e,n,i){var l,u,h,m,y,x,w,T,D,S,A,P,k,N,H,q,Z,K,ee,le,he,fe,xe,_e,Me=i[0],Be=i[1],Te=i[2],ke=Math.hypot(Me,Be,Te);return ke<rr.EPSILON?null:(Me*=ke=1/ke,Be*=ke,Te*=ke,l=Math.sin(n),u=Math.cos(n),y=e[1],x=e[2],w=e[3],D=e[5],S=e[6],A=e[7],k=e[9],N=e[10],H=e[11],ee=Me*Be*(h=1-u)-Te*l,le=Be*Be*h+u,he=Te*Be*h+Me*l,fe=Me*Te*h+Be*l,xe=Be*Te*h-Me*l,_e=Te*Te*h+u,t[0]=(m=e[0])*(q=Me*Me*h+u)+(T=e[4])*(Z=Be*Me*h+Te*l)+(P=e[8])*(K=Te*Me*h-Be*l),t[1]=y*q+D*Z+k*K,t[2]=x*q+S*Z+N*K,t[3]=w*q+A*Z+H*K,t[4]=m*ee+T*le+P*he,t[5]=y*ee+D*le+k*he,t[6]=x*ee+S*le+N*he,t[7]=w*ee+A*le+H*he,t[8]=m*fe+T*xe+P*_e,t[9]=y*fe+D*xe+k*_e,t[10]=x*fe+S*xe+N*_e,t[11]=w*fe+A*xe+H*_e,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},jt.rotateX=function(t,e,n){var i=Math.sin(n),l=Math.cos(n),u=e[4],h=e[5],m=e[6],y=e[7],x=e[8],w=e[9],T=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=u*l+x*i,t[5]=h*l+w*i,t[6]=m*l+T*i,t[7]=y*l+D*i,t[8]=x*l-u*i,t[9]=w*l-h*i,t[10]=T*l-m*i,t[11]=D*l-y*i,t},jt.rotateY=function(t,e,n){var i=Math.sin(n),l=Math.cos(n),u=e[0],h=e[1],m=e[2],y=e[3],x=e[8],w=e[9],T=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l-x*i,t[1]=h*l-w*i,t[2]=m*l-T*i,t[3]=y*l-D*i,t[8]=u*i+x*l,t[9]=h*i+w*l,t[10]=m*i+T*l,t[11]=y*i+D*l,t},jt.rotateZ=function(t,e,n){var i=Math.sin(n),l=Math.cos(n),u=e[0],h=e[1],m=e[2],y=e[3],x=e[4],w=e[5],T=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=u*l+x*i,t[1]=h*l+w*i,t[2]=m*l+T*i,t[3]=y*l+D*i,t[4]=x*l-u*i,t[5]=w*l-h*i,t[6]=T*l-m*i,t[7]=D*l-y*i,t},jt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},jt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromRotation=function(t,e,n){var i,l,u,h=n[0],m=n[1],y=n[2],x=Math.hypot(h,m,y);return x<rr.EPSILON?null:(h*=x=1/x,m*=x,y*=x,i=Math.sin(e),l=Math.cos(e),t[0]=h*h*(u=1-l)+l,t[1]=m*h*u+y*i,t[2]=y*h*u-m*i,t[3]=0,t[4]=h*m*u-y*i,t[5]=m*m*u+l,t[6]=y*m*u+h*i,t[7]=0,t[8]=h*y*u+m*i,t[9]=m*y*u-h*i,t[10]=y*y*u+l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},jt.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.fromRotationTranslation=zE,jt.fromQuat2=function(t,e){var n=new rr.ARRAY_TYPE(3),i=-e[0],l=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=i*i+l*l+u*u+h*h;return T>0?(n[0]=2*(m*h+w*i+y*u-x*l)/T,n[1]=2*(y*h+w*l+x*i-m*u)/T,n[2]=2*(x*h+w*u+m*l-y*i)/T):(n[0]=2*(m*h+w*i+y*u-x*l),n[1]=2*(y*h+w*l+x*i-m*u),n[2]=2*(x*h+w*u+m*l-y*i)),zE(t,e,n),t},jt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},jt.getScaling=BE,jt.getRotation=function(t,e){var n=new rr.ARRAY_TYPE(3);BE(n,e);var i=1/n[0],l=1/n[1],u=1/n[2],h=e[0]*i,m=e[1]*l,y=e[2]*u,x=e[4]*i,w=e[5]*l,T=e[6]*u,D=e[8]*i,S=e[9]*l,A=e[10]*u,P=h+w+A,k=0;return P>0?(k=2*Math.sqrt(P+1),t[3]=.25*k,t[0]=(T-S)/k,t[1]=(D-y)/k,t[2]=(m-x)/k):h>w&&h>A?(k=2*Math.sqrt(1+h-w-A),t[3]=(T-S)/k,t[0]=.25*k,t[1]=(m+x)/k,t[2]=(D+y)/k):w>A?(k=2*Math.sqrt(1+w-h-A),t[3]=(D-y)/k,t[0]=(m+x)/k,t[1]=.25*k,t[2]=(T+S)/k):(k=2*Math.sqrt(1+A-h-w),t[3]=(m-x)/k,t[0]=(D+y)/k,t[1]=(T+S)/k,t[2]=.25*k),t},jt.fromRotationTranslationScale=function(t,e,n,i){var l=e[0],u=e[1],h=e[2],m=e[3],y=l+l,x=u+u,w=h+h,T=l*y,D=l*x,S=l*w,A=u*x,P=u*w,k=h*w,N=m*y,H=m*x,q=m*w,Z=i[0],K=i[1],ee=i[2];return t[0]=(1-(A+k))*Z,t[1]=(D+q)*Z,t[2]=(S-H)*Z,t[3]=0,t[4]=(D-q)*K,t[5]=(1-(T+k))*K,t[6]=(P+N)*K,t[7]=0,t[8]=(S+H)*ee,t[9]=(P-N)*ee,t[10]=(1-(T+A))*ee,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},jt.fromRotationTranslationScaleOrigin=function(t,e,n,i,l){var u=e[0],h=e[1],m=e[2],y=e[3],x=u+u,w=h+h,T=m+m,D=u*x,S=u*w,A=u*T,P=h*w,k=h*T,N=m*T,H=y*x,q=y*w,Z=y*T,K=i[0],ee=i[1],le=i[2],he=l[0],fe=l[1],xe=l[2],_e=(1-(P+N))*K,Me=(S+Z)*K,Be=(A-q)*K,Te=(S-Z)*ee,ke=(1-(D+N))*ee,Ee=(k+H)*ee,Je=(A+q)*le,rt=(k-H)*le,Ne=(1-(D+P))*le;return t[0]=_e,t[1]=Me,t[2]=Be,t[3]=0,t[4]=Te,t[5]=ke,t[6]=Ee,t[7]=0,t[8]=Je,t[9]=rt,t[10]=Ne,t[11]=0,t[12]=n[0]+he-(_e*he+Te*fe+Je*xe),t[13]=n[1]+fe-(Me*he+ke*fe+rt*xe),t[14]=n[2]+xe-(Be*he+Ee*fe+Ne*xe),t[15]=1,t},jt.fromQuat=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=n+n,m=i+i,y=l+l,x=n*h,w=i*h,T=i*m,D=l*h,S=l*m,A=l*y,P=u*h,k=u*m,N=u*y;return t[0]=1-T-A,t[1]=w+N,t[2]=D-k,t[3]=0,t[4]=w-N,t[5]=1-x-A,t[6]=S+P,t[7]=0,t[8]=D+k,t[9]=S-P,t[10]=1-x-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},jt.frustum=function(t,e,n,i,l,u,h){var m=1/(n-e),y=1/(l-i),x=1/(u-h);return t[0]=2*u*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*u*y,t[6]=0,t[7]=0,t[8]=(n+e)*m,t[9]=(l+i)*y,t[10]=(h+u)*x,t[11]=-1,t[12]=0,t[13]=0,t[14]=h*u*2*x,t[15]=0,t},jt.perspectiveNO=jE,jt.perspectiveZO=function(t,e,n,i,l){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=l*(u=1/(i-l)),t[14]=l*i*u):(t[10]=-1,t[14]=-i),t},jt.perspectiveFromFieldOfView=function(t,e,n,i){var l=Math.tan(e.upDegrees*Math.PI/180),u=Math.tan(e.downDegrees*Math.PI/180),h=Math.tan(e.leftDegrees*Math.PI/180),m=Math.tan(e.rightDegrees*Math.PI/180),y=2/(h+m),x=2/(l+u);return t[0]=y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=-(h-m)*y*.5,t[9]=(l-u)*x*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},jt.orthoNO=VE,jt.orthoZO=function(t,e,n,i,l,u,h){var m=1/(e-n),y=1/(i-l),x=1/(u-h);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=x,t[11]=0,t[12]=(e+n)*m,t[13]=(l+i)*y,t[14]=u*x,t[15]=1,t},jt.lookAt=function(t,e,n,i){var l,u,h,m,y,x,w,T,D,S,A=e[0],P=e[1],k=e[2],N=i[0],H=i[1],q=i[2],Z=n[0],K=n[1],ee=n[2];return Math.abs(A-Z)<rr.EPSILON&&Math.abs(P-K)<rr.EPSILON&&Math.abs(k-ee)<rr.EPSILON?FE(t):(w=A-Z,T=P-K,D=k-ee,l=H*(D*=S=1/Math.hypot(w,T,D))-q*(T*=S),u=q*(w*=S)-N*D,h=N*T-H*w,(S=Math.hypot(l,u,h))?(l*=S=1/S,u*=S,h*=S):(l=0,u=0,h=0),m=T*h-D*u,y=D*l-w*h,x=w*u-T*l,(S=Math.hypot(m,y,x))?(m*=S=1/S,y*=S,x*=S):(m=0,y=0,x=0),t[0]=l,t[1]=m,t[2]=w,t[3]=0,t[4]=u,t[5]=y,t[6]=T,t[7]=0,t[8]=h,t[9]=x,t[10]=D,t[11]=0,t[12]=-(l*A+u*P+h*k),t[13]=-(m*A+y*P+x*k),t[14]=-(w*A+T*P+D*k),t[15]=1,t)},jt.targetTo=function(t,e,n,i){var l=e[0],u=e[1],h=e[2],m=i[0],y=i[1],x=i[2],w=l-n[0],T=u-n[1],D=h-n[2],S=w*w+T*T+D*D;S>0&&(w*=S=1/Math.sqrt(S),T*=S,D*=S);var A=y*D-x*T,P=x*w-m*D,k=m*T-y*w;return(S=A*A+P*P+k*k)>0&&(A*=S=1/Math.sqrt(S),P*=S,k*=S),t[0]=A,t[1]=P,t[2]=k,t[3]=0,t[4]=T*k-D*P,t[5]=D*A-w*k,t[6]=w*P-T*A,t[7]=0,t[8]=w,t[9]=T,t[10]=D,t[11]=0,t[12]=l,t[13]=u,t[14]=h,t[15]=1,t},jt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},jt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},jt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},jt.subtract=UE,jt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},jt.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},jt.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],w=t[8],T=t[9],D=t[10],S=t[11],A=t[12],P=t[13],k=t[14],N=t[15],H=e[0],q=e[1],Z=e[2],K=e[3],ee=e[4],le=e[5],he=e[6],fe=e[7],xe=e[8],_e=e[9],Me=e[10],Be=e[11],Te=e[12],ke=e[13],Ee=e[14],Je=e[15];return Math.abs(n-H)<=rr.EPSILON*Math.max(1,Math.abs(n),Math.abs(H))&&Math.abs(i-q)<=rr.EPSILON*Math.max(1,Math.abs(i),Math.abs(q))&&Math.abs(l-Z)<=rr.EPSILON*Math.max(1,Math.abs(l),Math.abs(Z))&&Math.abs(u-K)<=rr.EPSILON*Math.max(1,Math.abs(u),Math.abs(K))&&Math.abs(h-ee)<=rr.EPSILON*Math.max(1,Math.abs(h),Math.abs(ee))&&Math.abs(m-le)<=rr.EPSILON*Math.max(1,Math.abs(m),Math.abs(le))&&Math.abs(y-he)<=rr.EPSILON*Math.max(1,Math.abs(y),Math.abs(he))&&Math.abs(x-fe)<=rr.EPSILON*Math.max(1,Math.abs(x),Math.abs(fe))&&Math.abs(w-xe)<=rr.EPSILON*Math.max(1,Math.abs(w),Math.abs(xe))&&Math.abs(T-_e)<=rr.EPSILON*Math.max(1,Math.abs(T),Math.abs(_e))&&Math.abs(D-Me)<=rr.EPSILON*Math.max(1,Math.abs(D),Math.abs(Me))&&Math.abs(S-Be)<=rr.EPSILON*Math.max(1,Math.abs(S),Math.abs(Be))&&Math.abs(A-Te)<=rr.EPSILON*Math.max(1,Math.abs(A),Math.abs(Te))&&Math.abs(P-ke)<=rr.EPSILON*Math.max(1,Math.abs(P),Math.abs(ke))&&Math.abs(k-Ee)<=rr.EPSILON*Math.max(1,Math.abs(k),Math.abs(Ee))&&Math.abs(N-Je)<=rr.EPSILON*Math.max(1,Math.abs(N),Math.abs(Je))},jt.sub=jt.mul=jt.ortho=jt.perspective=void 0;var rr=function(t,e){if(t&&t.__esModule)return t;if(t===null||kv(t)!=="object"&&typeof t!="function")return{default:t};var n=LE(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function LE(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(LE=function(i){return i?n:e})(t)}function FE(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function NE(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=e[8],D=e[9],S=e[10],A=e[11],P=e[12],k=e[13],N=e[14],H=e[15],q=n[0],Z=n[1],K=n[2],ee=n[3];return t[0]=q*i+Z*m+K*T+ee*P,t[1]=q*l+Z*y+K*D+ee*k,t[2]=q*u+Z*x+K*S+ee*N,t[3]=q*h+Z*w+K*A+ee*H,t[4]=(q=n[4])*i+(Z=n[5])*m+(K=n[6])*T+(ee=n[7])*P,t[5]=q*l+Z*y+K*D+ee*k,t[6]=q*u+Z*x+K*S+ee*N,t[7]=q*h+Z*w+K*A+ee*H,t[8]=(q=n[8])*i+(Z=n[9])*m+(K=n[10])*T+(ee=n[11])*P,t[9]=q*l+Z*y+K*D+ee*k,t[10]=q*u+Z*x+K*S+ee*N,t[11]=q*h+Z*w+K*A+ee*H,t[12]=(q=n[12])*i+(Z=n[13])*m+(K=n[14])*T+(ee=n[15])*P,t[13]=q*l+Z*y+K*D+ee*k,t[14]=q*u+Z*x+K*S+ee*N,t[15]=q*h+Z*w+K*A+ee*H,t}function zE(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=i+i,y=l+l,x=u+u,w=i*m,T=i*y,D=i*x,S=l*y,A=l*x,P=u*x,k=h*m,N=h*y,H=h*x;return t[0]=1-(S+P),t[1]=T+H,t[2]=D-N,t[3]=0,t[4]=T-H,t[5]=1-(w+P),t[6]=A+k,t[7]=0,t[8]=D+N,t[9]=A-k,t[10]=1-(w+S),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function BE(t,e){var n=e[4],i=e[5],l=e[6],u=e[8],h=e[9],m=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,l),t[2]=Math.hypot(u,h,m),t}function jE(t,e,n,i,l){var u,h=1/Math.tan(e/2);return t[0]=h/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,l!=null&&l!==1/0?(t[10]=(l+i)*(u=1/(i-l)),t[14]=2*l*i*u):(t[10]=-1,t[14]=-2*i),t}function VE(t,e,n,i,l,u,h){var m=1/(e-n),y=1/(i-l),x=1/(u-h);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*x,t[11]=0,t[12]=(e+n)*m,t[13]=(l+i)*y,t[14]=(h+u)*x,t[15]=1,t}function UE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}jt.perspective=jE,jt.ortho=VE,jt.mul=NE,jt.sub=UE;var Pt={},zt={};function Lv(t){return Lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lv(t)}Object.defineProperty(zt,"__esModule",{value:!0}),zt.create=GE,zt.clone=function(t){var e=new da.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},zt.length=HE,zt.fromValues=function(t,e,n){var i=new da.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},zt.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},zt.subtract=qE,zt.multiply=WE,zt.divide=ZE,zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},zt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},zt.distance=XE,zt.squaredDistance=YE,zt.squaredLength=JE,zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},zt.normalize=function(t,e){var n=e[0],i=e[1],l=e[2],u=n*n+i*i+l*l;return u>0&&(u=1/Math.sqrt(u)),t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t},zt.dot=KE,zt.cross=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=n[0],m=n[1],y=n[2];return t[0]=l*y-u*m,t[1]=u*h-i*y,t[2]=i*m-l*h,t},zt.lerp=function(t,e,n,i){var l=e[0],u=e[1],h=e[2];return t[0]=l+i*(n[0]-l),t[1]=u+i*(n[1]-u),t[2]=h+i*(n[2]-h),t},zt.hermite=function(t,e,n,i,l,u){var h=u*u,m=h*(2*u-3)+1,y=h*(u-2)+u,x=h*(u-1),w=h*(3-2*u);return t[0]=e[0]*m+n[0]*y+i[0]*x+l[0]*w,t[1]=e[1]*m+n[1]*y+i[1]*x+l[1]*w,t[2]=e[2]*m+n[2]*y+i[2]*x+l[2]*w,t},zt.bezier=function(t,e,n,i,l,u){var h=1-u,m=h*h,y=u*u,x=m*h,w=3*u*m,T=3*y*h,D=y*u;return t[0]=e[0]*x+n[0]*w+i[0]*T+l[0]*D,t[1]=e[1]*x+n[1]*w+i[1]*T+l[1]*D,t[2]=e[2]*x+n[2]*w+i[2]*T+l[2]*D,t},zt.random=function(t,e){e=e||1;var n=2*da.RANDOM()*Math.PI,i=2*da.RANDOM()-1,l=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*l,t[1]=Math.sin(n)*l,t[2]=i*e,t},zt.transformMat4=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=n[3]*i+n[7]*l+n[11]*u+n[15];return t[0]=(n[0]*i+n[4]*l+n[8]*u+n[12])/(h=h||1),t[1]=(n[1]*i+n[5]*l+n[9]*u+n[13])/h,t[2]=(n[2]*i+n[6]*l+n[10]*u+n[14])/h,t},zt.transformMat3=function(t,e,n){var i=e[0],l=e[1],u=e[2];return t[0]=i*n[0]+l*n[3]+u*n[6],t[1]=i*n[1]+l*n[4]+u*n[7],t[2]=i*n[2]+l*n[5]+u*n[8],t},zt.transformQuat=function(t,e,n){var i=n[0],l=n[1],u=n[2],h=e[0],m=e[1],y=e[2],x=l*y-u*m,w=u*h-i*y,T=i*m-l*h,D=l*T-u*w,S=u*x-i*T,A=i*w-l*x,P=2*n[3];return w*=P,T*=P,S*=2,A*=2,t[0]=h+(x*=P)+(D*=2),t[1]=m+w+S,t[2]=y+T+A,t},zt.rotateX=function(t,e,n,i){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[0],u[1]=l[1]*Math.cos(i)-l[2]*Math.sin(i),u[2]=l[1]*Math.sin(i)+l[2]*Math.cos(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},zt.rotateY=function(t,e,n,i){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[2]*Math.sin(i)+l[0]*Math.cos(i),u[1]=l[1],u[2]=l[2]*Math.cos(i)-l[0]*Math.sin(i),t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},zt.rotateZ=function(t,e,n,i){var l=[],u=[];return l[0]=e[0]-n[0],l[1]=e[1]-n[1],l[2]=e[2]-n[2],u[0]=l[0]*Math.cos(i)-l[1]*Math.sin(i),u[1]=l[0]*Math.sin(i)+l[1]*Math.cos(i),u[2]=l[2],t[0]=u[0]+n[0],t[1]=u[1]+n[1],t[2]=u[2]+n[2],t},zt.angle=function(t,e){var n=t[0],i=t[1],l=t[2],u=e[0],h=e[1],m=e[2],y=Math.sqrt(n*n+i*i+l*l)*Math.sqrt(u*u+h*h+m*m),x=y&&KE(t,e)/y;return Math.acos(Math.min(Math.max(x,-1),1))},zt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},zt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},zt.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=e[0],h=e[1],m=e[2];return Math.abs(n-u)<=da.EPSILON*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=da.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(l-m)<=da.EPSILON*Math.max(1,Math.abs(l),Math.abs(m))},zt.forEach=zt.sqrLen=zt.len=zt.sqrDist=zt.dist=zt.div=zt.mul=zt.sub=void 0;var da=function(t,e){if(t&&t.__esModule)return t;if(t===null||Lv(t)!=="object"&&typeof t!="function")return{default:t};var n=$E(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function $E(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return($E=function(i){return i?n:e})(t)}function GE(){var t=new da.ARRAY_TYPE(3);return da.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function HE(t){return Math.hypot(t[0],t[1],t[2])}function qE(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function WE(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ZE(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function XE(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function YE(t,e){var n=e[0]-t[0],i=e[1]-t[1],l=e[2]-t[2];return n*n+i*i+l*l}function JE(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function KE(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}zt.sub=qE,zt.mul=WE,zt.div=ZE,zt.dist=XE,zt.sqrDist=YE,zt.len=HE,zt.sqrLen=JE;var fa,UP=(fa=GE(),function(t,e,n,i,l,u){var h,m;for(e||(e=3),n||(n=0),m=i?Math.min(i*e+n,t.length):t.length,h=n;h<m;h+=e)fa[0]=t[h],fa[1]=t[h+1],fa[2]=t[h+2],l(fa,fa,u),t[h]=fa[0],t[h+1]=fa[1],t[h+2]=fa[2];return t});zt.forEach=UP;var Zt={};function Fv(t){return Fv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Fv(t)}Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.create=eT,Zt.clone=function(t){var e=new _o.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Zt.fromValues=function(t,e,n,i){var l=new _o.ARRAY_TYPE(4);return l[0]=t,l[1]=e,l[2]=n,l[3]=i,l},Zt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Zt.set=function(t,e,n,i,l){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t},Zt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Zt.subtract=tT,Zt.multiply=nT,Zt.divide=rT,Zt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Zt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Zt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},Zt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},Zt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Zt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Zt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Zt.distance=iT,Zt.squaredDistance=oT,Zt.length=sT,Zt.squaredLength=aT,Zt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Zt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Zt.normalize=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=n*n+i*i+l*l+u*u;return h>0&&(h=1/Math.sqrt(h)),t[0]=n*h,t[1]=i*h,t[2]=l*h,t[3]=u*h,t},Zt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Zt.cross=function(t,e,n,i){var l=n[0]*i[1]-n[1]*i[0],u=n[0]*i[2]-n[2]*i[0],h=n[0]*i[3]-n[3]*i[0],m=n[1]*i[2]-n[2]*i[1],y=n[1]*i[3]-n[3]*i[1],x=n[2]*i[3]-n[3]*i[2],w=e[0],T=e[1],D=e[2],S=e[3];return t[0]=T*x-D*y+S*m,t[1]=-w*x+D*h-S*u,t[2]=w*y-T*h+S*l,t[3]=-w*m+T*u-D*l,t},Zt.lerp=function(t,e,n,i){var l=e[0],u=e[1],h=e[2],m=e[3];return t[0]=l+i*(n[0]-l),t[1]=u+i*(n[1]-u),t[2]=h+i*(n[2]-h),t[3]=m+i*(n[3]-m),t},Zt.random=function(t,e){var n,i,l,u,h,m;e=e||1;do h=(n=2*_o.RANDOM()-1)*n+(i=2*_o.RANDOM()-1)*i;while(h>=1);do m=(l=2*_o.RANDOM()-1)*l+(u=2*_o.RANDOM()-1)*u;while(m>=1);var y=Math.sqrt((1-h)/m);return t[0]=e*n,t[1]=e*i,t[2]=e*l*y,t[3]=e*u*y,t},Zt.transformMat4=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3];return t[0]=n[0]*i+n[4]*l+n[8]*u+n[12]*h,t[1]=n[1]*i+n[5]*l+n[9]*u+n[13]*h,t[2]=n[2]*i+n[6]*l+n[10]*u+n[14]*h,t[3]=n[3]*i+n[7]*l+n[11]*u+n[15]*h,t},Zt.transformQuat=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=n[0],m=n[1],y=n[2],x=n[3],w=x*i+m*u-y*l,T=x*l+y*i-h*u,D=x*u+h*l-m*i,S=-h*i-m*l-y*u;return t[0]=w*x+S*-h+T*-y-D*-m,t[1]=T*x+S*-m+D*-h-w*-y,t[2]=D*x+S*-y+w*-m-T*-h,t[3]=e[3],t},Zt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Zt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Zt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Zt.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=e[0],m=e[1],y=e[2],x=e[3];return Math.abs(n-h)<=_o.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-m)<=_o.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(l-y)<=_o.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-x)<=_o.EPSILON*Math.max(1,Math.abs(u),Math.abs(x))},Zt.forEach=Zt.sqrLen=Zt.len=Zt.sqrDist=Zt.dist=Zt.div=Zt.mul=Zt.sub=void 0;var _o=function(t,e){if(t&&t.__esModule)return t;if(t===null||Fv(t)!=="object"&&typeof t!="function")return{default:t};var n=QE(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function QE(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(QE=function(i){return i?n:e})(t)}function eT(){var t=new _o.ARRAY_TYPE(4);return _o.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function nT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function rT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function iT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function oT(t,e){var n=e[0]-t[0],i=e[1]-t[1],l=e[2]-t[2],u=e[3]-t[3];return n*n+i*i+l*l+u*u}function sT(t){return Math.hypot(t[0],t[1],t[2],t[3])}function aT(t){var e=t[0],n=t[1],i=t[2],l=t[3];return e*e+n*n+i*i+l*l}Zt.sub=tT,Zt.mul=nT,Zt.div=rT,Zt.dist=iT,Zt.sqrDist=oT,Zt.len=sT,Zt.sqrLen=aT;var $P=function(){var t=eT();return function(e,n,i,l,u,h){var m,y;for(n||(n=4),i||(i=0),y=l?Math.min(l*n+i,e.length):e.length,m=i;m<y;m+=n)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],t[3]=e[m+3],u(t,t,h),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2],e[m+3]=t[3];return e}}();function Nv(t){return Nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nv(t)}Zt.forEach=$P,Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.create=zv,Pt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Pt.setAxisAngle=cT,Pt.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>nc.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},Pt.getAngle=function(t,e){var n=mT(t,e);return Math.acos(2*n*n-1)},Pt.multiply=uT,Pt.rotateX=function(t,e,n){n*=.5;var i=e[0],l=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=i*y+h*m,t[1]=l*y+u*m,t[2]=u*y-l*m,t[3]=h*y-i*m,t},Pt.rotateY=function(t,e,n){n*=.5;var i=e[0],l=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=i*y-u*m,t[1]=l*y+h*m,t[2]=u*y+i*m,t[3]=h*y-l*m,t},Pt.rotateZ=function(t,e,n){n*=.5;var i=e[0],l=e[1],u=e[2],h=e[3],m=Math.sin(n),y=Math.cos(n);return t[0]=i*y+l*m,t[1]=l*y-i*m,t[2]=u*y+h*m,t[3]=h*y-u*m,t},Pt.calculateW=function(t,e){var n=e[0],i=e[1],l=e[2];return t[0]=n,t[1]=i,t[2]=l,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-l*l)),t},Pt.exp=hT,Pt.ln=dT,Pt.pow=function(t,e,n){return dT(t,e),pT(t,t,n),hT(t,t),t},Pt.slerp=Mm,Pt.random=function(t){var e=nc.RANDOM(),n=nc.RANDOM(),i=nc.RANDOM(),l=Math.sqrt(1-e),u=Math.sqrt(e);return t[0]=l*Math.sin(2*Math.PI*n),t[1]=l*Math.cos(2*Math.PI*n),t[2]=u*Math.sin(2*Math.PI*i),t[3]=u*Math.cos(2*Math.PI*i),t},Pt.invert=function(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=n*n+i*i+l*l+u*u,m=h?1/h:0;return t[0]=-n*m,t[1]=-i*m,t[2]=-l*m,t[3]=u*m,t},Pt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Pt.fromMat3=fT,Pt.fromEuler=function(t,e,n,i){var l=.5*Math.PI/180;e*=l,n*=l,i*=l;var u=Math.sin(e),h=Math.cos(e),m=Math.sin(n),y=Math.cos(n),x=Math.sin(i),w=Math.cos(i);return t[0]=u*y*w-h*m*x,t[1]=h*m*w+u*y*x,t[2]=h*y*x-u*m*w,t[3]=h*y*w+u*m*x,t},Pt.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Pt.setAxes=Pt.sqlerp=Pt.rotationTo=Pt.equals=Pt.exactEquals=Pt.normalize=Pt.sqrLen=Pt.squaredLength=Pt.len=Pt.length=Pt.lerp=Pt.dot=Pt.scale=Pt.mul=Pt.add=Pt.set=Pt.copy=Pt.fromValues=Pt.clone=void 0;var nc=Dm(Sr),GP=Dm(Tn),pa=Dm(zt),ro=Dm(Zt);function lT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(lT=function(i){return i?n:e})(t)}function Dm(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Nv(t)!=="object"&&typeof t!="function")return{default:t};var n=lT(e);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}function zv(){var t=new nc.ARRAY_TYPE(4);return nc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function cT(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function uT(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],w=n[3];return t[0]=i*w+h*m+l*x-u*y,t[1]=l*w+h*y+u*m-i*x,t[2]=u*w+h*x+i*y-l*m,t[3]=h*w-i*m-l*y-u*x,t}function hT(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=Math.sqrt(n*n+i*i+l*l),m=Math.exp(u),y=h>0?m*Math.sin(h)/h:0;return t[0]=n*y,t[1]=i*y,t[2]=l*y,t[3]=m*Math.cos(h),t}function dT(t,e){var n=e[0],i=e[1],l=e[2],u=e[3],h=Math.sqrt(n*n+i*i+l*l),m=h>0?Math.atan2(h,u)/h:0;return t[0]=n*m,t[1]=i*m,t[2]=l*m,t[3]=.5*Math.log(n*n+i*i+l*l+u*u),t}function Mm(t,e,n,i){var l,u,h,m,y,x=e[0],w=e[1],T=e[2],D=e[3],S=n[0],A=n[1],P=n[2],k=n[3];return(u=x*S+w*A+T*P+D*k)<0&&(u=-u,S=-S,A=-A,P=-P,k=-k),1-u>nc.EPSILON?(l=Math.acos(u),h=Math.sin(l),m=Math.sin((1-i)*l)/h,y=Math.sin(i*l)/h):(m=1-i,y=i),t[0]=m*x+y*S,t[1]=m*w+y*A,t[2]=m*T+y*P,t[3]=m*D+y*k,t}function fT(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var l=0;e[4]>e[0]&&(l=1),e[8]>e[3*l+l]&&(l=2);var u=(l+1)%3,h=(l+2)%3;n=Math.sqrt(e[3*l+l]-e[3*u+u]-e[3*h+h]+1),t[l]=.5*n,t[3]=(e[3*u+h]-e[3*h+u])*(n=.5/n),t[u]=(e[3*u+l]+e[3*l+u])*n,t[h]=(e[3*h+l]+e[3*l+h])*n}return t}Pt.clone=ro.clone,Pt.fromValues=ro.fromValues,Pt.copy=ro.copy,Pt.set=ro.set,Pt.add=ro.add,Pt.mul=uT;var pT=ro.scale;Pt.scale=pT;var mT=ro.dot;Pt.dot=mT,Pt.lerp=ro.lerp;var gT=ro.length;Pt.length=gT,Pt.len=gT;var _T=ro.squaredLength;Pt.squaredLength=_T,Pt.sqrLen=_T;var Bv=ro.normalize;Pt.normalize=Bv,Pt.exactEquals=ro.exactEquals,Pt.equals=ro.equals;var Bo,yT,vT,HP=(Bo=pa.create(),yT=pa.fromValues(1,0,0),vT=pa.fromValues(0,1,0),function(t,e,n){var i=pa.dot(e,n);return i<-.999999?(pa.cross(Bo,yT,e),pa.len(Bo)<1e-6&&pa.cross(Bo,vT,e),pa.normalize(Bo,Bo),cT(t,Bo,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(pa.cross(Bo,e,n),t[0]=Bo[0],t[1]=Bo[1],t[2]=Bo[2],t[3]=1+i,Bv(t,t))});Pt.rotationTo=HP;var jv,Vv,qP=(jv=zv(),Vv=zv(),function(t,e,n,i,l,u){return Mm(jv,e,l,u),Mm(Vv,n,i,u),Mm(t,jv,Vv,2*u*(1-u)),t});Pt.sqlerp=qP;var jo,WP=(jo=GP.create(),function(t,e,n,i){return jo[0]=n[0],jo[3]=n[1],jo[6]=n[2],jo[1]=i[0],jo[4]=i[1],jo[7]=i[2],jo[2]=-e[0],jo[5]=-e[1],jo[8]=-e[2],Bv(t,fT(t,jo))});Pt.setAxes=WP;var Qt={};function Uv(t){return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Uv(t)}Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.create=function(){var t=new Ei.ARRAY_TYPE(8);return Ei.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Qt.clone=function(t){var e=new Ei.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Qt.fromValues=function(t,e,n,i,l,u,h,m){var y=new Ei.ARRAY_TYPE(8);return y[0]=t,y[1]=e,y[2]=n,y[3]=i,y[4]=l,y[5]=u,y[6]=h,y[7]=m,y},Qt.fromRotationTranslationValues=function(t,e,n,i,l,u,h){var m=new Ei.ARRAY_TYPE(8);m[0]=t,m[1]=e,m[2]=n,m[3]=i;var y=.5*l,x=.5*u,w=.5*h;return m[4]=y*i+x*n-w*e,m[5]=x*i+w*t-y*n,m[6]=w*i+y*e-x*t,m[7]=-y*t-x*e-w*n,m},Qt.fromRotationTranslation=wT,Qt.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Qt.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Qt.fromMat4=function(t,e){var n=ma.create();xT.getRotation(n,e);var i=new Ei.ARRAY_TYPE(3);return xT.getTranslation(i,e),wT(t,n,i),t},Qt.copy=ET,Qt.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Qt.set=function(t,e,n,i,l,u,h,m,y){return t[0]=e,t[1]=n,t[2]=i,t[3]=l,t[4]=u,t[5]=h,t[6]=m,t[7]=y,t},Qt.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Qt.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Qt.getTranslation=function(t,e){var n=e[4],i=e[5],l=e[6],u=e[7],h=-e[0],m=-e[1],y=-e[2],x=e[3];return t[0]=2*(n*x+u*h+i*y-l*m),t[1]=2*(i*x+u*m+l*h-n*y),t[2]=2*(l*x+u*y+n*m-i*h),t},Qt.translate=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=.5*n[0],y=.5*n[1],x=.5*n[2],w=e[4],T=e[5],D=e[6],S=e[7];return t[0]=i,t[1]=l,t[2]=u,t[3]=h,t[4]=h*m+l*x-u*y+w,t[5]=h*y+u*m-i*x+T,t[6]=h*x+i*y-l*m+D,t[7]=-i*m-l*y-u*x+S,t},Qt.rotateX=function(t,e,n){var i=-e[0],l=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=m*h+w*i+y*u-x*l,D=y*h+w*l+x*i-m*u,S=x*h+w*u+m*l-y*i,A=w*h-m*i-y*l-x*u;return ma.rotateX(t,e,n),t[4]=T*(h=t[3])+A*(i=t[0])+D*(u=t[2])-S*(l=t[1]),t[5]=D*h+A*l+S*i-T*u,t[6]=S*h+A*u+T*l-D*i,t[7]=A*h-T*i-D*l-S*u,t},Qt.rotateY=function(t,e,n){var i=-e[0],l=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=m*h+w*i+y*u-x*l,D=y*h+w*l+x*i-m*u,S=x*h+w*u+m*l-y*i,A=w*h-m*i-y*l-x*u;return ma.rotateY(t,e,n),t[4]=T*(h=t[3])+A*(i=t[0])+D*(u=t[2])-S*(l=t[1]),t[5]=D*h+A*l+S*i-T*u,t[6]=S*h+A*u+T*l-D*i,t[7]=A*h-T*i-D*l-S*u,t},Qt.rotateZ=function(t,e,n){var i=-e[0],l=-e[1],u=-e[2],h=e[3],m=e[4],y=e[5],x=e[6],w=e[7],T=m*h+w*i+y*u-x*l,D=y*h+w*l+x*i-m*u,S=x*h+w*u+m*l-y*i,A=w*h-m*i-y*l-x*u;return ma.rotateZ(t,e,n),t[4]=T*(h=t[3])+A*(i=t[0])+D*(u=t[2])-S*(l=t[1]),t[5]=D*h+A*l+S*i-T*u,t[6]=S*h+A*u+T*l-D*i,t[7]=A*h-T*i-D*l-S*u,t},Qt.rotateByQuatAppend=function(t,e,n){var i=n[0],l=n[1],u=n[2],h=n[3],m=e[0],y=e[1],x=e[2],w=e[3];return t[0]=m*h+w*i+y*u-x*l,t[1]=y*h+w*l+x*i-m*u,t[2]=x*h+w*u+m*l-y*i,t[3]=w*h-m*i-y*l-x*u,t[4]=(m=e[4])*h+(w=e[7])*i+(y=e[5])*u-(x=e[6])*l,t[5]=y*h+w*l+x*i-m*u,t[6]=x*h+w*u+m*l-y*i,t[7]=w*h-m*i-y*l-x*u,t},Qt.rotateByQuatPrepend=function(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=n[0],y=n[1],x=n[2],w=n[3];return t[0]=i*w+h*m+l*x-u*y,t[1]=l*w+h*y+u*m-i*x,t[2]=u*w+h*x+i*y-l*m,t[3]=h*w-i*m-l*y-u*x,t[4]=i*(w=n[7])+h*(m=n[4])+l*(x=n[6])-u*(y=n[5]),t[5]=l*w+h*y+u*m-i*x,t[6]=u*w+h*x+i*y-l*m,t[7]=h*w-i*m-l*y-u*x,t},Qt.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<Ei.EPSILON)return ET(t,e);var l=Math.hypot(n[0],n[1],n[2]);i*=.5;var u=Math.sin(i),h=u*n[0]/l,m=u*n[1]/l,y=u*n[2]/l,x=Math.cos(i),w=e[0],T=e[1],D=e[2],S=e[3];t[0]=w*x+S*h+T*y-D*m,t[1]=T*x+S*m+D*h-w*y,t[2]=D*x+S*y+w*m-T*h,t[3]=S*x-w*h-T*m-D*y;var A=e[4],P=e[5],k=e[6],N=e[7];return t[4]=A*x+N*h+P*y-k*m,t[5]=P*x+N*m+k*h-A*y,t[6]=k*x+N*y+A*m-P*h,t[7]=N*x-A*h-P*m-k*y,t},Qt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Qt.multiply=TT,Qt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Qt.lerp=function(t,e,n,i){var l=1-i;return IT(e,n)<0&&(i=-i),t[0]=e[0]*l+n[0]*i,t[1]=e[1]*l+n[1]*i,t[2]=e[2]*l+n[2]*i,t[3]=e[3]*l+n[3]*i,t[4]=e[4]*l+n[4]*i,t[5]=e[5]*l+n[5]*i,t[6]=e[6]*l+n[6]*i,t[7]=e[7]*l+n[7]*i,t},Qt.invert=function(t,e){var n=Sm(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Qt.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Qt.normalize=function(t,e){var n=Sm(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,l=e[1]/n,u=e[2]/n,h=e[3]/n,m=e[4],y=e[5],x=e[6],w=e[7],T=i*m+l*y+u*x+h*w;t[0]=i,t[1]=l,t[2]=u,t[3]=h,t[4]=(m-i*T)/n,t[5]=(y-l*T)/n,t[6]=(x-u*T)/n,t[7]=(w-h*T)/n}return t},Qt.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Qt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Qt.equals=function(t,e){var n=t[0],i=t[1],l=t[2],u=t[3],h=t[4],m=t[5],y=t[6],x=t[7],w=e[0],T=e[1],D=e[2],S=e[3],A=e[4],P=e[5],k=e[6],N=e[7];return Math.abs(n-w)<=Ei.EPSILON*Math.max(1,Math.abs(n),Math.abs(w))&&Math.abs(i-T)<=Ei.EPSILON*Math.max(1,Math.abs(i),Math.abs(T))&&Math.abs(l-D)<=Ei.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(u-S)<=Ei.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-A)<=Ei.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-P)<=Ei.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(y-k)<=Ei.EPSILON*Math.max(1,Math.abs(y),Math.abs(k))&&Math.abs(x-N)<=Ei.EPSILON*Math.max(1,Math.abs(x),Math.abs(N))},Qt.sqrLen=Qt.squaredLength=Qt.len=Qt.length=Qt.dot=Qt.mul=Qt.setReal=Qt.getReal=void 0;var Ei=$v(Sr),ma=$v(Pt),xT=$v(jt);function bT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(bT=function(i){return i?n:e})(t)}function $v(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Uv(t)!=="object"&&typeof t!="function")return{default:t};var n=bT(e);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}function wT(t,e,n){var i=.5*n[0],l=.5*n[1],u=.5*n[2],h=e[0],m=e[1],y=e[2],x=e[3];return t[0]=h,t[1]=m,t[2]=y,t[3]=x,t[4]=i*x+l*y-u*m,t[5]=l*x+u*h-i*y,t[6]=u*x+i*m-l*h,t[7]=-i*h-l*m-u*y,t}function ET(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function TT(t,e,n){var i=e[0],l=e[1],u=e[2],h=e[3],m=n[4],y=n[5],x=n[6],w=n[7],T=e[4],D=e[5],S=e[6],A=e[7],P=n[0],k=n[1],N=n[2],H=n[3];return t[0]=i*H+h*P+l*N-u*k,t[1]=l*H+h*k+u*P-i*N,t[2]=u*H+h*N+i*k-l*P,t[3]=h*H-i*P-l*k-u*N,t[4]=i*w+h*m+l*x-u*y+T*H+A*P+D*N-S*k,t[5]=l*w+h*y+u*m-i*x+D*H+A*k+S*P-T*N,t[6]=u*w+h*x+i*y-l*m+S*H+A*N+T*k-D*P,t[7]=h*w-i*m-l*y-u*x+A*H-T*P-D*k-S*N,t}Qt.getReal=ma.copy,Qt.setReal=ma.copy,Qt.mul=TT;var IT=ma.dot;Qt.dot=IT;var DT=ma.length;Qt.length=DT,Qt.len=DT;var Sm=ma.squaredLength;Qt.squaredLength=Sm,Qt.sqrLen=Sm;var $t={};function Gv(t){return Gv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Gv(t)}Object.defineProperty($t,"__esModule",{value:!0}),$t.create=ST,$t.clone=function(t){var e=new rc.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},$t.fromValues=function(t,e){var n=new rc.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},$t.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},$t.set=function(t,e,n){return t[0]=e,t[1]=n,t},$t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},$t.subtract=CT,$t.multiply=AT,$t.divide=RT,$t.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},$t.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},$t.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},$t.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},$t.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},$t.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},$t.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},$t.distance=PT,$t.squaredDistance=OT,$t.length=kT,$t.squaredLength=LT,$t.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},$t.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},$t.normalize=function(t,e){var n=e[0],i=e[1],l=n*n+i*i;return l>0&&(l=1/Math.sqrt(l)),t[0]=e[0]*l,t[1]=e[1]*l,t},$t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},$t.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},$t.lerp=function(t,e,n,i){var l=e[0],u=e[1];return t[0]=l+i*(n[0]-l),t[1]=u+i*(n[1]-u),t},$t.random=function(t,e){e=e||1;var n=2*rc.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},$t.transformMat2=function(t,e,n){var i=e[0],l=e[1];return t[0]=n[0]*i+n[2]*l,t[1]=n[1]*i+n[3]*l,t},$t.transformMat2d=function(t,e,n){var i=e[0],l=e[1];return t[0]=n[0]*i+n[2]*l+n[4],t[1]=n[1]*i+n[3]*l+n[5],t},$t.transformMat3=function(t,e,n){var i=e[0],l=e[1];return t[0]=n[0]*i+n[3]*l+n[6],t[1]=n[1]*i+n[4]*l+n[7],t},$t.transformMat4=function(t,e,n){var i=e[0],l=e[1];return t[0]=n[0]*i+n[4]*l+n[12],t[1]=n[1]*i+n[5]*l+n[13],t},$t.rotate=function(t,e,n,i){var l=e[0]-n[0],u=e[1]-n[1],h=Math.sin(i),m=Math.cos(i);return t[0]=l*m-u*h+n[0],t[1]=l*h+u*m+n[1],t},$t.angle=function(t,e){var n=t[0],i=t[1],l=e[0],u=e[1],h=Math.sqrt(n*n+i*i)*Math.sqrt(l*l+u*u);return Math.acos(Math.min(Math.max(h&&(n*l+i*u)/h,-1),1))},$t.zero=function(t){return t[0]=0,t[1]=0,t},$t.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},$t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},$t.equals=function(t,e){var n=t[0],i=t[1],l=e[0],u=e[1];return Math.abs(n-l)<=rc.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=rc.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))},$t.forEach=$t.sqrLen=$t.sqrDist=$t.dist=$t.div=$t.mul=$t.sub=$t.len=void 0;var rc=function(t,e){if(t&&t.__esModule)return t;if(t===null||Gv(t)!=="object"&&typeof t!="function")return{default:t};var n=MT(void 0);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}(Sr);function MT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(MT=function(i){return i?n:e})(t)}function ST(){var t=new rc.ARRAY_TYPE(2);return rc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function CT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function AT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function RT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function PT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function OT(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function kT(t){return Math.hypot(t[0],t[1])}function LT(t){var e=t[0],n=t[1];return e*e+n*n}$t.len=kT,$t.sub=CT,$t.mul=AT,$t.div=RT,$t.dist=PT,$t.sqrDist=OT,$t.sqrLen=LT;var ZP=function(){var t=ST();return function(e,n,i,l,u,h){var m,y;for(n||(n=2),i||(i=0),y=l?Math.min(l*n+i,e.length):e.length,m=i;m<y;m+=n)t[0]=e[m],t[1]=e[m+1],u(t,t,h),e[m]=t[0],e[m+1]=t[1];return e}}();function Hv(t){return Hv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Hv(t)}$t.forEach=ZP,Object.defineProperty(Mr,"__esModule",{value:!0}),r.e=Mr.vec4=r.v=Mr.vec3=Mr.vec2=Mr.quat2=r.q=Mr.quat=r.m=Mr.mat4=r.bx=Mr.mat3=Mr.mat2d=r.h=Mr.mat2=Mr.glMatrix=void 0;var XP=bs(Sr);Mr.glMatrix=XP;var YP=bs(Yn);r.h=Mr.mat2=YP;var JP=bs(Kn);Mr.mat2d=JP;var KP=bs(Tn);r.bx=Mr.mat3=KP;var QP=bs(jt);r.m=Mr.mat4=QP;var eO=bs(Pt);r.q=Mr.quat=eO;var tO=bs(Qt);Mr.quat2=tO;var nO=bs($t);Mr.vec2=nO;var rO=bs(zt);r.v=Mr.vec3=rO;var iO=bs(Zt);function FT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(FT=function(i){return i?n:e})(t)}function bs(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Hv(t)!=="object"&&typeof t!="function")return{default:t};var n=FT(e);if(n&&n.has(t))return n.get(t);var i={},l=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in t)if(u!=="default"&&Object.prototype.hasOwnProperty.call(t,u)){var h=l?Object.getOwnPropertyDescriptor(t,u):null;h&&(h.get||h.set)?Object.defineProperty(i,u,h):i[u]=t[u]}return i.default=t,n&&n.set(t,i),i}r.e=Mr.vec4=iO;let oO=dt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Cm}=oO,NT=dt([{name:"a_pos_3",components:3,type:"Int16"}]);var qd=dt([{name:"a_pos",type:"Int16",components:2}]),zT={};(function(t,e){(function(n){function i(u,h,m){var y=l(256*u,256*(h=Math.pow(2,m)-h-1),m),x=l(256*(u+1),256*(h+1),m);return y[0]+","+y[1]+","+x[0]+","+x[1]}function l(u,h,m){var y=2*Math.PI*6378137/256/Math.pow(2,m);return[u*y-2*Math.PI*6378137/2,h*y-2*Math.PI*6378137/2]}n.getURL=function(u,h,m,y,x,w){return w=w||{},u+"?"+["bbox="+i(m,y,x),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+h].join("&")},n.getTileBBox=i,n.getMercCoords=l,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,zT);var sO=zT;class ic{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=Wd(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let i=sO.getTileBBox(this.x,this.y,this.z),l=function(u,h,m){let y,x="";for(let w=u;w>0;w--)y=1<<w-1,x+=(h&y?1:0)+(m&y?2:0);return x}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class BT{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Wd(e,n.z,n.z,n.x,n.y)}}class zr{constructor(e,n,i,l,u){this.overscaledZ=e,this.wrap=n,this.canonical=new ic(i,+l,+u),this.key=n===0&&e===i?this.canonical.key:Wd(n,e,i,l,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new zr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zr(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Wd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let i=this.canonical.z-e;return Wd(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new zr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,i=2*this.canonical.x,l=2*this.canonical.y;return[new zr(n,this.wrap,n,i,l),new zr(n,this.wrap,n,i+1,l),new zr(n,this.wrap,n,i,l+1),new zr(n,this.wrap,n,i+1,l+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new zr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new zr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new BT(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Wd(t,e,n,i,l){let u=1<<Math.min(n,22),h=u*(l%u)+i%u;return t&&n<22&&(h+=u*u*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*h+n)+(e-n)}let aO=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new zr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new zr(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new zr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new zr(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];it(ic,"CanonicalTileID"),it(zr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class qv{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){let l=r.v.dot(n,this.dir);if(Math.abs(l)<1e-6)return!1;let u=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/l;return i[0]=this.pos[0]+this.dir[0]*u,i[1]=this.pos[1]+this.dir[1]*u,i[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,n,i){if(r.v.equals(this.pos,e)||n===0)return i[0]=i[1]=i[2]=0,!1;let[l,u,h]=this.dir,m=this.pos[0]-e[0],y=this.pos[1]-e[1],x=this.pos[2]-e[2],w=l*l+u*u+h*h,T=2*(m*l+y*u+x*h),D=T*T-4*w*(m*m+y*y+x*x-n*n);if(D<0){let S=Math.max(-T/2,0),A=m+l*S,P=y+u*S,k=x+h*S,N=Math.hypot(A,P,k);return i[0]=A*n/N,i[1]=P*n/N,i[2]=k*n/N,!1}{let S=(-T-Math.sqrt(D))/(2*w);if(S<0){let A=Math.hypot(m,y,x);return i[0]=m*n/A,i[1]=y*n/A,i[2]=x*n/A,!1}return i[0]=m+l*S,i[1]=y+u*S,i[2]=x+h*S,!0}}}class Wv{constructor(e,n,i,l,u){this.TL=e,this.TR=n,this.BR=i,this.BL=l,this.horizon=u}static fromInvProjectionMatrix(e,n,i){let l=[-1,1,1],u=[1,1,1],h=[1,-1,1],m=[-1,-1,1],y=r.v.transformMat4(l,l,e),x=r.v.transformMat4(u,u,e),w=r.v.transformMat4(h,h,e),T=r.v.transformMat4(m,m,e);return new Wv(y,x,w,T,n/i)}}function Zd(t,e,n){let i=1/0,l=-1/0,u=[];for(let h of t){r.v.sub(u,h,e);let m=r.v.dot(u,n);i=Math.min(i,m),l=Math.max(l,m)}return[i,l]}function jT(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){let l=t.planes[i],u=0;for(let h=0;h<e.length;h++)u+=r.v.dot(l,e[h])+l[3]>=0;if(u===0)return 0;u!==e.length&&(n=!1)}return n?2:1}function VT(t,e){for(let n of t.projections){let i=Zd(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function UT(t,e){let n=0,i=[0,0,0,0];for(let l=0;l<t.length;l++)i[0]=t[l][0],i[1]=t[l][1],i[2]=t[l][2],i[3]=1,r.e.dot(i,e)>=0&&n++;return n}class Zv{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=dr.fromPoints(this.points),this.projections=[],this.frustumEdges=[r.v.sub([],this.points[2],this.points[3]),r.v.sub([],this.points[0],this.points[3]),r.v.sub([],this.points[4],this.points[0]),r.v.sub([],this.points[5],this.points[1]),r.v.sub([],this.points[6],this.points[2]),r.v.sub([],this.points[7],this.points[3])];for(let i of this.frustumEdges){let l=[0,-i[2],i[1]],u=[i[2],0,-i[0]];this.projections.push({axis:l,projection:Zd(this.points,this.points[0],l)}),this.projections.push({axis:u,projection:Zd(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,n,i,l){let u=Math.pow(2,i),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(x=>{let w=r.e.transformMat4([],x,e),T=1/w[3]/n*u;return r.e.mul(w,w,[T,T,l?1/w[3]:T,T])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(x=>{let w=r.v.sub([],h[x[0]],h[x[1]]),T=r.v.sub([],h[x[2]],h[x[1]]),D=r.v.normalize([],r.v.cross([],w,T)),S=-r.v.dot(D,h[x[1]]);return D.concat(S)}),y=[];for(let x=0;x<h.length;x++)y.push([h[x][0],h[x][1],h[x][2]]);return new Zv(y,m)}intersectsPrecise(e,n,i){for(let l=0;l<n.length;l++)if(!UT(e,n[l]))return 0;for(let l=0;l<this.planes.length;l++)if(!UT(e,this.planes[l]))return 0;for(let l of i)for(let u of this.frustumEdges){let h=r.v.cross([],l,u),m=r.v.length(h);if(m===0)continue;r.v.scale(h,h,1/m);let y=Zd(this.points,this.points[0],h),x=Zd(e,this.points[0],h);if(y[0]>x[1]||x[0]>y[1])return 0}return 1}}class dr{static fromPoints(e){let n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(let l of e)r.v.min(n,n,l),r.v.max(i,i,l);return new dr(n,i)}static fromTileIdAndHeight(e,n,i){let l=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new dr([u/l,h/l,n],[(u+1)/l,(h+1)/l,i])}static applyTransform(e,n){let i=e.getCorners();for(let l=0;l<i.length;++l)r.v.transformMat4(i[l],i[l],n);return dr.fromPoints(i)}static projectAabbCorners(e,n){let i=e.getCorners();for(let l=0;l<i.length;++l)r.v.transformMat4(i[l],i[l],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=r.v.scale([],r.v.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],i=r.v.clone(this.min),l=r.v.clone(this.max);for(let u=0;u<n.length;u++)i[u]=n[u]?this.min[u]:this.center[u],l[u]=n[u]?this.center[u]:this.max[u];return l[2]=this.max[2],new dr(i,l)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?jT(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?jT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?VT(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?VT(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}it(dr,"Aabb");let Xv=5,$T=6,io=Ze/Math.PI/2,lO=16383,Ou=64,Yv=[Ou,32,16],yo=-io,vo=io,cO=[new dr([yo,yo,yo],[vo,vo,vo]),new dr([yo,yo,yo],[0,0,vo]),new dr([0,yo,yo],[vo,0,vo]),new dr([yo,0,yo],[0,vo,vo]),new dr([0,0,yo],[vo,vo,vo])];function Am(t){return t*io/Jd}function GT(t,e,n,i=!0){let l=r.v.scale([],t._camera.position,t.worldSize),u=[e,n,1,1];r.e.transformMat4(u,u,t.pixelMatrixInverse),r.e.scale(u,u,1/u[3]);let h=r.v.sub([],u,l),m=r.v.normalize([],h),y=t.globeMatrix,x=[y[12],y[13],y[14]],w=r.v.sub([],x,l),T=r.v.length(w),D=r.v.normalize([],w),S=t.worldSize/(2*Math.PI),A=r.v.dot(D,m),P=Math.asin(S/T);if(P<Math.acos(A)){if(!i)return null;let _e=[],Me=[];r.v.scale(_e,m,T/A),r.v.normalize(Me,r.v.sub(Me,_e,w)),r.v.normalize(m,r.v.add(m,w,r.v.scale(m,Me,Math.tan(P)*T)))}let k=[];new qv(l,m).closestPointOnSphere(x,S,k);let N=r.v.normalize([],pt(y,0)),H=r.v.normalize([],pt(y,1)),q=r.v.normalize([],pt(y,2)),Z=r.v.dot(N,k),K=r.v.dot(H,k),ee=r.v.dot(q,k),le=Or(Math.asin(-K/S)),he=Or(Math.atan2(Z,ee));he=t.center.lng+function(_e,Me){let Be=(Me-_e+180)%360-180;return Be<-180?Be+360:Be}(t.center.lng,he);let fe=Es(he),xe=Bt(Ts(le),0,1);return new Hr(fe,xe)}class uO{constructor(e,n,i){this.a=r.v.sub([],e,i),this.b=r.v.sub([],n,i),this.center=i;let l=r.v.normalize([],this.a),u=r.v.normalize([],this.b);this.angle=Math.acos(r.v.dot(l,u))}}function Jv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,l,u,h){let m=Math.sin(u);return i*(Math.sin((1-h)*u)/m)+l*(Math.sin(h*u)/m)}(t.a[e],t.b[e],t.angle,Bt(n,0,1))+t.center[e]}function ws(t){if(t.z<=1)return cO[t.z+2*t.y+t.x];let e=Kv(Rm(t));return dr.fromPoints(e)}function ga(t,e,n){return r.v.scale(t,t,1-n),r.v.scaleAndAdd(t,t,e,n)}function HT(t,e){let n=_a(e.zoom);if(n===0)return ws(t);let i=Rm(t),l=Kv(i),u=Es(i.getWest())*e.worldSize,h=Es(i.getEast())*e.worldSize,m=Ts(i.getNorth())*e.worldSize,y=Ts(i.getSouth())*e.worldSize,x=[u,m,0],w=[h,m,0],T=[u,y,0],D=[h,y,0],S=r.m.invert([],e.globeMatrix);return r.v.transformMat4(x,x,S),r.v.transformMat4(w,w,S),r.v.transformMat4(T,T,S),r.v.transformMat4(D,D,S),l[0]=ga(l[0],T,n),l[1]=ga(l[1],D,n),l[2]=ga(l[2],w,n),l[3]=ga(l[3],x,n),dr.fromPoints(l)}function qT(t,e,n){for(let i of t)r.v.transformMat4(i,i,e),r.v.scale(i,i,n)}function WT(t,e,n,i){let l=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){let fe=ws(n).getCorners();return qT(fe,u,l),dr.fromPoints(fe)}let h=Rm(n,i),m=Kv(h);qT(m,u,l);let y=Number.MAX_VALUE,x=[-y,-y,-y],w=[y,y,y];if(h.contains(t.center)){for(let _e of m)r.v.min(w,w,_e),r.v.max(x,x,_e);x[2]=0;let fe=t.point,xe=[fe.x*l,fe.y*l,0];return r.v.min(w,w,xe),r.v.max(x,x,xe),new dr(w,x)}let T=[u[12]*l,u[13]*l,u[14]*l],D=h.getCenter(),S=Bt(t.center.lat,-ar,ar),A=Bt(D.lat,-ar,ar),P=Es(t.center.lng),k=Ts(S),N=P-Es(D.lng),H=k-Ts(A);N>.5?N-=1:N<-.5&&(N+=1);let q=0;if(Math.abs(N)>Math.abs(H))q=N>=0?1:3;else{q=H>=0?0:2;let fe=[u[4]*l,u[5]*l,u[6]*l],xe=-Math.sin(gt(H>=0?h.getSouth():h.getNorth()))*io;r.v.scaleAndAdd(T,T,fe,xe)}let Z=m[q],K=m[(q+1)%4],ee=new uO(Z,K,T),le=[Jv(ee,0)||Z[0],Jv(ee,1)||Z[1],Jv(ee,2)||Z[2]],he=_a(t.zoom);if(he>0){let fe=function({x:_e,y:Me,z:Be},Te,ke,Ee,Je){let rt=1/(1<<Be),Ne=_e*rt,wt=Ne+rt,st=Me*rt,Ye=st+rt,Et=0,ft=(Ne+wt)/2-Ee;return ft>.5?Et=-1:ft<-.5&&(Et=1),Ne=((Ne+Et)*Te-(Ee*=Te))*ke+Ee,wt=((wt+Et)*Te-Ee)*ke+Ee,st=(st*Te-(Je*=Te))*ke+Je,Ye=(Ye*Te-Je)*ke+Je,[[Ne,Ye,0],[wt,Ye,0],[wt,st,0],[Ne,st,0]]}(n,e,t._pixelsPerMercatorPixel,P,k);for(let _e=0;_e<m.length;_e++)ga(m[_e],fe[_e],he);let xe=r.v.add([],fe[q],fe[(q+1)%4]);r.v.scale(xe,xe,.5),ga(le,xe,he)}for(let fe of m)r.v.min(w,w,fe),r.v.max(x,x,fe);return w[2]=Math.min(Z[2],K[2]),r.v.min(w,w,le),r.v.max(x,x,le),new dr(w,x)}function Rm({x:t,y:e,z:n},i=!1){let l=1/(1<<n),u=new gn(Oi(t*l),e===(1<<n)-1&&i?-90:$r((e+1)*l)),h=new gn(Oi((t+1)*l),e===0&&i?90:$r(e*l));return new Xa(u,h)}function Kv(t){let e=gt(t.getNorth()),n=gt(t.getSouth()),i=Math.cos(e),l=Math.cos(n),u=Math.sin(e),h=Math.sin(n),m=t.getWest(),y=t.getEast();return[ku(l,h,m),ku(l,h,y),ku(i,u,y),ku(i,u,m)]}function ku(t,e,n,i=io){return n=gt(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function oc(t,e,n){return ku(Math.cos(gt(t)),Math.sin(gt(t)),e,n)}function Xd(t,e,n,i){let l=1<<n.z,u=(t/Ze+n.x)/l;return oc($r((e/Ze+n.y)/l),Oi(u),i)}function Pm({min:t,max:e}){return lO/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let ZT=new Float64Array(16);function Yd(t){let e=Pm(t),n=r.m.fromScaling(ZT,[e,e,e]);return r.m.translate(n,n,r.v.negate([],t.min))}function Qv(t){let e=r.m.fromTranslation(ZT,t.min),n=1/Pm(t);return r.m.scale(e,e,[n,n,n])}function e0(t){let e=Ze/(2*Math.PI);return t/(2*Math.PI)/e}function XT(t,e){return Ze/(512*Math.pow(2,t))*Pm(ws(e))}function YT(t,e,n,i,l){let u=e0(n),h=[t,e,-n/(2*Math.PI)],m=r.m.identity(new Float64Array(16));return r.m.translate(m,m,h),r.m.scale(m,m,[u,u,u]),r.m.rotateX(m,m,gt(-l)),r.m.rotateY(m,m,gt(-i)),m}function _a(t){return Us(Xv,$T,t)}function JT(t,e){let n=oc(e.lat,e.lng),i=function(u){let h=oc(u._center.lat,u._center.lng),m=r.v.fromValues(0,1,0),y=r.v.cross([],m,h),x=r.m.fromRotation([],-u.angle,h);y=r.v.transformMat4(y,y,x),r.m.fromRotation(x,-u._pitch,y);let w=r.v.normalize([],h);return r.v.scale(w,w,Am(u.cameraToCenterDistance/u.pixelsPerMeter)),r.v.transformMat4(w,w,x),r.v.add([],h,w)}(t),l=r.v.subtract([],i,n);return r.v.angle(l,n)}function t0(t,e){return JT(t,e)>Math.PI/2*1.01}let KT=gt(85),hO=Math.cos(KT),dO=Math.sin(KT),Jd=63710088e-1,n0=2*Math.PI*Jd;class Ja{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ja(ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,i=this.lat*n,l=e.lat*n,u=Math.sin(i)*Math.sin(l)+Math.cos(i)*Math.cos(l)*Math.cos((e.lng-this.lng)*n);return Jd*Math.acos(Math.min(u,1))}toBounds(e=0){let n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Xa(new Ja(this.lng-i,this.lat-n),new Ja(this.lng+i,this.lat+n))}toEcef(e){let n=Am(e);return oc(this.lat,this.lng,io+n)}static convert(e){if(e instanceof Ja)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Ja(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Ja(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var gn=Ja;let fO=0,pO=25.5;function r0(t){return n0*Math.cos(t*Math.PI/180)}function Es(t){return(180+t)/360}function Ts(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function pi(t,e){return t/r0(e)}function Oi(t){return 360*t-180}function $r(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function QT(t,e){return t*r0($r(e))}let ar=85.051129;function eI(t){return Math.cos(gt(Bt(t,-ar,ar)))}function sc(t,e){let n=Bt(e,fO,pO),i=Math.pow(2,n);return eI(t)*n0/(512*i)}function tI(t){return 1/Math.cos(t*Math.PI/180)}function Om(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/Ze)/(1<<t.z)*2));return 80150034*n/(n*n+1)/Ze/(1<<t.z)}class Hr{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){let i=gn.convert(e);return new Hr(Es(i.lng),Ts(i.lat),pi(n,i.lat))}toLngLat(){return new gn(Oi(this.x),$r(this.y))}toAltitude(){return QT(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/n0*tI($r(this.y))}}function i0(t,e,n,i,l,u,h,m,y){let x=(e+i)/2,w=(n+l)/2,T=new Ue(x,w);m(T),function(D,S,A,P,k,N){let H=A-k,q=P-N;return Math.abs((P-S)*H-(A-D)*q)/Math.hypot(H,q)}(T.x,T.y,u.x,u.y,h.x,h.y)>=y?(i0(t,e,n,x,w,u,T,m,y),i0(t,x,w,i,l,T,h,m,y)):t.push(h)}function nI(t,e,n){let i=t[0],l=i.x,u=i.y;e(i);let h=[i];for(let m=1;m<t.length;m++){let y=t[m],{x,y:w}=y;e(y),i0(h,l,u,x,w,i,y,e,n),l=x,u=w,i=y}return h}function o0(t,e,n,i){if(i(e,n)){let l=e.add(n)._mult(.5);o0(t,e,l,i),o0(t,l,n,i)}else t.push(n)}function mO(t,e){let n=t[0],i=[n];for(let l=1;l<t.length;l++){let u=t[l];o0(i,n,u,e),n=u}return i}let s0=Math.pow(2,14)-1,rI=-s0-1;function gO(t,e){let n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=Bt(n,rI,s0),t.y=Bt(i,rI,s0),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&Zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Is(t,e,n){let i=t.loadGeometry(),l=t.extent,u=Ze/l;if(e&&n&&n.projection.isReprojectedInTileSpace){let h=1<<e.z,{scale:m,x:y,y:x,projection:w}=n,T=D=>{let S=Oi((e.x+D.x/l)/h),A=$r((e.y+D.y/l)/h),P=w.project(S,A);D.x=(P.x*m-y)*l,D.y=(P.y*m-x)*l};for(let D=0;D<i.length;D++)if(t.type!==1)i[D]=nI(i[D],T,1);else{let S=[];for(let A of i[D])A.x<0||A.x>=l||A.y<0||A.y>=l||(T(A),S.push(A));i[D]=S}}for(let h of i)for(let m of h)gO(m,u);return i}function Ka(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Is(t):[]}}function km(t,e,n,i,l){t.emplaceBack(2*e+(i+1)/2,2*n+(l+1)/2)}function Lm(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class a0{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Lt,this.indexArray=new En,this.segments=new Xn,this.programConfigurations=new Za(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,l){let u=this.layers[0],h=[],m=null;u.type==="circle"&&(m=u.layout.get("circle-sort-key"));for(let{feature:x,id:w,index:T,sourceLayerIndex:D}of e){let S=this.layers[0]._featureFilter.needGeometry,A=Ka(x,S);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),A,i))continue;let P=m?m.evaluate(A,{},i):void 0,k={id:w,properties:x.properties,type:x.type,sourceLayerIndex:D,index:T,geometry:S?A.geometry:Is(x,i,l),patterns:{},sortKey:P};h.push(k)}m&&h.sort((x,w)=>x.sortKey-w.sortKey);let y=null;l.projection.name==="globe"&&(this.globeExtVertexArray=new Un,y=l.projection);for(let x of h){let{geometry:w,index:T,sourceLayerIndex:D}=x,S=e[T].feature;this.addFeature(x,w,T,n.availableImages,i,y,n.brightness),n.featureIndex.insert(S,w,T,D,this.index)}}update(e,n,i,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MP.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,SP.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,l,u,h,m){for(let y of n)for(let x of y){let w=x.x,T=x.y;if(w<0||w>=Ze||T<0||T>=Ze)continue;if(h){let A=h.projectTilePoint(w,T,u),P=h.upVector(u,w,T),k=this.globeExtVertexArray;Lm(k,A,P),Lm(k,A,P),Lm(k,A,P),Lm(k,A,P)}let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),S=D.vertexLength;km(this.layoutVertexArray,w,T,-1,-1),km(this.layoutVertexArray,w,T,1,-1),km(this.layoutVertexArray,w,T,1,1),km(this.layoutVertexArray,w,T,-1,1),this.indexArray.emplaceBack(S,S+1,S+2),this.indexArray.emplaceBack(S,S+2,S+3),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},l,u,m)}}function iI(t,e){for(let n=0;n<t.length;n++)if(ac(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(ac(t,e[n]))return!0;return!!l0(t,e)}function _O(t,e,n){return!!ac(t,e)||!!c0(e,t,n)}function oI(t,e){if(t.length===1)return aI(e,t[0]);for(let n=0;n<e.length;n++){let i=e[n];for(let l=0;l<i.length;l++)if(ac(t,i[l]))return!0}for(let n=0;n<t.length;n++)if(aI(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(l0(t,e[n]))return!0;return!1}function yO(t,e,n){if(t.length>1){if(l0(t,e))return!0;for(let i=0;i<e.length;i++)if(c0(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(c0(t[i],e,n))return!0;return!1}function l0(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let i=t[n],l=t[n+1];for(let u=0;u<e.length-1;u++)if(vO(i,l,e[u],e[u+1]))return!0}return!1}function vO(t,e,n,i){return $e(t,n,i)!==$e(e,n,i)&&$e(t,e,n)!==$e(t,e,i)}function c0(t,e,n){let i=n*n;if(e.length===1)return t.distSqr(e[0])<i;for(let l=1;l<e.length;l++)if(sI(t,e[l-1],e[l])<i)return!0;return!1}function sI(t,e,n){let i=e.distSqr(n);if(i===0)return t.distSqr(e);let l=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(l<0?e:l>1?n:n.sub(e)._mult(l)._add(e))}function aI(t,e){let n,i,l,u=!1;for(let h=0;h<t.length;h++){n=t[h];for(let m=0,y=n.length-1;m<n.length;y=m++)i=n[m],l=n[y],i.y>e.y!=l.y>e.y&&e.x<(l.x-i.x)*(e.y-i.y)/(l.y-i.y)+i.x&&(u=!u)}return u}function ac(t,e){let n=!1;for(let i=0,l=t.length-1;i<t.length;l=i++){let u=t[i],h=t[l];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(n=!n)}return n}function lI(t,e,n,i,l){for(let h of t)if(e<=h.x&&n<=h.y&&i>=h.x&&l>=h.y)return!0;let u=[new Ue(e,n),new Ue(e,l),new Ue(i,l),new Ue(i,n)];if(t.length>2){for(let h of u)if(ac(t,h))return!0}for(let h=0;h<t.length-1;h++)if(xO(t[h],t[h+1],u))return!0;return!1}function xO(t,e,n){let i=n[0],l=n[2];if(t.x<i.x&&e.x<i.x||t.x>l.x&&e.x>l.x||t.y<i.y&&e.y<i.y||t.y>l.y&&e.y>l.y)return!1;let u=$e(t,e,n[0]);return u!==$e(t,e,n[1])||u!==$e(t,e,n[2])||u!==$e(t,e,n[3])}function Lu(t,e,n,i,l,u){let h=e.y-t.y,m=t.x-e.x;if(u=u||0){let y=h*h+m*m;if(y===0)return!0;let x=Math.sqrt(y);h/=x,m/=x}return!((n.x-t.x)*h+(n.y-t.y)*m-u<0||(i.x-t.x)*h+(i.y-t.y)*m-u<0||(l.x-t.x)*h+(l.y-t.y)*m-u<0)}function u0(t,e,n,i,l,u,h){return!(Lu(t,e,i,l,u,h)||Lu(e,n,i,l,u,h)||Lu(n,t,i,l,u,h)||Lu(i,l,t,e,n,h)||Lu(l,u,t,e,n,h)||Lu(u,i,t,e,n,h))}function Fu(t,e,n){let i=e.paint.get(t).value;return i.kind==="constant"?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Fm(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function cI(t,e,n,i,l){if(!e[0]&&!e[1])return t;let u=Ue.convert(e)._mult(l);n==="viewport"&&u._rotate(-i);let h=[];for(let m=0;m<t.length;m++)h.push(t[m].sub(u));return h}function uI(t,e,n,i){let l=Ue.convert(t)._mult(i);return e==="viewport"&&l._rotate(-n),l}it(a0,"CircleBucket",{omit:["layers"]});let bO=new Re({"circle-sort-key":new me(ye.layout_circle["circle-sort-key"]),visibility:new Q(ye.layout_circle.visibility)});var wO={paint:new Re({"circle-radius":new me(ye.paint_circle["circle-radius"]),"circle-color":new me(ye.paint_circle["circle-color"]),"circle-blur":new me(ye.paint_circle["circle-blur"]),"circle-opacity":new me(ye.paint_circle["circle-opacity"]),"circle-translate":new Q(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new Q(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Q(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Q(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new me(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new me(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new me(ye.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Q(ye.paint_circle["circle-emissive-strength"])}),layout:bO};let EO=r.m.create(),hI=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function dI(t,e,n,i,l,u,h,m,y){if(u&&t.queryGeometry.isAboveHorizon)return!1;u&&(y*=t.pixelToTileUnitsFactor);let x=t.tileID.canonical,w=n.projection.upVectorScale(x,n.center.lat,n.worldSize).metersToTile;for(let T of e)for(let D of T){let S=D.add(m),A=l&&n.elevation?n.elevation.exaggeration()*l.getElevationAt(S.x,S.y,!0):0,P=n.projection.projectTilePoint(S.x,S.y,x);if(A>0){let q=n.projection.upVector(x,S.x,S.y);P.x+=q[0]*w*A,P.y+=q[1]*w*A,P.z+=q[2]*w*A}let k=u?S:TO(P.x,P.y,P.z,i),N=u?t.tilespaceRays.map(q=>DO(q,A)):t.queryGeometry.screenGeometry,H=r.e.transformMat4([],[P.x,P.y,P.z,1],i);if(!h&&u?y*=H[3]/n.cameraToCenterDistance:h&&!u&&(y*=n.cameraToCenterDistance/H[3]),u){let q=$r((D.y/Ze+x.y)/(1<<x.z));y/=n.projection.pixelsPerMeter(q,1)/pi(1,q)}if(_O(N,k,y))return!0}return!1}function TO(t,e,n,i){let l=r.e.transformMat4([],[t,e,n,1],i);return new Ue(l[0]/l[3],l[1]/l[3])}let fI=r.v.fromValues(0,0,0),IO=r.v.fromValues(0,0,1);function DO(t,e){let n=r.v.create();return fI[2]=e,t.intersectsPlane(fI,IO,n),new Ue(n[0],n[1])}class pI extends a0{}function mI(t,{width:e,height:n},i,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==e*n*i)throw new RangeError("mismatched image size")}else l=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=l,t}function gI(t,e,n){let{width:i,height:l}=e;i===t.width&&l===t.height||(h0(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,l)},n),t.width=i,t.height=l,t.data=e.data)}function h0(t,e,n,i,l,u,h){if(l.width===0||l.height===0)return e;if(l.width>t.width||l.height>t.height||n.x>t.width-l.width||n.y>t.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>e.width||l.height>e.height||i.x>e.width-l.width||i.y>e.height-l.height)throw new RangeError("out of range destination coordinates for image copy");let m=t.data,y=e.data,x=u===4&&h;for(let w=0;w<l.height;w++){let T=((n.y+w)*t.width+n.x)*u,D=((i.y+w)*e.width+i.x)*u;if(x)for(let S=0;S<l.width;S++){let A=T+S*u+3,P=D+S*u;y[P+0]=255,y[P+1]=255,y[P+2]=255,y[P+3]=m[A]}else for(let S=0;S<l.width*u;S++)y[D+S]=m[T+S]}return e}it(pI,"HeatmapBucket",{omit:["layers"]});class ya{constructor(e,n){mI(this,e,1,n)}resize(e){gI(this,new ya(e),1)}clone(){return new ya({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,l,u){h0(e,n,i,l,u,1)}}class oo{constructor(e,n){mI(this,e,4,n)}resize(e){gI(this,new oo(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new oo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,l,u,h){h0(e,n,i,l,u,4,h)}}class _I{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}it(ya,"AlphaImage"),it(oo,"RGBAImage");let MO=new Re({visibility:new Q(ye.layout_heatmap.visibility)});var SO={paint:new Re({"heatmap-radius":new me(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new me(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Q(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Le(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Q(ye.paint_heatmap["heatmap-opacity"])}),layout:MO};function Nm(t){let e={},n=t.resolution||256,i=t.clips?t.clips.length:1,l=t.image||new oo({width:n,height:i}),u=(h,m,y)=>{e[t.evaluationKey]=y;let x=t.expression.evaluate(e);x&&(l.data[h+m+0]=Math.floor(255*x.r/x.a),l.data[h+m+1]=Math.floor(255*x.g/x.a),l.data[h+m+2]=Math.floor(255*x.b/x.a),l.data[h+m+3]=Math.floor(255*x.a))};if(t.clips)for(let h=0,m=0;h<i;++h,m+=4*n)for(let y=0,x=0;y<n;y++,x+=4){let w=y/(n-1),{start:T,end:D}=t.clips[h];u(m,x,T*(1-w)+D*w)}else for(let h=0,m=0;h<n;h++,m+=4)u(0,m,h/(n-1));return l}let CO=new Re({visibility:new Q(ye.layout_hillshade.visibility)});var AO={paint:new Re({"hillshade-illumination-direction":new Q(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Q(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Q(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Q(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Q(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Q(ye.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Q(ye.paint_hillshade["hillshade-emissive-strength"])}),layout:CO};let RO=dt([{name:"a_pos",components:2,type:"Int16"}],4),{members:PO}=RO;var d0={exports:{}};function zm(t,e,n){n=n||2;var i,l,u,h,m,y,x,w=e&&e.length,T=w?e[0]*n:t.length,D=yI(t,0,T,n,!0),S=[];if(!D||D.next===D.prev)return S;if(w&&(D=function(P,k,N,H){var q,Z,K,ee=[];for(q=0,Z=k.length;q<Z;q++)(K=yI(P,k[q]*H,q<Z-1?k[q+1]*H:P.length,H,!1))===K.next&&(K.steiner=!0),ee.push(jO(K));for(ee.sort(NO),q=0;q<ee.length;q++)N=zO(ee[q],N);return N}(t,e,D,n)),t.length>80*n){i=u=t[0],l=h=t[1];for(var A=n;A<T;A+=n)(m=t[A])<i&&(i=m),(y=t[A+1])<l&&(l=y),m>u&&(u=m),y>h&&(h=y);x=(x=Math.max(u-i,h-l))!==0?32767/x:0}return Kd(D,S,n,i,l,x,0),S}function yI(t,e,n,i,l){var u,h;if(l===m0(t,e,n,i)>0)for(u=e;u<n;u+=i)h=bI(u,t[u],t[u+1],h);else for(u=n-i;u>=e;u-=i)h=bI(u,t[u],t[u+1],h);return h&&Bm(h,h.next)&&(ef(h),h=h.next),h}function lc(t,e){if(!t)return t;e||(e=t);var n,i=t;do if(n=!1,i.steiner||!Bm(i,i.next)&&yr(i.prev,i,i.next)!==0)i=i.next;else{if(ef(i),(i=e=i.prev)===i.next)break;n=!0}while(n||i!==e);return e}function Kd(t,e,n,i,l,u,h){if(t){!h&&u&&function(w,T,D,S){var A=w;do A.z===0&&(A.z=f0(A.x,A.y,T,D,S)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==w);A.prevZ.nextZ=null,A.prevZ=null,function(P){var k,N,H,q,Z,K,ee,le,he=1;do{for(N=P,P=null,Z=null,K=0;N;){for(K++,H=N,ee=0,k=0;k<he&&(ee++,H=H.nextZ);k++);for(le=he;ee>0||le>0&&H;)ee!==0&&(le===0||!H||N.z<=H.z)?(q=N,N=N.nextZ,ee--):(q=H,H=H.nextZ,le--),Z?Z.nextZ=q:P=q,q.prevZ=Z,Z=q;N=H}Z.nextZ=null,he*=2}while(K>1)}(A)}(t,i,l,u);for(var m,y,x=t;t.prev!==t.next;)if(m=t.prev,y=t.next,u?kO(t,i,l,u):OO(t))e.push(m.i/n|0),e.push(t.i/n|0),e.push(y.i/n|0),ef(t),t=y.next,x=y.next;else if((t=y)===x){h?h===1?Kd(t=LO(lc(t),e,n),e,n,i,l,u,2):h===2&&FO(t,e,n,i,l,u):Kd(lc(t),e,n,i,l,u,1);break}}}function OO(t){var e=t.prev,n=t,i=t.next;if(yr(e,n,i)>=0)return!1;for(var l=e.x,u=n.x,h=i.x,m=e.y,y=n.y,x=i.y,w=l<u?l<h?l:h:u<h?u:h,T=m<y?m<x?m:x:y<x?y:x,D=l>u?l>h?l:h:u>h?u:h,S=m>y?m>x?m:x:y>x?y:x,A=i.next;A!==e;){if(A.x>=w&&A.x<=D&&A.y>=T&&A.y<=S&&Nu(l,m,u,y,h,x,A.x,A.y)&&yr(A.prev,A,A.next)>=0)return!1;A=A.next}return!0}function kO(t,e,n,i){var l=t.prev,u=t,h=t.next;if(yr(l,u,h)>=0)return!1;for(var m=l.x,y=u.x,x=h.x,w=l.y,T=u.y,D=h.y,S=m<y?m<x?m:x:y<x?y:x,A=w<T?w<D?w:D:T<D?T:D,P=m>y?m>x?m:x:y>x?y:x,k=w>T?w>D?w:D:T>D?T:D,N=f0(S,A,e,n,i),H=f0(P,k,e,n,i),q=t.prevZ,Z=t.nextZ;q&&q.z>=N&&Z&&Z.z<=H;){if(q.x>=S&&q.x<=P&&q.y>=A&&q.y<=k&&q!==l&&q!==h&&Nu(m,w,y,T,x,D,q.x,q.y)&&yr(q.prev,q,q.next)>=0||(q=q.prevZ,Z.x>=S&&Z.x<=P&&Z.y>=A&&Z.y<=k&&Z!==l&&Z!==h&&Nu(m,w,y,T,x,D,Z.x,Z.y)&&yr(Z.prev,Z,Z.next)>=0))return!1;Z=Z.nextZ}for(;q&&q.z>=N;){if(q.x>=S&&q.x<=P&&q.y>=A&&q.y<=k&&q!==l&&q!==h&&Nu(m,w,y,T,x,D,q.x,q.y)&&yr(q.prev,q,q.next)>=0)return!1;q=q.prevZ}for(;Z&&Z.z<=H;){if(Z.x>=S&&Z.x<=P&&Z.y>=A&&Z.y<=k&&Z!==l&&Z!==h&&Nu(m,w,y,T,x,D,Z.x,Z.y)&&yr(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function LO(t,e,n){var i=t;do{var l=i.prev,u=i.next.next;!Bm(l,u)&&vI(l,i,i.next,u)&&Qd(l,u)&&Qd(u,l)&&(e.push(l.i/n|0),e.push(i.i/n|0),e.push(u.i/n|0),ef(i),ef(i.next),i=t=u),i=i.next}while(i!==t);return lc(i)}function FO(t,e,n,i,l,u){var h=t;do{for(var m=h.next.next;m!==h.prev;){if(h.i!==m.i&&VO(h,m)){var y=xI(h,m);return h=lc(h,h.next),y=lc(y,y.next),Kd(h,e,n,i,l,u,0),void Kd(y,e,n,i,l,u,0)}m=m.next}h=h.next}while(h!==t)}function NO(t,e){return t.x-e.x}function zO(t,e){var n=function(l,u){var h,m=u,y=l.x,x=l.y,w=-1/0;do{if(x<=m.y&&x>=m.next.y&&m.next.y!==m.y){var T=m.x+(x-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(T<=y&&T>w&&(w=T,h=m.x<m.next.x?m:m.next,T===y))return h}m=m.next}while(m!==u);if(!h)return null;var D,S=h,A=h.x,P=h.y,k=1/0;m=h;do y>=m.x&&m.x>=A&&y!==m.x&&Nu(x<P?y:w,x,A,P,x<P?w:y,x,m.x,m.y)&&(D=Math.abs(x-m.y)/(y-m.x),Qd(m,l)&&(D<k||D===k&&(m.x>h.x||m.x===h.x&&BO(h,m)))&&(h=m,k=D)),m=m.next;while(m!==S);return h}(t,e);if(!n)return e;var i=xI(n,t);return lc(i,i.next),lc(n,n.next)}function BO(t,e){return yr(t.prev,t,e.prev)<0&&yr(e.next,t,t.next)<0}function f0(t,e,n,i,l){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*l|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*l|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jO(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Nu(t,e,n,i,l,u,h,m){return(l-h)*(e-m)>=(t-h)*(u-m)&&(t-h)*(i-m)>=(n-h)*(e-m)&&(n-h)*(u-m)>=(l-h)*(i-m)}function VO(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){var l=n;do{if(l.i!==n.i&&l.next.i!==n.i&&l.i!==i.i&&l.next.i!==i.i&&vI(l,l.next,n,i))return!0;l=l.next}while(l!==n);return!1}(t,e)&&(Qd(t,e)&&Qd(e,t)&&function(n,i){var l=n,u=!1,h=(n.x+i.x)/2,m=(n.y+i.y)/2;do l.y>m!=l.next.y>m&&l.next.y!==l.y&&h<(l.next.x-l.x)*(m-l.y)/(l.next.y-l.y)+l.x&&(u=!u),l=l.next;while(l!==n);return u}(t,e)&&(yr(t.prev,t,e.prev)||yr(t,e.prev,e))||Bm(t,e)&&yr(t.prev,t,t.next)>0&&yr(e.prev,e,e.next)>0)}function yr(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Bm(t,e){return t.x===e.x&&t.y===e.y}function vI(t,e,n,i){var l=Vm(yr(t,e,n)),u=Vm(yr(t,e,i)),h=Vm(yr(n,i,t)),m=Vm(yr(n,i,e));return l!==u&&h!==m||!(l!==0||!jm(t,n,e))||!(u!==0||!jm(t,i,e))||!(h!==0||!jm(n,t,i))||!(m!==0||!jm(n,e,i))}function jm(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Vm(t){return t>0?1:t<0?-1:0}function Qd(t,e){return yr(t.prev,t,t.next)<0?yr(t,e,t.next)>=0&&yr(t,t.prev,e)>=0:yr(t,e,t.prev)<0||yr(t,t.next,e)<0}function xI(t,e){var n=new p0(t.i,t.x,t.y),i=new p0(e.i,e.x,e.y),l=t.next,u=e.prev;return t.next=e,e.prev=t,n.next=l,l.prev=n,i.next=n,n.prev=i,u.next=i,i.prev=u,i}function bI(t,e,n,i){var l=new p0(t,e,n);return i?(l.next=i.next,l.prev=i,i.next.prev=l,i.next=l):(l.prev=l,l.next=l),l}function ef(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function p0(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function m0(t,e,n,i){for(var l=0,u=e,h=n-i;u<n;u+=i)l+=(t[h]-t[u])*(t[u+1]+t[h+1]),h=u;return l}d0.exports=zm,d0.exports.default=zm,zm.deviation=function(t,e,n,i){var l=e&&e.length,u=Math.abs(m0(t,0,l?e[0]*n:t.length,n));if(l)for(var h=0,m=e.length;h<m;h++)u-=Math.abs(m0(t,e[h]*n,h<m-1?e[h+1]*n:t.length,n));var y=0;for(h=0;h<i.length;h+=3){var x=i[h]*n,w=i[h+1]*n,T=i[h+2]*n;y+=Math.abs((t[x]-t[T])*(t[w+1]-t[x+1])-(t[x]-t[w])*(t[T+1]-t[x+1]))}return u===0&&y===0?0:Math.abs((y-u)/u)},zm.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,l=0;l<t.length;l++){for(var u=0;u<t[l].length;u++)for(var h=0;h<e;h++)n.vertices.push(t[l][u][h]);l>0&&n.holes.push(i+=t[l-1].length)}return n};var Um=St(d0.exports);function g0(t,e){let n=t.length;if(n<=1)return[t];let i=[],l,u;for(let h=0;h<n;h++){let m=te(t[h]);m!==0&&(t[h].area=Math.abs(m),u===void 0&&(u=m<0),u===m<0?(l&&i.push(l),l=[t[h]]):l.push(t[h]))}if(l&&i.push(l),e>1)for(let h=0;h<i.length;h++)i[h].length<=e||(Lp(i[h],e,1,i[h].length-1,UO),i[h]=i[h].slice(0,e));return i}function UO(t,e){return e.area-t.area}function _0(t,e,n){let i=n.patternDependencies,l=!1;for(let u of e){let h=u.paint.get(`${t}-pattern`);h.isConstant()||(l=!0);let m=h.constantOr(null);m&&(l=!0,i[m]=!0)}return l}function y0(t,e,n,i,l){let u=l.patternDependencies;for(let h of e){let m=h.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let y=m.evaluate({zoom:i},n,{},l.availableImages);y=y&&y.name?y.name:y,u[y]=!0,n.patterns[h.id]=y}}return n}class $m{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Lt,this.indexArray=new En,this.indexArray2=new ei,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new Xn,this.segments2=new Xn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,i,l){this.hasPattern=_0("fill",this.layers,n);let u=this.layers[0].layout.get("fill-sort-key"),h=[];for(let{feature:m,id:y,index:x,sourceLayerIndex:w}of e){let T=this.layers[0]._featureFilter.needGeometry,D=Ka(m,T);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),D,i))continue;let S=u?u.evaluate(D,{},i,n.availableImages):void 0,A={id:y,properties:m.properties,type:m.type,sourceLayerIndex:w,index:x,geometry:T?D.geometry:Is(m,i,l),patterns:{},sortKey:S};h.push(A)}u&&h.sort((m,y)=>m.sortKey-y.sortKey);for(let m of h){let{geometry:y,index:x,sourceLayerIndex:w}=m;if(this.hasPattern){let T=y0("fill",this.layers,m,this.zoom,n);this.patternFeatures.push(T)}else this.addFeature(m,y,x,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[x].feature,y,x,w,this.index)}}update(e,n,i,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,i,l,u)}addFeatures(e,n,i,l,u,h){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,PO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,l,u,h=[],m){for(let y of g0(n,500)){let x=0;for(let P of y)x+=P.length;let w=this.segments.prepareSegment(x,this.layoutVertexArray,this.indexArray),T=w.vertexLength,D=[],S=[];for(let P of y){if(P.length===0)continue;P!==y[0]&&S.push(D.length/2);let k=this.segments2.prepareSegment(P.length,this.layoutVertexArray,this.indexArray2),N=k.vertexLength;this.layoutVertexArray.emplaceBack(P[0].x,P[0].y),this.indexArray2.emplaceBack(N+P.length-1,N),D.push(P[0].x),D.push(P[0].y);for(let H=1;H<P.length;H++)this.layoutVertexArray.emplaceBack(P[H].x,P[H].y),this.indexArray2.emplaceBack(N+H-1,N+H),D.push(P[H].x),D.push(P[H].y);k.vertexLength+=P.length,k.primitiveLength+=P.length}let A=Um(D,S);for(let P=0;P<A.length;P+=3)this.indexArray.emplaceBack(T+A[P],T+A[P+1],T+A[P+2]);w.vertexLength+=x,w.primitiveLength+=A.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,u,h,l,m)}}it($m,"FillBucket",{omit:["layers","patternFeatures"]});let $O=new Re({"fill-sort-key":new me(ye.layout_fill["fill-sort-key"]),visibility:new Q(ye.layout_fill.visibility)});var GO={paint:new Re({"fill-antialias":new Q(ye.paint_fill["fill-antialias"]),"fill-opacity":new me(ye.paint_fill["fill-opacity"]),"fill-color":new me(ye.paint_fill["fill-color"]),"fill-outline-color":new me(ye.paint_fill["fill-outline-color"]),"fill-translate":new Q(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new Q(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new me(ye.paint_fill["fill-pattern"]),"fill-emissive-strength":new Q(ye.paint_fill["fill-emissive-strength"])}),layout:$O};let HO=dt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),qO=dt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),WO=dt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ZO=dt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),XO=dt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:YO}=HO;var Gm={},JO=Pr,wI=zu;function zu(t,e,n,i,l){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=l,t.readFields(KO,this,e)}function KO(t,e,n){t==1?e.id=n.readVarint():t==2?function(i,l){for(var u=i.readVarint()+i.pos;i.pos<u;){var h=l._keys[i.readVarint()],m=l._values[i.readVarint()];l.properties[h]=m}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function QO(t){for(var e,n,i=0,l=0,u=t.length,h=u-1;l<u;h=l++)i+=((n=t[h]).x-(e=t[l]).x)*(e.y+n.y);return i}zu.types=["Unknown","Point","LineString","Polygon"],zu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,l=0,u=0,h=0,m=[];t.pos<n;){if(l<=0){var y=t.readVarint();i=7&y,l=y>>3}if(l--,i===1||i===2)u+=t.readSVarint(),h+=t.readSVarint(),i===1&&(e&&m.push(e),e=[]),e.push(new JO(u,h));else{if(i!==7)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&m.push(e),m},zu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,l=0,u=0,h=1/0,m=-1/0,y=1/0,x=-1/0;t.pos<e;){if(i<=0){var w=t.readVarint();n=7&w,i=w>>3}if(i--,n===1||n===2)(l+=t.readSVarint())<h&&(h=l),l>m&&(m=l),(u+=t.readSVarint())<y&&(y=u),u>x&&(x=u);else if(n!==7)throw new Error("unknown command "+n)}return[h,y,m,x]},zu.prototype.toGeoJSON=function(t,e,n){var i,l,u=this.extent*Math.pow(2,n),h=this.extent*t,m=this.extent*e,y=this.loadGeometry(),x=zu.types[this.type];function w(S){for(var A=0;A<S.length;A++){var P=S[A];S[A]=[360*(P.x+h)/u-180,360/Math.PI*Math.atan(Math.exp((180-360*(P.y+m)/u)*Math.PI/180))-90]}}switch(this.type){case 1:var T=[];for(i=0;i<y.length;i++)T[i]=y[i][0];w(y=T);break;case 2:for(i=0;i<y.length;i++)w(y[i]);break;case 3:for(y=function(S){var A=S.length;if(A<=1)return[S];for(var P,k,N=[],H=0;H<A;H++){var q=QO(S[H]);q!==0&&(k===void 0&&(k=q<0),k===q<0?(P&&N.push(P),P=[S[H]]):P.push(S[H]))}return P&&N.push(P),N}(y),i=0;i<y.length;i++)for(l=0;l<y[i].length;l++)w(y[i][l])}y.length===1?y=y[0]:x="Multi"+x;var D={type:"Feature",geometry:{type:x,coordinates:y},properties:this.properties};return"id"in this&&(D.id=this.id),D};var ek=wI,EI=TI;function TI(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(tk,this,e),this.length=this._features.length}function tk(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(i){for(var l=null,u=i.readVarint()+i.pos;i.pos<u;){var h=i.readVarint()>>3;l=h===1?i.readString():h===2?i.readFloat():h===3?i.readDouble():h===4?i.readVarint64():h===5?i.readVarint():h===6?i.readSVarint():h===7?i.readBoolean():null}return l}(n))}TI.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ek(this._pbf,e,this.extent,this._keys,this._values)};var nk=EI;function rk(t,e,n){if(t===3){var i=new nk(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var v0=Gm.VectorTile=function(t,e){this.layers=t.readFields(rk,{},e)},Hm=Gm.VectorTileFeature=wI;function qm(t,e,n,i){let l=[],u=i===0?(h,m,y,x,w,T)=>{h.push(new Ue(T,y+(T-m)/(x-m)*(w-y)))}:(h,m,y,x,w,T)=>{h.push(new Ue(m+(T-y)/(w-y)*(x-m),T))};for(let h of t){let m=[];for(let y of h){if(y.length<=2)continue;let x=[];for(let D=0;D<y.length-1;D++){let S=y[D].x,A=y[D].y,P=y[D+1].x,k=y[D+1].y,N=i===0?S:A,H=i===0?P:k;N<e?H>e&&u(x,S,A,P,k,e):N>n?H<n&&u(x,S,A,P,k,n):x.push(y[D]),H<e&&N>=e&&u(x,S,A,P,k,e),H>n&&N<=n&&u(x,S,A,P,k,n)}let w=y[y.length-1],T=i===0?w.x:w.y;T>=e&&T<=n&&x.push(w),x.length&&(w=x[x.length-1],x[0].x===w.x&&x[0].y===w.y||x.push(x[0]),m.push(x))}m.length&&l.push(m)}return l}Gm.VectorTileLayer=EI;class II{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var ik={read:function(t,e,n,i,l){var u,h,m=8*l-i-1,y=(1<<m)-1,x=y>>1,w=-7,T=n?l-1:0,D=n?-1:1,S=t[e+T];for(T+=D,u=S&(1<<-w)-1,S>>=-w,w+=m;w>0;u=256*u+t[e+T],T+=D,w-=8);for(h=u&(1<<-w)-1,u>>=-w,w+=i;w>0;h=256*h+t[e+T],T+=D,w-=8);if(u===0)u=1-x;else{if(u===y)return h?NaN:1/0*(S?-1:1);h+=Math.pow(2,i),u-=x}return(S?-1:1)*h*Math.pow(2,u-i)},write:function(t,e,n,i,l,u){var h,m,y,x=8*u-l-1,w=(1<<x)-1,T=w>>1,D=l===23?Math.pow(2,-24)-Math.pow(2,-77):0,S=i?0:u-1,A=i?1:-1,P=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,h=w):(h=Math.floor(Math.log(e)/Math.LN2),e*(y=Math.pow(2,-h))<1&&(h--,y*=2),(e+=h+T>=1?D/y:D*Math.pow(2,1-T))*y>=2&&(h++,y/=2),h+T>=w?(m=0,h=w):h+T>=1?(m=(e*y-1)*Math.pow(2,l),h+=T):(m=e*Math.pow(2,T-1)*Math.pow(2,l),h=0));l>=8;t[n+S]=255&m,S+=A,m/=256,l-=8);for(h=h<<l|m,x+=l;x>0;t[n+S]=255&h,S+=A,h/=256,x-=8);t[n+S-A]|=128*P}},DI=$n,Wm=ik;function $n(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var x0=4294967296,MI=1/x0,SI=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function va(t){return t.type===$n.Bytes?t.readVarint()+t.pos:t.pos+1}function Bu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function CI(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var l=n.pos-1;l>=t;l--)n.buf[l+i]=n.buf[l]}function ok(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function sk(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function ak(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function lk(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function ck(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function uk(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function hk(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function dk(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function fk(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Zm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function ju(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function AI(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),l=i>>3,u=this.pos;this.type=7&i,t(l,e,this),this.pos===u&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Zm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=AI(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Zm(this.buf,this.pos)+Zm(this.buf,this.pos+4)*x0;return this.pos+=8,t},readSFixed64:function(){var t=Zm(this.buf,this.pos)+AI(this.buf,this.pos+4)*x0;return this.pos+=8,t},readFloat:function(){var t=Wm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Wm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(l,u,h){var m,y,x=h.buf;if(m=(112&(y=x[h.pos++]))>>4,y<128||(m|=(127&(y=x[h.pos++]))<<3,y<128)||(m|=(127&(y=x[h.pos++]))<<10,y<128)||(m|=(127&(y=x[h.pos++]))<<17,y<128)||(m|=(127&(y=x[h.pos++]))<<24,y<128)||(m|=(1&(y=x[h.pos++]))<<31,y<128))return Bu(l,m,u);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&SI?function(n,i,l){return SI.decode(n.subarray(i,l))}(this.buf,e,t):function(n,i,l){for(var u="",h=i;h<l;){var m,y,x,w=n[h],T=null,D=w>239?4:w>223?3:w>191?2:1;if(h+D>l)break;D===1?w<128&&(T=w):D===2?(192&(m=n[h+1]))==128&&(T=(31&w)<<6|63&m)<=127&&(T=null):D===3?(y=n[h+2],(192&(m=n[h+1]))==128&&(192&y)==128&&((T=(15&w)<<12|(63&m)<<6|63&y)<=2047||T>=55296&&T<=57343)&&(T=null)):D===4&&(y=n[h+2],x=n[h+3],(192&(m=n[h+1]))==128&&(192&y)==128&&(192&x)==128&&((T=(15&w)<<18|(63&m)<<12|(63&y)<<6|63&x)<=65535||T>=1114112)&&(T=null)),T===null?(T=65533,D=1):T>65535&&(T-=65536,u+=String.fromCharCode(T>>>10&1023|55296),T=56320|1023&T),u+=String.fromCharCode(T),h+=D}return u}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==$n.Bytes)return t.push(this.readVarint(e));var n=va(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==$n.Bytes)return t.push(this.readSVarint());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==$n.Bytes)return t.push(this.readBoolean());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==$n.Bytes)return t.push(this.readFloat());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==$n.Bytes)return t.push(this.readDouble());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==$n.Bytes)return t.push(this.readFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==$n.Bytes)return t.push(this.readSFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==$n.Bytes)return t.push(this.readFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==$n.Bytes)return t.push(this.readSFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===$n.Varint)for(;this.buf[this.pos++]>127;);else if(e===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===$n.Fixed32)this.pos+=4;else{if(e!==$n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),ju(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),ju(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),ju(this.buf,-1&t,this.pos),ju(this.buf,Math.floor(t*MI),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),ju(this.buf,-1&t,this.pos),ju(this.buf,Math.floor(t*MI),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,l;if(e>=0?(i=e%4294967296|0,l=e/4294967296|0):(l=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,l=l+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(u,h,m){m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,u>>>=7,m.buf[m.pos++]=127&u|128,m.buf[m.pos]=127&(u>>>=7)}(i,0,n),function(u,h){var m=(7&u)<<4;h.buf[h.pos++]|=m|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(l,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,l,u){for(var h,m,y=0;y<l.length;y++){if((h=l.charCodeAt(y))>55295&&h<57344){if(!m){h>56319||y+1===l.length?(i[u++]=239,i[u++]=191,i[u++]=189):m=h;continue}if(h<56320){i[u++]=239,i[u++]=191,i[u++]=189,m=h;continue}h=m-55296<<10|h-56320|65536,m=null}else m&&(i[u++]=239,i[u++]=191,i[u++]=189,m=null);h<128?i[u++]=h:(h<2048?i[u++]=h>>6|192:(h<65536?i[u++]=h>>12|224:(i[u++]=h>>18|240,i[u++]=h>>12&63|128),i[u++]=h>>6&63|128),i[u++]=63&h|128)}return u}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&CI(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Wm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Wm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&CI(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,$n.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,ok,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,sk,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ck,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ak,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,lk,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,uk,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,hk,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,dk,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,fk,e)},writeBytesField:function(t,e){this.writeTag(t,$n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,$n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,$n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,$n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,$n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,$n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,$n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,$n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,$n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,$n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Xm=St(DI);let pk=["tile","layer","source","sourceLayer","state"];class RI{constructor(e,n,i,l,u){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=l,this.properties=e.properties,this.id=u}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of pk)this[n]!==void 0&&(e[n]=this[n]);return e}}class mk{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){let l=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][l]=this.stateChanges[e][l]||{},Tr(this.stateChanges[e][l],i),this.deletedStates[e]===null){this.deletedStates[e]={};for(let u in this.state[e])u!==l&&(this.deletedStates[e][u]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][l]===null){this.deletedStates[e][l]={};for(let u in this.state[e][l])i[u]||(this.deletedStates[e][l][u]=null)}else for(let u in i)this.deletedStates[e]&&this.deletedStates[e][l]&&this.deletedStates[e][l][u]===null&&delete this.deletedStates[e][l][u]}removeFeatureState(e,n,i){if(this.deletedStates[e]===null)return;let l=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&n!==void 0)this.deletedStates[e][l]!==null&&(this.deletedStates[e][l]=this.deletedStates[e][l]||{},this.deletedStates[e][l][i]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][l])for(i in this.deletedStates[e][l]={},this.stateChanges[e][l])this.deletedStates[e][l][i]=null;else this.deletedStates[e][l]=null;else this.deletedStates[e]=null}getState(e,n){let i=String(n),l=Tr({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let u=this.deletedStates[e][n];if(u===null)return{};for(let h in u)delete l[h]}return l}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let i={};for(let l in this.stateChanges){this.state[l]=this.state[l]||{};let u={};for(let h in this.stateChanges[l])this.state[l][h]||(this.state[l][h]={}),Tr(this.state[l][h],this.stateChanges[l][h]),u[h]=this.state[l][h];i[l]=u}for(let l in this.deletedStates){this.state[l]=this.state[l]||{};let u={};if(this.deletedStates[l]===null)for(let h in this.state[l])u[h]={},this.state[l][h]={};else for(let h in this.deletedStates[l]){if(this.deletedStates[l][h]===null)this.state[l][h]={};else if(this.state[l][h])for(let m of Object.keys(this.deletedStates[l][h]))delete this.state[l][h][m];u[h]=this.state[l][h]}i[l]=i[l]||{},Tr(i[l],u)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(let l in e)e[l].setFeatureState(i,n)}}class PI{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function OI(t,e,n,i){let l=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(i[h])<1e-15){if(n[h]<t[h]||n[h]>e[h])return null}else{let m=1/i[h],y=(t[h]-n[h])*m,x=(e[h]-n[h])*m;if(y>x){let w=y;y=x,x=w}if(y>l&&(l=y),x<u&&(u=x),l>u)return null}return l}function kI(t,e,n,i,l,u,h,m,y,x,w){let T=i-t,D=l-e,S=u-n,A=h-t,P=m-e,k=y-n,N=w[1]*k-w[2]*P,H=w[2]*A-w[0]*k,q=w[0]*P-w[1]*A,Z=T*N+D*H+S*q;if(Math.abs(Z)<1e-15)return null;let K=1/Z,ee=x[0]-t,le=x[1]-e,he=x[2]-n,fe=(ee*N+le*H+he*q)*K;if(fe<0||fe>1)return null;let xe=le*S-he*D,_e=he*T-ee*S,Me=ee*D-le*T,Be=(w[0]*xe+w[1]*_e+w[2]*Me)*K;return Be<0||fe+Be>1?null:(A*xe+P*_e+k*Me)*K}function LI(t,e,n){return(t-e)/(n-e)}function FI(t,e,n,i,l,u,h,m,y){let x=1<<n,w=u-i,T=h-l,D=(t+1)/x*w+i,S=(e+0)/x*T+l,A=(e+1)/x*T+l;m[0]=(t+0)/x*w+i,m[1]=S,y[0]=D,y[1]=A}class NI{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(u){let h=Math.ceil(Math.log2(u.dim/8)),m=[],y=Math.ceil(Math.pow(2,h)),x=1/y,w=(S,A,P,k,N)=>{let H=k?1:0,q=(S+1)*P-H,Z=A*P,K=(A+1)*P-H;N[0]=S*P,N[1]=Z,N[2]=q,N[3]=K},T=new PI(y),D=[];for(let S=0;S<y*y;S++){w(S%y,Math.floor(S/y),x,!1,D);let A=Qa(D[0],D[1],u),P=Qa(D[2],D[1],u),k=Qa(D[2],D[3],u),N=Qa(D[0],D[3],u);T.minimums.push(Math.min(A,P,k,N)),T.maximums.push(Math.max(A,P,k,N)),T.leaves.push(1)}for(m.push(T),y/=2;y>=1;y/=2){let S=m[m.length-1];T=new PI(y);for(let A=0;A<y*y;A++){w(A%y,Math.floor(A/y),2,!0,D);let P=S.getElevation(D[0],D[1]),k=S.getElevation(D[2],D[1]),N=S.getElevation(D[2],D[3]),H=S.getElevation(D[0],D[3]),q=S.isLeaf(D[0],D[1]),Z=S.isLeaf(D[2],D[1]),K=S.isLeaf(D[2],D[3]),ee=S.isLeaf(D[0],D[3]),le=Math.min(P.min,k.min,N.min,H.min),he=Math.max(P.max,k.max,N.max,H.max),fe=q&&Z&&K&&ee;T.maximums.push(he),T.minimums.push(le),T.leaves.push(he-le<=5&&fe?1:0)}m.push(T)}return m}(this.dem),i=n.length-1,l=n[i];this._addNode(l.minimums[0],l.maximums[0],l.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,l,u,h,m=1){return OI([e,n,-100],[i,l,this.maximums[0]*m],u,h)}raycast(e,n,i,l,u,h,m=1){if(!this.nodeCount)return null;let y=this.raycastRoot(e,n,i,l,u,h,m);if(y==null)return null;let x=[],w=[],T=[],D=[],S=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;S.length>0;){let{idx:A,t:P,nodex:k,nodey:N,depth:H}=S.pop();if(this.leaves[A]){FI(k,N,H,e,n,i,l,T,D);let Z=1<<H,K=(k+0)/Z,ee=(k+1)/Z,le=(N+0)/Z,he=(N+1)/Z,fe=Qa(K,le,this.dem)*m,xe=Qa(ee,le,this.dem)*m,_e=Qa(ee,he,this.dem)*m,Me=Qa(K,he,this.dem)*m,Be=kI(T[0],T[1],fe,D[0],T[1],xe,D[0],D[1],_e,u,h),Te=kI(D[0],D[1],_e,T[0],D[1],Me,T[0],T[1],fe,u,h),ke=Math.min(Be!==null?Be:Number.MAX_VALUE,Te!==null?Te:Number.MAX_VALUE);if(ke!==Number.MAX_VALUE)return ke;{let Ee=r.v.scaleAndAdd([],u,h,P);if(zI(fe,xe,Me,_e,LI(Ee[0],T[0],D[0]),LI(Ee[1],T[1],D[1]))>=Ee[2])return P}continue}let q=0;for(let Z=0;Z<this._siblingOffset.length;Z++){FI((k<<1)+this._siblingOffset[Z][0],(N<<1)+this._siblingOffset[Z][1],H+1,e,n,i,l,T,D),T[2]=-100,D[2]=this.maximums[this.childOffsets[A]+Z]*m;let K=OI(T,D,u,h);if(K!=null){let ee=K;x[Z]=ee;let le=!1;for(let he=0;he<q&&!le;he++)ee>=x[w[he]]&&(w.splice(he,0,Z),le=!0);le||(w[q]=Z),q++}}for(let Z=0;Z<q;Z++){let K=w[Z];S.push({idx:this.childOffsets[A]+K,t:x[K],nodex:(k<<1)+this._siblingOffset[K][0],nodey:(N<<1)+this._siblingOffset[K][1],depth:H+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,l,u){if(e[l].isLeaf(n,i)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);let h=l-1,m=e[h],y=0,x=0;for(let w=0;w<this._siblingOffset.length;w++){let T=2*n+this._siblingOffset[w][0],D=2*i+this._siblingOffset[w][1],S=m.getElevation(T,D),A=m.isLeaf(T,D),P=this._addNode(S.min,S.max,A);A&&(y|=1<<w),x||(x=P)}for(let w=0;w<this._siblingOffset.length;w++)y&1<<w||this._construct(e,2*n+this._siblingOffset[w][0],2*i+this._siblingOffset[w][1],h,x+w)}}function zI(t,e,n,i,l,u){return Wt(Wt(t,n,u),Wt(e,i,u),l)}function Qa(t,e,n){let i=n.dim,l=Bt(t*i-.5,0,i-1),u=Bt(e*i-.5,0,i-1),h=Math.floor(l),m=Math.floor(u),y=Math.min(h+1,i-1),x=Math.min(m+1,i-1);return zI(n.get(h,m),n.get(y,m),n.get(h,x),n.get(y,x),l-h,u-m)}let gk={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _k(t,e,n){return(256*t*256+256*e+n)/10-1e4}function yk(t,e,n){return 256*t+e+n/256-32768}class Ym{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,l=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return Zn(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let u=this.dim=n.height-2,h=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=l,this._modifiedForSources={},!l){for(let y=0;y<u;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(u,y)]=h[this._idx(u-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,u)]=h[this._idx(y,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}let m=i==="terrarium"?yk:_k;for(let y=0;y<h.length;++y){let x=4*y;this.floatView[y]=m(this.pixels[x],this.pixels[x+1],this.pixels[x+2])}this._timestamp=Xr.now()}_buildQuadTree(){this._tree=new NI(this)}get(e,n,i=!1){i&&(e=Bt(e,-1,this.dim),n=Bt(n,-1,this.dim));let l=this._idx(e,n);return this.floatView[l]}set(e,n,i){let l=this._idx(e,n),u=this.floatView[l];return this.floatView[l]=i,i-u}static getUnpackVector(e){return gk[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let i=[0,0,0,0],l=Ym.getUnpackVector(n),u=Math.floor((e+l[3])/l[2]);return i[2]=u%256,u=Math.floor(u/256),i[1]=u%256,u=Math.floor(u/256),i[0]=u,i}getPixels(){return new _I({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let l=n*this.dim,u=n*this.dim+this.dim,h=i*this.dim,m=i*this.dim+this.dim;switch(n){case-1:l=u-1;break;case 1:u=l+1}switch(i){case-1:h=m-1;break;case 1:m=h+1}let y=-n*this.dim,x=-i*this.dim;for(let w=h;w<m;w++)for(let T=l;T<u;T++){let D=4*this._idx(T,w),S=4*this._idx(T+y,w+x);this.pixels[D+0]=e.pixels[S+0],this.pixels[D+1]=e.pixels[S+1],this.pixels[D+2]=e.pixels[S+2],this.pixels[D+3]=e.pixels[S+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}it(Ym,"DEMData"),it(NI,"DemMinMaxQuadTree",{omit:["dem"]});class Vu{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){let l=i||e.findDEMTileFor(n);if(!l||!l.dem)return;let u=l.dem,h=l.tileID,m=1<<n.canonical.z-h.canonical.z;return new Vu(l,u.dim/Ze/m,[(n.canonical.x/m-h.canonical.x)*u.dim,(n.canonical.y/m-h.canonical.y)*u.dim])}tileCoordToPixel(e,n){let i=n*this._scale+this._offset[1],l=Math.floor(e*this._scale+this._offset[0]),u=Math.floor(i);return new Ue(l,u)}getElevationAt(e,n,i,l){let u=e*this._scale+this._offset[0],h=n*this._scale+this._offset[1],m=Math.floor(u),y=Math.floor(h),x=this._dem;return l=!!l,i?Wt(Wt(x.get(m,y,l),x.get(m,y+1,l),h-y),Wt(x.get(m+1,y,l),x.get(m+1,y+1,l),h-y),u-m):x.get(m,y,l)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*pi(1,e)*this._dem.stride}}class b0{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new qa(Ze,16,0),this.featureIndexArray=new pE,this.promoteId=n}insert(e,n,i,l,u,h=0){let m=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,l,u,h);let y=this.grid;for(let x=0;x<n.length;x++){let w=n[x],T=[1/0,1/0,-1/0,-1/0];for(let D=0;D<w.length;D++){let S=w[D];T[0]=Math.min(T[0],S.x),T[1]=Math.min(T[1],S.y),T[2]=Math.max(T[2],S.x),T[3]=Math.max(T[3],S.y)}T[0]<Ze&&T[1]<Ze&&T[2]>=0&&T[3]>=0&&y.insert(m,T[0],T[1],T[2],T[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new v0(new Xm(this.rawTileData)).layers,this.sourceLayerCoder=new II(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,l){this.loadVTLayers();let u=e.params||{},h=Du(u.filter),m=e.tileResult,y=e.transform,x=m.bufferedTilespaceBounds,w=this.grid.query(x.min.x,x.min.y,x.max.x,x.max.y,(A,P,k,N)=>lI(m.bufferedTilespaceGeometry,A,P,k,N));w.sort(vk);let T=null;y.elevation&&w.length>0&&(T=Vu.create(y.elevation,this.tileID));let D={},S;for(let A=0;A<w.length;A++){let P=w[A];if(P===S)continue;S=P;let k=this.featureIndexArray.get(P),N=null;this.loadMatchingFeature(D,k,h,u.layers,u.availableImages,n,i,l,(H,q,Z,K=0)=>(N||(N=Is(H,this.tileID.canonical,e.tileTransform)),q.queryIntersectsFeature(m,H,Z,N,this.z,e.transform,e.pixelPosMatrix,T,K)))}return D}loadMatchingFeature(e,n,i,l,u,h,m,y,x){let{featureIndex:w,bucketIndex:T,sourceLayerIndex:D,layoutVertexArrayOffset:S}=n,A=this.bucketLayerIDs[T];if(l&&!function(H,q){for(let Z=0;Z<H.length;Z++)if(q.indexOf(H[Z])>=0)return!0;return!1}(l,A))return;let P=this.sourceLayerCoder.decode(D),k=this.vtLayers[P].feature(w);if(i.needGeometry){let H=Ka(k,!0);if(!i.filter(new ae(this.tileID.overscaledZ),H,this.tileID.canonical))return}else if(!i.filter(new ae(this.tileID.overscaledZ),k))return;let N=this.getId(k,P);for(let H=0;H<A.length;H++){let q=A[H];if(l&&l.indexOf(q)<0)continue;let Z=h[q];if(!Z)continue;let K={};N!==void 0&&y&&(K=y.getState(Z.sourceLayer||"_geojsonTileLayer",N));let ee=Tr({},m[q]);ee.paint=BI(ee.paint,Z.paint,k,K,u),ee.layout=BI(ee.layout,Z.layout,k,K,u);let le=!x||x(k,Z,K,S);if(!le)continue;let he=new RI(k,this.z,this.x,this.y,N);he.layer=ee;let fe=e[q];fe===void 0&&(fe=e[q]=[]),fe.push({featureIndex:w,feature:he,intersectionZ:le})}}lookupSymbolFeatures(e,n,i,l,u,h,m,y){let x={};this.loadVTLayers();let w=Du(u);for(let T of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:l,featureIndex:T,layoutVertexArrayOffset:0},w,h,m,y,n);return x}loadFeature(e){let{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();let l=this.sourceLayerCoder.decode(i),u=this.vtFeatures[l];if(u[n])return u[n];let h=this.vtLayers[l].feature(n);return u[n]=h,h}hasLayer(e){for(let n of this.bucketLayerIDs)for(let i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){let l=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];l!=null&&(i=e.properties[l]),typeof i=="boolean"&&(i=Number(i))}return i}}function BI(t,e,n,i,l){return Sl(t,(u,h)=>{let m=e instanceof Ce?e.get(h):null;return m&&m.evaluate?m.evaluate(n,i,l):m})}function vk(t,e){return e-t}it(b0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let xk=dt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),bk=dt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),wk=dt([{name:"a_projected_pos",components:4,type:"Float32"}],4);dt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Ek=dt([{name:"a_z_offset",components:1,type:"Float32"}],4),Tk=dt([{name:"a_texb",components:2,type:"Uint16"}]),Ik=dt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Dk=dt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);dt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let jI=dt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Mk=dt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);dt([{name:"triangle",components:3,type:"Uint16"}]),dt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),dt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),dt([{type:"Float32",name:"offsetX"}]),dt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Gr=24;let Vo=128;function w0(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ae(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:i,interpolationType:l}=n,u=0;for(;u<i.length&&i[u]<=t;)u++;u=Math.max(0,u-1);let h=u;for(;h<i.length&&i[h]<t+1;)h++;h=Math.min(i.length-1,h);let m=i[u],y=i[h];return n.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:y,interpolationType:l}:{kind:"camera",minZoom:m,maxZoom:y,minSize:n.evaluate(new ae(m)),maxSize:n.evaluate(new ae(y)),interpolationType:l}}}function Jm(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:l}){return t.kind==="source"?i/Vo:t.kind==="composite"?Wt(i/Vo,l/Vo,n):e}function Uu(t,e){let n=0,i=0;if(t.kind==="constant")i=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:l,minZoom:u,maxZoom:h}=t,m=l?Bt(Ki.interpolationFactor(l,e,u,h),0,1):0;t.kind==="camera"?i=Wt(t.minSize,t.maxSize,m):n=m}return{uSizeT:n,uSize:i}}var Sk=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Vo,evaluateSizeForFeature:Jm,evaluateSizeForZoom:Uu,getSizeData:w0});function Ck(t,e,n){return t.sections.forEach(i=>{i.text=function(l,u,h){let m=u.layout.get("text-transform").evaluate(h,{});return m==="uppercase"?l=l.toLocaleUpperCase():m==="lowercase"&&(l=l.toLocaleLowerCase()),ce.applyArabicShaping&&(l=ce.applyArabicShaping(l)),l}(i.text,e,n)}),t}let tf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Ak(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function Rk(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let E0=3;function Pk(t,e,n){e.glyphs=[],t===1&&n.readMessage(Ok,e)}function Ok(t,e,n){if(t===3){let{id:i,bitmap:l,width:u,height:h,left:m,top:y,advance:x}=n.readMessage(kk,{});e.glyphs.push({id:i,bitmap:new ya({width:u+2*E0,height:h+2*E0},l),metrics:{width:u,height:h,left:m,top:y,advance:x}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function kk(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let VI=E0,so={horizontal:1,vertical:2,horizontalOnly:3},UI=-17;class nf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let i=new nf;return i.scale=e||1,i.fontStack=n,i}static forImage(e){let n=new nf;return n.imageName=e,n}}class $u{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let i=new $u;for(let l=0;l<e.sections.length;l++){let u=e.sections[l];u.image?i.addImageSection(u):i.addTextSection(u,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let l="";for(let u=0;u<n.length;u++){let h=n.charCodeAt(u+1)||null,m=n.charCodeAt(u-1)||null;l+=!i&&(h&&R(h)&&!tf[n[u+1]]||m&&R(m)&&!tf[n[u-1]])||!tf[n[u]]?n[u]:tf[n[u]]}return l}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&Km[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&Km[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let i=new $u;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(nf.forText(e.scale,e.fontStack||n));let i=this.sections.length-1;for(let l=0;l<e.text.length;++l)this.sectionIndex.push(i)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void Zn("Can't add FormattedSection with an empty image.");let i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(nf.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function T0(t,e,n,i,l,u,h,m,y,x,w,T,D,S,A){let P=$u.fromFeature(t,l);T===so.vertical&&P.verticalizePunctuation(D);let k=[],N=function(ee,le,he,fe,xe,_e){if(!ee)return[];let Me=[],Be=function(Je,rt,Ne,wt,st,Ye){let Et=0;for(let ft=0;ft<Je.length();ft++){let yt=Je.getSection(ft);Et+=$I(Je.getCodePoint(ft),yt,wt,st,rt,Ye)}return Et/Math.max(1,Math.ceil(Et/Ne))}(ee,le,he,fe,xe,_e),Te=ee.text.indexOf("\u200B")>=0,ke=0;for(let Je=0;Je<ee.length();Je++){let rt=ee.getSection(Je),Ne=ee.getCodePoint(Je);if(Km[Ne]||(ke+=$I(Ne,rt,fe,xe,le,_e)),Je<ee.length()-1){let wt=!((Ee=Ne)<11904||!(v["Bopomofo Extended"](Ee)||v.Bopomofo(Ee)||v["CJK Compatibility Forms"](Ee)||v["CJK Compatibility Ideographs"](Ee)||v["CJK Compatibility"](Ee)||v["CJK Radicals Supplement"](Ee)||v["CJK Strokes"](Ee)||v["CJK Symbols and Punctuation"](Ee)||v["CJK Unified Ideographs Extension A"](Ee)||v["CJK Unified Ideographs"](Ee)||v["Enclosed CJK Letters and Months"](Ee)||v["Halfwidth and Fullwidth Forms"](Ee)||v.Hiragana(Ee)||v["Ideographic Description Characters"](Ee)||v["Kangxi Radicals"](Ee)||v["Katakana Phonetic Extensions"](Ee)||v.Katakana(Ee)||v["Vertical Forms"](Ee)||v["Yi Radicals"](Ee)||v["Yi Syllables"](Ee)));(Lk[Ne]||wt||rt.imageName)&&Me.push(HI(Je+1,ke,Be,Me,Fk(Ne,ee.getCodePoint(Je+1),wt&&Te),!1))}}var Ee;return qI(HI(ee.length(),ke,Be,Me,0,!0))}(P,x,u,e,i,S),{processBidirectionalText:H,processStyledBidirectionalText:q}=ce;if(H&&P.sections.length===1){let ee=H(P.toString(),N);for(let le of ee){let he=new $u;he.text=le,he.sections=P.sections;for(let fe=0;fe<le.length;fe++)he.sectionIndex.push(0);k.push(he)}}else if(q){let ee=q(P.text,P.sectionIndex,N);for(let le of ee){let he=new $u;he.text=le[0],he.sectionIndex=le[1],he.sections=P.sections,k.push(he)}}else k=function(ee,le){let he=[],fe=ee.text,xe=0;for(let _e of le)he.push(ee.substring(xe,_e)),xe=_e;return xe<fe.length&&he.push(ee.substring(xe,fe.length)),he}(P,N);let Z=[],K={positionedLines:Z,text:P.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:T,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ee,le,he,fe,xe,_e,Me,Be,Te,ke,Ee,Je){let rt=0,Ne=0,wt=0,st=Be==="right"?1:Be==="left"?0:.5,Ye=!1;for(let en of xe){let Ft=en.getSections();for(let Xt of Ft){if(Xt.imageName)continue;let un=le[Xt.fontStack];if(un&&(Ye=un.ascender!==void 0&&un.descender!==void 0,!Ye))break}if(!Ye)break}let Et=0;for(let en of xe){en.trim();let Ft=en.getMaxScale(),Xt=(Ft-1)*Gr,un={positionedGlyphs:[],lineOffset:0};ee.positionedLines[Et]=un;let Pn=un.positionedGlyphs,Ut=0;if(!en.length()){Ne+=_e,++Et;continue}let Gn=0,On=0;for(let bn=0;bn<en.length();bn++){let hn=en.getSection(bn),er=en.getSectionIndex(bn),Hn=en.getCodePoint(bn),lr=hn.scale,Cr=null,mi=null,fr=null,ir=Gr,ti=0,ni=!(Te===so.horizontal||!Ee&&!C(Hn)||Ee&&(Km[Hn]||(ft=Hn,v.Arabic(ft)||v["Arabic Supplement"](ft)||v["Arabic Extended-A"](ft)||v["Arabic Presentation Forms-A"](ft)||v["Arabic Presentation Forms-B"](ft))));if(hn.imageName){let gi=fe[hn.imageName];if(!gi)continue;fr=hn.imageName,ee.iconsInText=ee.iconsInText||!0,mi=gi.paddedRect;let qn=gi.displaySize;lr=lr*Gr/Je,Cr={width:qn[0],height:qn[1],left:0,top:-VI,advance:ni?qn[1]:qn[0],localGlyph:!1},ti=Ye?-Cr.height*lr:UI+Ft*Gr-qn[1]*lr,ir=Cr.advance;let Ho=(ni?qn[0]:qn[1])*lr-Gr*Ft;Ho>0&&Ho>Ut&&(Ut=Ho)}else{let gi=he[hn.fontStack];if(!gi)continue;gi[Hn]&&(mi=gi[Hn]);let qn=le[hn.fontStack];if(!qn)continue;let Ho=qn.glyphs[Hn];if(!Ho)continue;if(Cr=Ho.metrics,ir=Hn!==8203?Gr:0,Ye){let Yu=qn.ascender!==void 0?Math.abs(qn.ascender):0,wa=qn.descender!==void 0?Math.abs(qn.descender):0,Ea=(Yu+wa)*lr;Gn<Ea&&(Gn=Ea,On=(Yu-wa)/2*lr),ti=-Yu*lr}else ti=UI+(Ft-lr)*Gr}ni?(ee.verticalizable=!0,Pn.push({glyph:Hn,imageName:fr,x:rt,y:Ne+ti,vertical:ni,scale:lr,localGlyph:Cr.localGlyph,fontStack:hn.fontStack,sectionIndex:er,metrics:Cr,rect:mi}),rt+=ir*lr+ke):(Pn.push({glyph:Hn,imageName:fr,x:rt,y:Ne+ti,vertical:ni,scale:lr,localGlyph:Cr.localGlyph,fontStack:hn.fontStack,sectionIndex:er,metrics:Cr,rect:mi}),rt+=Cr.advance*lr+ke)}Pn.length!==0&&(wt=Math.max(rt-ke,wt),Ye?WI(Pn,st,Ut,On,_e*Ft/2):WI(Pn,st,Ut,0,_e/2)),rt=0;let _n=_e*Ft+Ut;un.lineOffset=Math.max(Ut,Xt),Ne+=_n,++Et}var ft;let yt=Ne,{horizontalAlign:He,verticalAlign:At}=I0(Me);(function(en,Ft,Xt,un,Pn,Ut){let Gn=(Ft-Xt)*Pn,On=-Ut*un;for(let _n of en)for(let bn of _n.positionedGlyphs)bn.x+=Gn,bn.y+=On})(ee.positionedLines,st,He,At,wt,yt),ee.top+=-At*yt,ee.bottom=ee.top+yt,ee.left+=-He*wt,ee.right=ee.left+wt,ee.hasBaseline=Ye}(K,e,n,i,k,h,m,y,T,x,D,A),!function(ee){for(let le of ee)if(le.positionedGlyphs.length!==0)return!1;return!0}(Z)&&K}let Km={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lk={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function $I(t,e,n,i,l,u){if(e.imageName){let h=i[e.imageName];return h?h.displaySize[0]*e.scale*Gr/u+l:0}{let h=n[e.fontStack],m=h&&h.glyphs[t];return m?m.metrics.advance*e.scale+l:0}}function GI(t,e,n,i){let l=Math.pow(t-e,2);return i?t<e?l/2:2*l:l+Math.abs(n)*n}function Fk(t,e,n){let i=0;return t===10&&(i-=1e4),n&&(i+=150),t!==40&&t!==65288||(i+=50),e!==41&&e!==65289||(i+=50),i}function HI(t,e,n,i,l,u){let h=null,m=GI(e,n,l,u);for(let y of i){let x=GI(e-y.x,n,l,u)+y.badness;x<=m&&(h=y,m=x)}return{index:t,x:e,priorBreak:h,badness:m}}function qI(t){return t?qI(t.priorBreak).concat(t.index):[]}function I0(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function WI(t,e,n,i,l){if(!(e||n||i||l))return;let u=t.length-1,h=t[u],m=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=u;y++)t[y].x-=m,t[y].y+=n+i+l}function Nk(t,e,n,i){let{horizontalAlign:l,verticalAlign:u}=I0(i),h=n[0]-t.displaySize[0]*l,m=n[1]-t.displaySize[1]*u;return{imagePrimary:t,imageSecondary:e,top:m,bottom:m+t.displaySize[1],left:h,right:h+t.displaySize[0]}}function ZI(t,e,n,i,l,u){let h=t.imagePrimary,m;if(h.content){let k=h.content,N=h.pixelRatio||1;m=[k[0]/N,k[1]/N,h.displaySize[0]-k[2]/N,h.displaySize[1]-k[3]/N]}let y=e.left*u,x=e.right*u,w,T,D,S;n==="width"||n==="both"?(S=l[0]+y-i[3],T=l[0]+x+i[1]):(S=l[0]+(y+x-h.displaySize[0])/2,T=S+h.displaySize[0]);let A=e.top*u,P=e.bottom*u;return n==="height"||n==="both"?(w=l[1]+A-i[0],D=l[1]+P+i[2]):(w=l[1]+(A+P-h.displaySize[1])/2,D=w+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:w,right:T,bottom:D,left:S,collisionPadding:m}}class xa extends Ue{constructor(e,n,i,l,u){super(e,n),this.angle=l,this.z=i,u!==void 0&&(this.segment=u)}clone(){return new xa(this.x,this.y,this.z,this.angle,this.segment)}}function XI(t,e,n,i,l){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,m=0;for(;m>-n/2;){if(h--,h<0)return!1;m-=t[h].dist(u),u=t[h]}m+=t[h].dist(t[h+1]),h++;let y=[],x=0;for(;m<n/2;){let w=t[h],T=t[h+1];if(!T)return!1;let D=t[h-1].angleTo(w)-w.angleTo(T);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:m,angleDelta:D}),x+=D;m-y[0].distance>i;)x-=y.shift().angleDelta;if(x>l)return!1;h++,m+=w.dist(T)}return!0}function YI(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function JI(t,e,n){return t?.6*e*n:0}function KI(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function zk(t,e,n,i,l,u){let h=JI(n,l,u),m=KI(n,i)*u,y=0,x=YI(t)/2;for(let w=0;w<t.length-1;w++){let T=t[w],D=t[w+1],S=T.dist(D);if(y+S>x){let A=(x-y)/S,P=Wt(T.x,D.x,A),k=Wt(T.y,D.y,A),N=new xa(P,k,0,D.angleTo(T),w);return!h||XI(t,N,m,h,e)?N:void 0}y+=S}}function Bk(t,e,n,i,l,u,h,m,y){let x=JI(i,u,h),w=KI(i,l),T=w*h,D=t[0].x===0||t[0].x===y||t[0].y===0||t[0].y===y;return e-T<e/4&&(e=T+e/4),QI(t,D?e/2*m%e:(w/2+2*u)*h*m%e,e,x,n,T,D,!1,y)}function QI(t,e,n,i,l,u,h,m,y){let x=u/2,w=YI(t),T=0,D=e-n,S=[];for(let A=0;A<t.length-1;A++){let P=t[A],k=t[A+1],N=P.dist(k),H=k.angleTo(P);for(;D+n<T+N;){D+=n;let q=(D-T)/N,Z=Wt(P.x,k.x,q),K=Wt(P.y,k.y,q);if(Z>=0&&Z<y&&K>=0&&K<y&&D-x>=0&&D+x<=w){let ee=new xa(Z,K,0,H,A);i&&!XI(t,ee,u,i,l)||S.push(ee)}}T+=N}return m||S.length||h||(S=QI(t,T/2,n,i,l,u,h,!0,y)),S}function eD(t,e,n,i,l){let u=[];for(let h=0;h<t.length;h++){let m=t[h],y;for(let x=0;x<m.length-1;x++){let w=m[x],T=m[x+1];w.x<e&&T.x<e||(w.x<e?w=new Ue(e,w.y+(e-w.x)/(T.x-w.x)*(T.y-w.y))._round():T.x<e&&(T=new Ue(e,w.y+(e-w.x)/(T.x-w.x)*(T.y-w.y))._round()),w.y<n&&T.y<n||(w.y<n?w=new Ue(w.x+(n-w.y)/(T.y-w.y)*(T.x-w.x),n)._round():T.y<n&&(T=new Ue(w.x+(n-w.y)/(T.y-w.y)*(T.x-w.x),n)._round()),w.x>=i&&T.x>=i||(w.x>=i?w=new Ue(i,w.y+(i-w.x)/(T.x-w.x)*(T.y-w.y))._round():T.x>=i&&(T=new Ue(i,w.y+(i-w.x)/(T.x-w.x)*(T.y-w.y))._round()),w.y>=l&&T.y>=l||(w.y>=l?w=new Ue(w.x+(l-w.y)/(T.y-w.y)*(T.x-w.x),l)._round():T.y>=l&&(T=new Ue(w.x+(l-w.y)/(T.y-w.y)*(T.x-w.x),l)._round()),y&&w.equals(y[y.length-1])||(y=[w],u.push(y)),y.push(T)))))}}return u}function D0(t){let e=0,n=0;for(let h of t)e+=h.w*h.h,n=Math.max(n,h.w);t.sort((h,m)=>m.h-h.h);let i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],l=0,u=0;for(let h of t)for(let m=i.length-1;m>=0;m--){let y=i[m];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===y.w&&h.h===y.h){let x=i.pop();m<i.length&&(i[m]=x)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(i.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:l,h:u,fill:e/(l*u)||0}}it(xa,"Anchor");let ki=1;class M0{constructor(e,{pixelRatio:n,version:i,stretchX:l,stretchY:u,content:h}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=l,this.stretchY=u,this.content=h,this.version=i}get tl(){return[this.paddedRect.x+ki,this.paddedRect.y+ki]}get br(){return[this.paddedRect.x+this.paddedRect.w-ki,this.paddedRect.y+this.paddedRect.h-ki]}get displaySize(){return[(this.paddedRect.w-2*ki)/this.pixelRatio,(this.paddedRect.h-2*ki)/this.pixelRatio]}}class tD{constructor(e,n){let i={},l={};this.haveRenderCallbacks=[];let u=[];this.addImages(e,i,u),this.addImages(n,l,u);let{w:h,h:m}=D0(u),y=new oo({width:h||1,height:m||1});for(let x in e){let w=e[x],T=i[x].paddedRect;oo.copy(w.data,y,{x:0,y:0},{x:T.x+ki,y:T.y+ki},w.data,w.sdf)}for(let x in n){let w=n[x],T=l[x].paddedRect,D=T.x+ki,S=T.y+ki,A=w.data.width,P=w.data.height;oo.copy(w.data,y,{x:0,y:0},{x:D,y:S},w.data),oo.copy(w.data,y,{x:0,y:P-1},{x:D,y:S-1},{width:A,height:1}),oo.copy(w.data,y,{x:0,y:0},{x:D,y:S+P},{width:A,height:1}),oo.copy(w.data,y,{x:A-1,y:0},{x:D-1,y:S},{width:1,height:P}),oo.copy(w.data,y,{x:0,y:0},{x:D+A,y:S},{width:1,height:P})}this.image=y,this.iconPositions=i,this.patternPositions=l}addImages(e,n,i){for(let l in e){let u=e[l],h={x:0,y:0,w:u.data.width+2*ki,h:u.data.height+2*ki};i.push(h),n[l]=new M0(h,u),u.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(let l in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[l],e.getImage(l,i),n),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;let[l,u]=e.tl,h=!!Object.keys(this.patternPositions).length;i.update(n.data,{useMipmap:h},{x:l,y:u})}}it(M0,"ImagePosition"),it(tD,"ImageAtlas");let rf=1e20;function nD(t,e,n,i,l,u,h,m,y){for(let x=e;x<e+i;x++)rD(t,n*u+x,u,l,h,m,y);for(let x=n;x<n+l;x++)rD(t,x*u+e,1,i,h,m,y)}function rD(t,e,n,i,l,u,h){u[0]=0,h[0]=-rf,h[1]=rf,l[0]=t[e];for(let m=1,y=0,x=0;m<i;m++){l[m]=t[e+m*n];let w=m*m;do{let T=u[y];x=(l[m]-l[T]+w-T*T)/(m-T)/2}while(x<=h[y]&&--y>-1);y++,u[y]=m,h[y]=x,h[y+1]=rf}for(let m=0,y=0;m<i;m++){for(;h[y+1]<m;)y++;let x=u[y],w=m-x;t[e+m*n]=l[x]+w*w}}let Uo=2,S0={none:0,ideographs:1,all:2};class Gu{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){let l=[],u=this.urls[n]||B.GLYPHS_URL;for(let h in e)for(let m of e[h])l.push({stack:h,id:m});vi(l,({stack:h,id:m},y)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(w!==void 0)return void y(null,{stack:h,id:m,glyph:w});if(w=this._tinySDF(x,h,m),w)return x.glyphs[m]=w,void y(null,{stack:h,id:m,glyph:w});let T=Math.floor(m/256);if(256*T>65535)return void y(new Error("glyphs > 65535 not supported"));if(x.ranges[T])return void y(null,{stack:h,id:m,glyph:w});let D=x.requests[T];D||(D=x.requests[T]=[],Gu.loadGlyphRange(h,T,u,this.requestManager,(S,A)=>{if(A){x.ascender=A.ascender,x.descender=A.descender;for(let P in A.glyphs)this._doesCharSupportLocalGlyph(+P)||(x.glyphs[+P]=A.glyphs[+P]);x.ranges[T]=!0}for(let P of D)P(S,A);delete x.requests[T]})),D.push((S,A)=>{S?y(S):A&&y(null,{stack:h,id:m,glyph:A.glyphs[m]||null})})},(h,m)=>{if(h)i(h);else if(m){let y={};for(let{stack:x,id:w,glyph:T}of m)y[x]===void 0&&(y[x]={}),y[x].glyphs===void 0&&(y[x].glyphs={}),y[x].glyphs[w]=T&&{id:T.id,bitmap:T.bitmap.clone(),metrics:T.metrics},y[x].ascender=this.entries[x].ascender,y[x].descender=this.entries[x].descender;i(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==S0.none&&(this.localGlyphMode===S0.all?!!this.localFontFamily:!!this.localFontFamily&&(v["CJK Unified Ideographs"](e)||v["Hangul Syllables"](e)||v.Hiragana(e)||v.Katakana(e)||v["CJK Symbols and Punctuation"](e)||v["CJK Unified Ideographs Extension A"](e)||v["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,i){let l=this.localFontFamily;if(!l||!this._doesCharSupportLocalGlyph(i))return;let u=e.tinySDF;if(!u){let P="400";/bold/i.test(n)?P="900":/medium/i.test(n)?P="500":/light/i.test(n)&&(P="200"),u=e.tinySDF=new Gu.TinySDF({fontFamily:l,fontWeight:P,fontSize:24*Uo,buffer:3*Uo,radius:8*Uo}),u.fontWeight=P}if(this.localGlyphs[u.fontWeight][i])return this.localGlyphs[u.fontWeight][i];let h=String.fromCodePoint(i),{data:m,width:y,height:x,glyphWidth:w,glyphHeight:T,glyphLeft:D,glyphTop:S,glyphAdvance:A}=u.draw(h);return this.localGlyphs[u.fontWeight][i]={id:i,bitmap:new ya({width:y,height:x},m),metrics:{width:w/Uo,height:T/Uo,left:D/Uo,top:S/Uo-27,advance:A/Uo,localGlyph:!0}}}}Gu.loadGlyphRange=function(t,e,n,i,l){let u=256*e,h=u+255,m=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${u}-${h}`),kr.Glyphs);Lr(m,(y,x)=>{if(y)l(y);else if(x){let w={},T=function(D){return new Xm(D).readFields(Pk,{})}(x);for(let D of T.glyphs)w[D.id]=D;l(null,{glyphs:w,ascender:T.ascender,descender:T.descender})}})},Gu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:l="sans-serif",fontWeight:u="normal",fontStyle:h="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;let m=this.size=t+4*e,y=this._createCanvas(m),x=this.ctx=y.getContext("2d",{willReadFrequently:!0});x.font=`${h} ${u} ${t}px ${l}`,x.textBaseline="alphabetic",x.textAlign="left",x.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:l,actualBoundingBoxRight:u}=this.ctx.measureText(t),h=Math.ceil(n),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-l))),y=Math.min(this.size-this.buffer,h+Math.ceil(i)),x=m+2*this.buffer,w=y+2*this.buffer,T=Math.max(x*w,0),D=new Uint8ClampedArray(T),S={data:D,width:x,height:w,glyphWidth:m,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(m===0||y===0)return S;let{ctx:A,buffer:P,gridInner:k,gridOuter:N}=this;A.clearRect(P,P,m,y),A.fillText(t,P,P+h);let H=A.getImageData(P,P,m,y);N.fill(rf,0,T),k.fill(0,0,T);for(let q=0;q<y;q++)for(let Z=0;Z<m;Z++){let K=H.data[4*(q*m+Z)+3]/255;if(K===0)continue;let ee=(q+P)*x+Z+P;if(K===1)N[ee]=0,k[ee]=rf;else{let le=.5-K;N[ee]=le>0?le*le:0,k[ee]=le<0?le*le:0}}nD(N,0,0,x,w,x,this.f,this.v,this.z),nD(k,P,P,m,y,x,this.f,this.v,this.z);for(let q=0;q<T;q++){let Z=Math.sqrt(N[q])-Math.sqrt(k[q]);D[q]=Math.round(255-255*(Z/this.radius+this.cutoff))}return S}};let el=ki;function iD(t,e,n,i){let l=[],u=t.imagePrimary,h=u.pixelRatio,m=u.paddedRect.w-2*el,y=u.paddedRect.h-2*el,x=t.right-t.left,w=t.bottom-t.top,T=u.stretchX||[[0,m]],D=u.stretchY||[[0,y]],S=(_e,Me)=>_e+Me[1]-Me[0],A=T.reduce(S,0),P=D.reduce(S,0),k=m-A,N=y-P,H=0,q=A,Z=0,K=P,ee=0,le=k,he=0,fe=N;if(u.content&&i){let _e=u.content;H=Qm(T,0,_e[0]),Z=Qm(D,0,_e[1]),q=Qm(T,_e[0],_e[2]),K=Qm(D,_e[1],_e[3]),ee=_e[0]-H,he=_e[1]-Z,le=_e[2]-_e[0]-q,fe=_e[3]-_e[1]-K}let xe=(_e,Me,Be,Te)=>{let ke=eg(_e.stretch-H,q,x,t.left),Ee=tg(_e.fixed-ee,le,_e.stretch,A),Je=eg(Me.stretch-Z,K,w,t.top),rt=tg(Me.fixed-he,fe,Me.stretch,P),Ne=eg(Be.stretch-H,q,x,t.left),wt=tg(Be.fixed-ee,le,Be.stretch,A),st=eg(Te.stretch-Z,K,w,t.top),Ye=tg(Te.fixed-he,fe,Te.stretch,P),Et=new Ue(ke,Je),ft=new Ue(Ne,Je),yt=new Ue(Ne,st),He=new Ue(ke,st),At=new Ue(Ee/h,rt/h),en=new Ue(wt/h,Ye/h),Ft=e*Math.PI/180;if(Ft){let On=Math.sin(Ft),_n=Math.cos(Ft),bn=[_n,-On,On,_n];Et._matMult(bn),ft._matMult(bn),He._matMult(bn),yt._matMult(bn)}let Xt=_e.stretch+_e.fixed,un=Be.stretch+Be.fixed,Pn=Me.stretch+Me.fixed,Ut=Te.stretch+Te.fixed,Gn=t.imageSecondary;return{tl:Et,tr:ft,bl:He,br:yt,texPrimary:{x:u.paddedRect.x+el+Xt,y:u.paddedRect.y+el+Pn,w:un-Xt,h:Ut-Pn},texSecondary:Gn?{x:Gn.paddedRect.x+el+Xt,y:Gn.paddedRect.y+el+Pn,w:un-Xt,h:Ut-Pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:At,pixelOffsetBR:en,minFontScaleX:le/h/x,minFontScaleY:fe/h/w,isSDF:n}};if(i&&(u.stretchX||u.stretchY)){let _e=oD(T,k,A),Me=oD(D,N,P);for(let Be=0;Be<_e.length-1;Be++){let Te=_e[Be],ke=_e[Be+1];for(let Ee=0;Ee<Me.length-1;Ee++)l.push(xe(Te,Me[Ee],ke,Me[Ee+1]))}}else l.push(xe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:y+1}));return l}function Qm(t,e,n){let i=0;for(let l of t)i+=Math.max(e,Math.min(n,l[1]))-Math.max(e,Math.min(n,l[0]));return i}function oD(t,e,n){let i=[{fixed:-el,stretch:0}];for(let[l,u]of t){let h=i[i.length-1];i.push({fixed:l-h.stretch,stretch:h.stretch}),i.push({fixed:l-h.stretch,stretch:h.stretch+(u-l)})}return i.push({fixed:e+el,stretch:n}),i}function eg(t,e,n,i){return t/e*n+i}function tg(t,e,n,i){return t-e*n/i}function jk(t,e,n,i){let l=e+t.positionedLines[i].lineOffset;return i===0?n+l/2:n+(l+(e+t.positionedLines[i-1].lineOffset))/2}function Vk(t,e=1,n=!1){let i=1/0,l=1/0,u=-1/0,h=-1/0,m=t[0];for(let S=0;S<m.length;S++){let A=m[S];(!S||A.x<i)&&(i=A.x),(!S||A.y<l)&&(l=A.y),(!S||A.x>u)&&(u=A.x),(!S||A.y>h)&&(h=A.y)}let y=Math.min(u-i,h-l),x=y/2,w=new iu([],Uk);if(y===0)return new Ue(i,l);for(let S=i;S<u;S+=y)for(let A=l;A<h;A+=y)w.push(new Hu(S+x,A+x,x,t));let T=function(S){let A=0,P=0,k=0,N=S[0];for(let H=0,q=N.length,Z=q-1;H<q;Z=H++){let K=N[H],ee=N[Z],le=K.x*ee.y-ee.x*K.y;P+=(K.x+ee.x)*le,k+=(K.y+ee.y)*le,A+=3*le}return new Hu(P/A,k/A,0,S)}(t),D=w.length;for(;w.length;){let S=w.pop();(S.d>T.d||!T.d)&&(T=S,n&&console.log("found best %d after %d probes",Math.round(1e4*S.d)/1e4,D)),S.max-T.d<=e||(x=S.h/2,w.push(new Hu(S.p.x-x,S.p.y-x,x,t)),w.push(new Hu(S.p.x+x,S.p.y-x,x,t)),w.push(new Hu(S.p.x-x,S.p.y+x,x,t)),w.push(new Hu(S.p.x+x,S.p.y+x,x,t)),D+=4)}return n&&(console.log(`num probes: ${D}`),console.log(`best distance: ${T.d}`)),T.p}function Uk(t,e){return e.max-t.max}class Hu{constructor(e,n,i,l){this.p=new Ue(e,n),this.h=i,this.d=function(u,h){let m=!1,y=1/0;for(let x=0;x<h.length;x++){let w=h[x];for(let T=0,D=w.length,S=D-1;T<D;S=T++){let A=w[T],P=w[S];A.y>u.y!=P.y>u.y&&u.x<(P.x-A.x)*(u.y-A.y)/(P.y-A.y)+A.x&&(m=!m),y=Math.min(y,sI(u,A,P))}}return(m?1:-1)*Math.sqrt(y)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}}let qu=7,C0=Number.POSITIVE_INFINITY,$k=Math.sqrt(2);function sD(t,[e,n]){let i=0,l=0;if(n===C0){e<0&&(e=0);let u=e/$k;switch(t){case"top-right":case"top-left":l=u-qu;break;case"bottom-right":case"bottom-left":l=-u+qu;break;case"bottom":l=-e+qu;break;case"top":l=e-qu}switch(t){case"top-right":case"bottom-right":i=-u;break;case"top-left":case"bottom-left":i=u;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":l=n-qu;break;case"bottom-right":case"bottom-left":case"bottom":l=-n+qu}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,l]}function Gk(t,e,n,i,l,u,h,m,y,x,w){t.createArrays(),t.tilePixelRatio=Ze/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let T=t.layers[0].layout,D=t.layers[0]._unevaluatedLayout._values,S={};if(t.textSizeData.kind==="composite"){let{minZoom:N,maxZoom:H}=t.textSizeData;S.compositeTextSizes=[D["text-size"].possiblyEvaluate(new ae(N),m),D["text-size"].possiblyEvaluate(new ae(H),m)]}if(t.iconSizeData.kind==="composite"){let{minZoom:N,maxZoom:H}=t.iconSizeData;S.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new ae(N),m),D["icon-size"].possiblyEvaluate(new ae(H),m)]}S.layoutTextSize=D["text-size"].possiblyEvaluate(new ae(y+1),m),S.layoutIconSize=D["icon-size"].possiblyEvaluate(new ae(y+1),m),S.textMaxSize=D["text-size"].possiblyEvaluate(new ae(18),m);let A=T.get("text-rotation-alignment")==="map"&&T.get("symbol-placement")!=="point",P=T.get("text-size"),k=!1;for(let N of t.features)if(N.icon&&N.icon.nameSecondary){k=!0;break}for(let N of t.features){let H=T.get("text-font").evaluate(N,{},m).join(","),q=P.evaluate(N,{},m),Z=S.layoutTextSize.evaluate(N,{},m),K=(S.layoutIconSize.evaluate(N,{},m),{horizontal:{},vertical:void 0}),ee=N.text,le,he=[0,0];if(ee){let _e=ee.toString(),Me=T.get("text-letter-spacing").evaluate(N,{},m)*Gr,Be=T.get("text-line-height").evaluate(N,{},m)*Gr,Te=E(_e)?Me:0,ke=T.get("text-anchor").evaluate(N,{},m),Ee=T.get("text-variable-anchor");if(!Ee){let st=T.get("text-radial-offset").evaluate(N,{},m);he=st?sD(ke,[st*Gr,C0]):T.get("text-offset").evaluate(N,{},m).map(Ye=>Ye*Gr)}let Je=A?"center":T.get("text-justify").evaluate(N,{},m),rt=T.get("symbol-placement")==="point",Ne=rt?T.get("text-max-width").evaluate(N,{},m)*Gr:1/0,wt=st=>{t.allowVerticalPlacement&&b(_e)&&(K.vertical=T0(ee,e,n,l,H,Ne,Be,ke,st,Te,he,so.vertical,!0,Z,q))};if(!A&&Ee){let st=Je==="auto"?Ee.map(Et=>A0(Et)):[Je],Ye=!1;for(let Et=0;Et<st.length;Et++){let ft=st[Et];if(!K.horizontal[ft])if(Ye)K.horizontal[ft]=K.horizontal[0];else{let yt=T0(ee,e,n,l,H,Ne,Be,"center",ft,Te,he,so.horizontal,!1,Z,q);yt&&(K.horizontal[ft]=yt,Ye=yt.positionedLines.length===1)}}wt("left")}else{if(Je==="auto"&&(Je=A0(ke)),rt||T.get("text-writing-mode").indexOf("horizontal")>=0||!b(_e)){let st=T0(ee,e,n,l,H,Ne,Be,ke,Je,Te,he,so.horizontal,!1,Z,q);st&&(K.horizontal[Je]=st)}wt(rt?"left":Je)}}let fe=!1;if(N.icon&&N.icon.namePrimary){let _e=i[N.icon.namePrimary];_e&&(le=Nk(l[N.icon.namePrimary],N.icon.nameSecondary?l[N.icon.nameSecondary]:void 0,T.get("icon-offset").evaluate(N,{},m),T.get("icon-anchor").evaluate(N,{},m)),fe=_e.sdf,t.sdfIcons===void 0?t.sdfIcons=_e.sdf:t.sdfIcons!==_e.sdf&&Zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_e.pixelRatio!==t.pixelRatio||T.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let xe=lD(K.horizontal)||K.vertical;t.iconsInText||(t.iconsInText=!!xe&&xe.iconsInText),(xe||le)&&Hk(t,N,K,le,i,S,Z,0,he,fe,h,m,x,w,k)}u&&t.generateCollisionDebugBuffers(y,t.collisionBoxArray)}function A0(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hk(t,e,n,i,l,u,h,m,y,x,w,T,D,S,A){let P=u.textMaxSize.evaluate(e,{},T);P===void 0&&(P=h);let k=t.layers[0].layout,N=k.get("icon-offset").evaluate(e,{},T),H=lD(n.horizontal)||n.vertical,q=D.name==="globe",Z=Gr,K=h/Z,ee=t.tilePixelRatio*P/Z,le=(ke=t.overscaling,t.zoom>18&&ke>2&&(ke>>=1),Math.max(Ze/(512*ke),1)*k.get("symbol-spacing")),he=k.get("text-padding")*t.tilePixelRatio,fe=k.get("icon-padding")*t.tilePixelRatio,xe=gt(k.get("text-max-angle")),_e=k.get("text-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Me=k.get("icon-rotation-alignment")==="map"&&k.get("symbol-placement")!=="point",Be=k.get("symbol-placement"),Te=le/2;var ke;let Ee=k.get("icon-text-fit").evaluate(e,{},T),Je=k.get("icon-text-fit-padding").evaluate(e,{},T),rt=Ee!=="none",Ne;t.hasAnyIconTextFit===!1&&rt&&(t.hasAnyIconTextFit=!0),i&&rt&&(t.allowVerticalPlacement&&n.vertical&&(Ne=ZI(i,n.vertical,Ee,Je,N,K)),H&&(i=ZI(i,H,Ee,Je,N,K)));let wt=(st,Ye,Et)=>{if(Ye.x<0||Ye.x>=Ze||Ye.y<0||Ye.y>=Ze)return;let ft=null;if(q){let{x:yt,y:He,z:At}=D.projectTilePoint(Ye.x,Ye.y,Et);ft={anchor:new xa(yt,He,At,0,void 0),up:D.upVector(Et,Ye.x,Ye.y)}}(function(yt,He,At,en,Ft,Xt,un,Pn,Ut,Gn,On,_n,bn,hn,er,Hn,lr,Cr,mi,fr,ir,ti,ni,gi,qn,Ho,Yu){let wa=yt.addToLineVertexArray(He,en),Ea,wf,Ef,Ig,CM,AM,RM,PM=0,OM=0,kM=0,LM=0,ix=-1,ox=-1,Ss={},FM=Dv(""),fc=At?At.anchor:He,sx=Ut.layout.get("icon-text-fit").evaluate(ir,{},qn)!=="none",ax=0,lx=0;if(Ut._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ax,lx]=Ut.layout.get("text-offset").evaluate(ir,{},qn).map(Li=>Li*Gr):(ax=Ut.layout.get("text-radial-offset").evaluate(ir,{},qn)*Gr,lx=C0),yt.allowVerticalPlacement&&Ft.vertical){let Li=Ft.vertical;if(er)AM=R0(Li),Pn&&(RM=R0(Pn));else{let Fi=Ut.layout.get("text-rotate").evaluate(ir,{},qn)+90;Ef=ng(Gn,fc,He,On,_n,bn,Li,hn,Fi,Hn),Pn&&(Ig=ng(Gn,fc,He,On,_n,bn,Pn,Cr,Fi))}}if(Xt){let Li=Ut.layout.get("icon-rotate").evaluate(ir,{},qn),Fi=iD(Xt,Li,ni,sx),Ju=Pn?iD(Pn,Li,ni,sx):void 0;wf=ng(Gn,fc,He,On,_n,bn,Xt,Cr,Li),PM=4*Fi.length;let NM=yt.iconSizeData,pc=null;NM.kind==="source"?(pc=[Vo*Ut.layout.get("icon-size").evaluate(ir,{},qn)],pc[0]>tl&&Zn(`${yt.layerIds[0]}: Value for "icon-size" is >= ${of}. Reduce your "icon-size".`)):NM.kind==="composite"&&(pc=[Vo*ti.compositeIconSizes[0].evaluate(ir,{},qn),Vo*ti.compositeIconSizes[1].evaluate(ir,{},qn)],(pc[0]>tl||pc[1]>tl)&&Zn(`${yt.layerIds[0]}: Value for "icon-size" is >= ${of}. Reduce your "icon-size".`)),yt.addSymbols(yt.icon,Fi,pc,fr,mi,ir,!1,At,He,wa.lineStartIndex,wa.lineLength,-1,gi,qn,Ho,Yu),ix=yt.icon.placedSymbolArray.length-1,Ju&&(OM=4*Ju.length,yt.addSymbols(yt.icon,Ju,pc,fr,mi,ir,so.vertical,At,He,wa.lineStartIndex,wa.lineLength,-1,gi,qn,Ho,Yu),ox=yt.icon.placedSymbolArray.length-1)}for(let Li in Ft.horizontal){let Fi=Ft.horizontal[Li];Ea||(FM=Dv(Fi.text),er?CM=R0(Fi):Ea=ng(Gn,fc,He,On,_n,bn,Fi,hn,Ut.layout.get("text-rotate").evaluate(ir,{},qn),Hn));let Ju=Fi.positionedLines.length===1;if(kM+=aD(yt,At,He,Fi,un,Ut,er,ir,Hn,wa,Ft.vertical?so.horizontal:so.horizontalOnly,Ju?Object.keys(Ft.horizontal):[Li],Ss,ix,ti,gi,qn,Ho),Ju)break}Ft.vertical&&(LM+=aD(yt,At,He,Ft.vertical,un,Ut,er,ir,Hn,wa,so.vertical,["vertical"],Ss,ox,ti,gi,qn,Ho));let cl=-1,cx=(Li,Fi)=>Li?Math.max(Li,Fi):Fi;cl=cx(CM,cl),cl=cx(AM,cl),cl=cx(RM,cl);let aF=cl>-1?1:0;yt.glyphOffsetArray.length>=uf.MAX_GLYPHS&&Zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ir.sortKey!==void 0&&yt.addToSortKeyRanges(yt.symbolInstances.length,ir.sortKey),yt.symbolInstances.emplaceBack(He.x,He.y,fc.x,fc.y,fc.z,Ss.right>=0?Ss.right:-1,Ss.center>=0?Ss.center:-1,Ss.left>=0?Ss.left:-1,Ss.vertical>=0?Ss.vertical:-1,ix,ox,FM,Ea!==void 0?Ea:yt.collisionBoxArray.length,Ea!==void 0?Ea+1:yt.collisionBoxArray.length,Ef!==void 0?Ef:yt.collisionBoxArray.length,Ef!==void 0?Ef+1:yt.collisionBoxArray.length,wf!==void 0?wf:yt.collisionBoxArray.length,wf!==void 0?wf+1:yt.collisionBoxArray.length,Ig||yt.collisionBoxArray.length,Ig?Ig+1:yt.collisionBoxArray.length,On,kM,LM,PM,OM,aF,0,ax,lx,cl,0,sx?1:0)})(t,Ye,ft,st,n,i,l,Ne,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,he,_e,y,0,fe,Me,N,e,u,x,w,T,S,A)};if(Be==="line")for(let st of eD(e.geometry,0,0,Ze,Ze)){let Ye=Bk(st,le,xe,n.vertical||H,i,Z,ee,t.overscaling,Ze);for(let Et of Ye)H&&qk(t,H.text,Te,Et)||wt(st,Et,T)}else if(Be==="line-center"){for(let st of e.geometry)if(st.length>1){let Ye=zk(st,xe,n.vertical||H,i,Z,ee);Ye&&wt(st,Ye,T)}}else if(e.type==="Polygon")for(let st of g0(e.geometry,0)){let Ye=Vk(st,16);wt(st[0],new xa(Ye.x,Ye.y,0,0,void 0),T)}else if(e.type==="LineString")for(let st of e.geometry)wt(st,new xa(st[0].x,st[0].y,0,0,void 0),T);else if(e.type==="Point")for(let st of e.geometry)for(let Ye of st)wt([Ye],new xa(Ye.x,Ye.y,0,0,void 0),T)}let of=255,tl=of*Vo;function aD(t,e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k,N){let H=function(K,ee,le,he,fe,xe,_e,Me){let Be=[];if(ee.positionedLines.length===0)return Be;let Te=he.layout.get("text-rotate").evaluate(xe,{})*Math.PI/180,ke=function(wt){let st=wt[0],Ye=wt[1],Et=st*Ye;return Et>0?[st,-Ye]:Et<0?[-st,Ye]:st===0?[Ye,st]:[Ye,-st]}(le),Ee=Math.abs(ee.top-ee.bottom);for(let wt of ee.positionedLines)Ee-=wt.lineOffset;let Je=ee.positionedLines.length,rt=Ee/Je,Ne=ee.top-le[1];for(let wt=0;wt<Je;++wt){let st=ee.positionedLines[wt];Ne=jk(ee,rt,Ne,wt);for(let Ye of st.positionedGlyphs){if(!Ye.rect)continue;let Et=Ye.rect||{},ft=VI+1,yt=!0,He=1,At=0;if(Ye.imageName){let fr=_e[Ye.imageName];if(!fr)continue;if(fr.sdf){Zn("SDF images are not supported in formatted text and will be ignored.");continue}yt=!1,He=fr.pixelRatio,ft=ki/He}let en=(fe||Me)&&Ye.vertical,Ft=Ye.metrics.advance*Ye.scale/2,Xt=Ye.metrics,un=Ye.rect;if(un===null)continue;Me&&ee.verticalizable&&(At=Ye.imageName?Ft-Ye.metrics.width*Ye.scale/2:0);let Pn=fe?[Ye.x+Ft,Ye.y]:[0,0],Ut=[0,0],Gn=[0,0],On=!1;fe||(en?(Gn=[Ye.x+Ft+ke[0],Ye.y+ke[1]-At],On=!0):Ut=[Ye.x+Ft+le[0],Ye.y+le[1]-At]);let _n=un.w*Ye.scale/(He*(Ye.localGlyph?Uo:1)),bn=un.h*Ye.scale/(He*(Ye.localGlyph?Uo:1)),hn,er,Hn,lr;if(en){let fr=Ye.y-Ne,ir=new Ue(-Ft,Ft-fr),ti=-Math.PI/2,ni=new Ue(...Gn);hn=new Ue(-Ft+Ut[0],Ut[1]),hn._rotateAround(ti,ir)._add(ni),hn.x+=-fr+Ft,hn.y-=(Xt.left-ft)*Ye.scale;let gi=Ye.imageName?Xt.advance*Ye.scale:Gr*Ye.scale,qn=String.fromCodePoint(Ye.glyph);Ak(qn)?hn.x+=(1-ft)*Ye.scale:Rk(qn)?hn.x+=gi-Xt.height*Ye.scale+(-ft-1)*Ye.scale:hn.x+=Ye.imageName||Xt.width+2*ft===un.w&&Xt.height+2*ft===un.h?(gi-bn)/2:(gi-(Xt.height+2*ft)*Ye.scale)/2,er=new Ue(hn.x,hn.y-_n),Hn=new Ue(hn.x+bn,hn.y),lr=new Ue(hn.x+bn,hn.y-_n)}else{let fr=(Xt.left-ft)*Ye.scale-Ft+Ut[0],ir=(-Xt.top-ft)*Ye.scale+Ut[1],ti=fr+_n,ni=ir+bn;hn=new Ue(fr,ir),er=new Ue(ti,ir),Hn=new Ue(fr,ni),lr=new Ue(ti,ni)}if(Te){let fr;fr=fe?new Ue(0,0):On?new Ue(ke[0],ke[1]):new Ue(le[0],le[1]),hn._rotateAround(Te,fr),er._rotateAround(Te,fr),Hn._rotateAround(Te,fr),lr._rotateAround(Te,fr)}let Cr=new Ue(0,0),mi=new Ue(0,0);Be.push({tl:hn,tr:er,bl:Hn,br:lr,texPrimary:Et,texSecondary:void 0,writingMode:ee.writingMode,glyphOffset:Pn,sectionIndex:Ye.sectionIndex,isSDF:yt,pixelOffsetTL:Cr,pixelOffsetBR:mi,minFontScaleX:0,minFontScaleY:0})}}return Be}(0,i,y,u,h,m,l,t.allowVerticalPlacement),q=t.textSizeData,Z=null;q.kind==="source"?(Z=[Vo*u.layout.get("text-size").evaluate(m,{},k)],Z[0]>tl&&Zn(`${t.layerIds[0]}: Value for "text-size" is >= ${of}. Reduce your "text-size".`)):q.kind==="composite"&&(Z=[Vo*A.compositeTextSizes[0].evaluate(m,{},k),Vo*A.compositeTextSizes[1].evaluate(m,{},k)],(Z[0]>tl||Z[1]>tl)&&Zn(`${t.layerIds[0]}: Value for "text-size" is >= ${of}. Reduce your "text-size".`)),t.addSymbols(t.text,H,Z,y,h,m,w,e,n,x.lineStartIndex,x.lineLength,S,P,k,N,!1);for(let K of T)D[K]=t.text.placedSymbolArray.length-1;return 4*H.length}function lD(t){for(let e in t)return t[e];return null}function ng(t,e,n,i,l,u,h,m,y,x){let w=h.top,T=h.bottom,D=h.left,S=h.right,A=h.collisionPadding;if(A&&(D-=A[0],w-=A[1],S+=A[2],T+=A[3]),y){let P=new Ue(D,w),k=new Ue(S,w),N=new Ue(D,T),H=new Ue(S,T),q=gt(y),Z=new Ue(0,0);x&&(Z=new Ue(x[0],x[1])),P._rotateAround(q,Z),k._rotateAround(q,Z),N._rotateAround(q,Z),H._rotateAround(q,Z),D=Math.min(P.x,k.x,N.x,H.x),S=Math.max(P.x,k.x,N.x,H.x),w=Math.min(P.y,k.y,N.y,H.y),T=Math.max(P.y,k.y,N.y,H.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,D,w,S,T,m,i,l,u),t.length-1}function R0(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function qk(t,e,n,i){let l=t.compareText;if(e in l){let u=l[e];for(let h=u.length-1;h>=0;h--)if(i.dist(u[h])<n)return!0}else l[e]=[];return l[e].push(i),!1}function cD(t,e){let n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,l=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),u=Math.sin(n)*l/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),h=Math.sin(t._pitch)*u+l;return Math.min(1.01*h,l*(1/t._horizonShift))}function nl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),i=t.x*n,l=(t.x+1)*n,u=t.y*n,h=(t.y+1)*n,m=Oi(i),y=Oi(l),x=$r(u),w=$r(h),T=e.project(m,x),D=e.project(y,x),S=e.project(y,w),A=e.project(m,w),P=Math.min(T.x,D.x,S.x,A.x),k=Math.min(T.y,D.y,S.y,A.y),N=Math.max(T.x,D.x,S.x,A.x),H=Math.max(T.y,D.y,S.y,A.y),q=n/16;function Z(ee,le,he,fe,xe,_e){let Me=(he+xe)/2,Be=(fe+_e)/2,Te=e.project(Oi(Me),$r(Be)),ke=Math.max(0,P-Te.x,k-Te.y,Te.x-N,Te.y-H);P=Math.min(P,Te.x),N=Math.max(N,Te.x),k=Math.min(k,Te.y),H=Math.max(H,Te.y),ke>q&&(Z(ee,Te,he,fe,Me,Be),Z(Te,le,Me,Be,xe,_e))}Z(T,D,i,u,l,u),Z(D,S,l,u,l,h),Z(S,A,l,h,i,h),Z(A,T,i,h,i,u),P-=q,k-=q,N+=q,H+=q;let K=1/Math.max(N-P,H-k);return{scale:K,x:P*K,y:k*K,x2:N*K,y2:H*K,projection:e}}function uD(t,{x:e,y:n},i=0){return new Ue(((e-i)*t.scale-t.x)*Ze,(n*t.scale-t.y)*Ze)}let Wk=r.m.identity(new Float32Array(16));class rl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new gn(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return pi(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return cD(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,l){let u=e.horizonLineFromTop(!1),h=new Ue(n,Math.max(u,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,l))}pointCoordinate3D(e,n,i){let l=new Ue(n,i);if(e.elevation)return e.elevation.pointCoordinate(l);{let u=this.pointCoordinate(e,l.x,l.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return Wk}createTileMatrix(e,n,i){let l,u,h,m=i.canonical,y=r.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let x=nl(m,this);l=1,u=x.x+i.wrap*x.scale,h=x.y,r.m.scale(y,y,[l/x.scale,l/x.scale,e.pixelsPerMeter/n])}else l=n/e.zoomScale(m.z),u=(m.x+Math.pow(2,m.z)*i.wrap)*l,h=m.y*l;return r.m.translate(y,y,[u,h,0]),r.m.scale(y,y,[l/Ze,l/Ze,1]),y}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class Zk extends rl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,i]=this.parallels=e.parallels||[29.5,45.5],l=Math.sin(gt(n));this.n=(l+Math.sin(gt(i)))/2,this.c=1+l*(2*this.n-l),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:i,c:l,r0:u}=this,h=gt(e-this.center[0]),m=gt(n),y=Math.sqrt(l-2*i*Math.sin(m))/i;return{x:y*Math.sin(h*i),y:y*Math.cos(h*i)-u,z:0}}unproject(e,n){let{n:i,c:l,r0:u}=this,h=u+n,m=Math.atan2(e,Math.abs(h))*Math.sign(h);h*i<0&&(m-=Math.PI*Math.sign(e)*Math.sign(h));let y=gt(this.center[0])*i;m=ci(m,-Math.PI-y,Math.PI-y);let x=Bt(Or(m/i)+this.center[0],-180,180),w=Math.asin(Bt((l-(e*e+h*h)*i*i)/(2*i),-1,1)),T=Bt(Or(w),-ar,ar);return new gn(x,T)}}let sf=1.340264,af=-.081106,lf=893e-6,cf=.003796,rg=Math.sqrt(3)/2;class Xk extends rl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let i=Math.asin(rg*Math.sin(n)),l=i*i,u=l*l*l;return{x:.5*(e*Math.cos(i)/(rg*(sf+3*af*l+u*(7*lf+9*cf*l)))/Math.PI+.5),y:1-.5*(i*(sf+af*l+u*(lf+cf*l))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,l=i*i,u=l*l*l;for(let w,T,D,S=0;S<12&&(T=i*(sf+af*l+u*(lf+cf*l))-n,D=sf+3*af*l+u*(7*lf+9*cf*l),w=T/D,i=Bt(i-w,-Math.PI/3,Math.PI/3),l=i*i,u=l*l*l,!(Math.abs(w)<1e-12));++S);let h=rg*e*(sf+3*af*l+u*(7*lf+9*cf*l))/Math.cos(i),m=Math.asin(Math.sin(i)/rg),y=Bt(180*h/Math.PI,-180,180),x=Bt(180*m/Math.PI,-ar,ar);return new gn(y,x)}}class Yk extends rl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let i=360*(e-.5),l=Bt(360*(.5-n),-ar,ar);return new gn(i,l)}}let Wu=Math.PI/2;function ig(t){return Math.tan((Wu+t)/2)}class Jk extends rl{constructor(e){super(e),this.center=e.center||[0,30];let[n,i]=this.parallels=e.parallels||[30,30],l=gt(n),u=gt(i);this.southernCenter=l+u<0,this.southernCenter&&(l=-l,u=-u);let h=Math.cos(l),m=ig(l);this.n=l===u?Math.sin(l):Math.log(h/Math.cos(u))/Math.log(ig(u)/m),this.f=h*Math.pow(ig(l),this.n)/this.n}project(e,n){n=gt(n),this.southernCenter&&(n=-n),e=gt(e-this.center[0]);let i=1e-6,{n:l,f:u}=this;u>0?n<-Wu+i&&(n=-Wu+i):n>Wu-i&&(n=Wu-i);let h=u/Math.pow(ig(n),l),m=h*Math.sin(l*e),y=u-h*Math.cos(l*e);return m=.5*(m/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:m,y:this.southernCenter?y:1-y,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:i,f:l}=this,u=l-n,h=Math.sign(u),m=Math.sign(i)*Math.sqrt(e*e+u*u),y=Math.atan2(e,Math.abs(u))*h;u*i<0&&(y-=Math.PI*Math.sign(e)*h);let x=Bt(Or(y/i)+this.center[0],-180,180),w=Bt(Or(2*Math.atan(Math.pow(l/m,1/i))-Wu),-ar,ar);return new gn(x,this.southernCenter?-w:w)}}class hD extends rl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Es(e),y:Ts(n),z:0}}unproject(e,n){let i=Oi(e),l=$r(n);return new gn(i,l)}}let dD=gt(ar);class Kk extends rl{project(e,n){let i=(n=gt(n))*n,l=i*i;return{x:.5*((e=gt(e))*(.8707-.131979*i+l*(l*(.003971*i-.001529*l)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+l*(.028874*i-.044475-.005916*l)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,l=25,u=0,h=i*i;do{h=i*i;let x=h*h;u=(i*(1.007226+h*(.015085+x*(.028874*h-.044475-.005916*x)))-n)/(1.007226+h*(.045255+x*(.259866*h-.311325-.005916*11*x))),i=Bt(i-u,-dD,dD)}while(Math.abs(u)>1e-6&&--l>0);h=i*i;let m=Bt(Or(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=Or(i);return new gn(m,y)}}let fD=gt(ar);class Qk extends rl{project(e,n){n=gt(n),e=gt(e);let i=Math.cos(n),l=2/Math.PI,u=Math.acos(i*Math.cos(e/2)),h=Math.sin(u)/u,m=.5*(e*l+2*i*Math.sin(e/2)/h)||0,y=.5*(n+Math.sin(n)/h)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,l=n=(2*(1-n)-1)*Math.PI,u=25,h=1e-6,m=0,y=0;do{let x=Math.cos(l),w=Math.sin(l),T=2*w*x,D=w*w,S=x*x,A=Math.cos(i/2),P=Math.sin(i/2),k=2*A*P,N=P*P,H=1-S*A*A,q=H?1/H:0,Z=H?Math.acos(x*A)*Math.sqrt(1/H):0,K=.5*(2*Z*x*P+2*i/Math.PI)-e,ee=.5*(Z*w+l)-n,le=.5*q*(S*N+Z*x*A*D)+1/Math.PI,he=q*(k*T/4-Z*w*P),fe=.125*q*(T*P-Z*w*S*k),xe=.5*q*(D*A+Z*N*x)+.5,_e=he*fe-xe*le;m=(ee*he-K*xe)/_e,y=(K*fe-ee*le)/_e,i=Bt(i-m,-Math.PI,Math.PI),l=Bt(l-y,-fD,fD)}while((Math.abs(m)>h||Math.abs(y)>h)&&--u>0);return new gn(Or(i),Or(l))}}class pD extends rl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(gt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:i,cosPhi:l}=this;return{x:gt(e)*l*i+.5,y:-Math.sin(gt(n))/l*i+.5,z:0}}unproject(e,n){let{scale:i,cosPhi:l}=this,u=-(n-.5)/i,h=Bt(Or((e-.5)/i)/l,-180,180),m=Math.asin(Bt(u*l,-1,1)),y=Bt(Or(m),-ar,ar);return new gn(h,y)}}class eL extends hD{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){let l=Xd(e,n,i),u=Yd(ws(i));return r.v.transformMat4(l,l,u),{x:l[0],y:l[1],z:l[2]}}locationPoint(e,n){let i=oc(n.lat,n.lng),l=r.v.normalize([],i),u=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,h=pi(1,0)*Ze*u;r.v.scaleAndAdd(i,i,l,h);let m=r.m.identity(new Float64Array(16));return r.m.multiply(m,e.pixelMatrix,e.globeMatrix),r.v.transformMat4(i,i,m),new Ue(i[0],i[1])}pixelsPerMeter(e,n){return pi(1,0)*n}pixelSpaceConversion(e,n,i){let l=pi(1,e)*n,u=Wt(pi(1,45)*n,l,i);return this.pixelsPerMeter(e,n)/u}createTileMatrix(e,n,i){let l=Qv(ws(i.canonical));return r.m.multiply(new Float64Array(16),e.globeMatrix,l)}createInversionMatrix(e,n){let{center:i}=e,l=Yd(ws(n));return r.m.rotateY(l,l,gt(i.lng)),r.m.rotateX(l,l,gt(i.lat)),r.m.scale(l,l,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(l)}pointCoordinate(e,n,i,l){return GT(e,n,i,!0)||new Hr(0,0)}pointCoordinate3D(e,n,i){let l=this.pointCoordinate(e,n,i,0);return[l.x,l.y,l.z]}isPointAboveHorizon(e,n){return!GT(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(l,u){let h=l.cameraToCenterDistance,m=l._centerAltitude*u,y=l._camera,x=l._camera.forward(),w=r.v.add([],r.v.scale([],x,-h),[0,0,m]),T=l.worldSize/(2*Math.PI),D=[0,0,-T],S=l.width/l.height,A=Math.tan(l.fovAboveCenter),P=r.v.scale([],y.up(),A),k=r.v.scale([],y.right(),A*S),N=r.v.normalize([],r.v.add([],r.v.add([],x,P),k)),H=[],q;if(new qv(w,N).closestPointOnSphere(D,T,H)){let Z=r.v.add([],H,D),K=r.v.sub([],Z,w);q=Math.cos(l.fovAboveCenter)*r.v.length(K)}else{let Z=r.v.sub([],w,D),K=r.v.sub([],D,w);r.v.normalize(K,K);let ee=r.v.length(Z)-T;q=Math.sqrt(ee*(ee+2*T));let le=Math.acos(q/(T+ee))-Math.acos(r.v.dot(x,K));q*=Math.cos(le)}return 1.01*q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=_a(e.zoom);if(i>0){let l=cD(e,pi(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Wt(n,l+u*(1-Math.cos(h)),Math.pow(i,10))}return n}upVector(e,n,i){return Xd(n,i,e,1)}upVectorScale(e){return{metersToTile:Am(Pm(ws(e)))}}}function mD(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new hD(t);case"equirectangular":return new Yk(t);case"naturalEarth":return new Kk(t);case"equalEarth":return new Xk(t);case"winkelTripel":return new Qk(t);case"albers":return n?new pD(t):new Zk(t);case"lambertConformalConic":return n?new pD(t):new Jk(t);case"globe":return new eL(t)}throw new Error(`Invalid projection name: ${t.name}`)}let tL=new Re({"symbol-placement":new Q(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new Q(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Q(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new me(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Q(ye.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Q(ye.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new Q(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Q(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new Q(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Q(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new me(ye.layout_symbol["icon-size"]),"icon-text-fit":new me(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new me(ye.layout_symbol["icon-image"]),"icon-rotate":new me(ye.layout_symbol["icon-rotate"]),"icon-padding":new Q(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new Q(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new me(ye.layout_symbol["icon-offset"]),"icon-anchor":new me(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Q(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Q(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Q(ye.layout_symbol["text-rotation-alignment"]),"text-field":new me(ye.layout_symbol["text-field"]),"text-font":new me(ye.layout_symbol["text-font"]),"text-size":new me(ye.layout_symbol["text-size"]),"text-max-width":new me(ye.layout_symbol["text-max-width"]),"text-line-height":new me(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new me(ye.layout_symbol["text-letter-spacing"]),"text-justify":new me(ye.layout_symbol["text-justify"]),"text-radial-offset":new me(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Q(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new me(ye.layout_symbol["text-anchor"]),"text-max-angle":new Q(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new Q(ye.layout_symbol["text-writing-mode"]),"text-rotate":new me(ye.layout_symbol["text-rotate"]),"text-padding":new Q(ye.layout_symbol["text-padding"]),"text-keep-upright":new Q(ye.layout_symbol["text-keep-upright"]),"text-transform":new me(ye.layout_symbol["text-transform"]),"text-offset":new me(ye.layout_symbol["text-offset"]),"text-allow-overlap":new Q(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Q(ye.layout_symbol["text-ignore-placement"]),"text-optional":new Q(ye.layout_symbol["text-optional"]),visibility:new Q(ye.layout_symbol.visibility)});var P0={paint:new Re({"icon-opacity":new me(ye.paint_symbol["icon-opacity"]),"icon-emissive-strength":new me(ye.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new me(ye.paint_symbol["text-emissive-strength"]),"icon-color":new me(ye.paint_symbol["icon-color"]),"icon-halo-color":new me(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new me(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new me(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new Q(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new Q(ye.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new me(ye.paint_symbol["icon-image-cross-fade"]),"text-opacity":new me(ye.paint_symbol["text-opacity"]),"text-color":new me(ye.paint_symbol["text-color"],{runtimeType:Mi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new me(ye.paint_symbol["text-halo-color"]),"text-halo-width":new me(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new me(ye.paint_symbol["text-halo-blur"]),"text-translate":new Q(ye.paint_symbol["text-translate"]),"text-translate-anchor":new Q(ye.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Q(ye.paint_symbol["icon-color-saturation"])}),layout:tL};class gD{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Xs,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}it(gD,"FormatSectionOverride",{omit:["defaultValue"]});class og extends tt{constructor(e,n,i){super(e,P0,n,i)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let i=this.layout.get("text-writing-mode");if(i){let l=[];for(let u of i)l.indexOf(u)<0&&l.push(u);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,i,l){let u=this.layout.get(e).evaluate(n,{},i,l),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||bu(h.value)||!u?u:function(m,y){return y.replace(/{([^{}]+)}/g,(x,w)=>w in m?String(m[w]):"")}(n.properties,u)}createBucket(e){return new uf(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of P0.paint.overridableProperties){if(!og.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),i=new gD(n),l=new Rd(i,n.property.specification,this.scope,this.options),u=null;u=n.value.kind==="constant"||n.value.kind==="source"?new Wl("source",l):new Zl("composite",l,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new be(n.property,u,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&og.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let i=e.get("text-field"),l=P0.paint.properties[n],u=!1,h=m=>{for(let y of m)if(l.overrides&&l.overrides.hasOverride(y))return void(u=!0)};if(i.value.kind==="constant"&&i.value.value instanceof Kr)h(i.value.value.sections);else if(i.value.kind==="source"){let m=x=>{u||(x instanceof Ba&&gr(x.value)===ss?h(x.value.sections):x instanceof Pl?h(x.sections):x.eachChild(m))},y=i.value;y._styleExpression&&m(y._styleExpression.expression)}return u}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n){return{config:new tc(this,n),overrideFog:!1}}}let nL=Hm.types,rL=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sg(t,e,n,i,l,u,h,m,y,x,w,T,D){let S=m?Math.min(tl,Math.round(m[0])):0,A=m?Math.min(tl,Math.round(m[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*l),u,h,(S<<1)+(y?1:0),A,16*x,16*w,256*T,256*D)}function ag(t,e,n){t.emplaceBack(e,n)}function lg(t,e,n,i,l,u,h){t.emplaceBack(e,n,i,l,u,h)}function cg(t,e,n,i,l){t.emplaceBack(e,n,i,l),t.emplaceBack(e,n,i,l),t.emplaceBack(e,n,i,l),t.emplaceBack(e,n,i,l)}function iL(t){for(let e of t.sections)if(z(e.text))return!0;return!1}class O0{constructor(e){this.layoutVertexArray=new Dr,this.indexArray=new En,this.programConfigurations=e,this.segments=new Xn,this.dynamicLayoutVertexArray=new mn,this.opacityVertexArray=new Vr,this.placedSymbolArray=new lE,this.iconTransitioningVertexArray=new ei,this.globeExtVertexArray=new kn,this.zOffsetVertexArray=new No}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,i,l,u){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,xk.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,wk.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rL,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Tk.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,bk.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ek.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||l)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}it(O0,"SymbolBuffers");class k0{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new Xn,this.collisionVertexArray=new eo,this.collisionVertexArrayExt=new mn}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ik.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Dk.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}it(k0,"CollisionBuffers");class ug{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=r.m.identity([]),this.placementViewportMatrix=r.m.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=w0(this.zoom,n["text-size"]),this.iconSizeData=w0(this.zoom,n["icon-size"]);let i=this.layers[0].layout,l=i.get("symbol-sort-key"),u=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&l.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(h=>so[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new O0(new Za(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new O0(new Za(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new hE,this.lineVertexArray=new dE,this.symbolInstances=new uE}calculateGlyphDependencies(e,n,i,l,u){for(let h=0;h<e.length;h++){let m=e.codePointAt(h);if(m===void 0)break;if(n[m]=!0,l&&u&&m<=65535){let y=tf[e.charAt(h)];y&&(n[y.charCodeAt(0)]=!0)}}}populate(e,n,i,l){let u=this.layers[0],h=u.layout,m=this.projection.name==="globe",y=h.get("text-font"),x=h.get("text-field"),w=h.get("icon-image"),T=(x.value.kind!=="constant"||x.value.value instanceof Kr&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),D=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,S=h.get("symbol-sort-key");if(this.features=[],!T&&!D)return;let A=n.iconDependencies,P=n.glyphDependencies,k=n.availableImages,N=new ae(this.zoom);for(let{feature:H,id:q,index:Z,sourceLayerIndex:K}of e){let ee=u._featureFilter.needGeometry,le=Ka(H,ee);if(!u._featureFilter.filter(N,le,i))continue;if(ee||(le.geometry=Is(H,i,l)),m&&H.type!==1&&i.z<=5){let _e=le.geometry,Me=.98078528056,Be=(Te,ke)=>{let Ee=Xd(Te.x,Te.y,i,1),Je=Xd(ke.x,ke.y,i,1);return r.v.dot(Ee,Je)<Me};for(let Te=0;Te<_e.length;Te++)_e[Te]=mO(_e[Te],Be)}let he,fe;if(T){let _e=u.getValueAndResolveTokens("text-field",le,i,k),Me=Kr.factory(_e);iL(Me)&&(this.hasRTLText=!0),(!this.hasRTLText||J()==="unavailable"||this.hasRTLText&&ce.isParsed())&&(he=Ck(Me,u,le))}if(D){let _e=u.getValueAndResolveTokens("icon-image",le,i,k);fe=_e instanceof Si?_e:Si.fromString(_e)}if(!he&&!fe)continue;let xe=this.sortFeaturesByKey?S.evaluate(le,{},i):void 0;if(this.features.push({id:q,text:he,icon:fe,index:Z,sourceLayerIndex:K,geometry:le.geometry,properties:H.properties,type:nL[H.type],sortKey:xe}),fe&&(A[fe.namePrimary]=!0,fe.nameSecondary&&(A[fe.nameSecondary]=!0)),he){let _e=y.evaluate(le,{},i).join(","),Me=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(so.vertical)>=0;for(let Be of he.sections)if(Be.image)A[Be.image.namePrimary]=!0;else{let Te=b(he.toString()),ke=Be.fontStack||_e,Ee=P[ke]=P[ke]||{};this.calculateGlyphDependencies(Be.text,Ee,Me,this.allowVerticalPlacement,Te)}}}h.get("symbol-placement")==="line"&&(this.features=function(H){let q={},Z={},K=[],ee=0;function le(_e){K.push(H[_e]),ee++}function he(_e,Me,Be){let Te=Z[_e];return delete Z[_e],Z[Me]=Te,K[Te].geometry[0].pop(),K[Te].geometry[0]=K[Te].geometry[0].concat(Be[0]),Te}function fe(_e,Me,Be){let Te=q[Me];return delete q[Me],q[_e]=Te,K[Te].geometry[0].shift(),K[Te].geometry[0]=Be[0].concat(K[Te].geometry[0]),Te}function xe(_e,Me,Be){let Te=Be?Me[0][Me[0].length-1]:Me[0][0];return`${_e}:${Te.x}:${Te.y}`}for(let _e=0;_e<H.length;_e++){let Me=H[_e],Be=Me.geometry,Te=Me.text?Me.text.toString():null;if(!Te){le(_e);continue}let ke=xe(Te,Be),Ee=xe(Te,Be,!0);if(ke in Z&&Ee in q&&Z[ke]!==q[Ee]){let Je=fe(ke,Ee,Be),rt=he(ke,Ee,K[Je].geometry);delete q[ke],delete Z[Ee],Z[xe(Te,K[rt].geometry,!0)]=rt,K[Je].geometry=null}else ke in Z?he(ke,Ee,Be):Ee in q?fe(ke,Ee,Be):(le(_e),q[ke]=ee-1,Z[Ee]=ee-1)}return K.filter(_e=>_e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((H,q)=>H.sortKey-q.sortKey)}update(e,n,i,l,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let m=h?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,m,i,l,u),this.icon.programConfigurations.updatePaintArrays(e,n,m,i,l,u)}updateZOffset(){let e=(u,h,m)=>{i+=h,i>u.length&&u.resize(i);for(let y=-h;y<0;y++)u.emplace(y+i,m)},n=(u,h,m)=>{l+=h,l>u.length&&u.resize(l);for(let y=-h;y<0;y++)u.emplace(y+l,m)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,l=0;for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:m,numVerticalGlyphVertices:y,numIconVertices:x}=h,w=h.zOffset,T=x>0;if((m>0||y>0)&&(e(this.text.zOffsetVertexArray,m,w),e(this.text.zOffsetVertexArray,y,w)),T){let{placedIconSymbolIndex:D,verticalPlacedIconSymbolIndex:S}=h;D>=0&&n(this.icon.zOffsetVertexArray,x,w),S>=0&&n(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mD(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let i=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:l,y:u}of n)this.lineVertexArray.emplaceBack(l,u);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,l,u,h,m,y,x,w,T,D,S,A,P,k){let N=e.indexArray,H=e.layoutVertexArray,q=e.globeExtVertexArray,Z=e.segments.prepareSegment(4*n.length,H,N,this.canOverlap?h.sortKey:void 0),K=this.glyphOffsetArray.length,ee=Z.vertexLength,le=this.allowVerticalPlacement&&m===so.vertical?Math.PI/2:0,he=h.text&&h.text.sections;for(let xe=0;xe<n.length;xe++){let{tl:_e,tr:Me,bl:Be,br:Te,texPrimary:ke,texSecondary:Ee,pixelOffsetTL:Je,pixelOffsetBR:rt,minFontScaleX:Ne,minFontScaleY:wt,glyphOffset:st,isSDF:Ye,sectionIndex:Et}=n[xe],ft=Z.vertexLength,yt=st[1];if(sg(H,x.x,x.y,_e.x,yt+_e.y,ke.x,ke.y,i,Ye,Je.x,Je.y,Ne,wt),sg(H,x.x,x.y,Me.x,yt+Me.y,ke.x+ke.w,ke.y,i,Ye,rt.x,Je.y,Ne,wt),sg(H,x.x,x.y,Be.x,yt+Be.y,ke.x,ke.y+ke.h,i,Ye,Je.x,rt.y,Ne,wt),sg(H,x.x,x.y,Te.x,yt+Te.y,ke.x+ke.w,ke.y+ke.h,i,Ye,rt.x,rt.y,Ne,wt),y){let{x:He,y:At,z:en}=y.anchor,[Ft,Xt,un]=y.up;lg(q,He,At,en,Ft,Xt,un),lg(q,He,At,en,Ft,Xt,un),lg(q,He,At,en,Ft,Xt,un),lg(q,He,At,en,Ft,Xt,un),cg(e.dynamicLayoutVertexArray,He,At,en,le)}else cg(e.dynamicLayoutVertexArray,x.x,x.y,x.z,le);if(k){let He=Ee||ke;ag(e.iconTransitioningVertexArray,He.x,He.y),ag(e.iconTransitioningVertexArray,He.x+He.w,He.y),ag(e.iconTransitioningVertexArray,He.x,He.y+He.h),ag(e.iconTransitioningVertexArray,He.x+He.w,He.y+He.h)}N.emplaceBack(ft,ft+1,ft+2),N.emplaceBack(ft+1,ft+2,ft+3),Z.vertexLength+=4,Z.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(st[0]),xe!==n.length-1&&Et===n[xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(H.length,h,h.index,{},S,A,P,he&&he[Et])}let fe=y?y.anchor:x;e.placedSymbolArray.emplaceBack(fe.x,fe.y,fe.z,x.x,x.y,K,this.glyphOffsetArray.length-K,ee,w,T,x.segment,i?i[0]:0,i?i[1]:0,l[0],l[1],m,0,!1,0,D,0)}_commitLayoutVertex(e,n,i,l,u,h,m){e.emplaceBack(n,i,l,u,h,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,n,i,l,u,h,m){let y=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),x=y.vertexLength,w=m.tileAnchorX,T=m.tileAnchorY;for(let S=0;S<4;S++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,n,e.padding,m.zOffset),this._commitLayoutVertex(i.layoutVertexArray,l,u,h,w,T,new Ue(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,l,u,h,w,T,new Ue(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,l,u,h,w,T,new Ue(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,l,u,h,w,T,new Ue(e.x1,e.y2)),y.vertexLength+=4;let D=i.indexArray;D.emplaceBack(x,x+1),D.emplaceBack(x+1,x+2),D.emplaceBack(x+2,x+3),D.emplaceBack(x+3,x),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,l,u,h){for(let m=l;m<u;m++){let y=i.get(m),x=this.getSymbolInstanceTextSize(e,h,n,m);this._addCollisionDebugVertices(y,x,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,n,i,l,u,h){for(let m=l;m<u;m++){let y=i.get(m),x=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,x,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new k0(Pi,jI.members,ei),this.iconCollisionBox=new k0(Pi,jI.members,ei);let i=Uu(this.iconSizeData,e),l=Uu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._addTextDebugCollisionBoxes(l,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._addTextDebugCollisionBoxes(l,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._addIconDebugCollisionBoxes(i,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._addIconDebugCollisionBoxes(i,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}}getSymbolInstanceTextSize(e,n,i,l){let u=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:l),h=Jm(this.textSizeData,e,u)/Gr;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,n,i){let l=this.icon.placedSymbolArray.get(i),u=Jm(this.iconSizeData,e,l);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,n,i,l){e.emplaceBack(n,-i,-i,l),e.emplaceBack(n,i,-i,l),e.emplaceBack(n,i,i,l),e.emplaceBack(n,-i,i,l)}_updateTextDebugCollisionBoxes(e,n,i,l,u,h){for(let m=l;m<u;m++){let y=i.get(m),x=this.getSymbolInstanceTextSize(e,h,n,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,n,i,l,u,h){for(let m=l;m<u;m++){let y=i.get(m),x=this.getSymbolInstanceIconSize(e,n,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,x,y.padding,h.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let i=Uu(this.iconSizeData,e),l=Uu(this.textSizeData,e);for(let u=0;u<this.symbolInstances.length;u++){let h=this.symbolInstances.get(u);this._updateTextDebugCollisionBoxes(l,e,n,h.textBoxStartIndex,h.textBoxEndIndex,h),this._updateTextDebugCollisionBoxes(l,e,n,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h),this._updateIconDebugCollisionBoxes(i,e,n,h.iconBoxStartIndex,h.iconBoxEndIndex,h),this._updateIconDebugCollisionBoxes(i,e,n,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,l,u,h,m,y,x){let w={};if(n<i){let{x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z,featureIndex:K}=e.get(n);w.textBox={x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z},w.textFeatureIndex=K}if(l<u){let{x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z,featureIndex:K}=e.get(l);w.verticalTextBox={x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z},w.verticalTextFeatureIndex=K}if(h<m){let{x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z,featureIndex:K}=e.get(h);w.iconBox={x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z},w.iconFeatureIndex=K}if(y<x){let{x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z,featureIndex:K}=e.get(y);w.verticalIconBox={x1:T,y1:D,x2:S,y2:A,padding:P,projectedAnchorX:k,projectedAnchorY:N,projectedAnchorZ:H,tileAnchorX:q,tileAnchorY:Z},w.verticalIconFeatureIndex=K}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let i=e.placedSymbolArray.get(n),l=i.vertexStartIndex+4*i.numGlyphs;for(let u=i.vertexStartIndex;u<l;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),i=Math.cos(e),l=[],u=[],h=[];for(let m=0;m<this.symbolInstances.length;++m){h.push(m);let y=this.symbolInstances.get(m);l.push(0|Math.round(n*y.tileAnchorX+i*y.tileAnchorY)),u.push(y.featureIndex)}return h.sort((m,y)=>l[m]-l[y]||u[y]-u[m]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);let{rightJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:x}=i;l>=0&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&u!==l&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==l&&this.addIndicesForPlacedSymbol(this.text,h),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),x>=0&&this.addIndicesForPlacedSymbol(this.icon,x)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}it(ug,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ug.MAX_GLYPHS=65535,ug.addDynamicAttributes=cg;var uf=ug;let oL=dt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sL}=oL,aL=dt([{name:"a_packed",components:4,type:"Float32"}]),{members:lL}=aL,cL=Hm.types,uL=Math.cos(Math.PI/180*37.5);class hg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Ri,this.layoutVertexArray2=new mn,this.indexArray=new En,this.programConfigurations=new Za(e.layers,e.zoom),this.segments=new Xn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,l){this.hasPattern=_0("line",this.layers,n);let u=this.layers[0].layout.get("line-sort-key"),h=[];for(let{feature:w,id:T,index:D,sourceLayerIndex:S}of e){let A=this.layers[0]._featureFilter.needGeometry,P=Ka(w,A);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),P,i))continue;let k=u?u.evaluate(P,{},i):void 0,N={id:T,properties:w.properties,type:w.type,sourceLayerIndex:S,index:D,geometry:A?P.geometry:Is(w,i,l),patterns:{},sortKey:k};h.push(N)}u&&h.sort((w,T)=>w.sortKey-T.sortKey);let{lineAtlas:m,featureIndex:y}=n,x=this.addConstantDashes(m);for(let w of h){let{geometry:T,index:D,sourceLayerIndex:S}=w;if(x&&this.addFeatureDashes(w,m),this.hasPattern){let A=y0("line",this.layers,w,this.zoom,n);this.patternFeatures.push(A)}else this.addFeature(w,T,D,i,m.positions,n.availableImages,n.brightness);y.insert(e[D].feature,T,D,S,this.index)}}addConstantDashes(e){let n=!1;for(let i of this.layers){let l=i.paint.get("line-dasharray").value,u=i.layout.get("line-cap").value;if(l.kind!=="constant"||u.kind!=="constant")n=!0;else{let h=u.value,m=l.value;if(!m)continue;e.addDash(m,h)}}return n}addFeatureDashes(e,n){let i=this.zoom;for(let l of this.layers){let u=l.paint.get("line-dasharray").value,h=l.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let m,y;if(u.kind==="constant"){if(m=u.value,!m)continue}else m=u.evaluate({zoom:i},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:i},e),n.addDash(m,y),e.patterns[l.id]=n.getKey(m,y)}}update(e,n,i,l,u){let h=Object.keys(e).length!==0;h&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,h?this.stateDependentLayers:this.layers,i,l,u)}addFeatures(e,n,i,l,u,h){for(let m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,n,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,lL)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sL),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,l,u,h,m){let y=this.layers[0].layout,x=y.get("line-join").evaluate(e,{}),w=y.get("line-cap").evaluate(e,{}),T=y.get("line-miter-limit"),D=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let S of n)this.addLine(S,e,x,w,T,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,u,h,l,m)}addLine(e,n,i,l,u,h){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let N=0;N<e.length-1;N++)this.totalDistance+=e[N].dist(e[N+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let m=cL[n.type]==="Polygon",y=e.length;for(;y>=2&&e[y-1].equals(e[y-2]);)y--;let x=0;for(;x<y-1&&e[x].equals(e[x+1]);)x++;if(y<(m?3:2))return;i==="bevel"&&(u=1.05);let w=this.overscaling<=16?15*Ze/(512*this.overscaling):0,T=this.segments.prepareSegment(10*y,this.layoutVertexArray,this.indexArray),D,S,A,P,k;this.e1=this.e2=-1,m&&(D=e[y-2],k=e[x].sub(D)._unit()._perp());for(let N=x;N<y;N++){if(A=N===y-1?m?e[x+1]:void 0:e[N+1],A&&e[N].equals(A))continue;k&&(P=k),D&&(S=D),D=e[N],k=A?A.sub(D)._unit()._perp():P,P=P||k;let H=P.add(k);H.x===0&&H.y===0||H._unit();let q=P.x*k.x+P.y*k.y,Z=H.x*k.x+H.y*k.y,K=Z!==0?1/Z:1/0,ee=2*Math.sqrt(2-2*Z),le=Z<uL&&S&&A,he=P.x*k.y-P.y*k.x>0;if(le&&N>x){let _e=D.dist(S);if(_e>2*w){let Me=D.sub(D.sub(S)._mult(w/_e)._round());this.updateDistance(S,Me),this.addCurrentVertex(Me,P,0,0,T),S=Me}}let fe=S&&A,xe=fe?i:m?"butt":l;if(fe&&xe==="round"&&(K<h?xe="miter":K<=2&&(xe="fakeround")),xe==="miter"&&K>u&&(xe="bevel"),xe==="bevel"&&(K>2&&(xe="flipbevel"),K<u&&(xe="miter")),S&&this.updateDistance(S,D),xe==="miter")H._mult(K),this.addCurrentVertex(D,H,0,0,T);else if(xe==="flipbevel"){if(K>100)H=k.mult(-1);else{let _e=K*P.add(k).mag()/P.sub(k).mag();H._perp()._mult(_e*(he?-1:1))}this.addCurrentVertex(D,H,0,0,T),this.addCurrentVertex(D,H.mult(-1),0,0,T)}else if(xe==="bevel"||xe==="fakeround"){let _e=-Math.sqrt(K*K-1),Me=he?_e:0,Be=he?0:_e;if(S&&this.addCurrentVertex(D,P,Me,Be,T),xe==="fakeround"){let Te=Math.round(180*ee/Math.PI/20);for(let ke=1;ke<Te;ke++){let Ee=ke/Te;if(Ee!==.5){let rt=Ee-.5;Ee+=Ee*rt*(Ee-1)*((1.0904+q*(q*(3.55645-1.43519*q)-3.2452))*rt*rt+(.848013+q*(.215638*q-1.06021)))}let Je=k.sub(P)._mult(Ee)._add(P)._unit()._mult(he?-1:1);this.addHalfVertex(D,Je.x,Je.y,!1,he,0,T)}}A&&this.addCurrentVertex(D,k,-Me,-Be,T)}else if(xe==="butt")this.addCurrentVertex(D,H,0,0,T);else if(xe==="square"){let _e=S?1:-1;S||this.addCurrentVertex(D,H,_e,_e,T),this.addCurrentVertex(D,H,0,0,T),S&&this.addCurrentVertex(D,H,_e,_e,T)}else xe==="round"&&(S&&(this.addCurrentVertex(D,P,0,0,T),this.addCurrentVertex(D,P,1,1,T,!0)),A&&(this.addCurrentVertex(D,k,-1,-1,T,!0),this.addCurrentVertex(D,k,0,0,T)));if(le&&N<y-1){let _e=D.dist(A);if(_e>2*w){let Me=D.add(A.sub(D)._mult(w/_e)._round());this.updateDistance(D,Me),this.addCurrentVertex(Me,k,0,0,T),D=Me}}}}addCurrentVertex(e,n,i,l,u,h=!1){let m=n.y*l-n.x,y=-n.y-n.x*l;this.addHalfVertex(e,n.x+n.y*i,n.y-n.x*i,h,!1,i,u),this.addHalfVertex(e,m,y,h,!0,-l,u)}addHalfVertex({x:e,y:n},i,l,u,h,m,y){this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(n<<1)+(h?1:0),Math.round(63*i)+128,Math.round(63*l)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let x=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,x),y.primitiveLength++),h?this.e2=x:this.e1=x}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}it(hg,"LineBucket",{omit:["layers","patternFeatures"]});class ba{constructor(e,n,i,l){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,l)}update(e,n,i){let{width:l,height:u}=e,{context:h}=this,{gl:m}=h;if(m.bindTexture(m.TEXTURE_2D,this.texture),h.pixelStoreUnpackFlipY.set(!1),h.pixelStoreUnpack.set(1),h.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!n||n.premultiply!==!1)),i||this.size&&this.size[0]===l&&this.size[1]===u){let{x:y,y:x}=i||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)m.texSubImage2D(m.TEXTURE_2D,0,y,x,m.RGBA,m.UNSIGNED_BYTE,e);else{let w=this.format,T=m.UNSIGNED_BYTE;this.format===m.R32F&&(w=m.RED,T=m.FLOAT),m.texSubImage2D(m.TEXTURE_2D,0,y,x,l,u,w,T,e.data)}}else if(this.size=[l,u],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let y=this.format;this.format===m.R8&&(y=m.RED),m.texImage2D(m.TEXTURE_2D,0,this.format,y,m.UNSIGNED_BYTE,e)}else{let y=this.format,x=this.format,w=m.UNSIGNED_BYTE;this.format===m.DEPTH_COMPONENT&&(y=m.DEPTH_COMPONENT16,w=m.UNSIGNED_SHORT),this.format===m.R8&&(x=m.RED),this.format===m.R32F&&(w=m.FLOAT,x=m.RED),m.texImage2D(m.TEXTURE_2D,0,y,l,u,0,x,w,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,n,i=!1){let{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!i?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,l){let{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),n!==this.magFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),this.wrapS=i),l!==this.wrapT&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,l),this.wrapT=l)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class dg{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_2D,this.texture),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,e),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,n),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,n),this.wrapS=n)}}let xo=32,Ds=33,il=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,l=0,u=0,h=0,m=0;for(1&e?l=u=h=xo:n=i=m=xo;(e>>=1)>1;){let x=n+l>>1,w=i+u>>1;1&e?(l=n,u=i,n=h,i=m):(n=l,i=u,l=h,u=m),h=x,m=w}let y=4*t;il[y+0]=n,il[y+1]=i,il[y+2]=l,il[y+3]=u}let Ms=new Uint16Array(2178),ol=new Uint8Array(1089),fg=new Uint16Array(1089);function _D(t){return t===0?-.03125:t===32?.03125:0}var pg=dt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let yD={type:2,extent:Ze,loadGeometry:()=>[[new Ue(0,0),new Ue(Ze+1,0),new Ue(Ze+1,Ze+1),new Ue(0,Ze+1),new Ue(0,0)]]};class L0{constructor(e,n,i,l,u){this.tileID=e,this.uid=Ra(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=u,l&&l.style&&(this._lastUpdatedBrightness=l.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",l&&l.transform&&(this.projection=l.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<Xr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=nl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(l,u){let h={};if(!u)return h;for(let m of l){let y=m.layerIds.map(x=>u.getLayer(x)).filter(Boolean);if(y.length!==0){m.layers=y,m.stateDependentLayerIds&&(m.stateDependentLayers=m.stateDependentLayerIds.map(x=>y.filter(w=>w.id===x)[0]));for(let x of y)h[x.fqid]=m}}return h}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let l in this.buckets){let u=this.buckets[l];if(u instanceof uf){if(this.hasSymbolBuckets=!0,!i)break;u.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let l in this.buckets){let u=this.buckets[l];if(u instanceof uf&&u.hasRTLText){this.hasRTLText=!0,ce.isLoading()||ce.isLoaded()||J()!=="deferred"||oe();break}}this.queryPadding=0;for(let l in this.buckets){let u=this.buckets[l],h=n.style.getOwnLayer(l);if(!h)continue;let m=h.queryRadius(u);this.queryPadding=Math.max(this.queryPadding,m)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new Iv}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let l in this.buckets){let u=this.buckets[l];u.uploadPending()&&u.upload(e)}let n=e.gl,i=this.imageAtlas;if(i&&!i.uploaded){let l=!!Object.keys(i.patternPositions).length;this.imageAtlasTexture=new ba(e,i.image,n.RGBA,{useMipmap:l}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new ba(e,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ba(e,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let l=n.style.getBrightness();(this._lastUpdatedBrightness||l)&&(this._lastUpdatedBrightness&&l&&Math.abs(this._lastUpdatedBrightness-l)<.001||(this._lastUpdatedBrightness=l,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,l,u,h,m,y){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:l,pixelPosMatrix:m,transform:h,params:u,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){let i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;let l=i.loadVTLayers(),u=n?n.sourceLayer:"",h=l._geojsonTileLayer||l[u];if(!h)return;let m=Du(n&&n.filter),{z:y,x,y:w}=this.tileID.canonical,T={z:y,x,y:w};for(let D=0;D<h.length;D++){let S=h.feature(D);if(m.needGeometry){let k=Ka(S,!0);if(!m.filter(new ae(this.tileID.overscaledZ),k,this.tileID.canonical))continue}else if(!m.filter(new ae(this.tileID.overscaledZ),S))continue;let A=i.getId(S,u),P=new RI(S,y,x,w,A);P.tile=T,e.push(P)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let i=ze(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let i=Date.now(),l=!1;if(this.expirationTime>i)l=!1;else if(n)if(this.expirationTime<n)l=!0;else{let u=this.expirationTime-n;u?this.expirationTime=i+Math.max(u,3e4):l=!0}else l=!0;l?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let i=this.latestFeatureIndex.loadVTLayers(),l=n.style.listImages(),u=n.style.getBrightness();for(let h in this.buckets){if(!n.style.hasLayer(h))continue;let m=this.buckets[h],y=m.layers[0].sourceLayer||"_geojsonTileLayer",x=i[y],w={};if(e&&(w=e[y],!x||!w||Object.keys(w).length===0))continue;if(m.update(w,x,l,this.imageAtlas&&this.imageAtlas.patternPositions||{},u),m instanceof hg||m instanceof $m){let D=n.style.getOwnSourceCache(m.layers[0].source);n._terrain&&n._terrain.enabled&&D&&m.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(D.id,this.tileID)}let T=n&&n.style&&n.style.getOwnLayer(h);T&&(this.queryPadding=Math.max(this.queryPadding,T.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Xr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Xr.now()+e}setTexture(e,n){let i=n.context,l=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof ba?this.texture.update(e,{useMipmap:!0}):(this.texture=new ba(i,e,l.RGBA,{useMipmap:!0}),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE))}setDependencies(e,n){let i={};for(let l of n)i[l]=!0;this.dependencies[e]=i}hasDependency(e,n){for(let i of e){let l=this.dependencies[i];if(l){for(let u of n)if(l[u])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let i=Is(yD,this.tileID.canonical,this.tileTransform)[0],l=new Lt,u=new Vd;for(let h=0;h<i.length;h++){let{x:m,y}=i[h];l.emplaceBack(m,y),u.emplaceBack(h)}u.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(l,qd.members),this._tileDebugSegments=Xn.simpleSegment(0,0,l.length,u.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let i=Is(yD,this.tileID.canonical,this.tileTransform)[0],l,u;if(this.isRaster){let h=function(m,y){let x=nl(m,y),w=Math.pow(2,m.z);for(let k=0;k<Ds;k++)for(let N=0;N<Ds;N++){let H=Oi((m.x+(N+_D(N))/xo)/w),q=$r((m.y+(k+_D(k))/xo)/w),Z=y.project(H,q),K=k*Ds+N;Ms[2*K+0]=Math.round((Z.x*x.scale-x.x)*Ze),Ms[2*K+1]=Math.round((Z.y*x.scale-x.y)*Ze)}ol.fill(0),fg.fill(0);for(let k=2045;k>=0;k--){let N=4*k,H=il[N+0],q=il[N+1],Z=il[N+2],K=il[N+3],ee=H+Z>>1,le=q+K>>1,he=ee+le-q,fe=le+H-ee,xe=q*Ds+H,_e=K*Ds+Z,Me=le*Ds+ee,Be=Math.hypot((Ms[2*xe+0]+Ms[2*_e+0])/2-Ms[2*Me+0],(Ms[2*xe+1]+Ms[2*_e+1])/2-Ms[2*Me+1])>=16;ol[Me]=ol[Me]||(Be?1:0),k<1022&&(ol[Me]=ol[Me]||ol[(q+fe>>1)*Ds+(H+he>>1)]||ol[(K+fe>>1)*Ds+(Z+he>>1)])}let T=new xn,D=new En,S=0;function A(k,N){let H=N*Ds+k;return fg[H]===0&&(T.emplaceBack(Ms[2*H+0],Ms[2*H+1],k*Ze/xo,N*Ze/xo),fg[H]=++S),fg[H]-1}function P(k,N,H,q,Z,K){let ee=k+H>>1,le=N+q>>1;if(Math.abs(k-Z)+Math.abs(N-K)>1&&ol[le*Ds+ee])P(Z,K,k,N,ee,le),P(H,q,Z,K,ee,le);else{let he=A(k,N),fe=A(H,q),xe=A(Z,K);D.emplaceBack(he,fe,xe)}}return P(0,0,xo,xo,xo,0),P(xo,xo,0,0,0,xo),{vertices:T,indices:D}}(this.tileID.canonical,n);l=h.vertices,u=h.indices}else{l=new xn,u=new En;for(let{x:m,y}of i)l.emplaceBack(m,y,0,0);let h=Um(l.int16,void 0,4);for(let m=0;m<h.length;m+=3)u.emplaceBack(h[m],h[m+1],h[m+2])}this._tileBoundsBuffer=e.createVertexBuffer(l,pg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(u),this._tileBoundsSegments=Xn.simpleSegment(0,0,l.length,u.length)}_makeGlobeTileDebugBuffers(e,n){let i=n.projection;if(!i||i.name!=="globe"||n.freezeTileCoverage)return;let l=this.tileID.canonical,u=Yd(HT(l,n)),h=_a(n.zoom),m;h>0&&(m=r.m.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,l,n,u,m,h),this._makeGlobeTileDebugTextBuffer(e,l,n,u,m,h)}_globePoint(e,n,i,l,u,h,m){let y=Xd(e,n,i);if(h){let x=1<<i.z,w=Es(l.center.lng),T=Ts(l.center.lat),D=(i.x+.5)/x-w,S=0;D>.5?S=-1:D<-.5&&(S=1);let A=(e/Ze+i.x)/x+S,P=(n/Ze+i.y)/x;A=(A-w)*l._pixelsPerMercatorPixel+w,P=(P-T)*l._pixelsPerMercatorPixel+T;let k=[A*l.worldSize,P*l.worldSize,0];r.v.transformMat4(k,k,h),y=ga(y,k,m)}return r.v.transformMat4(y,y,u)}_makeGlobeTileDebugBorderBuffer(e,n,i,l,u,h){let m=new Lt,y=new Vd,x=new Rn,w=(D,S,A,P,k)=>{let N=(A-D)/(k-1),H=(P-S)/(k-1),q=m.length;for(let Z=0;Z<k;Z++){let K=D+Z*N,ee=S+Z*H;m.emplaceBack(K,ee);let le=this._globePoint(K,ee,n,i,l,u,h);x.emplaceBack(le[0],le[1],le[2]),y.emplaceBack(q+Z)}},T=Ze;w(0,0,T,0,16),w(T,0,T,T,16),w(T,T,0,T,16),w(0,T,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(m,qd.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(x,NT.members),this._tileDebugSegments=Xn.simpleSegment(0,0,m.length,y.length)}_makeGlobeTileDebugTextBuffer(e,n,i,l,u,h){let m=Ze/4,y=new Lt,x=new En,w=new Rn,T=25;x.reserve(32),y.reserve(T),w.reserve(T);let D=(S,A)=>T*S+A;for(let S=0;S<T;S++){let A=S*m;for(let P=0;P<T;P++){let k=P*m;y.emplaceBack(k,A);let N=this._globePoint(k,A,n,i,l,u,h);w.emplaceBack(N[0],N[1],N[2])}}for(let S=0;S<4;S++)for(let A=0;A<4;A++){let P=D(S,A),k=D(S,A+1),N=D(S+1,A),H=D(S+1,A+1);x.emplaceBack(P,k,N),x.emplaceBack(N,k,H)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(x),this._tileDebugTextBuffer=e.createVertexBuffer(y,qd.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(w,NT.members),this._tileDebugTextSegments=Xn.simpleSegment(0,0,T,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof ba&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class hL{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){let l=e.wrapped().key;this.data[l]===void 0&&(this.data[l]=[]);let u={value:n,timeout:void 0};if(i!==void 0&&(u.timeout=setTimeout(()=>{this.remove(e,u)},i)),this.data[l].push(u),this.order.push(l),this.order.length>this.max){let h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let i=e.wrapped().key,l=n===void 0?0:this.data[i].indexOf(n),u=this.data[i][l];return this.data[i].splice(l,1),u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(u.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let i in this.data)for(let l of this.data[i])e(l.value)||n.push(l);for(let i of n)this.remove(i.value.tileID,i)}}let dL=(()=>{class t{constructor(n,i,l,u){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let h=n.gl;this.buffer=h.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||u||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})();class Zu{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}Zu.ReadOnly=!1,Zu.ReadWrite=!0,Zu.disabled=new Zu(519,Zu.ReadOnly,[0,1]);let F0=7680;class N0{constructor(e,n,i,l,u,h){this.test=e,this.ref=n,this.mask=i,this.fail=l,this.depthFail=u,this.pass=h}}N0.disabled=new N0({func:519,mask:0},0,0,F0,F0,F0);class bo{constructor(e,n,i,l){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=l}}bo.Replace=[1,0,1,0],bo.disabled=new bo(bo.Replace,Vn.transparent,[!1,!1,!1,!1]),bo.unblended=new bo(bo.Replace,Vn.transparent,[!0,!0,!0,!0]),bo.alphaBlended=new bo([1,771,1,771],Vn.transparent,[!0,!0,!0,!0]),bo.multiply=new bo([774,0,774,0],Vn.transparent,[!0,!0,!0,!0]);let z0=1029,B0=2305;class $o{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}$o.disabled=new $o(!1,z0,B0),$o.backCCW=new $o(!0,z0,B0),$o.backCW=new $o(!0,z0,2304),$o.frontCW=new $o(!0,1028,2304),$o.frontCCW=new $o(!0,1028,B0);class cc extends uo{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",l=>{l.dataType==="source"&&l.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&l.dataType==="source"&&l.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new hL(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new mk,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return $s(this._tiles).map(e=>e.tileID).sort(vD).map(e=>e.key)}getRenderableIds(e,n){let i=[];for(let l in this._tiles)this._isIdRenderable(+l,e,n)&&i.push(this._tiles[l]);return e?i.sort((l,u)=>{let h=l.tileID,m=u.tileID,y=new Ue(h.canonical.x,h.canonical.y)._rotate(this.transform.angle),x=new Ue(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return h.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(vD).map(l=>l.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let i=this._tiles[e];i&&(i.state!=="loading"&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,l){if(l)if(e.state="errored",l.status!==404)this._source.fire(new Zs(l,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Wi("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let u=this.map.painter.terrain;this.update(this.transform,u.getScaledDemTileSize(),!0),u.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=Xr.now(),i==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Wi("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let l=0;l<n.length;l++){let u=n[l];if(e.neighboringTiles&&e.neighboringTiles[u]){let h=this.getTileByID(u);i(e,h),i(h,e)}}function i(l,u){if(!l.dem||l.dem.borderReady)return;l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0;let h=u.tileID.canonical.x-l.tileID.canonical.x,m=u.tileID.canonical.y-l.tileID.canonical.y,y=Math.pow(2,l.tileID.canonical.z),x=u.tileID.key;h===0&&m===0||Math.abs(m)>1||(Math.abs(h)>1&&(Math.abs(h+y)===1?h+=y:Math.abs(h-y)===1&&(h-=y)),u.dem&&l.dem&&(l.dem.backfillBorder(u.dem,h,m),l.neighboringTiles&&l.neighboringTiles[x]&&(l.neighboringTiles[x].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,l){for(let u in this._tiles){let h=this._tiles[u];if(l[u]||!h.hasData()||h.tileID.overscaledZ<=n||h.tileID.overscaledZ>i)continue;let m=h.tileID;for(;h&&h.tileID.overscaledZ>n+1;){let x=h.tileID.scaledTo(h.tileID.overscaledZ-1);h=this._tiles[x.key],h&&h.hasData()&&(m=x)}let y=m;for(;y.overscaledZ>n;)if(y=y.scaledTo(y.overscaledZ-1),e[y.key]){l[m.key]=m;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){let l=e.scaledTo(i),u=this._getLoadedTile(l);if(u)return u}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let i=Math.ceil(e.width/n)+1,l=Math.ceil(e.height/n)+1,u=Math.floor(i*l*5),h=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,u):u,m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,h):h;this._cache.setMaxSize(m)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let i={};for(let l in this._tiles){let u=this._tiles[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),i[u.tileID.key]=u}this._tiles=i;for(let l in this._timers)clearTimeout(this._timers[l]),delete this._timers[l];for(let l in this._tiles)this._setTileReloadTimer(+l,this._tiles[l])}}update(e,n,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let u;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new zr(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(y=>this._source.hasTile(y)))):u=[],u.length>0&&this.castsShadows&&l&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!j0(this._source.type)){let y=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),x=Math.min(y,this._source.maxzoom),w=e.extendTileCoverForShadows(u,l,x);for(let T of w)this._shadowCasterTiles[T.key]=!0,u.push(T)}let h=this._updateRetainedTiles(u);if(j0(this._source.type)&&u.length!==0){let y={},x={},w=Object.keys(h);for(let D of w){let S=h[D],A=this._tiles[D];if(!A||A.fadeEndTime&&A.fadeEndTime<=Xr.now())continue;let P=this.findLoadedParent(S,Math.max(S.overscaledZ-cc.maxOverzooming,this._source.minzoom));P&&(this._addTile(P.tileID),y[P.tileID.key]=P.tileID),x[D]=S}let T=u[u.length-1].overscaledZ;for(let D in this._tiles){let S=this._tiles[D];if(h[D]||!S.hasData())continue;let A=S.tileID;for(;A.overscaledZ>T;){A=A.scaledTo(A.overscaledZ-1);let P=this._tiles[A.key];if(P&&P.hasData()&&x[A.key]){h[D]=S.tileID;break}}}for(let D in y)h[D]||(this._coveredTiles[D]=!0,h[D]=y[D])}for(let y in h)this._tiles[y].clearFadeHold();let m=function(y,x){let w=[];for(let T in y)T in x||w.push(T);return w}(this._tiles,h);for(let y of m){let x=this._tiles[y];x.hasSymbolBuckets&&!x.holdingForFade()?x.setHoldDuration(this.map._fadeDuration):x.hasSymbolBuckets&&!x.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let i={},l=e.reduce((x,w)=>Math.min(x,w.overscaledZ),1/0),u=e[0].overscaledZ,h=Math.max(u-cc.maxOverzooming,this._source.minzoom),m=Math.max(u+cc.maxUnderzooming,this._source.minzoom),y={};for(let x of e){let w=this._addTile(x);n[x.key]=x,w.hasData()||l<this._source.maxzoom&&(y[x.key]=x)}this._retainLoadedChildren(y,l,m,n);for(let x of e){let w=this._tiles[x.key];if(w.hasData())continue;if(x.canonical.z>=this._source.maxzoom){let D=x.children(this._source.maxzoom)[0],S=this.getTile(D);if(S&&S.hasData()){n[D.key]=D;continue}}else{let D=x.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let T=w.wasRequested();for(let D=x.overscaledZ-1;D>=h;--D){let S=x.scaledTo(D);if(i[S.key]||(i[S.key]=!0,w=this.getTile(S),!w&&T&&(w=this._addTile(S)),w&&(n[S.key]=S,T=w.wasRequested(),w.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],i,l=this._tiles[e].tileID;for(;l.overscaledZ>0;){if(l.key in this._loadedParentTiles){i=this._loadedParentTiles[l.key];break}n.push(l.key);let u=l.scaledTo(l.overscaledZ-1);if(i=this._getLoadedTile(u),i)break;l=u}for(let u of n)this._loadedParentTiles[u]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let i=!!n;if(!i){let l=this.map?this.map.painter:null;n=new L0(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,l,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new Wi("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){let l=[],u=this.transform;if(!u)return l;let h=u.projection.name==="globe",m=Es(u.center.lng);for(let y in this._tiles){let x=this._tiles[y];if(i&&x.clearQueryDebugViz(),x.holdingForFade())continue;let w;if(h){let T=x.tileID.canonical;if(T.z===0){let D=[Math.abs(Bt(m,...hf(T,-1))-m),Math.abs(Bt(m,...hf(T,1))-m)];w=[0,2*D.indexOf(Math.min(...D))-1]}else{let D=[Math.abs(Bt(m,...hf(T,-1))-m),Math.abs(Bt(m,...hf(T,0))-m),Math.abs(Bt(m,...hf(T,1))-m)];w=[D.indexOf(Math.min(...D))-1]}}else w=[0];for(let T of w){let D=e.containsTile(x,u,n,T);D&&l.push(D)}}return l}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let i=this.getRenderableIds(e,n).map(u=>this._tiles[u].tileID),l=this.transform.projection.name==="globe";for(let u of i)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped()),u.expandedProjMatrix=l?this.transform.calculateProjMatrix(u.toUnwrapped(),!1,!0):u.projMatrix;return i}sortCoordinatesByDistance(e){let n=e.slice(),i=this.transform._camera.position,l=this.transform._camera.forward(),u={};for(let h of n){let m=1/(1<<h.canonical.z);u[h.key]=((h.canonical.x+.5)*m+h.wrap-i[0])*l[0]+((h.canonical.y+.5)*m-i[1])*l[1]-i[2]*l[2]}return n.sort((h,m)=>u[h.key]-u[m.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(j0(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=Xr.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){let l=this._tiles[e];l&&l.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(let i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let m=()=>{this._sourceLoaded&&(this._source.off("data",m),this._preloadTiles(e,n))};return void this._source.on("data",m)}let i=new Map,l=Array.isArray(e)?e:[e],u=this.map.painter.terrain,h=this.usedForTerrain&&u?u.getScaledDemTileSize():this._source.tileSize;for(let m of l){let y=m.coveringTiles({tileSize:h,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let x of y)i.set(x.key,x);this.usedForTerrain&&m.updateElevation(!1)}vi(Array.from(i.values()),(m,y)=>{let x=new L0(m,this._source.tileSize*m.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(x,w=>{this._source.type==="raster-dem"&&x.dem&&this._backfillDEM(x),y(w,x)})},n)}}function vD(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function j0(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function hf(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}cc.maxOverzooming=10,cc.maxUnderzooming=3;let fL=dt([{name:"a_pos_3f",components:3,type:"Float32"}]),pL=dt([{name:"a_color_3f",components:3,type:"Float32"}]),mL=dt([{name:"a_color_4f",components:4,type:"Float32"}]),gL=dt([{name:"a_uv_2f",components:2,type:"Float32"}]),_L=dt([{name:"a_normal_3f",components:3,type:"Float32"}]),yL=dt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),vL=dt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function xD(t,e){let n=mg(t.projection,t.zoom,t.width,t.height),i=function(u,h,m,y,x){let w=new gn(m.lng-180*sl,m.lat),T=new gn(m.lng+180*sl,m.lat),D=u.project(w.lng,w.lat),S=u.project(T.lng,T.lat),A=-Math.atan2(S.y-D.y,S.x-D.x),P=Hr.fromLngLat(m);P.y=Bt(P.y,-1+sl,1-sl);let k=P.toLngLat(),N=u.project(k.lng,k.lat),H=Hr.fromLngLat(k);H.x+=sl;let q=H.toLngLat(),Z=u.project(q.lng,q.lat),K=ED(Z.x-N.x,Z.y-N.y,A),ee=Hr.fromLngLat(k);ee.y+=sl;let le=ee.toLngLat(),he=u.project(le.lng,le.lat),fe=ED(he.x-N.x,he.y-N.y,A),xe=Math.abs(K.x)/Math.abs(fe.y),_e=r.m.identity([]);r.m.rotateZ(_e,_e,-A*(1-(x?0:y)));let Me=r.m.identity([]);return r.m.scale(Me,Me,[1,1-(1-xe)*y,1]),Me[4]=-fe.x/fe.y*y,r.m.rotateZ(Me,Me,A),r.m.multiply(Me,_e,Me),Me}(t.projection,0,t.center,n,e),l=bD(t);return r.m.scale(i,i,[l,l,1]),i}function bD(t){let e=t.projection,n=mg(t.projection,t.zoom,t.width,t.height),i=wD(e,t.center),l=wD(e,gn.convert(e.center));return Math.pow(2,i*n+(1-n)*l)}function mg(t,e,n,i,l=1/0){let u=t.range;if(!u)return 0;let h=Math.min(l,Math.max(n,i)),m=Math.log(h/1024)/Math.LN2;return Us(u[0]+m,u[1]+m,e)}let sl=1/4e4;function wD(t,e){let n=Bt(e.lat,-ar,ar),i=new gn(e.lng-180*sl,n),l=new gn(e.lng+180*sl,n),u=t.project(i.lng,n),h=t.project(l.lng,n),m=Hr.fromLngLat(i),y=Hr.fromLngLat(l),x=h.x-u.x,w=h.y-u.y,T=y.x-m.x,D=y.y-m.y,S=Math.sqrt((T*T+D*D)/(x*x+w*w));return Math.log(S)/Math.LN2}function ED(t,e,n){let i=Math.cos(n),l=Math.sin(n);return{x:t*i-e*l,y:t*l+e*i}}function TD(t,e,n){return e*(Ze/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}function ID(t,e,n){r.m.identity(t),r.m.rotateZ(t,t,gt(e[2])),r.m.rotateX(t,t,gt(e[0])),r.m.rotateY(t,t,gt(e[1])),r.m.scale(t,t,n),r.m.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function gg(t,e,n,i,l,u,h,m){let y=[n[0]-e[0],n[1]-e[1],0],x=[i[0]-e[0],i[1]-e[1],0];if(r.v.length(y)<1e-12||r.v.length(x)<1e-12)return r.q.identity(t);let w=r.v.cross([],y,x);r.v.normalize(w,w),r.v.subtract(x,i,e),y[2]=(u-l)*m,x[2]=(h-l)*m;let T=y;return r.v.cross(T,y,x),r.v.normalize(T,T),r.q.rotationTo(t,w,T)}function DD(t,e,n=!1){let i=_a(e.zoom),l=function(u,h,m){let y=h.worldSize,x=[u[12],u[13],u[14]],w=$r(x[1]/y),T=Oi(x[0]/y),D=r.m.identity([]),S=pi(1,w)*y,A=pi(1,0)*y*sc(w,h.zoom),P=1/e0(y),k=A*P;if(m){let Z=mg(h.projection,h.zoom,h.width,h.height,1024);k=P*h.projection.pixelSpaceConversion(h.center.lat,y,Z)}let N=oc(w,T);r.v.add(N,N,r.v.scale([],r.v.normalize([],N),S*k*x[2]));let H=function(Z){let K=[Z[0],Z[1],Z[2]],ee=[0,1,0],le=r.v.cross([],ee,K);return r.v.cross(ee,K,le),r.v.squaredLength(ee)===0&&(ee=[0,1,0],r.v.cross(le,K,ee)),r.v.normalize(le,le),r.v.normalize(ee,ee),r.v.normalize(K,K),[le[0],le[1],le[2],0,ee[0],ee[1],ee[2],0,K[0],K[1],K[2],0,Z[0],Z[1],Z[2],1]}(N);r.m.scale(D,D,[k,k,k*S]),r.m.translate(D,D,[-x[0],-x[1],-x[2]]);let q=r.m.multiply([],h.globeMatrix,H);return r.m.multiply(q,q,D),r.m.multiply(q,q,u),q}(t,e,n);if(i>0){let u=function(h,m){let y=m.worldSize,x=pi(1,0)*y*sc(m.center.lat,m.zoom)/e0(y),w=pi(1,m.center.lat)*y,T=r.m.identity([]);return r.m.rotateY(T,T,gt(m.center.lng)),r.m.rotateX(T,T,gt(m.center.lat)),r.m.translate(T,T,[0,0,io]),r.m.scale(T,T,[x,x,x*w]),r.m.translate(T,T,[m.point.x-.5*y,m.point.y-.5*y,0]),r.m.multiply(T,T,h),r.m.multiply(T,m.globeMatrix,T)}(t,e);return function(h,m,y){let x=(A,P,k)=>{let N=r.v.length(A),H=r.v.length(P),q=ga(A,P,k);return r.v.scale(q,q,1/r.v.length(q)*Wt(N,H,k))},w=x([h[0],h[1],h[2]],[m[0],m[1],m[2]],y),T=x([h[4],h[5],h[6]],[m[4],m[5],m[6]],y),D=x([h[8],h[9],h[10]],[m[8],m[9],m[10]],y),S=ga([h[12],h[13],h[14]],[m[12],m[13],m[14]],y);return[w[0],w[1],w[2],0,T[0],T[1],T[2],0,D[0],D[1],D[2],0,S[0],S[1],S[2],1]}(l,u,i)}return l}let uc=64,_g={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function df(t,e,n=!1){t.uploaded||(t.gfxTexture=new ba(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function xL(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,fL.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,_L.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,gL.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?pL:mL).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,vL.members,!0)),t.segments=Xn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let i=t.material;i.pbrMetallicRoughness.baseColorTexture&&df(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&df(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&df(i.normalTexture,e),i.occlusionTexture&&df(i.occlusionTexture,e,n),i.emissionTexture&&df(i.emissionTexture,e)}function V0(t,e,n){if(t.meshes)for(let i of t.meshes)xL(i,e,n);if(t.children)for(let i of t.children)V0(i,e,n)}function yg(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)yg(e)}function vg(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)vg(n)}class MD{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class SD{constructor(){this.instancedDataArray=new Ev,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class CD{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,i,l){this.tileToMeter=Om(i);let u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:h,id:m,index:y,sourceLayerIndex:x}of e){let w=Ka(h,u);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),w,i))continue;let T={id:m,sourceLayerIndex:x,index:y,geometry:u?w.geometry:Is(h,i,l),properties:h.properties,type:h.type,patterns:{}},D=this.addFeature(T,T.geometry,w);D&&n.featureIndex.insert(h,T.geometry,y,x,this.index,this.instancesPerModel[D].instancedDataArray.length)}this.lookup=null}update(e,n,i,l){for(let u in this.instancesPerModel){let h=this.instancesPerModel[u];for(let m in e)h.idToFeaturesIndex.hasOwnProperty(m)&&this.evaluate(h.features[h.idToFeaturesIndex[m]],e[m],h,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];for(let l of i.features){let u=this.layers[0],h=l.feature,m=this.canonical,y=u.paint.get("model-rotation").evaluate(h,{},m),x=u.paint.get("model-scale").evaluate(h,{},m),w=u.paint.get("model-translation").evaluate(h,{},m);r.v.exactEquals(l.rotation,y)&&r.v.exactEquals(l.scale,x)&&r.v.exactEquals(l.translation,w)||(this.evaluate(l,l.featureStates,i,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];i.instancedDataArray.length<0||i.instancedDataArray.length===0||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,yL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,i){let l=this.layers[0],u=l.layout.get("model-id").evaluate(i,{},this.canonical);if(!u)return Zn(`modelId is not evaluated for layer ${l.id} and it is not going to get rendered.`),u;this.instancesPerModel[u]||(this.instancesPerModel[u]=new SD);let h=this.instancesPerModel[u],m=h.instancedDataArray,y=new MD(i,m.length);for(let x of n)for(let w of x){if(w.x<0||w.x>=Ze||w.y<0||w.y>=Ze)continue;let T=(this.lookupDim-1)/Ze,D=this.lookupDim*(w.y*T|0)+w.x*T|0;if(this.lookup){if(this.lookup[D]!==0)continue;this.lookup[D]=1}this.instanceCount++;let S=m.length;m.resize(S+1),h.instancesEvaluatedElevation.push(0),m.float32[16*S]=w.x,m.float32[16*S+1]=w.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),u}evaluate(e,n,i,l){let u=this.layers[0],h=e.feature,m=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(h,n,m),x=e.scale=u.paint.get("model-scale").evaluate(h,n,m),w=e.translation=u.paint.get("model-translation").evaluate(h,n,m),T=u.paint.get("model-color").evaluate(h,n,m);T.a=u.paint.get("model-color-mix-intensity").evaluate(h,n,m);let D=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,x[0]),Math.max(x[1],x[2])),ID(D,y,x);let S=Math.round(100*T.a)+T.b/1.05;for(let A=0;A<e.instancedDataCount;++A){let P=e.instancedDataOffset+A,k=16*P,N=i.instancedDataArray.float32,H=0;l&&(H=N[k+6]-i.instancesEvaluatedElevation[P]);let q=0|N[k+1];N[k]=(0|N[k])+T.r/1.05,N[k+1]=q+T.g/1.05,N[k+2]=S,N[k+3]=1/(m.z>10?this.tileToMeter:Om(m,q)),N[k+4]=w[0],N[k+5]=w[1],N[k+6]=w[2]+H,N[k+7]=D[0],N[k+8]=D[1],N[k+9]=D[2],N[k+10]=D[4],N[k+11]=D[5],N[k+12]=D[6],N[k+13]=D[8],N[k+14]=D[9],N[k+15]=D[10],i.instancesEvaluatedElevation[P]=w[2]}}}it(CD,"ModelBucket",{omit:["layers"]}),it(SD,"PerModelAttributes"),it(MD,"ModelFeature");let bL=new Re({visibility:new Q(ye.layout_model.visibility),"model-id":new me(ye.layout_model["model-id"])});var wL={paint:new Re({"model-opacity":new Q(ye.paint_model["model-opacity"]),"model-rotation":new me(ye.paint_model["model-rotation"]),"model-scale":new me(ye.paint_model["model-scale"]),"model-translation":new me(ye.paint_model["model-translation"]),"model-color":new me(ye.paint_model["model-color"]),"model-color-mix-intensity":new me(ye.paint_model["model-color-mix-intensity"]),"model-type":new Q(ye.paint_model["model-type"]),"model-cast-shadows":new Q(ye.paint_model["model-cast-shadows"]),"model-receive-shadows":new Q(ye.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Q(ye.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new me(ye.paint_model["model-emissive-strength"]),"model-roughness":new me(ye.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new me(ye.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Q(ye.paint_model["model-cutoff-fade-range"])}),layout:bL};let U0=new Float32Array(262144),hc=new Uint8Array(262144);function AD(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,AD(n));return e}let RD=["","wall","door","roof","window","lamp","logo"];class PD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:AD(e)}}}}class OD{constructor(e,n,i,l){this.nodes=e,this.id=n,this.modelTraits|=_g.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=_g.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=l,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let i of n){let l=i.node;this.uploaded?this.updatePbrBuffer(l):V0(l,e,!0)}for(let i of n)yg(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){let l=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;return!!(!this.uploaded||this.dirty||l.name!==this.projection.name||ff(i.paint.get("model-color").value,h)||ff(i.paint.get("model-color-mix-intensity").value,h)||ff(i.paint.get("model-roughness").value,h)||ff(i.paint.get("model-emissive-strength").value,h)||ff(i.paint.get("model-height-based-emissive-strength-multiplier").value,h))&&(this.projection=l,this.brightness=u,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let i=this.getNodesInfo(),l=this.id.canonical;for(let u of i){let h=u.feature;u.evaluatedScale=n.paint.get("model-scale").evaluate(h,{},l)}}evaluate(e){let n=this.getNodesInfo();for(let i of n){if(!i.node.meshes)continue;let l=i.feature,u=i.node.meshes&&i.node.meshes[0].featureData,h=i.evaluatedColor[2],m=i.evaluatedRMEA[2],y=this.id.canonical;if(i.hasTranslucentParts=!1,u){for(let x=0;x<RD.length;x++){let w=RD[x];w.length&&(l.properties.part=w);let T=e.paint.get("model-color").evaluate(l,{},y),D=e.paint.get("model-color-mix-intensity").evaluate(l,{},y);i.evaluatedColor[x]=[T.r,T.g,T.b,D],i.evaluatedRMEA[x][0]=e.paint.get("model-roughness").evaluate(l,{},y),i.evaluatedRMEA[x][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y),i.evaluatedRMEA[x][3]=T.a,i.emissionHeightBasedParams[x]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(l,{},y),!i.hasTranslucentParts&&T.a<1&&(i.hasTranslucentParts=!0)}delete l.properties.part,TL(i,h!==i.evaluatedColor[2]||m!==i.evaluatedRMEA[2])}else i.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(l,{},y);i.evaluatedScale=e.paint.get("model-scale").evaluate(l,{},y),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,l){let u=e.findDEMTileFor(i);if(u&&(u.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;let h=Vu.create(e,i,u);if(!h)return;this.modelTraits&_g.HasMapboxMeshFeatures&&this.updateDEM(e,h,i,l);for(let m of this.getNodesInfo()){let y=m.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;let x=y.footprint.vertices,w=h.getElevationAt(x[0].x,x[0].y,!0,!0);for(let T=1;T<x.length;T++)w=Math.min(w,h.getElevationAt(x[T].x,x[T].y,!0,!0));y.elevation=w}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,l){let u=n._dem._modifiedForSources[l];if(u===void 0&&(n._dem._modifiedForSources[l]=[],u=n._dem._modifiedForSources[l]),u.includes(i.canonical))return;let h=n._dem.dim;u.push(i.canonical);let m=!1;for(let y of this.getNodesInfo()){let x=y.node;if(!x.footprint||!x.footprint.grid)continue;let w=x.footprint.grid,T=n.tileCoordToPixel(w.min.x,w.min.y),D=n.tileCoordToPixel(w.max.x,w.max.y),S=Math.min(Math.min(h-D.y,T.x),Math.min(T.y,h-D.x));if(S<0)continue;let A=Bt(S,2,5),P=Math.max(0,T.x-A),k=Math.max(0,T.y-A),N=Math.min(D.x+A,h-1),H=Math.min(D.y+A,h-1);for(let ee=k;ee<=H;++ee)for(let le=P;le<=N;++le)hc[ee*h+le]=255;let q=0,Z=0;for(let ee=0;ee<w.cellsY;++ee)for(let le=0;le<w.cellsX;++le){if(!w.cells[ee*w.cellsX+le])continue;let he=n.tileCoordToPixel(w.min.x+le/w.xScale,w.min.y+ee/w.yScale),fe=n.tileCoordToPixel(w.min.x+(le+1)/w.xScale,w.min.y+(ee+1)/w.yScale);for(let xe=he.y;xe<=Math.min(fe.y+1,h-1);++xe)for(let _e=he.x;_e<=Math.min(fe.x+1,h-1);++_e)hc[xe*h+_e]===255&&(hc[xe*h+_e]=0,q+=n.getElevationAtPixel(_e,xe),Z++)}let K=q/Z;P=Math.max(1,T.x-A),k=Math.max(1,T.y-A),N=Math.min(D.x+A,h-2),H=Math.min(D.y+A,h-2),m=!0;for(let ee=k;ee<=H;++ee)for(let le=P;le<=N;++le)hc[ee*h+le]===0&&(U0[ee*h+le]=n._dem.set(le,ee,K));for(let ee=1;ee<A;++ee){P=Math.max(1,T.x-ee),k=Math.max(1,T.y-ee),N=Math.min(D.x+ee,h-2),H=Math.min(D.y+ee,h-2);for(let le=k;le<=H;++le)for(let he=P;he<=N;++he){let fe=le*h+he;if(hc[fe]===255){let xe=0,_e=0,Me=-1,Be=-1;for(let Te=-1;Te<=1;++Te)for(let ke=-1;ke<=1;++ke){let Ee=(le+Te)*h+he+ke;if(hc[Ee]>=ee)continue;let Je=U0[Ee],rt=Math.abs(Je);rt>_e&&(xe=Je,_e=rt,Me=ke,Be=Te)}if(_e>.1){let Te=1-(ee+.5*Math.abs(Me*Be))/A,ke=n._dem.get(he,le)+xe*Te,Ee=n._dem.get(he+Me,le+Be),Je=n._dem.get(he-Me,le-Be,!0);(ke-Ee)*(ke-Je)>0&&(ke=(Ee+Je)/2),U0[fe]=n._dem.set(he,le,ke),hc[fe]=ee}}}}}m&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=Xr.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let e of this.nodes)this.nodesInfo.push(new PD(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let e of this.nodes)vg(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let e=this.getNodesInfo();for(let n of e)yg(n.node),vg(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped()),l=this.getNodesInfo();for(let u=0;u<this.nodesInfo.length;u++){let h=l[u].node;l[u].hiddenByReplacement=!!h.footprint&&!i.find(m=>m.footprint===h.footprint)}}getHeightAtTileCoord(e,n){let i=this.getNodesInfo(),l=[];for(let u=0;u<this.nodesInfo.length;u++){let h=i[u],m=h.node.meshes[0];if(e<m.aabb.min[0]||n<m.aabb.min[1]||e>m.aabb.max[0]||n>m.aabb.max[1])continue;let y=(e-m.aabb.min[0])/(m.aabb.max[0]-m.aabb.min[0])*uc|0,x=Math.min(63,(n-m.aabb.min[1])/(m.aabb.max[1]-m.aabb.min[1])*uc|0)*uc+Math.min(63,y);if(!(m.heightmap[x]<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:m.heightmap[x],maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new Ue(e,n),new Ue(e,n),l),l.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function ff(t,e){return!t.isLightConstant&&e}function EL(t,e,n,i,l,u,h,m){let y=(61440&e|(61440&e)>>4)>>8,x=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;n[3]>0&&(y=Wt(y,255*n[0],n[3]),x=Wt(x,255*n[1],n[3]),w=Wt(w,255*n[2],n[3]));let T=y<<8|x,D=w<<8|Math.floor(255*i[3]),S=function(ee){let le=Bt(ee,0,2);return Math.min(Math.round(.5*le*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],A=Bt(l[0],0,1),P=Bt(l[1],0,1),k=Bt(l[2],0,1),N=Bt(l[3],0,1),H,q,Z,K;if(A!==P&&h!==u&&P!==A){let ee=h-u;q=1/(ee*(P-A)),Z=-(u+ee*A)/(ee*(P-A));let le=Bt(l[4],-1,1);K=Math.pow(10,le),H=255*k<<8|255*N}else H=65535,q=0,Z=1,K=1;if(t.emplaceBack(T,D,S,H,q,Z,K),m){let ee=m.length;m.clear();for(let le=0;le<ee;le++)m.emplaceBack(T,D,S,H,q,Z,K)}}function TL(t,e){let n=t.node,i=0;for(let l of n.meshes){if(n.lights&&n.lightMeshIndex===i||!l.featureData)continue;l.featureArray=new wm,l.featureArray.reserve(l.featureData.length);let u=e;for(let h of l.featureData){let m,y=65535&h,x=(15&y)<8?15&y:0,w=h>>16&65535,T=t.evaluatedRMEA[x],D=t.evaluatedColor[x],S=t.emissionHeightBasedParams[x];if(u&&x===2&&n.lights&&(m=new wm,m.resize(10*n.lights.length)),EL(l.featureArray,w,D,T,S,l.aabb.min[2],l.aabb.max[2],m),m&&u){u=!1;let A=n.meshes[n.lightMeshIndex];A.featureArray=m,A.featureArray._trim()}}l.featureArray._trim(),i++}}function xg(t,e){return t.x-e.x||t.y-e.y}function kD(t,e){return xg(t.min,e.min)===0&&xg(t.max,e.max)===0}function LD(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function FD(t,e,n){let i=1/Ze,l=1/(1<<n.canonical.z),u=(e.x*i+n.canonical.x)*l+n.wrap,h=(e.y*i+n.canonical.y)*l;return{min:new Ue((t.x*i+n.canonical.x)*l+n.wrap,(t.y*i+n.canonical.y)*l),max:new Ue(u,h)}}function IL(t,e,n){let i=1<<n.canonical.z,l=((e.x-n.wrap)*i-n.canonical.x)*Ze,u=(e.y*i-n.canonical.y)*Ze;return{min:new Ue(((t.x-n.wrap)*i-n.canonical.x)*Ze,(t.y*i-n.canonical.y)*Ze),max:new Ue(l,u)}}function ND(t,e,n,i,l,u,h){let m=t.indices,y=t.vertices,x=[];for(let w=i;w<i+l;w+=3){let T=e[n[w+0]+u],D=e[n[w+1]+u],S=e[n[w+2]+u],A=Math.min(T.x,D.x,S.x),P=Math.max(T.x,D.x,S.x),k=Math.min(T.y,D.y,S.y),N=Math.max(T.y,D.y,S.y);x.length=0,t.grid.query(new Ue(A,k),new Ue(P,N),x);for(let H=0;H<x.length;H++){let q=x[H];if(u0(y[m[3*q+0]],y[m[3*q+1]],y[m[3*q+2]],T,D,S,h))return!0}}return!1}function zD(t,e,n,i){if(!t||!n)return!1;let l=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return zD(n,i,t,e);let u=e.canonical,h=i.canonical,m=Math.pow(2,h.z-u.z);l=t.vertices.map(y=>new Ue(y.x*u.x*Ze*m-h.x*Ze,y.y*u.y*Ze*m-h.y*Ze))}return ND(n,l,t.indices,0,t.indices.length,0,0)}it(OD,"Tiled3dModelBucket",{omit:["layers"]}),it(PD,"Tiled3dModelFeature");let DL=Hm.types,ML=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],SL=["fill-extrusion-flood-light-ground-radius"],CL=Math.pow(2,13),AL=Math.pow(2,15)-1,BD=new Ue(0,1),al=2147483648;function pf(t,e,n,i,l,u,h,m){t.emplaceBack((e<<1)+h,(n<<1)+u,(Math.floor(i*CL)<<1)+l,Math.round(m))}function bg(t,e,n,i,l,u){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+l,u)}function mf(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class jD{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class VD{constructor(){this.centroidXY=new Ue(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ue(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ue(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ue(this.max.x-this.min.x,this.max.y-this.min.y)}}class UD{constructor(){this.acc=new Ue(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let l=!!this.borders;n.x<e.min.x?(e.min.x=n.x,l=!0):n.x>e.max.x&&(e.max.x=n.x,l=!0),n.y<e.min.y?(e.min.y=n.y,l=!0):n.y>e.max.y&&(e.max.y=n.y,l=!0),((n.x===0||n.x===Ze)&&n.x===i.x)!=((n.y===0||n.y===Ze)&&n.y===i.y)&&this.processBorderOverlap(n,i),l&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,Wt(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Ze!=e.x>Ze&&this.addBorderIntersection(1,Wt(n.y,e.y,(Ze-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Wt(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Ze!=e.y>Ze&&this.addBorderIntersection(3,Wt(n.x,e.x,(Ze-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let i=e.x===0?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{let i=e.y===0?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return this.accCount===0?new Ue(0,0):new Ue(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function $D(t,e){let n=t.add(e)._unit(),i=Bt(t.x*n.x+t.y*n.y,-1,1);var l,u,h;return l=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(l)))/4*AL*((u=t).x*(h=e).y-u.y*h.x<0?-1:1)}let RL=[t=>t.x<0,t=>t.x>Ze,t=>t.y<0,t=>t.y>Ze];function PL(t,e,n,i){let l=[4];if(i===0)return l;n._mult(i);let u=t.sub(n),h=e.sub(n),m=[t,e,u,h];for(let y=0;y<4;y++)for(let x of m)if(RL[y](x)){l.push(y);break}return l}class GD{constructor(e){this.vertexArray=new Qr,this.indexArray=new En,this.programConfigurations=new Za(e.layers,e.zoom,n=>SL.includes(n)),this._segments=new Xn,this.hiddenByLandmarkVertexArray=new Tv,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Xn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,i,l=!1){let u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1),m=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length),y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{let x=e[0],w=e[1];y=$D(x.sub(e[u-1])._perp()._unit(),w.sub(x)._perp()._unit())}for(let x=0;x<u;x++){let w=x===u-1?0:x+1,T=e[x],D=e[w],S=e[w===u-1?0:w+1],A=D.sub(T)._perp()._unit(),P=$D(A,S.sub(D)._perp()._unit()),k=y,N=P;if($0(T,D,n)||l&&WD(T,n)&&WD(D,n)){y=P;continue}let H=m.vertexLength;bg(this.vertexArray,T,D,1,1,k),bg(this.vertexArray,T,D,1,0,k),bg(this.vertexArray,T,D,0,1,N),bg(this.vertexArray,T,D,0,0,N),m.vertexLength+=4;let q=PL(T,D,A,i);for(let Z of q)this._segmentToGroundQuads[h].push({id:H,region:Z}),this._segmentToRegionTriCounts[h][Z]+=2,m.primitiveLength+=2;y=P}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((l,u)=>l.region-u.region);for(let i=0;i<n;i++){let l=this._segmentToGroundQuads[i],u=e[i],h=this._segmentToRegionTriCounts[i];h.reduce((y,x)=>y+x,0);let m=0;for(let y=0;y<=4;y++){let x=h[y];if(x!==0){let w=this.regionSegments[y];w||(w=this.regionSegments[y]=new Xn);let T={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+m,vertexLength:u.vertexLength,primitiveLength:x};w.get().push(T)}m+=x}for(let y=0;y<l.length;y++){let x=l[y].id;this.indexArray.emplaceBack(x,x+1,x+3),this.indexArray.emplaceBack(x,x+3,x+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,l,u,h){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,l,u,h)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,qO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,l,u,h){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,l,u,h)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let i=e.flags&al?1:0;for(let l=e.groundVertexArrayOffset;l<n;++l)this.hiddenByLandmarkVertexArray.emplace(l,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,ZO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class gf{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new En,this.footprintVertices=new Lt,this.footprintSegments=[],this.layoutVertexArray=new xn,this.centroidVertexArray=new mE,this.indexArray=new En,this.programConfigurations=new Za(e.layers,e.zoom,n=>ML.includes(n)),this.segments=new Xn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new GD(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,i,l){this.features=[],this.hasPattern=_0("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Om(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:u,id:h,index:m,sourceLayerIndex:y}of e){let x=this.layers[0]._featureFilter.needGeometry,w=Ka(u,x);if(!this.layers[0]._featureFilter.filter(new ae(this.zoom),w,i))continue;let T={id:h,sourceLayerIndex:y,index:m,geometry:x?w.geometry:Is(u,i,l),properties:u.properties,type:u.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(y0("fill-extrusion",this.layers,T,this.zoom,n)):this.addFeature(T,T.geometry,m,i,{},n.availableImages,l,n.brightness),n.featureIndex.insert(u,T.geometry,m,y,this.index,D)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,i,l,u,h){for(let m of this.features){let{geometry:y}=m;this.addFeature(m,y,m.index,n,i,l,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,i,l,u){let h=Object.keys(e).length!==0;if(h&&!this.stateDependentLayers.length)return;let m=h?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,m,i,l,u),this.groundEffect.update(e,n,m,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,YO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,XO.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,WO.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,l,u,h,m,y){let x=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,w=[new Ue(0,0),new Ue(Ze,Ze)],T=m.projection,D=T.name==="globe",S=DL[e.type]==="Polygon",A=new UD;A.centroidDataIndex=this.centroidData.length;let P=new VD,k=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},l)<=0,N=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},l);P.height=N,P.vertexArrayOffset=this.layoutVertexArray.length,P.groundVertexArrayOffset=this.groundEffect.vertexArray.length,D&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Un);let H=g0(n,500);for(let he=H.length-1;he>=0;he--){let fe=H[he];(fe.length===0||(q=fe[0]).every(xe=>xe.x<=0)||q.every(xe=>xe.x>=Ze)||q.every(xe=>xe.y<=0)||q.every(xe=>xe.y>=Ze))&&H.splice(he,1)}var q;let Z;if(D)Z=JD(H,w,l);else{Z=[];for(let he of H)Z.push({polygon:he,bounds:w})}let K=S?this.edgeRadius:0,ee=K>0&&this.zoom<17,le=(he,fe)=>{if(he.length===0)return!1;let xe=he[he.length-1];return fe.x===xe.x&&fe.y===xe.y};for(let{polygon:he,bounds:fe}of Z){let xe=0,_e=0;for(let ke of he)S&&!ke[0].equals(ke[ke.length-1])&&ke.push(ke[0]),_e+=S?ke.length-1:ke.length;let Me=this.segments.prepareSegment((S?5:4)*_e,this.layoutVertexArray,this.indexArray);P.footprintSegIdx<0&&(P.footprintSegIdx=this.footprintSegments.length),P.polygonSegIdx<0&&(P.polygonSegIdx=this.polygonSegments.length);let Be={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Te=new jD;if(Te.vertexOffset=this.footprintVertices.length,Te.indexOffset=3*this.footprintIndices.length,Te.ringIndices=[],S){let ke=[],Ee=[];xe=Me.vertexLength;for(let rt=0;rt<he.length;rt++){let Ne=he[rt];Ne.length&&rt!==0&&Ee.push(ke.length/2);let wt=[],st,Ye;st=Ne[1].sub(Ne[0])._perp()._unit(),Te.ringIndices.push(Ne.length-1);for(let Et=1;Et<Ne.length;Et++){let ft=Ne[Et],yt=Ne[Et===Ne.length-1?1:Et+1],He=ft.clone();if(K){Ye=yt.sub(ft)._perp()._unit();let At=st.add(Ye)._unit(),en=K*Math.min(4,1/(st.x*At.x+st.y*At.y));He.x+=en*At.x,He.y+=en*At.y,He.x=Math.round(He.x),He.y=Math.round(He.y),st=Ye}!k||K!==0&&!ee||le(wt,He)||wt.push(He),pf(this.layoutVertexArray,He.x,He.y,0,0,1,1,0),Me.vertexLength++,this.footprintVertices.emplaceBack(ft.x,ft.y),ke.push(ft.x,ft.y),D&&mf(this.layoutVertexExtArray,T.projectTilePoint(He.x,He.y,l),T.upVector(l,He.x,He.y))}k&&(K===0||ee)&&(wt.length!==0&&le(wt,wt[0])&&wt.pop(),this.groundEffect.addData(wt,fe,x))}let Je=Um(ke,Ee);for(let rt=0;rt<Je.length;rt+=3)this.footprintIndices.emplaceBack(Te.vertexOffset+Je[rt+0],Te.vertexOffset+Je[rt+1],Te.vertexOffset+Je[rt+2]),this.indexArray.emplaceBack(xe+Je[rt],xe+Je[rt+2],xe+Je[rt+1]),Me.primitiveLength++;Te.indexCount+=Je.length,Te.vertexCount+=this.footprintVertices.length-Te.vertexOffset}for(let ke=0;ke<he.length;ke++){let Ee=he[ke];A.startRing(P,Ee[0]);let Je=Ee.length>4&&ZD(Ee[Ee.length-2],Ee[0],Ee[1]),rt=K?OL(Ee[Ee.length-2],Ee[0],Ee[1],K):0,Ne=[],wt,st,Ye;st=Ee[1].sub(Ee[0])._perp()._unit();let Et=!0;for(let ft=1,yt=0;ft<Ee.length;ft++){let He=Ee[ft-1],At=Ee[ft],en=Ee[ft===Ee.length-1?1:ft+1];if(A.appendEdge(P,At,He),$0(At,He,fe)){K&&(st=en.sub(At)._perp()._unit(),Et=!Et);continue}let Ft=At.sub(He)._perp(),Xt=Ft.x/(Math.abs(Ft.x)+Math.abs(Ft.y)),un=Ft.y>0?1:0,Pn=He.dist(At);if(yt+Pn>32768&&(yt=0),K){Ye=en.sub(At)._perp()._unit();let _n=qD(He,At,en,HD(st,Ye),K);isNaN(_n)&&(_n=0);let bn=At.sub(He)._unit();He=He.add(bn.mult(rt))._round(),At=At.add(bn.mult(-_n))._round(),rt=_n,st=Ye,k&&this.zoom>=17&&(le(Ne,He)||Ne.push(He),le(Ne,At)||Ne.push(At))}let Ut=Me.vertexLength,Gn=Ee.length>4&&ZD(He,At,en),On=XD(yt,Je,Et);if(pf(this.layoutVertexArray,He.x,He.y,Xt,un,0,0,On),pf(this.layoutVertexArray,He.x,He.y,Xt,un,0,1,On),yt+=Pn,On=XD(yt,Gn,!Et),Je=Gn,pf(this.layoutVertexArray,At.x,At.y,Xt,un,0,0,On),pf(this.layoutVertexArray,At.x,At.y,Xt,un,0,1,On),Me.vertexLength+=4,this.indexArray.emplaceBack(Ut+0,Ut+1,Ut+2),this.indexArray.emplaceBack(Ut+1,Ut+3,Ut+2),Me.primitiveLength+=2,K){let _n=xe+(ft===1?Ee.length-2:ft-2),bn=ft===1?xe:_n+1;if(this.indexArray.emplaceBack(Ut+1,_n,Ut+3),this.indexArray.emplaceBack(_n,bn,Ut+3),Me.primitiveLength+=2,wt===void 0&&(wt=Ut),!$0(en,Ee[ft],fe)){let hn=ft===Ee.length-1?wt:Me.vertexLength;this.indexArray.emplaceBack(Ut+2,Ut+3,hn),this.indexArray.emplaceBack(Ut+3,hn+1,hn),this.indexArray.emplaceBack(Ut+3,bn,hn+1),Me.primitiveLength+=3}Et=!Et}if(D){let _n=this.layoutVertexExtArray,bn=T.projectTilePoint(He.x,He.y,l),hn=T.projectTilePoint(At.x,At.y,l),er=T.upVector(l,He.x,He.y),Hn=T.upVector(l,At.x,At.y);mf(_n,bn,er),mf(_n,bn,er),mf(_n,hn,Hn),mf(_n,hn,Hn)}}S&&(xe+=Ee.length-1),k&&K&&this.zoom>=17&&(Ne.length!==0&&le(Ne,Ne[0])&&Ne.pop(),this.groundEffect.addData(Ne,fe,x,K>0))}this.footprintSegments.push(Te),Be.triangleCount=this.indexArray.length-Be.triangleArrayOffset,this.polygonSegments.push(Be),++P.footprintSegLen,++P.polygonSegLen}if(P.vertexCount=this.layoutVertexArray.length-P.vertexArrayOffset,P.groundVertexCount=this.groundEffect.vertexArray.length-P.groundVertexArrayOffset,P.vertexCount!==0){if(P.centroidXY=A.borders?BD:this.encodeCentroid(A,P),this.centroidData.push(P),A.borders){this.featuresOnBorder.push(A);let he=this.featuresOnBorder.length-1;for(let fe=0;fe<A.borders.length;fe++)A.borders[fe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[fe].push(he)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,u,h,l,y),this.groundEffect.addPaintPropertiesData(e,i,u,h,l,y),this.maxHeight=Math.max(this.maxHeight,N)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}splitToSubtiles(){let e=[];for(let m=0;m<this.centroidData.length;m++){let y=this.centroidData[m],x=+(y.min.y+y.max.y>Ze),w=2*x+(+(y.min.x+y.max.x>Ze)^x);for(let T=0;T<y.polygonSegLen;T++){let D=y.polygonSegIdx+T;e.push({centroidIdx:m,subtile:w,polygonSegmentIdx:D,triangleSegmentIdx:this.polygonSegments[D].triangleSegIdx})}}let n=new En;e.sort((m,y)=>m.triangleSegmentIdx===y.triangleSegmentIdx?m.subtile-y.subtile:m.triangleSegmentIdx-y.triangleSegmentIdx);let i=0,l=0,u=0;for(let m of e){if(m.triangleSegmentIdx!==i)break;u++}let h=e.length;for(;l!==e.length;){i=e[l].triangleSegmentIdx;let m=0,y=l,x=l;for(let w=y;w<u&&e[w].subtile===m;w++)x++;for(;y!==u;){let w=e[y];m=w.subtile;let T=this.centroidData[w.centroidIdx].min.clone(),D=this.centroidData[w.centroidIdx].max.clone(),S={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let A=y;A<x;A++){let P=e[A],k=this.polygonSegments[P.polygonSegmentIdx],N=this.centroidData[P.centroidIdx].min,H=this.centroidData[P.centroidIdx].max,q=this.indexArray.uint16;for(let Z=k.triangleArrayOffset;Z<k.triangleArrayOffset+k.triangleCount;Z++)n.emplaceBack(q[3*Z],q[3*Z+1],q[3*Z+2]);S.primitiveLength+=k.triangleCount,T.x=Math.min(T.x,N.x),T.y=Math.min(T.y,N.y),D.x=Math.max(D.x,H.x),D.y=Math.max(D.y,H.y)}S.primitiveLength>0&&this.triangleSubSegments.push({segment:S,min:T,max:D}),y=x;for(let A=y;A<u&&e[A].subtile===e[y].subtile;A++)x++}l=u;for(let w=l;w<h&&e[w].triangleSegmentIdx===e[l].triangleSegmentIdx;w++)u++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,i){let l=0,u=0,h=1<<e.canonical.z;if(n){let P=n.getMinMaxForTile(e);P&&(l=P.min,u=P.max)}u+=this.maxHeight;let m=e.toUnwrapped(),y,x=[m.canonical.x/h+m.wrap,m.canonical.y/h],w=[(m.canonical.x+1)/h+m.wrap,(m.canonical.y+1)/h],T=new Xn,D=(P,k,N)=>[P[0]*(1-N[0])+k[0]*N[0],P[1]*(1-N[1])+k[1]*N[1]],S=[],A=[];for(let P of this.triangleSubSegments){S[0]=P.min.x/Ze,S[1]=P.min.y/Ze,A[0]=P.max.x/Ze,A[1]=P.max.y/Ze;let k=D(x,w,S),N=D(x,w,A);if(new dr([k[0],k[1],l],[N[0],N[1],u]).intersectsPrecise(i)===0){y&&(T.segments.push(y),y=void 0);continue}let H=P.segment;y&&y.vertexOffset!==H.vertexOffset&&(T.segments.push(y),y=void 0),y?(y.vertexLength+=H.vertexLength,y.primitiveLength+=H.primitiveLength):y={vertexOffset:H.vertexOffset,primitiveLength:H.primitiveLength,vertexLength:H.vertexLength,primitiveOffset:H.primitiveOffset,sortKey:void 0,vaos:{}}}return y&&T.segments.push(y),T}encodeCentroid(e,n){let i=e.centroid(),l=n.span(),u=Math.min(7,Math.round(l.x*this.tileToMeter/10)),h=Math.min(7,Math.round(l.y*this.tileToMeter/10));return new Ue(Bt(i.x,1,Ze-1)<<3|u,Bt(i.y,1,Ze-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new Ue(0,0);let n=e.borders,i=Number.MAX_VALUE;if(n[0][0]!==i||n[1][0]!==i){let l=n[0][0]!==i?0:1;return new Ue(6|(n[0][0]!==i?0:65528),((n[l][0]+n[l][1])/2|0)<<3|6)}{let l=n[2][0]!==i?2:3;return new Ue(((n[l][0]+n[l][1])/2|0)<<3|6,6|(n[2][0]!==i?0:65528))}}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=al,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,l=e.flags&al?BD:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==l.y||u!==l.x){for(let h=n;h<i;++h)this.centroidVertexArray.emplace(h,l.x,l.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(u,h){if(u.length!==h.length)return!1;for(let m=0;m<u.length;m++)if(u[m].sourceId!==h[m].sourceId||!kD(u[m],h[m]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let u of this.centroidData)u.flags&=2147483647;let l=[];for(let u of this.activeReplacements){let h=Math.pow(2,u.footprintTileId.canonical.z-e.canonical.z);for(let m of this.centroidData)if(!(m.flags&al||u.min.x>m.max.x||m.min.x>u.max.x||u.min.y>m.max.y||m.min.y>u.max.y))for(let y=0;y<m.footprintSegLen;y++){let x=this.footprintSegments[m.footprintSegIdx+y];if(l.length=0,kL(this.footprintVertices,x.vertexOffset,x.vertexCount,u.footprintTileId.canonical,e.canonical,l),ND(u.footprint,l,this.footprintIndices.uint16,x.indexOffset,x.indexCount,-x.vertexOffset,-h)){m.flags|=al;break}}}for(let u of this.centroidData)this.writeCentroidToBuffer(u);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let l=!1;for(let u=0;u<i.footprintSegLen;u++){let h=this.footprintSegments[i.footprintSegIdx+u],m=0;for(let y of h.ringIndices){for(let x=m,w=y+m-1;x<y+m;w=x++){let T=this.footprintVertices.int16[2*(x+h.vertexOffset)+0],D=this.footprintVertices.int16[2*(x+h.vertexOffset)+1],S=this.footprintVertices.int16[2*(w+h.vertexOffset)+1];D>n!=S>n&&e<(this.footprintVertices.int16[2*(w+h.vertexOffset)+0]-T)*(n-D)/(S-D)+T&&(l=!l)}m=y}}return l}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,l=!0,u=4*(e+Ze)*Ze+(n+Ze);if(this.partLookup.hasOwnProperty(u)){let h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&al)}:void 0}for(let h of this.centroidData)e>h.max.x||h.min.x>e||n>h.max.y||h.min.y>n||this.footprintContainsPoint(e,n,h)&&h&&h.height>i&&(i=h.height,this.partLookup[u]=h,l=!!(h.flags&al));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:l};this.partLookup[u]=void 0}}function HD(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function OL(t,e,n,i){let l=e.sub(t)._perp()._unit(),u=n.sub(e)._perp()._unit();return qD(t,e,n,HD(l,u),i)}function qD(t,e,n,i,l){let u=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,l*u/i)}function $0(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function WD(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function ZD(t,e,n){if(t.x<0||t.x>=Ze||e.x<0||e.x>=Ze||n.x<0||n.x>=Ze)return!1;let i=n.sub(e),l=i.perp(),u=t.sub(e);return(i.x*u.x+i.y*u.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(u.x*u.x+u.y*u.y))>-.866&&l.x*u.x+l.y*u.y<0}function XD(t,e,n){let i=e?2|t:-3&t;return n?1|i:-2&i}function YD(){let t=Math.PI/32,e=Math.tan(t),n=Jd;return n*Math.sqrt(1+2*e*e)-n}function JD(t,e,n){let i=1<<n.z,l=Oi(n.x/i),u=Oi((n.x+1)/i),h=$r(n.y/i),m=$r((n.y+1)/i);return function(y,x,w,T,D=0,S){let A=[];if(!y.length||!w||!T)return A;let P=(ee,le)=>{for(let he of ee)A.push({polygon:he,bounds:le})},k=Math.ceil(Math.log2(w)),N=Math.ceil(Math.log2(T)),H=k-N,q=[];for(let ee=0;ee<Math.abs(H);ee++)q.push(H>0?0:1);for(let ee=0;ee<Math.min(k,N);ee++)q.push(0),q.push(1);let Z=y;if(Z=qm(Z,x[0].y-D,x[1].y+D,1),Z=qm(Z,x[0].x-D,x[1].x+D,0),!Z.length)return A;let K=[];for(q.length?K.push({polygons:Z,bounds:x,depth:0}):P(Z,x);K.length;){let ee=K.pop(),le=ee.depth,he=q[le],fe=ee.bounds[0],xe=ee.bounds[1],_e=he===0?fe.x:fe.y,Me=he===0?xe.x:xe.y,Be=S?S(he,_e,Me):.5*(_e+Me),Te=qm(ee.polygons,_e-D,Be+D,he),ke=qm(ee.polygons,Be-D,Me+D,he);if(Te.length){let Ee=[fe,new Ue(he===0?Be:xe.x,he===1?Be:xe.y)];q.length>le+1?K.push({polygons:Te,bounds:Ee,depth:le+1}):P(Te,Ee)}if(ke.length){let Ee=[new Ue(he===0?Be:fe.x,he===1?Be:fe.y),xe];q.length>le+1?K.push({polygons:ke,bounds:Ee,depth:le+1}):P(ke,Ee)}}return A}(t,e,Math.ceil((u-l)/11.25),Math.ceil((h-m)/11.25),1,(y,x,w)=>{if(y===0)return .5*(x+w);{let T=$r((n.y+x/Ze)/i);return(Ts(.5*($r((n.y+w/Ze)/i)+T))*i-n.y)*Ze}})}function kL(t,e,n,i,l,u){let h=Math.pow(2,i.z-l.z);for(let m=0;m<n;m++){let y=t.int16[2*(m+e)+0],x=t.int16[2*(m+e)+1];y=(y+l.x*Ze)*h-i.x*Ze,x=(x+l.y*Ze)*h-i.y*Ze,u.push(new Ue(y,x))}}it(gf,"FillExtrusionBucket",{omit:["layers","features"]}),it(VD,"PartData"),it(jD,"FootprintSegment"),it(UD,"BorderCentroidData"),it(GD,"GroundEffect");let LL=new Re({visibility:new Q(ye["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Q(ye["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var FL={paint:new Re({"fill-extrusion-opacity":new Q(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new me(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Q(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Q(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new me(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new me(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new me(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Q(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Q(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Q(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Q(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Q(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Q(ye["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Q(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Q(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new me(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new me(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Q(ye["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Q(ye["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Q(ye["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Q(ye["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Q(ye["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:LL};class Xu extends Ue{constructor(e,n,i){super(e,n),this.z=i}}function _f(t,e){return t.x*e.x+t.y*e.y}function KD(t,e){if(t.length===1){let n=0,i=e[n++],l;for(;!l||i.equals(l);)if(l=e[n++],!l)return 1/0;for(;n<e.length;n++){let u=e[n],h=t[0],m=l.sub(i),y=u.sub(i),x=h.sub(i),w=_f(m,m),T=_f(m,y),D=_f(y,y),S=_f(x,m),A=_f(x,y),P=w*D-T*T,k=(D*S-T*A)/P,N=(w*A-T*S)/P,H=i.z*(1-k-N)+l.z*k+u.z*N;if(isFinite(H))return H}return 1/0}{let n=1/0;for(let i of e)n=Math.min(n,i.z);return n}}function QD(t,e,n,i,l,u,h,m){let y=h*l.getElevationAt(t,e,!0,!0),x=u[0]!==0,w=x?u[1]===0?h*(u[0]/7-450):h*function(T,D,S){let A=Math.floor(D[0]/8),P=Math.floor(D[1]/8),k=10*(D[0]-8*A),N=10*(D[1]-8*P),H=T.getElevationAt(A,P,!0,!0),q=T.getMeterToDEM(S),Z=Math.floor(.5*(k*q-1)),K=Math.floor(.5*(N*q-1)),ee=T.tileCoordToPixel(A,P),le=2*Z+1,he=2*K+1,fe=function(ke,Ee,Je,rt,Ne){return[ke.getElevationAtPixel(Ee,Je,!0),ke.getElevationAtPixel(Ee+Ne,Je,!0),ke.getElevationAtPixel(Ee,Je+Ne,!0),ke.getElevationAtPixel(Ee+rt,Je+Ne,!0)]}(T,ee.x-Z,ee.y-K,le,he),xe=Math.abs(fe[0]-fe[1]),_e=Math.abs(fe[2]-fe[3]),Me=Math.abs(fe[0]-fe[2])+Math.abs(fe[1]-fe[3]),Be=Math.min(.25,.5*q*(xe+_e)/le),Te=Math.min(.25,.5*q*Me/he);return H+Math.max(Be*k,Te*N)}(l,u,m):y;return{base:y+(n===0)?-1:n,top:x?Math.max(w+i,y+n+2):y+i}}let NL=new Re({"line-cap":new me(ye.layout_line["line-cap"]),"line-join":new me(ye.layout_line["line-join"]),"line-miter-limit":new Q(ye.layout_line["line-miter-limit"]),"line-round-limit":new Q(ye.layout_line["line-round-limit"]),"line-sort-key":new me(ye.layout_line["line-sort-key"]),visibility:new Q(ye.layout_line.visibility)});var eM={paint:new Re({"line-opacity":new me(ye.paint_line["line-opacity"]),"line-color":new me(ye.paint_line["line-color"]),"line-translate":new Q(ye.paint_line["line-translate"]),"line-translate-anchor":new Q(ye.paint_line["line-translate-anchor"]),"line-width":new me(ye.paint_line["line-width"]),"line-gap-width":new me(ye.paint_line["line-gap-width"]),"line-offset":new me(ye.paint_line["line-offset"]),"line-blur":new me(ye.paint_line["line-blur"]),"line-dasharray":new me(ye.paint_line["line-dasharray"]),"line-pattern":new me(ye.paint_line["line-pattern"]),"line-gradient":new Le(ye.paint_line["line-gradient"]),"line-trim-offset":new Q(ye.paint_line["line-trim-offset"]),"line-emissive-strength":new Q(ye.paint_line["line-emissive-strength"]),"line-border-width":new me(ye.paint_line["line-border-width"]),"line-border-color":new me(ye.paint_line["line-border-color"])}),layout:NL};function tM(t,e){return 1/TD(t,1,e.tileZoom)}function nM(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let rM=t=>{let e=[];iM(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function iM(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let oM=new class extends me{possiblyEvaluate(t,e){return e=new ae(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=Tr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(eM.paint.properties["line-width"].specification);function sM(t,e){return e>0?e+2*t:t}oM.useIntegerZoom=!0;let zL=new Re({visibility:new Q(ye.layout_background.visibility)});var BL={paint:new Re({"background-color":new Q(ye.paint_background["background-color"]),"background-pattern":new Q(ye.paint_background["background-pattern"]),"background-opacity":new Q(ye.paint_background["background-opacity"]),"background-emissive-strength":new Q(ye.paint_background["background-emissive-strength"])}),layout:zL};let jL=new Re({visibility:new Q(ye.layout_raster.visibility)});var VL={paint:new Re({"raster-opacity":new Q(ye.paint_raster["raster-opacity"]),"raster-color":new Le(ye.paint_raster["raster-color"]),"raster-color-mix":new Q(ye.paint_raster["raster-color-mix"]),"raster-color-range":new Q(ye.paint_raster["raster-color-range"]),"raster-hue-rotate":new Q(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Q(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Q(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new Q(ye.paint_raster["raster-saturation"]),"raster-contrast":new Q(ye.paint_raster["raster-contrast"]),"raster-resampling":new Q(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new Q(ye.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Q(ye.paint_raster["raster-emissive-strength"]),"raster-array-band":new Q(ye.paint_raster["raster-array-band"]),"raster-elevation":new Q(ye.paint_raster["raster-elevation"])}),layout:jL};function wg(t,e,n,i,l,u,h,m){let y=[t,e,1,n,i,1,l,u,1],x=[h,m,1],w=r.bx.adjoint([],y),[T,D,S]=r.v.transformMat3(x,x,w);return r.bx.multiply(y,y,[T,0,0,0,D,0,0,0,S])}function aM(t,e,n,i,l,u,h,m){let y=function(x,w,T,D,S,A,P,k){let N=wg(0,0,1,0,1,1,0,1),H=wg(x,w,T,D,S,A,P,k),q=r.bx.adjoint([],N);return r.bx.multiply(H,H,q)}(t,e,n,i,l,u,h,m);return[y[2]/y[8]/Ze,y[5]/y[8]/Ze]}function Eg(t){return[t[0],Math.min(Math.max(t[1],-ar),ar)]}class lM extends uo{constructor(e,n,i,l){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(l),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Wi("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ae(this.map._requestManager.transformRequest(this.url,kr.Image),(i,l)=>{this._imageRequest=null,this._loaded=!0,i?this.fire(new Zs(i)):l&&(this.image=l instanceof HTMLImageElement?Xr.getImageData(l):l,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new dg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Wi("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof dg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(let u of e)u[1]>i&&(i=u[1]),u[1]<n&&(n=u[1]);let l=(i+n)/2;if(l>ar?this.onNorthPole=!0:l<-ar&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let u=e.map(Hr.fromLngLat);this.tileID=function(h){let m=1/0,y=1/0,x=-1/0,w=-1/0;for(let P of h)m=Math.min(m,P.x),y=Math.min(y,P.y),x=Math.max(x,P.x),w=Math.max(w,P.y);let T=Math.max(x-m,w-y),D=Math.max(0,Math.floor(-Math.log(T)/Math.LN2)),S=Math.pow(2,D),A=Math.floor((m+x)/2*S);return A>1&&(A-=1),new ic(D,A,Math.floor((y+w)/2*S))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Wi("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(let k in this.tiles){let N=this.tiles[k];N.state!=="loaded"&&(N.state="loaded",N.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;let n=nl(new ic(0,0,0),this.map.transform.projection),i=[n.projection.project(this.coordinates[0][0],this.coordinates[0][1]),n.projection.project(this.coordinates[1][0],this.coordinates[1][1]),n.projection.project(this.coordinates[2][0],this.coordinates[2][1]),n.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(k){let N=k[1].x-k[0].x,H=k[1].y-k[0].y,q=k[2].x-k[1].x,Z=k[2].y-k[1].y,K=k[3].x-k[2].x,ee=k[3].y-k[2].y,le=k[0].x-k[3].x,he=k[0].y-k[3].y,fe=N*Z-q*H,xe=q*ee-K*Z,_e=K*he-le*ee,Me=le*H-N*he;return fe>0&&xe>0&&_e>0&&Me>0||fe<0&&xe<0&&_e<0&&Me<0}(i))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);let l=nl(this.tileID,this.map.transform.projection),[u,h,m,y]=this.coordinates.map(k=>{let N=l.projection.project(k[0],k[1]);return uD(l,N)._round()});this.perspectiveTransform=aM(u.x,u.y,h.x,h.y,m.x,m.y,y.x,y.y);let x=this._boundsArray=new xn;x.emplaceBack(u.x,u.y,0,0),x.emplaceBack(h.x,h.y,Ze,0),x.emplaceBack(y.x,y.y,0,Ze),x.emplaceBack(m.x,m.y,Ze,Ze),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(x,pg.members),this.boundsSegments=Xn.simpleSegment(0,0,4,2);let w=[],T=function(k){return[Eg(k[0]),Eg(k[1]),Eg(k[2]),Eg(k[3])]}(this.coordinates),[D,S,A,P]=function(k){let N=k[0][0],H=N,q=k[0][1],Z=q;for(let K=1;K<k.length;K++)k[K][0]<N?N=k[K][0]:k[K][0]>H&&(H=k[K][0]),k[K][1]<q?q=k[K][1]:k[K][1]>Z&&(Z=k[K][1]);return[N,q,H-N,Z-q]}(T);{let k=new xn,[N,H,q,Z]=function(Ee){let Je=Ee[0].x,rt=Je,Ne=Ee[0].y,wt=Ne;for(let st=1;st<Ee.length;st++)Ee[st].x<Je?Je=Ee[st].x:Ee[st].x>rt&&(rt=Ee[st].x),Ee[st].y<Ne?Ne=Ee[st].y:Ee[st].y>wt&&(wt=Ee[st].y);return[Je,Ne,rt-Je,wt-Ne]}(i),K=Ee=>[(Ee.x-N)/q,(Ee.y-H)/Z],[ee,le,he,fe]=i.map(K),xe=function(Ee,Je,rt,Ne,wt,st,Ye,Et){let ft=wg(0,0,1,0,1,1,0,1),yt=wg(Ee,Je,rt,Ne,wt,st,Ye,Et),He=r.bx.adjoint([],yt);return r.bx.multiply(ft,ft,He)}(ee[0],ee[1],le[0],le[1],he[0],he[1],fe[0],fe[1]);this.elevatedGlobePerspectiveTransform=aM(ee[0],ee[1],le[0],le[1],he[0],he[1],fe[0],fe[1]);let _e=(Ee,Je)=>{w.push(Ee.lng);let rt=Math.round((Ee.lng-D)/A*Ze),Ne=Math.round((Ee.lat-S)/P*Ze),wt=K(Je),st=r.v.transformMat3([],[wt[0],wt[1],1],xe),Ye=Math.round(st[0]/st[2]*Ze),Et=Math.round(st[1]/st[2]*Ze);k.emplaceBack(rt,Ne,Ye,Et)},Me=i[3].x-i[0].x,Be=i[3].y-i[0].y,Te=i[2].x-i[1].x,ke=i[2].y-i[1].y;for(let Ee=0;Ee<65;Ee++){let Je=Ee/64,rt=[i[0].x+Je*Me,i[0].y+Je*Be],Ne=[i[1].x+Je*Te,i[1].y+Je*ke],wt=Ne[0]-rt[0],st=Ne[1]-rt[1];for(let Ye=0;Ye<65;Ye++){let Et=Ye/64,ft={x:rt[0]+wt*Et,y:rt[1]+st*Et,z:0};_e(n.projection.unproject(ft.x,ft.y),ft)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(k,pg.members)}{this.maxLongitudeTriangleSize=0;let k=[],N=new En,H=(q,Z,K)=>{N.emplaceBack(q,Z,K);let ee=w[q],le=w[Z],he=w[K],fe=Math.min(Math.min(ee,le),he),xe=Math.max(Math.max(ee,le),he)-fe;xe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=xe),k.push(fe+xe/2)};for(let q=0;q<64;q++)for(let Z=0;Z<64;Z++){let K=65*q+Z,ee=K+1,le=K+65,he=le+1;H(K,le,ee),H(ee,le,he)}[k,N]=function(q,Z){let K=Array.from({length:q.length},(he,fe)=>fe);K.sort((he,fe)=>q[he]-q[fe]);let ee=[],le=new En;for(let he=0;he<K.length;he++){let fe=K[he];ee.push(q[fe]);let xe=3*fe,_e=xe+1;le.emplaceBack(Z.uint16[xe],Z.uint16[_e],Z.uint16[_e+1])}return[ee,le]}(k,N),this.elevatedGlobeTrianglesCenterLongitudes=k,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(N)}this.elevatedGlobeSegments=Xn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,A/Ze,0,P/Ze,0,0,S,D,0])}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof dg||(this.texture?this.texture.update(this.image):(this.texture=new ba(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){let n=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!n)return null;let i=this.elevatedGlobeTrianglesCenterLongitudes,l=((w,T)=>w+360*Math.round((T-w)/360))(e+180,i[0]),u=new Xn,h=(w,T)=>{u.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:n.segments[0].vertexLength,primitiveLength:T,sortKey:void 0,vaos:{}})},m=.51*this.maxLongitudeTriangleSize;if(Math.abs(i[0]-l)<=m){let w=Tt(i,0,i.length,l+m);return w===i.length||h(w,je(i,w+1,i.length,l+360-m)-w),u}l<i[0]&&(l+=360);let y=je(i,0,i.length,l-m);if(y===i.length)return h(0,i.length),u;h(0,y-0);let x=Tt(i,y+1,i.length,l+m);return x!==i.length&&h(x,i.length-x),u}}class UL extends tt{constructor(e,n){super(e,{},n),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let $L=new Re({visibility:new Q(ye.layout_sky.visibility)});var GL={paint:new Re({"sky-type":new Q(ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new Q(ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Q(ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Q(ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Q(ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Le(ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Q(ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Q(ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Q(ye.paint_sky["sky-opacity"])}),layout:$L};function G0(t,e,n){let i=[0,0,1],l=r.q.identity([]);return r.q.rotateY(l,l,n?-gt(t)+Math.PI:gt(t)),r.q.rotateX(l,l,-gt(e)),r.v.transformQuat(i,i,l),r.v.normalize(i,i)}var HL={paint:new Re({})};let qL={circle:class extends tt{constructor(t,e,n){super(t,wO,e,n)}createBucket(t){return new a0(t)}queryRadius(t){let e=t;return Fu("circle-radius",this,e)+Fu("circle-stroke-width",this,e)+Fm(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,l,u,h,m){let y=uI(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),x=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return dI(t,i,u,h,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,x)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=hI(this);return{config:new tc(this,e),defines:n,overrideFog:!1}}},heatmap:class extends tt{createBucket(t){return new pI(t)}constructor(t,e,n){super(t,SO,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Nm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Fu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,l,u,h,m){let y=this.paint.get("heatmap-radius").evaluate(e,n);return dI(t,i,u,h,m,!0,!0,new Ue(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new tc(this,e),overrideFog:!1}:{}}},hillshade:class extends tt{constructor(t,e,n){super(t,AO,e,n)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends tt{constructor(t,e,n){super(t,GO,e,n)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new tc(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new $m(t)}queryRadius(){return Fm(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,l,u){return!t.queryGeometry.isAboveHorizon&&oI(cI(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends tt{constructor(t,e,n){super(t,FL,e,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new gf(t)}queryRadius(){return Fm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,l,u,h,m,y){let x=uI(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,n),T=this.paint.get("fill-extrusion-base").evaluate(e,n),D=[0,0],S=m&&u.elevation,A=u.elevation?u.elevation.exaggeration():1,P=t.tile.getBucket(this);if(S&&P instanceof gf){let Z=P.centroidVertexArray,K=y+1;K<Z.length&&(D[0]=Z.geta_centroid_pos0(K),D[1]=Z.geta_centroid_pos1(K))}if(D[0]===0&&D[1]===1)return!1;u.projection.name==="globe"&&(i=JD([i],[new Ue(0,0),new Ue(Ze,Ze)],t.tileID.canonical).map(Z=>Z.polygon).flat());let k=S?m:null,[N,H]=function(Z,K,ee,le,he,fe,xe,_e,Me,Be,Te){return Z.projection.name==="globe"?function(ke,Ee,Je,rt,Ne,wt,st,Ye,Et,ft,yt){let He=[],At=[],en=ke.projection.upVectorScale(yt,ke.center.lat,ke.worldSize).metersToTile,Ft=[0,0,0,1],Xt=[0,0,0,1],un=(Ut,Gn,On,_n)=>{Ut[0]=Gn,Ut[1]=On,Ut[2]=_n,Ut[3]=1},Pn=YD();Je>0&&(Je+=Pn),rt+=Pn;for(let Ut of Ee){let Gn=[],On=[];for(let _n of Ut){let bn=_n.x+Ne.x,hn=_n.y+Ne.y,er=ke.projection.projectTilePoint(bn,hn,yt),Hn=ke.projection.upVector(yt,_n.x,_n.y),lr=Je,Cr=rt;if(st){let mi=QD(bn,hn,Je,rt,st,Ye,Et,ft);lr+=mi.base,Cr+=mi.top}Je!==0?un(Ft,er.x+Hn[0]*en*lr,er.y+Hn[1]*en*lr,er.z+Hn[2]*en*lr):un(Ft,er.x,er.y,er.z),un(Xt,er.x+Hn[0]*en*Cr,er.y+Hn[1]*en*Cr,er.z+Hn[2]*en*Cr),r.v.transformMat4(Ft,Ft,wt),r.v.transformMat4(Xt,Xt,wt),Gn.push(new Xu(Ft[0],Ft[1],Ft[2])),On.push(new Xu(Xt[0],Xt[1],Xt[2]))}He.push(Gn),At.push(On)}return[He,At]}(Z,K,ee,le,he,fe,xe,_e,Me,Be,Te):xe?function(ke,Ee,Je,rt,Ne,wt,st,Ye,Et){let ft=[],yt=[],He=[0,0,0,1];for(let At of ke){let en=[],Ft=[];for(let Xt of At){let un=Xt.x+rt.x,Pn=Xt.y+rt.y,Ut=QD(un,Pn,Ee,Je,wt,st,Ye,Et);He[0]=un,He[1]=Pn,He[2]=Ut.base,He[3]=1,r.e.transformMat4(He,He,Ne),He[3]=Math.max(He[3],1e-5);let Gn=new Xu(He[0]/He[3],He[1]/He[3],He[2]/He[3]);He[0]=un,He[1]=Pn,He[2]=Ut.top,He[3]=1,r.e.transformMat4(He,He,Ne),He[3]=Math.max(He[3],1e-5);let On=new Xu(He[0]/He[3],He[1]/He[3],He[2]/He[3]);en.push(Gn),Ft.push(On)}ft.push(en),yt.push(Ft)}return[ft,yt]}(K,ee,le,he,fe,xe,_e,Me,Be):function(ke,Ee,Je,rt,Ne){let wt=[],st=[],Ye=Ne[8]*Ee,Et=Ne[9]*Ee,ft=Ne[10]*Ee,yt=Ne[11]*Ee,He=Ne[8]*Je,At=Ne[9]*Je,en=Ne[10]*Je,Ft=Ne[11]*Je;for(let Xt of ke){let un=[],Pn=[];for(let Ut of Xt){let Gn=Ut.x+rt.x,On=Ut.y+rt.y,_n=Ne[0]*Gn+Ne[4]*On+Ne[12],bn=Ne[1]*Gn+Ne[5]*On+Ne[13],hn=Ne[2]*Gn+Ne[6]*On+Ne[14],er=Ne[3]*Gn+Ne[7]*On+Ne[15],Hn=_n+Ye,lr=bn+Et,Cr=hn+ft,mi=Math.max(er+yt,1e-5),fr=_n+He,ir=bn+At,ti=hn+en,ni=Math.max(er+Ft,1e-5);un.push(new Xu(Hn/mi,lr/mi,Cr/mi)),Pn.push(new Xu(fr/ni,ir/ni,ti/ni))}wt.push(un),st.push(Pn)}return[wt,st]}(K,ee,le,he,fe)}(u,i,T,w,x,h,k,D,A,u.center.lat,t.tileID.canonical),q=t.queryGeometry;return function(Z,K,ee){let le=1/0;oI(ee,K)&&(le=KD(ee,K[0]));for(let he=0;he<K.length;he++){let fe=K[he],xe=Z[he];for(let _e=0;_e<fe.length-1;_e++){let Me=fe[_e],Be=[Me,fe[_e+1],xe[_e+1],xe[_e],Me];iI(ee,Be)&&(le=Math.min(le,KD(ee,Be)))}}return le!==1/0&&le}(N,H,q.isPointQuery()?q.screenBounds:q.screenGeometry)}},line:class extends tt{constructor(t,e,n){super(t,eM,e,n),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof gd,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=oM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new hg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=rM(this);return{config:new tc(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=sM(Fu("line-width",this,e),Fu("line-gap-width",this,e)),i=Fu("line-offset",this,e);return n/2+Math.abs(i)+Fm(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,l,u){if(t.queryGeometry.isAboveHorizon)return!1;let h=cI(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*sM(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),y=this.paint.get("line-offset").evaluate(e,n);return y&&(i=function(x,w){let T=[],D=new Ue(0,0);for(let S=0;S<x.length;S++){let A=x[S],P=[];for(let k=0;k<A.length;k++){let N=A[k],H=A[k+1],q=k===0?D:N.sub(A[k-1])._unit()._perp(),Z=k===A.length-1?D:H.sub(N)._unit()._perp(),K=q._add(Z)._unit();K._mult(1/(K.x*Z.x+K.y*Z.y)),P.push(K._mult(w)._add(N))}T.push(P)}return T}(i,y*t.pixelToTileUnitsFactor)),function(x,w,T){for(let D=0;D<w.length;D++){let S=w[D];if(x.length>=3){for(let A=0;A<S.length;A++)if(ac(x,S[A]))return!0}if(yO(x,S,T))return!0}return!1}(h,i,m)}isTileClipped(){return!0}},symbol:og,background:class extends tt{constructor(t,e,n){super(t,BL,e,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends tt{constructor(t,e,n){super(t,VL,e,n),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof lM)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Nm({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends tt{constructor(t,e,n){super(t,GL,e,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Nm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let i=this.paint.get("sky-atmosphere-sun"),l=!i,u=t.style.light,h=u.properties.get("position");return l&&u.properties.get("anchor")==="viewport"&&Zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),l?G0(h.azimuthal,90-h.polar,e):G0(i[0],90-i[1],e)}let n=this.paint.get("sky-gradient-center");return G0(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends tt{constructor(t,e,n){super(t,HL,e)}},model:class extends tt{constructor(t,e,n){super(t,wL,e,n)}createBucket(t){return new CD(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Zl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class WL{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ZL{constructor(){this.tasks={},this.taskQueue=[],Pa(["process"],this),this.invoker=new WL(this.process),this.nextId=0}add(e,n){let i=this.nextId++,l=function({type:u,isSymbolTile:h,zoom:m}){return m=m||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-m:u==="maybePrepare"&&h?400-m:500:200-m:100-m}(n);if(l===0){pe();try{e()}finally{}return null}return this.tasks[i]={fn:e,metadata:n,priority:l,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){pe();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let l=0;l<this.taskQueue.length;l++){let u=this.tasks[this.taskQueue[l]];u.priority<n&&(n=u.priority,e=l)}if(e===null)return null;let i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class cM{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Pa(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ZL}send(e,n,i,l,u=!1,h){let m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=h,this.callbacks[m]=i);let y=new Set;return this.target.postMessage({id:m,type:e,hasCallback:!!i,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:c(n,y)},y),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){let n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(n.mustQueue||pe()){let l=this.callbacks[i],u=this.scheduler.add(()=>this.processTask(i,n),l&&l.metadata||{type:"message"});u&&(this.cancelCallbacks[i]=u)}else this.processTask(i,n)}processTask(e,n){if(delete this.cancelCallbacks[e],n.type==="<response>"){let i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(g(n.error)):i(null,g(n.data)))}else{let i=new Set,l=n.hasCallback?(h,m)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?c(h):null,data:c(m,i)},i)}:h=>{},u=g(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,u,l);else if(this.parent.getWorkerSource){let h=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,h[0],u.source,u.scope)[h[1]](u,l)}else l(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let uM=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Ra();let l=this.workerPool.acquire(this.id);for(let u=0;u<l.length;u++){let h=new t.Actor(l[u],i,this.id);h.name=`Worker ${u}`,this.actors.push(h)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,l){vi(this.actors,(u,h)=>{u.send(n,i,h)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=cM,t})();class hM{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new ya({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let i=this.getKey(e,n);return this.positions[i]}trim(){let e=this.width,n=this.height=Hs(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){let l=[],u=e.length%2==1?-e[e.length-1]*i:0,h=e[0]*i,m=!0;l.push({left:u,right:h,isDash:m,zeroLength:e[0]===0});let y=e[0];for(let x=1;x<e.length;x++){m=!m;let w=e[x];u=y*i,y+=w,h=y*i,l.push({left:u,right:h,isDash:m,zeroLength:w===0})}return l}addRoundDash(e,n,i){let l=n/2;for(let u=-i;u<=i;u++){let h=this.width*(this.nextRow+i+u),m=0,y=e[m];for(let x=0;x<this.width;x++){x/y.right>1&&(y=e[++m]);let w=Math.abs(x-y.left),T=Math.abs(x-y.right),D=Math.min(w,T),S,A=u/i*(l+1);if(y.isDash){let P=l-Math.abs(A);S=Math.sqrt(D*D+P*P)}else S=l-Math.sqrt(D*D+A*A);this.image.data[h+x]=Math.max(0,Math.min(255,S+128))}}}addRegularDash(e,n){for(let y=e.length-1;y>=0;--y){let x=e[y],w=e[y+1];x.zeroLength?e.splice(y,1):w&&w.isDash===x.isDash&&(w.left=x.left,e.splice(y,1))}let i=e[0],l=e[e.length-1];i.isDash===l.isDash&&(i.left=l.left-this.width,l.right=i.right+this.width);let u=this.width*this.nextRow,h=0,m=e[h];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++h]);let x=Math.abs(y-m.left),w=Math.abs(y-m.right),T=Math.min(x,w);this.image.data[u+y]=Math.max(0,Math.min(255,(m.isDash?T:-T)+n+128))}}addDash(e,n){let i=this.getKey(e,n);if(this.positions[i])return this.positions[i];let l=n==="round",u=l?7:0,h=2*u+1;if(this.nextRow+h>this.height)return Zn("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let w=0;w<e.length;w++)e[w]<0&&(Zn("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),m+=e[w];if(m!==0){let w=this.width/m,T=this.getDashRanges(e,this.width,w);l?this.addRoundDash(T,w,u):this.addRegularDash(T,n==="square"?.5*w:0)}let y=this.nextRow+u;this.nextRow+=h;let x={tl:[y,u],br:[m,0]};return this.positions[i]=x,x}}it(hM,"LineAtlas");let dM=1*Uo;class fM{constructor(e){let n={},i=[];for(let m in e){let y=e[m],x=n[m]={};for(let w in y.glyphs){let T=y.glyphs[+w];if(!T||T.bitmap.width===0||T.bitmap.height===0)continue;let D=T.metrics.localGlyph?dM:1,S={x:0,y:0,w:T.bitmap.width+2*D,h:T.bitmap.height+2*D};i.push(S),x[w]=S}}let{w:l,h:u}=D0(i),h=new ya({width:l||1,height:u||1});for(let m in e){let y=e[m];for(let x in y.glyphs){let w=y.glyphs[+x];if(!w||w.bitmap.width===0||w.bitmap.height===0)continue;let T=n[m][x],D=w.metrics.localGlyph?dM:1;ya.copy(w.bitmap,h,{x:0,y:0},{x:T.x+D,y:T.y+D},w.bitmap)}}this.image=h,this.positions=n}}it(fM,"GlyphAtlas");class XL{constructor(e){this.tileID=new zr(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=nl(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,i,l,u){this.status="parsing",this.data=e,this.collisionBoxArray=new Iv;let h=new II(Object.keys(e.layers).sort()),m=new b0(this.tileID,this.promoteId);m.bucketLayerIDs=[];let y={},x=new hM(256,256),w={featureIndex:m,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:x,availableImages:i,brightness:this.brightness},T=n.familiesBySource[this.source];for(let H in T){let q=e.layers[H];if(!q)continue;let Z=!1,K=!1,ee=!1;for(let fe of T[H])fe[0].type==="symbol"?Z=!0:K=!0,fe[0].is3D()&&fe[0].type!=="model"&&(ee=!0);if(this.extraShadowCaster&&!ee||this.isSymbolTile===!0&&!Z||this.isSymbolTile===!1&&!K)continue;q.version===1&&Zn(`Vector tile source "${this.source}" layer "${H}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let le=h.encode(H),he=[];for(let fe=0;fe<q.length;fe++){let xe=q.feature(fe),_e=m.getId(xe,H);he.push({feature:xe,id:_e,index:fe,sourceLayerIndex:le})}for(let fe of T[H]){let xe=fe[0];(!this.extraShadowCaster||xe.is3D()&&xe.type!=="model")&&(this.isSymbolTile!==void 0&&xe.type==="symbol"!==this.isSymbolTile||xe.minzoom&&this.zoom<Math.floor(xe.minzoom)||xe.maxzoom&&this.zoom>=xe.maxzoom||xe.visibility!=="none"&&(H0(fe,this.zoom,w.brightness,i),(y[xe.id]=xe.createBucket({index:m.bucketLayerIDs.length,layers:fe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:le,sourceID:this.source,projection:this.projection.spec})).populate(he,w,this.tileID.canonical,this.tileTransform),m.bucketLayerIDs.push(fe.map(_e=>_e.id))))}}let D,S,A,P;x.trim();let k={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},N=()=>{if(D)return this.status="done",u(D);if(this.extraShadowCaster)this.status="done",u(null,{buckets:$s(y).filter(H=>!H.isEmpty()),featureIndex:m,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:w.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(S&&A&&P){let H=new fM(S),q=new tD(A,P);for(let Z in y){let K=y[Z];K instanceof uf?(H0(K.layers,this.zoom,w.brightness,i),Gk(K,S,H.positions,A,q.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):K.hasPattern&&(K instanceof hg||K instanceof $m||K instanceof gf)&&(H0(K.layers,this.zoom,w.brightness,i),K.addFeatures(w,this.tileID.canonical,q.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",u(null,{buckets:$s(y).filter(Z=>!Z.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:H.image,lineAtlas:x,imageAtlas:q,brightness:w.brightness})}};if(!this.extraShadowCaster){let H=Sl(w.glyphDependencies,K=>Object.keys(K).map(Number));Object.keys(H).length?l.send("getGlyphs",{uid:this.uid,stacks:H,scope:this.scope},(K,ee)=>{D||(D=K,S=ee,N())},void 0,!1,k):S={};let q=Object.keys(w.iconDependencies);q.length?l.send("getImages",{icons:q,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(K,ee)=>{D||(D=K,A=ee,N())},void 0,!1,k):A={};let Z=Object.keys(w.patternDependencies);Z.length?l.send("getImages",{icons:Z,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(K,ee)=>{D||(D=K,P=ee,N())},void 0,!1,k):P={}}N()}}function H0(t,e,n,i){let l=new ae(e,{brightness:n});for(let u of t)u.recalculate(l,i)}class pM{constructor(e){this.entries={},this.scheduler=e}request(e,n,i,l){let u=this.entries[e]=this.entries[e]||{callbacks:[]};if(u.result){let[h,m]=u.result;return this.scheduler?this.scheduler.add(()=>{l(h,m)},n):l(h,m),()=>{}}return u.callbacks.push(l),u.cancel||(u.cancel=i((h,m)=>{u.result=[h,m];for(let y of u.callbacks)this.scheduler?this.scheduler.add(()=>{y(h,m)},n):y(h,m);setTimeout(()=>delete this.entries[e],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(h=>h!==l),u.callbacks.length||(u.cancel(),delete this.entries[e]))}}}function mM(t,e,n){let i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},l=>{let u=Lr(t.request,(h,m,y,x)=>{h?l(h):m&&l(null,{vectorTile:n?void 0:new v0(new Xm(m)),rawData:m,cacheControl:y,expires:x})});return()=>{u.cancel(),l()}},e)}var yf={workerUrl:"",workerClass:null,workerParams:void 0};function YL(){return yf.workerClass!=null?new yf.workerClass:new self.Worker(yf.workerUrl,yf.workerParams)}let q0="mapboxgl_preloaded_worker_pool";class vf{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<vf.workerCount;)this.workers.push(new YL);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[q0]}numActive(){return Object.keys(this.active).length}}let xf;function W0(){return xf||(xf=new vf),xf}vf.workerCount=2;let Tg,Z0,Go,X0=null;function gM(){return pe()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Z0||B.DRACO_URL}let Y0=5123,J0=5126,K0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[Y0]:Uint16Array,5125:Uint32Array,[J0]:Float32Array},JL={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[Y0]:"DT_UINT16",5125:"DT_UINT32",[J0]:"DT_FLOAT32"},Q0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function _M(t,e,n){let i=n.json.bufferViews.length,l=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:l,byteLength:t.byteLength},n.buffers[l]=t}let ex="KHR_draco_mesh_compression";function KL(t,e){let n=t.extensions&&t.extensions[ex];if(!n)return;let i=new Go.Decoder,l=bM(e,n.bufferView),u=new Go.Mesh;if(!i.DecodeArrayToMesh(l,l.byteLength,u))throw new Error("Failed to decode Draco mesh");let h=e.json.accessors[t.indices],m=K0[h.componentType],y=h.count*m.BYTES_PER_ELEMENT,x=Go._malloc(y);m===Uint16Array?i.GetTrianglesUInt16Array(u,y,x):i.GetTrianglesUInt32Array(u,y,x),_M(Go.memory.buffer.slice(x,x+y),h,e),Go._free(x);for(let w of Object.keys(n.attributes)){let T=i.GetAttributeByUniqueId(u,n.attributes[w]),D=e.json.accessors[t.attributes[w]],S=JL[D.componentType],A=D.count*Q0[D.type]*K0[D.componentType].BYTES_PER_ELEMENT,P=Go._malloc(A);i.GetAttributeDataArrayForAllPoints(u,T,Go[S],A,P),_M(Go.memory.buffer.slice(P,P+A),D,e),Go._free(P)}i.destroy(),u.destroy(),delete t.extensions[ex]}let yM=1179937895,vM=new TextDecoder("utf8");function xM(t,e){return new URL(t,e).href}function QL(t,e,n,i){return fetch(xM(t.uri,i)).then(l=>l.arrayBuffer()).then(l=>{e.buffers[n]=l})}function bM(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function eF(t,e,n,i){if(t.uri){let l=xM(t.uri,i);return fetch(l).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[n]=u})}if(t.bufferView!==void 0){let l=bM(e,t.bufferView),u=new Blob([l],{type:t.mimeType});return createImageBitmap(u).then(h=>{e.images[n]=h})}}function wM(t,e=0,n){let i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===yM){let x=new Uint32Array(t,e),w=2,T=(x[w++]>>2)-3,D=x[w++]>>2;if(w++,i.json=JSON.parse(vM.decode(x.subarray(w,w+D))),w+=D,w<T){let S=x[w++];w++;let A=e+(w<<2);i.buffers[0]=t.slice(A,A+S)}}else i.json=JSON.parse(vM.decode(new Uint8Array(t,e)));let{buffers:l,images:u,meshes:h,extensionsUsed:m}=i.json,y=Promise.resolve();if(l){let x=[];for(let w=0;w<l.length;w++){let T=l[w];T.uri?x.push(QL(T,i,w,n)):i.buffers[w]||(i.buffers[w]=null)}y=Promise.all(x)}return y.then(()=>{let x=[],w=m&&m.includes(ex);if(w&&x.push(function(){if(!Go)return Tg||(Tg=function(T){let D,S=null;function A(){D=new Uint8Array(S.buffer)}function P(){throw new Error("Unexpected Draco error.")}let k={a:{a:P,d:function(N,H,q){return D.copyWithin(N,H,H+q)},c:function(N){let H=D.length,q=Math.max(N>>>0,Math.ceil(1.2*H)),Z=Math.ceil((q-H)/65536);try{return S.grow(Z),A(),!0}catch{return!1}},b:P}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(T,k):T.then(N=>N.arrayBuffer()).then(N=>WebAssembly.instantiate(N,k))).then(N=>{let{Rb:H,Qb:q,P:Z,T:K,X:ee,Ja:le,La:he,Qa:fe,Va:xe,Wa:_e,eb:Me,jb:Be,f:Te,e:ke,yb:Ee,zb:Je,Ab:rt,Bb:Ne,Db:wt,Gb:st}=N.instance.exports;S=ke;let Ye=(()=>{let Et=0,ft=0,yt=0,He=0;return At=>{yt&&(H(He),H(Et),ft+=yt,yt=Et=0),Et||(ft+=128,Et=q(ft));let en=At.length+7&-8,Ft=Et;en>=ft&&(yt=en,Ft=He=q(en));for(let Xt=0;Xt<At.length;Xt++)D[Ft+Xt]=At[Xt];return Ft}})();return A(),Te(),{memory:ke,_free:H,_malloc:q,Mesh:class{constructor(){this.ptr=Z()}destroy(){K(this.ptr)}},Decoder:class{constructor(){this.ptr=le()}destroy(){Be(this.ptr)}DecodeArrayToMesh(Et,ft,yt){let He=Ye(Et),At=he(this.ptr,He,ft,yt.ptr);return!!ee(At)}GetAttributeByUniqueId(Et,ft){return{ptr:fe(this.ptr,Et.ptr,ft)}}GetTrianglesUInt16Array(Et,ft,yt){xe(this.ptr,Et.ptr,ft,yt)}GetTrianglesUInt32Array(Et,ft,yt){_e(this.ptr,Et.ptr,ft,yt)}GetAttributeDataArrayForAllPoints(Et,ft,yt,He,At){Me(this.ptr,Et.ptr,ft.ptr,yt,He,At)}},DT_INT8:Ee(),DT_UINT8:Je(),DT_INT16:rt(),DT_UINT16:Ne(),DT_UINT32:wt(),DT_FLOAT32:st()}})}(fetch(gM())),Tg.then(T=>{Go=T,Tg=void 0}))}()),u)for(let T=0;T<u.length;T++)x.push(eF(u[T],i,T,n));return(x.length?Promise.all(x):Promise.resolve()).then(()=>{if(w&&h)for(let{primitives:T}of h)for(let D of T)KL(D,i);return i})})}class EM{constructor(e,n,i){if(this.triangleCount=n.length/3,this.min=new Ue(0,0),this.max=new Ue(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||i===0)return;let l=e.map(w=>w.x),u=e.map(w=>w.y);this.min=new Ue(Math.min(...l),Math.min(...u)),this.max=new Ue(Math.max(...l),Math.max(...u));let h=this.max.sub(this.min);h.x=Math.max(h.x,1),h.y=Math.max(h.y,1);let m=Math.max(h.x,h.y)/i;this.cellsX=Math.max(1,Math.ceil(h.x/m)),this.cellsY=Math.max(1,Math.ceil(h.y/m)),this.xScale=1/m,this.yScale=1/m;let y=[];for(let w=0;w<this.triangleCount;w++){let T=e[n[3*w+0]].sub(this.min),D=e[n[3*w+1]].sub(this.min),S=e[n[3*w+2]].sub(this.min),A=ll(Math.floor(Math.min(T.x,D.x,S.x)),this.xScale,this.cellsX),P=ll(Math.floor(Math.max(T.x,D.x,S.x)),this.xScale,this.cellsX),k=ll(Math.floor(Math.min(T.y,D.y,S.y)),this.yScale,this.cellsY),N=ll(Math.floor(Math.max(T.y,D.y,S.y)),this.yScale,this.cellsY),H=new Ue(0,0),q=new Ue(0,0),Z=new Ue(0,0),K=new Ue(0,0);for(let ee=k;ee<=N;++ee){H.y=q.y=ee*m,Z.y=K.y=(ee+1)*m;for(let le=A;le<=P;++le)H.x=Z.x=le*m,q.x=K.x=(le+1)*m,(u0(T,D,S,H,q,K)||u0(T,D,S,H,K,Z))&&y.push({cellIdx:ee*this.cellsX+le,triIdx:w})}}if(y.length===0)return;y.sort((w,T)=>w.cellIdx-T.cellIdx||w.triIdx-T.triIdx);let x=0;for(;x<y.length;){let w=y[x].cellIdx,T={start:this.payload.length,len:0};for(;x<y.length&&y[x].cellIdx===w;)++T.len,this.payload.push(y[x++].triIdx);this.cells[w]=T}}query(e,n,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let y=0;y<this.lookup.length;y++)this.lookup[y]=0;let l=ll(e.x-this.min.x,this.xScale,this.cellsX),u=ll(n.x-this.min.x,this.xScale,this.cellsX),h=ll(e.y-this.min.y,this.yScale,this.cellsY),m=ll(n.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=m;y++)for(let x=l;x<=u;x++){let w=this.cells[y*this.cellsX+x];if(w)for(let T=0;T<w.len;T++){let D=this.payload[w.start+T],S=Math.floor(D/8),A=1<<D%8;if(!(this.lookup[S]&A)&&(this.lookup[S]|=A,i.push(D),i.length===this.triangleCount))return}}}}function ll(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function dc(t,e){let n=t.json.bufferViews[e.bufferView];return new K0[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*Q0[e.type])}function tF(t,e,n){let i=t.indices,l=t.attributes,u={};u.indexArray=new En;let h=e.json.accessors[i],m=h.count/3;u.indexArray.reserve(m);let y=dc(e,h);for(let D=0;D<m;D++)u.indexArray.emplaceBack(y[3*D],y[3*D+1],y[3*D+2]);u.indexArray._trim(),u.vertexArray=new Ql;let x=e.json.accessors[l.POSITION];u.vertexArray.reserve(x.count);let w=dc(e,x);for(let D=0;D<x.count;D++)u.vertexArray.emplaceBack(w[3*D],w[3*D+1],w[3*D+2]);if(u.vertexArray._trim(),u.aabb=new dr(x.min,x.max),u.centroid=function(D,S){let A=[0,0,0],P=D.length;if(P>0){for(let k=0;k<P;k++){let N=3*D[k];A[0]+=S[N],A[1]+=S[N+1],A[2]+=S[N+2]}A[0]/=P,A[1]/=P,A[2]/=P}return A}(y,w),l.COLOR_0!==void 0){let D=e.json.accessors[l.COLOR_0],S=Q0[D.type];if(D.componentType===J0){u.colorArray=S===3?new Ql:new mn,u.colorArray.reserve(D.count);let A=dc(e,D);if(S===3)for(let P=0;P<D.count;P++)u.colorArray.emplaceBack(A[3*P],A[3*P+1],A[3*P+2]);else for(let P=0;P<D.count;P++)u.colorArray.emplaceBack(A[4*P],A[4*P+1],A[4*P+2],A[4*P+3]);u.colorArray._trim()}else if(D.componentType===Y0&&S===4){u.colorArray=new mn,u.colorArray.resize(D.count);let A=dc(e,D),P=1/65535,k=u.colorArray.float32;for(let N=0;N<4*A.length;++N)k[N]=A[N]*P}else Zn(`glTF color buffer parsing for accessor ${JSON.stringify(D)} is not supported`)}if(l.NORMAL!==void 0){u.normalArray=new Ql;let D=e.json.accessors[l.NORMAL];u.normalArray.reserve(D.count);let S=dc(e,D);for(let A=0;A<D.count;A++)u.normalArray.emplaceBack(S[3*A],S[3*A+1],S[3*A+2]);u.normalArray._trim()}if(l.TEXCOORD_0!==void 0&&n.length>0){u.texcoordArray=new Ud;let D=e.json.accessors[l.TEXCOORD_0];u.texcoordArray.reserve(D.count);let S=dc(e,D);for(let A=0;A<D.count;A++)u.texcoordArray.emplaceBack(S[2*A],S[2*A+1]);u.texcoordArray._trim()}let T=t.material;return u.material=function(D,S){let{emissiveFactor:A=[0,0,0],alphaMode:P="OPAQUE",alphaCutoff:k=.5,normalTexture:N,occlusionTexture:H,emissiveTexture:q,doubleSided:Z}=D,{baseColorFactor:K=[1,1,1,1],metallicFactor:ee=1,roughnessFactor:le=1,baseColorTexture:he,metallicRoughnessTexture:fe}=D.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Vn(...K),metallicFactor:ee,roughnessFactor:le,baseColorTexture:he?S[he.index]:void 0,metallicRoughnessTexture:fe?S[fe.index]:void 0},doubleSided:Z,emissiveFactor:A,alphaMode:P,alphaCutoff:k,normalTexture:N?S[N.index]:void 0,occlusionTexture:H?S[H.index]:void 0,emissionTexture:q?S[q.index]:void 0,defined:D.defined===void 0}}(T!==void 0?e.json.materials[T]:{defined:!1},n),l._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(dc(e,e.json.accessors[l._FEATURE_RGBA4444]).buffer)),u}function TM(t,e,n){let{matrix:i,rotation:l,translation:u,scale:h,mesh:m,extras:y,children:x}=t,w={};if(w.matrix=i||r.m.fromRotationTranslationScale([],l||[0,0,0,1],u||[0,0,0],h||[1,1,1]),m!==void 0){w.meshes=n[m];let T=w.anchor=[0,0];for(let D of w.meshes){let{min:S,max:A}=D.aabb;T[0]+=S[0]+A[0],T[1]+=S[1]+A[1]}T[0]=Math.floor(T[0]/w.meshes.length/2),T[1]=Math.floor(T[1]/w.meshes.length/2)}if(y&&(y.id&&(w.id=y.id),y.lights&&(w.lights=function(T){if(!T.length)return[];let D=function(N){let H=atob(N),q=new Uint8Array(H.length);for(let Z=0;Z<H.length;Z++)q[Z]=H.codePointAt(Z);return q}(T),S=[],A=D.length/24,P=new Uint16Array(D.buffer),k=new Float32Array(D.buffer);for(let N=0;N<A;N++){let H=P[2*N*6]/30,q=P[2*N*6+1]/30,Z=P[2*N*6+10]/100,K=k[6*N+1],ee=k[6*N+2],le=k[6*N+3],he=k[6*N+4],fe=le-K,xe=he-ee,_e=Math.hypot(fe,xe);S.push({pos:[K+.5*fe,ee+.5*xe,q],normal:[xe/_e,-fe/_e,0],width:_e,height:H,depth:Z,points:[K,ee,le,he]})}return S}(y.lights))),x){let T=[];for(let D of x)T.push(TM(e.json.nodes[D],e,n));w.children=T}return w}function nF(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let h=1;h<t.vertices.length;++h){let m=t.vertices[h];e.x=Math.min(e.x,m.x),e.y=Math.min(e.y,m.y),n.x=Math.max(n.x,m.x),n.y=Math.max(n.y,m.y)}let i=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),l=Math.max(8,i),u=new EM(t.vertices,t.indices,l);return{vertices:t.vertices,indices:t.indices,grid:u,min:e,max:n}}function rF(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let i=[];for(let h of n){if(!Array.isArray(h)||h.length!==2)continue;let m=h[0],y=h[1];typeof m=="number"&&typeof y=="number"&&i.push(new Ue(m,y))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let l=0;for(let h=0;h<i.length;h++){let m=i[h],y=i[(h+1)%i.length],x=i[(h+2)%i.length];l+=(m.x-y.x)*(x.y-y.y)-(x.x-y.x)*(m.y-y.y)}l>0&&i.reverse();let u=Um(i.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:i,indices:u}}function iF(t){let e=[],n=[],i=0;for(let l of t){i=e.length;let u=l.vertexArray.float32,h=l.indexArray.uint16;for(let m=0;m<l.vertexArray.length;m++)e.push(new Ue(u[3*m+0],u[3*m+1]));for(let m=0;m<3*l.indexArray.length;m++)n.push(h[m]+i)}if(n.length%3!=0)return null;for(let l=0;l<n.length;l+=3){let u=e[n[l+0]],h=e[n[l+1]],m=e[n[l+2]];(u.x-h.x)*(m.y-h.y)-(m.x-h.x)*(u.y-h.y)>0&&([n[l+1],n[l+2]]=[n[l+2],n[l+1]])}return{vertices:e,indices:n}}function IM(t){let e=function(y,x){let w=[],T=WebGL2RenderingContext;if(y.json.textures)for(let D of y.json.textures){let S={magFilter:T.LINEAR,minFilter:T.NEAREST,wrapS:T.REPEAT,wrapT:T.REPEAT};D.sampler!==void 0&&Object.assign(S,y.json.samplers[D.sampler]),w.push({image:x[D.source],sampler:S,uploaded:!1})}return w}(t,t.images),n=function(y,x){let w=[];for(let T of y.json.meshes){let D=[];for(let S of T.primitives)D.push(tF(S,y,x));w.push(D)}return w}(t,e),{scenes:i,scene:l,nodes:u}=t.json,h=i?i[l||0].nodes:u,m=[];for(let y of h)m.push(TM(u[y],t,n));return function(y,x,w){let T={},D=new Set;for(let S=0;S<y.length;S++){let A=w[x[S]];if(!A.extras)continue;let P=A.extras["mapbox:footprint:version"],k=A.extras["mapbox:footprint:id"];(P||k)&&D.add(S),P==="1.0.0"&&k&&(T[k]=S)}for(let S=0;S<y.length;S++){if(D.has(S))continue;let A=y[S],P=w[x[S]];if(!P.extras)continue;let k=null;A.id in T&&(k=iF(y[T[A.id]].meshes)),k||(k=rF(P)),k&&(A.footprint=nF(k))}if(D.size>0){let S=Array.from(D.values()).sort((A,P)=>A-P);for(let A=S.length-1;A>=0;A--)y.splice(S[A],1)}}(m,h,t.json.nodes),m}function oF(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,l=uc/(t.aabb.max[0]-n+2),u=uc/(t.aabb.max[1]-i+2);for(let h=0;h<e.length;h+=3){let m=e[h+2],y=(e[h+0]-n)*l|0,x=(e[h+1]-i)*u|0;m>t.heightmap[x*uc+y]&&(t.heightmap[x*uc+y]=m)}}function sF(t,e){let n={};n.indexArray=new En,n.indexArray.reserve(4*t.length),n.vertexArray=new Ql,n.vertexArray.reserve(10*t.length),n.colorArray=new mn,n.vertexArray.reserve(10*t.length);let i=0;for(let h of t){let m=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],x=Math.min(.29,.1*h.width/h.depth),w=h.width-2*h.depth*e*(x+.01),T=r.v.scaleAndAdd([],h.pos,y,w/2),D=r.v.scaleAndAdd([],h.pos,y,-w/2),S=[T[0],T[1],T[2]+h.height],A=[D[0],D[1],D[2]+h.height],P=r.v.scaleAndAdd([],h.normal,y,x);r.v.scale(P,P,m);let k=r.v.scaleAndAdd([],h.normal,y,-x);r.v.scale(k,k,m),r.v.add(P,T,P),r.v.add(k,D,k),T[2]+=.1,D[2]+=.1,n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(S[0],S[1],S[2]),n.vertexArray.emplaceBack(A[0],A[1],A[2]),n.vertexArray.emplaceBack(T[0],T[1],T[2]),n.vertexArray.emplaceBack(D[0],D[1],D[2]),n.vertexArray.emplaceBack(P[0],P[1],P[2]),n.vertexArray.emplaceBack(k[0],k[1],k[2]);let N=w/m/2;n.colorArray.emplaceBack(-N-x,-1,N,.8),n.colorArray.emplaceBack(N+x,-1,N,.8),n.colorArray.emplaceBack(-N,0,N,1.3),n.colorArray.emplaceBack(N,0,N,1.3),n.colorArray.emplaceBack(N+x,-.8,N,.7),n.colorArray.emplaceBack(N+x,-.8,N,.7),n.colorArray.emplaceBack(0,0,N,1.3),n.colorArray.emplaceBack(0,0,N,1.3),n.colorArray.emplaceBack(N+x,-1.2,N,.8),n.colorArray.emplaceBack(N+x,-1.2,N,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}let l={defined:!0,emissiveFactor:[0,0,0]},u={};return u.baseColorFactor=Vn.white,l.pbrMetallicRoughness=u,n.material=l,n.aabb=new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}it(EM,"TriangleGridIndex");let DM=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class tx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,i]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let l=i>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);let u=DM[15&i];if(!u)throw new Error("Unrecognized array type.");let[h]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new tx(m,h,u,e)}constructor(e,n=64,i=Float64Array,l){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let u=DM.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-m%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${i}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+m+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return nx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:u,coords:h,nodeSize:m}=this,y=[0,u.length-1,0],x=[];for(;y.length;){let w=y.pop()||0,T=y.pop()||0,D=y.pop()||0;if(T-D<=m){for(let k=D;k<=T;k++){let N=h[2*k],H=h[2*k+1];N>=e&&N<=i&&H>=n&&H<=l&&x.push(u[k])}continue}let S=D+T>>1,A=h[2*S],P=h[2*S+1];A>=e&&A<=i&&P>=n&&P<=l&&x.push(u[S]),(w===0?e<=A:n<=P)&&(y.push(D),y.push(S-1),y.push(1-w)),(w===0?i>=A:l>=P)&&(y.push(S+1),y.push(T),y.push(1-w))}return x}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:l,coords:u,nodeSize:h}=this,m=[0,l.length-1,0],y=[],x=i*i;for(;m.length;){let w=m.pop()||0,T=m.pop()||0,D=m.pop()||0;if(T-D<=h){for(let k=D;k<=T;k++)SM(u[2*k],u[2*k+1],e,n)<=x&&y.push(l[k]);continue}let S=D+T>>1,A=u[2*S],P=u[2*S+1];SM(A,P,e,n)<=x&&y.push(l[S]),(w===0?e-i<=A:n-i<=P)&&(m.push(D),m.push(S-1),m.push(1-w)),(w===0?e+i>=A:n+i>=P)&&(m.push(S+1),m.push(T),m.push(1-w))}return y}}function nx(t,e,n,i,l,u){if(l-i<=n)return;let h=i+l>>1;MM(t,e,h,i,l,u),nx(t,e,n,i,h-1,1-u),nx(t,e,n,h+1,l,1-u)}function MM(t,e,n,i,l,u){for(;l>i;){if(l-i>600){let x=l-i+1,w=n-i+1,T=Math.log(x),D=.5*Math.exp(2*T/3),S=.5*Math.sqrt(T*D*(x-D)/x)*(w-x/2<0?-1:1);MM(t,e,n,Math.max(i,Math.floor(n-w*D/x+S)),Math.min(l,Math.floor(n+(x-w)*D/x+S)),u)}let h=e[2*n+u],m=i,y=l;for(bf(t,e,i,n),e[2*l+u]>h&&bf(t,e,i,l);m<y;){for(bf(t,e,m,y),m++,y--;e[2*m+u]<h;)m++;for(;e[2*y+u]>h;)y--}e[2*i+u]===h?bf(t,e,i,y):(y++,bf(t,e,y,l)),y<=n&&(i=y+1),n<=y&&(l=y-1)}}function bf(t,e,n,i){rx(t,n,i),rx(e,2*n,2*i),rx(e,2*n+1,2*i+1)}function rx(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function SM(t,e,n,i){let l=t-n,u=e-i;return l*l+u*u}r.$=45,r.A=ar,r.B=function(t){let e=r.m.identity(new Float64Array(16));r.m.multiply(e,t.pixelMatrix,t.globeMatrix);let n=[0,yo,0],i=[0,vo,0];return r.v.transformMat4(n,n,e),r.v.transformMat4(i,i,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!t0(t,new gn(t.center.lat,90)),i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!t0(t,new gn(t.center.lat,-90))]},r.C=Vn,r.D=Xa,r.E=Es,r.F=Zv,r.G=$T,r.H=Ts,r.I=dL,r.J=Ze,r.K=function(t,e){let{scale:n}=t.tileTransform,i=n*Ze/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return r.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[i,i])},r.L=gn,r.M=Hr,r.N=mg,r.O=zr,r.P=Ue,r.Q=xD,r.R=qv,r.S=function(t){let e=xD(t,!0);return r.h.invert([],[e[0],e[1],e[4],e[5]])},r.T=Wv,r.U=BT,r.V=function(t){let{x:e,y:n}=t.point,{lng:i,lat:l}=t._center;return YT(e,n,t.worldSize,i,l)},r.W=so,r.X=Zn,r.Y=Or,r.Z=Xv,r._=function(t){let e=Math.round((t+45+360)%360/90)%4;return Vh[e]},r.a=bo,r.a$=Im,r.a0=r0,r.a1=function(t,e){return Ao(Tr(t,{type:"json"}),e)},r.a2=kr,r.a3=Ae,r.a4=Xr,r.a5=oo,r.a6=uo,r.a7=Zs,r.a8=Wi,r.a9=ba,r.aA=ac,r.aB=nI,r.aC=io,r.aD=pM,r.aE=et,r.aF=mM,r.aG=function(t){Ir++,Ir>In&&(t.getActor().send("enforceCacheSizeLimit",Ct),Ir=0)},r.aH=nr,r.aI=Rp,r.aJ=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.aK=lM,r.aL=function(t,e){let n=document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let i=0;i<t.length;i++){let l=document.createElement("source");Ro(t[i])||(n.crossOrigin="Anonymous"),l.src=t[i],n.appendChild(l)}return{cancel:()=>{}}},r.aM=ut,r.aN=dg,r.aO=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>wM(e,0,t))},r.aP=IM,r.aQ=class{constructor(t,e,n,i){this.id=t,this.position=e!=null?new gn(e[0],e[1]):new gn(0,0),this.orientation=n??[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new dr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(r.m.multiply(t.matrix,e,t.matrix),t.meshes)for(let n of t.meshes){let i=dr.applyTransform(n.aabb,t.matrix);this.aabb.encapsulate(i)}if(t.children)for(let n of t.children)this._applyTransformations(n,t.matrix)}computeBoundsAndApplyParent(){let t=r.m.identity([]);for(let e of this.nodes)this._applyTransformations(e,t)}_positionModelOnTerrain(t,e){let n=t.elevation;if(!n)return 0;let i=dr.projectAabbCorners(this.aabb,this.matrix),l=pi(1,this.position.lat)*t.worldSize,u=function(k,N){let H=[0,0,1],q=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let Z of q){let K=k[Z.corners[0]],ee=k[Z.corners[1]],le=k[Z.corners[2]],he=[ee[0]-K[0],ee[1]-K[1],N*(ee[2]-K[2])],fe=r.v.cross(he,he,[le[0]-K[0],le[1]-K[1],N*(le[2]-K[2])]);r.v.normalize(fe,fe),Z.dotProductWithUp=r.v.dot(fe,H)}return q.sort((Z,K)=>Z.dotProductWithUp-K.dotProductWithUp),q[0].corners}(i,l),h=i[u[0]],m=i[u[1]],y=i[u[2]],x=i[u[3]],w=n.getAtPointOrZero(new Hr(h[0]/t.worldSize,h[1]/t.worldSize),0),T=n.getAtPointOrZero(new Hr(m[0]/t.worldSize,m[1]/t.worldSize),0),D=n.getAtPointOrZero(new Hr(y[0]/t.worldSize,y[1]/t.worldSize),0),S=n.getAtPointOrZero(new Hr(x[0]/t.worldSize,x[1]/t.worldSize),0),A=(w+S)/2,P=(T+D)/2;return A>P?T<D?gg(e,m,x,h,T,S,w,l):gg(e,y,h,x,D,w,S,l):w<S?gg(e,h,m,y,w,T,D,l):gg(e,x,y,m,S,D,T,l),Math.max(A,P)}computeModelMatrix(t,e,n,i,l,u,h=!1){let m=t.transform,y=m.zoom,x=m.project(this.position),w=sc(this.position.lat,y),T=1/w;r.m.identity(this.matrix),r.m.translate(this.matrix,this.matrix,[x.x+i[0]*T,x.y+i[1]*T,i[2]]);let D=1,S=1,A=m.worldSize;if(h){if(m.projection.name==="mercator"){let H=0;m.elevation&&(H=m.elevation.getAtPointOrZero(new Hr(x.x/A,x.y/A),0));let q=r.e.transformMat4([],[x.x,x.y,H,1],m.projMatrix)[3]/m.cameraToCenterDistance;D=q,S=q*sc(m.center.lat,y)}else if(m.projection.name==="globe"){let H=DD(this.matrix,m),q=r.m.multiply([],m.projMatrix,H),Z=[0,0,0,1];r.e.transformMat4(Z,Z,q);let K=Z[3]/m.cameraToCenterDistance,ee=_a(y),le=m.projection.pixelsPerMeter(this.position.lat,A)*sc(this.position.lat,y),he=m.projection.pixelsPerMeter(m.center.lat,A)*sc(m.center.lat,y);D=K/Wt(le,eI(m.center.lat),ee),S=K*w/le,D*=he,S*=he}}else D=T;r.m.scale(this.matrix,this.matrix,[D,D,S]);let P=[...this.matrix],k=this.orientation,N=[];if(ID(N,[k[0]+e[0],k[1]+e[1],k[2]+e[2]],n),r.m.multiply(this.matrix,P,N),l&&m.elevation){let H=0,q=[];if(u&&m.elevation){H=this._positionModelOnTerrain(m,q);let Z=r.m.fromQuat([],q),K=r.m.multiply([],Z,N);r.m.multiply(this.matrix,P,K)}else H=m.elevation.getAtPointOrZero(new Hr(x.x/A,x.y/A),0);H!==0&&(this.matrix[14]+=H)}}upload(t){if(!this.uploaded){for(let e of this.nodes)V0(e,t);for(let e of this.nodes)yg(e);this.uploaded=!0}}destroy(){for(let t of this.nodes)vg(t)}},r.aR=Pa,r.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.aT=eD,r.aU=iI,r.aV=Gr,r.aW=sD,r.aX=A0,r.aY=I0,r.aZ=tx,r.a_=Gd,r.aa=D0,r.ab=M0,r.ac=Re,r.ad=Q,r.ae=ye,r.af=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return ie(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n),azimuthal:Wt(t.azimuthal,e.azimuthal,n),polar:Wt(t.polar,e.polar,n)}}},r.ag=ve,r.ah=t=>Qi(Fd(t)),r.ai=bm,r.aj=jd,r.ak=Tr,r.al=ae,r.am=Zl,r.an=Us,r.ao=_a,r.ap=t=>Qi(Bd(t)),r.aq=mu,r.ar=Ce,r.as=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){let l=ie([1,n,i]);return{x:l.x,y:l.y,z:l.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:Wt(t.x,e.x,n),y:Wt(t.y,e.y,n),z:Wt(t.z,e.z,n)}}},r.at=function(t,e,n=0,i=!0){let l=new Ue(n,n),u=t.sub(l),h=e.add(l),m=[u,new Ue(h.x,u.y),h,new Ue(u.x,h.y)];return i&&m.push(u.clone()),m},r.au=function(t,e){let n=[];for(let i=0;i<t.length;i++){let l=ci(i-1,-1,t.length-1),u=ci(i+1,-1,t.length-1),h=t[i],m=t[u],y=t[l].sub(h).unit(),x=m.sub(h).unit(),w=x.angleWithSep(y.x,y.y),T=y.add(x).unit().mult(-1*e/Math.sin(w/2));n.push(h.add(T))}return n},r.av=uD,r.aw=lI,r.ax=function(t,e,n=0){return r.v.fromValues(((e.x-n)*t.scale-t.x)*Ze,(e.y*t.scale-t.y)*Ze,QT(e.z,e.y))},r.ay=TD,r.az=function(t){let e=1/0,n=1/0,i=-1/0,l=-1/0;for(let u of t)e=Math.min(e,u.x),n=Math.min(n,u.y),i=Math.max(i,u.x),l=Math.max(l,u.y);return{min:new Ue(e,n),max:new Ue(i,l)}},r.b=pi,r.b$=0,r.b0=ec,r.b1=wE,r.b2=fi,r.b3=function(t,e,n){let i=Math.sqrt(t*t+e*e+n*n),l=i>0?Math.acos(n/i)*Vs:0,u=t!==0||e!==0?Math.atan2(-e,-t)*Vs+90:0;return u<0&&(u+=360),[i,u,l]},r.b4=Zu,r.b5=$o,r.b6=N0,r.b7=Sv,r.b8=class extends ua{constructor(t){super(t),this.current=kP}set(t,e,n){if(this.fetchUniformLocation(t,e)){for(let i=0;i<9;i++)if(n[i]!==this.current[i]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}}},r.b9=bE,r.bA=function(t,e){let n=[0,0,0],i=Yd(ws(e.canonical));return r.v.transformMat4(n,n,i),r.v.transformMat4(n,n,t),n},r.bB=t=>({u_camera_to_center_distance:new fi(t),u_extrude_scale:new Cv(t),u_device_pixel_ratio:new fi(t),u_matrix:new Gd(t),u_inv_rot_matrix:new Gd(t),u_merc_center:new ec(t),u_tile_id:new Sv(t),u_zoom_transition:new fi(t),u_up_dir:new Sv(t),u_emissive_strength:new fi(t)}),r.bC=t=>({u_matrix:new Gd(t),u_pixels_to_tile_units:new Cv(t),u_device_pixel_ratio:new fi(t),u_units_to_pixels:new ec(t),u_dash_image:new Im(t),u_gradient_image:new Im(t),u_image_height:new fi(t),u_texsize:new ec(t),u_tile_units_to_pixels:new fi(t),u_alpha_discard_threshold:new fi(t),u_trim_offset:new ec(t),u_emissive_strength:new fi(t)}),r.bD=t=>({u_matrix:new Gd(t),u_texsize:new ec(t),u_pixels_to_tile_units:new Cv(t),u_device_pixel_ratio:new fi(t),u_image:new Im(t),u_units_to_pixels:new ec(t),u_tile_units_to_pixels:new fi(t),u_alpha_discard_threshold:new fi(t)}),r.bE=Fo,r.bF=Mk,r.bG=Sk,r.bH=hI,r.bI=(t,e,n,i,l,u)=>{let h=t.transform,m=h.projection.name==="globe",y;if(u.paint.get("circle-pitch-alignment")==="map")if(m){let w=XT(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([w,0,0,w])}else y=h.calculatePixelsToTileUnitsMatrix(n);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);let x={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(h.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Xr.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:EO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(m){x.u_inv_rot_matrix=i,x.u_merc_center=l,x.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],x.u_zoom_transition=_a(h.zoom);let w=l[0]*Ze,T=l[1]*Ze;x.u_up_dir=h.projection.upVector(new ic(0,0,0),w,T)}return x},r.bJ=rM,r.bK=(t,e,n,i,l)=>{let u=t.transform;return{u_matrix:nM(t,e,n,i),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:l,u_image:0,u_tile_units_to_pixels:tM(e,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},r.bL=(t,e,n,i,l,u,h)=>{let m=t.transform,y=m.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:nM(t,e,n,i),u_pixels_to_tile_units:y,u_device_pixel_ratio:u,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:l,u_texsize:iM(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:tM(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:h,u_emissive_strength:n.paint.get("line-emissive-strength")}},r.bM=Hs,r.bN=Nm,r.bO=YD,r.bP=aO,r.bQ=gf,r.bR=al,r.bS=450,r.bT=7,r.bU=HT,r.bV=Qv,r.bW=dt,r.bX=Ql,r.bY=Kl,r.bZ=1,r.b_=771,r.ba=Uc,r.bb=function(t,e,n){let i=_a(n.zoom),l=t.style.map._antialias,u=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return i===0&&!l&&!u},r.bc=function(t){let e=t.pixelsPerMeter,n=e/pi(1,t.center.lat),i=r.m.identity(new Float64Array(16));return r.m.translate(i,i,[t.point.x,t.point.y,0]),r.m.scale(i,i,[n,n,e]),Float32Array.from(i)},r.bd=Zi,r.be=Rm,r.bf=function(t){let e=ar-5;t=Bt(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(gt(t))),3);return Math.round(n*(Yv.length-1))},r.bg=function(t,e,n,i){let l=e.getNorth(),u=e.getSouth(),h=e.getWest(),m=e.getEast(),y=1<<t.z,x=m-h,w=l-u,T=x/Ou,D=-w/Yv[n],S=[0,T,0,D,0,0,l,h,0];if(t.z>0){let A=180/i;r.bx.multiply(S,S,[A/x+1,0,0,0,A/w+1,0,-.5*A/T,.5*A/D,1])}return S[2]=y,S[5]=t.x,S[8]=t.y,S},r.bh=Yd,r.bi=ws,r.bj=function(t,e,n){let i=r.m.identity(new Float64Array(16)),l=(e/(1<<t)-.5)*Math.PI*2;return r.m.rotateY(i,n.globeMatrix,l),Float32Array.from(i)},r.bk=class{isDataAvailableAtPoint(t){let e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;let n=e.getSource().maxzoom,i=1<<n,l=Math.floor(t.x),u=Math.floor((t.x-l)*i),h=Math.floor(t.y*i),m=this.findDEMTileFor(new zr(n,l,n,u,h));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);let i=this._source();if(!i||t.y<0||t.y>1)return e;let l=i.getSource().maxzoom,u=1<<l,h=Math.floor(t.x),m=t.x-h,y=new zr(l,h,l,Math.floor(m*u),Math.floor(t.y*u)),x=this.findDEMTileFor(y);if(!x||!x.dem)return e;let w=x.dem,T=1<<x.tileID.canonical.z,D=(m*T-x.tileID.canonical.x)*w.dim,S=(t.y*T-x.tileID.canonical.y)*w.dim,A=Math.floor(D),P=Math.floor(S);return(n?this.exaggeration():1)*Wt(Wt(w.get(A,P),w.get(A,P+1),S-P),Wt(w.get(A+1,P),w.get(A+1,P+1),S-P),D-A)}getAtTileOffset(t,e,n){let i=1<<t.canonical.z;return this.getAtPointOrZero(new Hr(t.wrap+(t.canonical.x+e/Ze)/i,(t.canonical.y+n/Ze)/i))}getAtTileOffsetFunc(t,e,n,i){return l=>{let u=this.getAtTileOffset(t,l.x,l.y),h=i.upVector(t.canonical,l.x,l.y),m=i.upVectorScale(t.canonical,e,n).metersToTile;return r.v.scale(h,h,u*m),h}}getForTilePoints(t,e,n,i){if(this.isUsingMockSource())return!1;let l=Vu.create(this,t,i);return!!l&&(e.forEach(u=>{u[2]=this.exaggeration()*l.getElevationAt(u[0],u[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;let e=this.findDEMTileFor(t);if(!e||!e.dem)return null;let n=e.dem.tree,i=e.tileID,l=1<<t.canonical.z-i.canonical.z,u=t.canonical.x/l-i.canonical.x,h=t.canonical.y/l-i.canonical.y,m=0;for(let y=0;y<t.canonical.z-i.canonical.z&&!n.leaves[m];y++){u*=2,h*=2;let x=2*Math.floor(h)+Math.floor(u);m=n.childOffsets[m]+x,u%=1,h%=1}return{min:this.exaggeration()*n.minimums[m],max:this.exaggeration()*n.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,n=Number.MAX_VALUE,i=Number.MIN_VALUE;for(let l of t){let u=this.getMinMaxForTile(l.tileID);u&&(n=Math.min(n,u.min),i=Math.max(i,u.max),e=!0)}return e?{min:n,max:i}:null}},r.bl=qd,r.bm=Xn,r.bn=Am,r.bo=Lt,r.bp=En,r.bq=cc,r.br=uM,r.bs=W0,r.bt=L0,r.bu=_I,r.bv=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},r.bw=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},r.by=XT,r.bz=256,r.c=Bt,r.c$=M,r.c0=bv,r.c1=function(t,e,n,i,l){return Bt((t-e)/(n-e)*(l-i)+i,i,l)},r.c2=Ul,r.c3=dr,r.c4=sc,r.c5=DD,r.c6=[1,1,1],r.c7=Vu,r.c8=_g,r.c9=ei,r.cA=qc,r.cB=t=>Qi(zd(t)),r.cC=W,r.cD=Ao,r.cE=$c,r.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},r.cG=Uh,r.cH=tI,r.cI=oc,r.cJ=function([t,e,n]){let i=Math.hypot(t,e,n),l=Math.atan2(t,n),u=.5*Math.PI-Math.acos(-e/i);return new gn(Or(l),Or(u))},r.cK=Oi,r.cL=Jd,r.cM=B,r.cN=t0,r.cO=JT,r.cP=function(t){let e=[0,0,0],n=r.m.identity(new Float64Array(16));return r.m.multiply(n,t.pixelMatrix,t.globeMatrix),r.v.transformMat4(e,e,n),new Ue(e[0],e[1])},r.cQ=function(t){let e=t.navigator?t.navigator.userAgent:null;return!!function(n){if(Fe==null){let i=n.navigator?n.navigator.userAgent:null;Fe=!!n.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Fe}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.cR=Ra,r.cS=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){let t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ge(t))return t;let n=qe(t);return n.params.push(`sdk=js-${M}`),n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ge(t))return t;let n=qe(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeModelURL(t,e){if(!Ge(t))return t;let n=qe(t);return n.path=`/models/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,i){if(!Ge(t))return t;let l=qe(t);return l.path=`/v4/${l.authority}.json`,l.params.push("secure"),n&&l.params.push(`language=${n}`),i&&l.params.push(`worldview=${i}`),this._makeAPIURL(l,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,i){let l=qe(t);return Ge(t)?(l.path=`/styles/v1${l.path}/sprite${e}${n}`,this._makeAPIURL(l,this._customAccessToken||i)):(l.path+=`${e}${n}`,Nt(l))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ge(t))return t;let i=qe(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&i.authority!=="raster"&&n===512?"@2x":""}${X.supported?".webp":"$1"}`),i.authority==="raster"?i.path=`/${B.RASTER_URL_PREFIX}${i.path}`:(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path=`/${B.TILE_URL_VERSION}${i.path}`);let l=this._customAccessToken||function(u){for(let h of u){let m=h.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(i.params)||B.ACCESS_TOKEN;return B.REQUIRE_ACCESS_TOKEN&&l&&this._skuToken&&i.params.push(`sku=${this._skuToken}`),this._makeAPIURL(i,l)}canonicalizeTileURL(t,e){let n=qe(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+=`raster/${n.path.replace(`/${B.RASTER_URL_PREFIX}/`,"")}`:i+=`tiles/${n.path.replace(`/${B.TILE_URL_VERSION}/`,"")}`;let l=n.params;return e&&(l=l.filter(u=>!u.match(/^access_token=/))),l.length&&(i+=`?${l.join("&")}`),i}canonicalizeTileset(t,e){let n=!!e&&Ge(e),i=[];for(let l of t.tiles||[])We(l)?i.push(this.canonicalizeTileURL(l,n)):i.push(l);return i}_makeAPIURL(t,e){let n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=qe(B.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,t.protocol==="http"){let l=t.params.indexOf("secure");l>=0&&t.params.splice(l,1)}if(i.path!=="/"&&(t.path=`${i.path}${t.path}`),!B.REQUIRE_ACCESS_TOKEN)return Nt(t);if(e=e||B.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(l=>l.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Nt(t)}},r.cT=function(t,e){e?ui.add(t):ui.delete(t)},r.cU=X,r.cV=Di,r.cW=jr,r.cX=Ve,r.cY=Br,r.cZ=function(t){ui.delete(t)},r.c_=vi,r.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){let e=FD(new Ue(0,0),new Ue(Ze,Ze),t),n=[];for(let i of this._activeRegions){if(i.hiddenByOverlap||!LD(e,i))continue;let l=IL(i.min,i.max,t);n.push({min:l.min,max:l.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId})}return n}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{let n=[];for(let i of e.cache.getVisibleCoordinates()){let l=e.cache.getTile(i).buckets[e.layer];if(l)for(let u of l.getNodesInfo()){let h=u.node;h.footprint&&n.push({footprint:h.footprint,id:i.toUnwrapped()})}}return n}})))}_addSource(t){let e=t.getFootprints();if(e.length!==0){for(let n of e){if(!n.footprint)continue;let i=FD(n.footprint.min,n.footprint.max,n.id);this._activeRegions.push({min:i.min,max:i.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:n.id,footprint:n.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,n)=>e.priority-n.priority||xg(e.min,n.min)||xg(e.max,n.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,n=0;for(;!t&&e!==this._activeRegions.length;){let i=this._activeRegions[e],l=this._prevRegions[n];t=i.priority!==l.priority||!kD(i,l),++e,++n}}if(t){++this._updateTime;let e=n=>{let i=this._activeRegions;if(n>=i.length)return n;let l=i[n].priority;for(;n<i.length&&i[n].priority===l;)++n;return n};if(this._sourceIds.length>1){let n=0,i=e(n);for(;n!==i;){let l=n,u=n;for(;l!==i;){let h=this._activeRegions[l];h.hiddenByOverlap=!1;for(let m=0;m<u;m++){let y=this._activeRegions[m];if(!y.hiddenByOverlap&&LD(h,y)&&(h.hiddenByOverlap=zD(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++l}n=i,i=e(n)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},r.cb=xn,r.cc=pg,r.cd=Vd,r.ce=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let t of this._poleSegments)t.destroy();for(let t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){let n=new Lt,i=new En,l=[],u=t+1+2,h=e[0]+1,m=e[0]+1+(1+e.length),y=(x,w,T)=>{let D=x===u-1?x-2:x===0?x:x-1;return D+=T?24575:0,[D,w]};for(let x=0;x<u;++x)n.emplaceBack(...y(x,0,!0));for(let x=0;x<h;++x)for(let w=0;w<u;++w)n.emplaceBack(...y(w,x,(w===0||w===u-1)&&!0));for(let x=0;x<e.length;++x){let w=e[x];for(let T=0;T<u;++T)n.emplaceBack(...y(T,w,!0))}for(let x=0;x<e.length;++x){let w=i.length,T=e[x]+1+2,D=new En;for(let P=0;P<T-1;P++){let k=P===T-2,N=k?u*(m-e.length+x-P):u;for(let H=0;H<u-1;H++){let q=P*u+H;P===0||k||H===0||H===u-2?(D.emplaceBack(q+1,q,q+N),D.emplaceBack(q+N,q+N+1,q+1)):(i.emplaceBack(q+1,q,q+N),i.emplaceBack(q+N,q+N+1,q+1))}}let S=Xn.simpleSegment(0,w,n.length,i.length-w);for(let P=0;P<D.uint16.length;P+=3)i.emplaceBack(D.uint16[P],D.uint16[P+1],D.uint16[P+2]);let A=Xn.simpleSegment(0,w,n.length,i.length-w);l.push({withoutSkirts:S,withSkirts:A})}return{vertices:n,indices:i,segments:l}}_createGrid(t){let e=this._fillGridMeshWithLods(Ou,Yv);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,qd.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){let e=new En;for(let h=0;h<=Ou;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);let n=new Kl,i=new Kl,l=new Kl,u=new Kl;this._poleSegments=[];for(let h=0,m=0;h<Xv;h++){let y=360/(1<<h);n.emplaceBack(0,-io,0,.5,0),i.emplaceBack(0,-io,0,.5,1),l.emplaceBack(0,-io,0,.5,.5),u.emplaceBack(0,-io,0,.5,.5);for(let x=0;x<=Ou;x++){let w=x/Ou,T=0,D=Wt(0,y,w),[S,A,P]=ku(hO,dO,D,io);n.emplaceBack(S,A,P,w,T),i.emplaceBack(S,A,P,w,1-T);let k=gt(D);w=.5+.5*Math.sin(k),T=.5+.5*Math.cos(k),l.emplaceBack(S,A,P,w,T),u.emplaceBack(S,A,P,w,1-T)}this._poleSegments.push(Xn.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Cm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(i,Cm,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(l,Cm,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(u,Cm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},r.cf=function(t){return ui.has(t)},r.cg=Om,r.ch=ie,r.ci=function(t){return t({pluginStatus:V,pluginURL:Y}),W.on("pluginStateChange",t),t},r.cj=Gu,r.ck=S0,r.cl=Zr,r.cm=ne,r.cn=Ge,r.co=qi,r.cp=function(t,e,n){return t.type==="custom"?new UL(t,e):new qL[t.type](t,e,n)},r.cq=function(t){let e=t.indexOf(ot);return e>=0?t.slice(0,e):t},r.cr=t=>Qi(vm(t)),r.cs=t=>Qi(_m(t)),r.ct=t=>Qi(Nd(t)),r.cu=function(t){return t.indexOf(ot)>=0},r.cv=function(t){let e=t.indexOf(ot);return e>=0?t.slice(e+1):""},r.cw=ql,r.cx=function(t){let e=[],n=t.id;return n===void 0&&e.push({message:`layers.${n}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},r.cy=t=>Qi(gm(t)),r.cz=t=>Qi(Ld(t)),r.d=gt,r.d0=function(t,e){Ct=t,In=e},r.d1=function(t,e,n=!1){if(V===j||V===U||V===G)throw new Error("setRTLTextPlugin cannot be called multiple times.");Y=Xr.resolveURL(t),V=j,$=e,re(),n||oe()},r.d2=J,r.d3=function(){W0().acquire(q0)},r.d4=function(){let t=xf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(q0),xf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},r.d5=vf,r.d6=function(t){let e=Nn();if(!e)return;let n=e.delete(Mt);t&&n.catch(t).then(()=>t())},r.d7=yf,r.d8=gM,r.d9=function(t){Z0=Xr.resolveURL(t),X0||(X0=new uM(W0(),new uo)),X0.broadcast("setDracoUrl",Z0)},r.da=$s,r.db=Ym,r.dc=St,r.dd=Hm,r.de=Gm,r.df=Pr,r.dg=DI,r.dh=class extends uo{constructor(t,e,n,i,l,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=l||mM,this.loading={},this.loaded={},this.deduped=new pM(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler,this.brightness=u}loadTile(t,e){let n=t.uid,i=t&&t.request,l=i&&i.collectResourceTiming,u=this.loading[n]=new XL(t);u.abort=this.loadVectorData(t,(h,m)=>{let y=!this.loading[n];if(delete this.loading[n],y||h||!m)return u.status="done",y||(this.loaded[n]=u),e(h);let x=m.rawData,w={};m.expires&&(w.expires=m.expires),m.cacheControl&&(w.cacheControl=m.cacheControl),u.vectorTile=m.vectorTile||new v0(new Xm(x));let T=()=>{u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,S)=>{if(D||!S)return e(D);let A={};if(l){let P=$h(i);P.length>0&&(A.resourceTiming=JSON.parse(JSON.stringify(P)))}e(null,Tr({rawTileData:x.slice(0)},S,w,A))})};this.isSpriteLoaded?T():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(T,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):T()}),this.loaded=this.loaded||{},this.loaded[n]=u})}reloadTile(t,e){let n=this.loaded,i=t.uid,l=this;if(n&&n[i]){let u=n[i];u.showCollisionBoxes=t.showCollisionBoxes,u.projection=t.projection,u.brightness=t.brightness,u.tileTransform=nl(t.tileID.canonical,t.projection),u.extraShadowCaster=t.extraShadowCaster;let h=(m,y)=>{let x=u.reloadCallback;x&&(delete u.reloadCallback,u.parse(u.vectorTile,l.layerIndex,this.availableImages,l.actor,x)),e(m,y)};u.status==="parsing"?u.reloadCallback=h:u.status==="done"&&(u.vectorTile?u.parse(u.vectorTile,this.layerIndex,this.availableImages,this.actor,h):h())}else e(null,void 0)}abortTile(t,e){let n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){let n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},r.di=$h,r.dj=Lr,r.dk=b0,r.dl=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==yM){let n=new Uint32Array(t,0,7),[,,i,l,u,h]=n;e=n.byteLength+l+u+h+u,(i!==t.byteLength||e>=t.byteLength)&&Zn("Invalid b3dm header information.")}return wM(t,e)},r.dm=function(t,e){let n=IM(t);for(let i of n){for(let l of i.meshes)oF(l);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(sF(i.lights,e)))}return n},r.dn=OD,r.dp=cM,r.dq=ce,r.dr=function(t){jn(),Bn&&Bn.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},r.f=function(t,e){let{x:n,y:i}=t.point,l=YT(n,i,t.worldSize/t._pixelsPerMercatorPixel,0,0);return r.m.multiply(l,l,Qv(ws(e)))},r.g=pt,r.i=Uu,r.j=Jm,r.k=cg,r.l=$r,r.n=Wt,r.o=mD,r.p=function(t,e){let n={};for(let i=0;i<e.length;i++){let l=e[i];l in t&&(n[l]=t[l])}return n},r.r=bD,r.s=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},r.t=ic,r.u=function(t,e,n,i,l){let u=5*e+2;t.float32[u+0]=n,t.float32[u+1]=i,t.float32[u+2]=l},r.w=ci,r.x=WT,r.y=function(t,e,n,i,l,u,h,m,y){if(y.name==="globe")return WT(t,e,new ic(n,i,l),!1);let x=nl({z:n,x:i,y:l},y);return new dr([(u+x.x/x.scale)*e,e*(x.y/x.scale),h],[(u+x.x2/x.scale)*e,e*(x.y2/x.scale),m])},r.z=function(t,e,n){let i=0;for(let l=0;l<2;++l){let u=n?n[l]:0;t[l]>u&&(i+=(t[l]-u)*(t[l]-u)),e[l]<u&&(i+=(u-e[l])*(u-e[l]))}return i}}),d(["./shared"],function(r){"use strict";function M($e){if(typeof $e=="number"||typeof $e=="boolean"||typeof $e=="string"||$e==null)return JSON.stringify($e);if(Array.isArray($e)){let ie="[";for(let pe of $e)ie+=`${M(pe)},`;return`${ie}]`}let te="{";for(let ie of Object.keys($e).sort())te+=`${ie}:${M($e[ie])},`;return`${te}}`}function L($e){let te="";for(let ie of r.aS)te+=`/${M($e[ie])}`;return te}class B{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,ie){this._layerConfigs={},this._layers={},this.update(te,[],ie)}update(te,ie,pe){this._options=pe;for(let Fe of te)this._layerConfigs[Fe.id]=Fe,(this._layers[Fe.id]=r.cp(Fe,this.scope,this._options)).compileFilter(),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id];for(let Fe of ie)delete this.keyCache[Fe],delete this._layerConfigs[Fe],delete this._layers[Fe];this.familiesBySource={};let ze=function(Fe,lt){let pt={};for(let Tt=0;Tt<Fe.length;Tt++){let Mt=lt&&lt[Fe[Tt].id]||L(Fe[Tt]);lt&&(lt[Fe[Tt].id]=Mt);let Ct=pt[Mt];Ct||(Ct=pt[Mt]=[]),Ct.push(Fe[Tt])}let je=[];for(let Tt in pt)je.push(pt[Tt]);return je}(r.da(this._layerConfigs),this.keyCache);for(let Fe of ze){let lt=Fe.map(In=>this._layers[In.id]),pt=lt[0];if(pt.visibility==="none")continue;let je=pt.source||"",Tt=this.familiesBySource[je];Tt||(Tt=this.familiesBySource[je]={});let Mt=pt.sourceLayer||"_geojsonTileLayer",Ct=Tt[Mt];Ct||(Ct=Tt[Mt]=[]),Ct.push(lt)}}}class X{loadTile(te,ie){let{uid:pe,encoding:ze,rawImageData:Fe,padding:lt}=te,pt=ImageBitmap&&Fe instanceof ImageBitmap?this.getImageData(Fe,lt):Fe;ie(null,new r.db(pe,pt,ze,lt<1))}getImageData(te,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);let pe=this.offscreenCanvasContext.getImageData(-ie,-ie,te.width+2*ie,te.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),pe}}function se($e,te){if($e.length!==0){ge($e[0],te);for(var ie=1;ie<$e.length;ie++)ge($e[ie],!te)}}function ge($e,te){for(var ie=0,pe=0,ze=0,Fe=$e.length,lt=Fe-1;ze<Fe;lt=ze++){var pt=($e[ze][0]-$e[lt][0])*($e[lt][1]+$e[ze][1]),je=ie+pt;pe+=Math.abs(ie)>=Math.abs(pt)?ie-je+pt:pt-je+ie,ie=je}ie+pe>=0!=!!te&&$e.reverse()}var Oe=r.dc(function $e(te,ie){var pe,ze=te&&te.type;if(ze==="FeatureCollection")for(pe=0;pe<te.features.length;pe++)$e(te.features[pe],ie);else if(ze==="GeometryCollection")for(pe=0;pe<te.geometries.length;pe++)$e(te.geometries[pe],ie);else if(ze==="Feature")$e(te.geometry,ie);else if(ze==="Polygon")se(te.coordinates,ie);else if(ze==="MultiPolygon")for(pe=0;pe<te.coordinates.length;pe++)se(te.coordinates[pe],ie);return te});let at=r.dd.prototype.toGeoJSON;var Dt={exports:{}},Vt=r.df,kt=r.de.VectorTileFeature,St=Fn;function Fn($e,te){this.options=te||{},this.features=$e,this.length=$e.length}function zn($e,te){this.id=typeof $e.id=="number"?$e.id:void 0,this.type=$e.type,this.rawGeometry=$e.type===1?[$e.geometry]:$e.geometry,this.properties=$e.tags,this.extent=te||4096}Fn.prototype.feature=function($e){return new zn(this.features[$e],this.options.extent)},zn.prototype.loadGeometry=function(){var $e=this.rawGeometry;this.geometry=[];for(var te=0;te<$e.length;te++){for(var ie=$e[te],pe=[],ze=0;ze<ie.length;ze++)pe.push(new Vt(ie[ze][0],ie[ze][1]));this.geometry.push(pe)}return this.geometry},zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var $e=this.geometry,te=1/0,ie=-1/0,pe=1/0,ze=-1/0,Fe=0;Fe<$e.length;Fe++)for(var lt=$e[Fe],pt=0;pt<lt.length;pt++){var je=lt[pt];te=Math.min(te,je.x),ie=Math.max(ie,je.x),pe=Math.min(pe,je.y),ze=Math.max(ze,je.y)}return[te,pe,ie,ze]},zn.prototype.toGeoJSON=kt.prototype.toGeoJSON;var An=r.dg,Pr=St;function tr($e){var te=new An;return function(ie,pe){for(var ze in ie.layers)pe.writeMessage(3,Ue,ie.layers[ze])}($e,te),te.finish()}function Ue($e,te){var ie;te.writeVarintField(15,$e.version||1),te.writeStringField(1,$e.name||""),te.writeVarintField(5,$e.extent||4096);var pe={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<$e.length;ie++)pe.feature=$e.feature(ie),te.writeMessage(2,js,pe);var ze=pe.keys;for(ie=0;ie<ze.length;ie++)te.writeStringField(3,ze[ie]);var Fe=pe.values;for(ie=0;ie<Fe.length;ie++)te.writeMessage(4,Uc,Fe[ie])}function js($e,te){var ie=$e.feature;ie.id!==void 0&&te.writeVarintField(1,ie.id),te.writeMessage(2,Vs,$e),te.writeVarintField(3,ie.type),te.writeMessage(4,Vh,ie)}function Vs($e,te){var ie=$e.feature,pe=$e.keys,ze=$e.values,Fe=$e.keycache,lt=$e.valuecache;for(var pt in ie.properties){var je=ie.properties[pt],Tt=Fe[pt];if(je!==null){Tt===void 0&&(pe.push(pt),Fe[pt]=Tt=pe.length-1),te.writeVarint(Tt);var Mt=typeof je;Mt!=="string"&&Mt!=="boolean"&&Mt!=="number"&&(je=JSON.stringify(je));var Ct=Mt+":"+je,In=lt[Ct];In===void 0&&(ze.push(je),lt[Ct]=In=ze.length-1),te.writeVarint(In)}}}function gt($e,te){return(te<<3)+(7&$e)}function Or($e){return $e<<1^$e>>31}function Vh($e,te){for(var ie=$e.loadGeometry(),pe=$e.type,ze=0,Fe=0,lt=ie.length,pt=0;pt<lt;pt++){var je=ie[pt],Tt=1;pe===1&&(Tt=je.length),te.writeVarint(gt(1,Tt));for(var Mt=pe===3?je.length-1:je.length,Ct=0;Ct<Mt;Ct++){Ct===1&&pe!==1&&te.writeVarint(gt(2,Mt-1));var In=je[Ct].x-ze,Bn=je[Ct].y-Fe;te.writeVarint(Or(In)),te.writeVarint(Or(Bn)),ze+=In,Fe+=Bn}pe===3&&te.writeVarint(gt(7,1))}}function Uc($e,te){var ie=typeof $e;ie==="string"?te.writeStringField(1,$e):ie==="boolean"?te.writeBooleanField(7,$e):ie==="number"&&($e%1!=0?te.writeDoubleField(3,$e):$e<0?te.writeSVarintField(6,$e):te.writeVarintField(5,$e))}Dt.exports=tr,Dt.exports.fromVectorTileJs=tr,Dt.exports.fromGeojsonVt=function($e,te){te=te||{};var ie={};for(var pe in $e)ie[pe]=new Pr($e[pe].features,te),ie[pe].name=pe,ie[pe].version=te.version,ie[pe].extent=te.extent;return tr({layers:ie})},Dt.exports.GeoJSONWrapper=Pr;var $c=r.dc(Dt.exports);let Uh={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:$e=>$e},Bt=Math.fround||(Us=new Float32Array(1),$e=>(Us[0]=+$e,Us[0]));var Us;let ci=3,vi=5,$s=6;class Tr{constructor(te){this.options=Object.assign(Object.create(Uh),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){let{log:ie,minZoom:pe,maxZoom:ze}=this.options;ie&&console.time("total time");let Fe=`prepare ${te.length} points`;ie&&console.time(Fe),this.points=te;let lt=[];for(let je=0;je<te.length;je++){let Tt=te[je];if(!Tt.geometry)continue;let[Mt,Ct]=Tt.geometry.coordinates,In=Bt(Gs(Mt)),Bn=Bt(Hs(Ct));lt.push(In,Bn,1/0,je,-1,1),this.options.reduce&&lt.push(0)}let pt=this.trees[ze+1]=this._createTree(lt);ie&&console.timeEnd(Fe);for(let je=ze;je>=pe;je--){let Tt=+Date.now();pt=this.trees[je]=this._createTree(this._cluster(pt,je)),ie&&console.log("z%d: %d clusters in %dms",je,pt.numItems,+Date.now()-Tt)}return ie&&console.timeEnd("total time"),this}getClusters(te,ie){let pe=((te[0]+180)%360+360)%360-180,ze=Math.max(-90,Math.min(90,te[1])),Fe=te[2]===180?180:((te[2]+180)%360+360)%360-180,lt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)pe=-180,Fe=180;else if(pe>Fe){let Ct=this.getClusters([pe,ze,180,lt],ie),In=this.getClusters([-180,ze,Fe,lt],ie);return Ct.concat(In)}let pt=this.trees[this._limitZoom(ie)],je=pt.range(Gs(pe),Hs(lt),Gs(Fe),Hs(ze)),Tt=pt.data,Mt=[];for(let Ct of je){let In=this.stride*Ct;Mt.push(Tt[In+vi]>1?Gc(Tt,In,this.clusterProps):this.points[Tt[In+ci]])}return Mt}getChildren(te){let ie=this._getOriginId(te),pe=this._getOriginZoom(te),ze="No cluster with the specified id.",Fe=this.trees[pe];if(!Fe)throw new Error(ze);let lt=Fe.data;if(ie*this.stride>=lt.length)throw new Error(ze);let pt=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),je=Fe.within(lt[ie*this.stride],lt[ie*this.stride+1],pt),Tt=[];for(let Mt of je){let Ct=Mt*this.stride;lt[Ct+4]===te&&Tt.push(lt[Ct+vi]>1?Gc(lt,Ct,this.clusterProps):this.points[lt[Ct+ci]])}if(Tt.length===0)throw new Error(ze);return Tt}getLeaves(te,ie,pe){let ze=[];return this._appendLeaves(ze,te,ie=ie||10,pe=pe||0,0),ze}getTile(te,ie,pe){let ze=this.trees[this._limitZoom(te)],Fe=Math.pow(2,te),{extent:lt,radius:pt}=this.options,je=pt/lt,Tt=(pe-je)/Fe,Mt=(pe+1+je)/Fe,Ct={features:[]};return this._addTileFeatures(ze.range((ie-je)/Fe,Tt,(ie+1+je)/Fe,Mt),ze.data,ie,pe,Fe,Ct),ie===0&&this._addTileFeatures(ze.range(1-je/Fe,Tt,1,Mt),ze.data,Fe,pe,Fe,Ct),ie===Fe-1&&this._addTileFeatures(ze.range(0,Tt,je/Fe,Mt),ze.data,-1,pe,Fe,Ct),Ct.features.length?Ct:null}getClusterExpansionZoom(te){let ie=this._getOriginZoom(te)-1;for(;ie<=this.options.maxZoom;){let pe=this.getChildren(te);if(ie++,pe.length!==1)break;te=pe[0].properties.cluster_id}return ie}_appendLeaves(te,ie,pe,ze,Fe){let lt=this.getChildren(ie);for(let pt of lt){let je=pt.properties;if(je&&je.cluster?Fe+je.point_count<=ze?Fe+=je.point_count:Fe=this._appendLeaves(te,je.cluster_id,pe,ze,Fe):Fe<ze?Fe++:te.push(pt),te.length===pe)break}return Fe}_createTree(te){let ie=new r.aZ(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let pe=0;pe<te.length;pe+=this.stride)ie.add(te[pe],te[pe+1]);return ie.finish(),ie.data=te,ie}_addTileFeatures(te,ie,pe,ze,Fe,lt){for(let pt of te){let je=pt*this.stride,Tt=ie[je+vi]>1,Mt,Ct,In;if(Tt)Mt=Ra(ie,je,this.clusterProps),Ct=ie[je],In=ie[je+1];else{let Nn=this.points[ie[je+ci]];Mt=Nn.properties;let[jn,Dn]=Nn.geometry.coordinates;Ct=Gs(jn),In=Hs(Dn)}let Bn={type:1,geometry:[[Math.round(this.options.extent*(Ct*Fe-pe)),Math.round(this.options.extent*(In*Fe-ze))]],tags:Mt},pr;pr=Tt||this.options.generateId?ie[je+ci]:this.points[ie[je+ci]].id,pr!==void 0&&(Bn.id=pr),lt.features.push(Bn)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,ie){let{radius:pe,extent:ze,reduce:Fe,minPoints:lt}=this.options,pt=pe/(ze*Math.pow(2,ie)),je=te.data,Tt=[],Mt=this.stride;for(let Ct=0;Ct<je.length;Ct+=Mt){if(je[Ct+2]<=ie)continue;je[Ct+2]=ie;let In=je[Ct],Bn=je[Ct+1],pr=te.within(je[Ct],je[Ct+1],pt),Nn=je[Ct+vi],jn=Nn;for(let Dn of pr){let Ir=Dn*Mt;je[Ir+2]>ie&&(jn+=je[Ir+vi])}if(jn>Nn&&jn>=lt){let Dn,Ir=In*Nn,kr=Bn*Nn,Ii=-1,Zr=((Ct/Mt|0)<<5)+(ie+1)+this.points.length;for(let Ao of pr){let Lr=Ao*Mt;if(je[Lr+2]<=ie)continue;je[Lr+2]=ie;let Ro=je[Lr+vi];Ir+=je[Lr]*Ro,kr+=je[Lr+1]*Ro,je[Lr+4]=Zr,Fe&&(Dn||(Dn=this._map(je,Ct,!0),Ii=this.clusterProps.length,this.clusterProps.push(Dn)),Fe(Dn,this._map(je,Lr)))}je[Ct+4]=Zr,Tt.push(Ir/jn,kr/jn,1/0,Zr,-1,jn),Fe&&Tt.push(Ii)}else{for(let Dn=0;Dn<Mt;Dn++)Tt.push(je[Ct+Dn]);if(jn>1)for(let Dn of pr){let Ir=Dn*Mt;if(!(je[Ir+2]<=ie)){je[Ir+2]=ie;for(let kr=0;kr<Mt;kr++)Tt.push(je[Ir+kr])}}}}return Tt}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,ie,pe){if(te[ie+vi]>1){let lt=this.clusterProps[te[ie+$s]];return pe?Object.assign({},lt):lt}let ze=this.points[te[ie+ci]].properties,Fe=this.options.map(ze);return pe&&Fe===ze?Object.assign({},Fe):Fe}}function Gc($e,te,ie){return{type:"Feature",id:$e[te+ci],properties:Ra($e,te,ie),geometry:{type:"Point",coordinates:[(pe=$e[te],360*(pe-.5)),Hc($e[te+1])]}};var pe}function Ra($e,te,ie){let pe=$e[te+vi],ze=pe>=1e4?`${Math.round(pe/1e3)}k`:pe>=1e3?Math.round(pe/100)/10+"k":pe,Fe=$e[te+$s],lt=Fe===-1?{}:Object.assign({},ie[Fe]);return Object.assign(lt,{cluster:!0,cluster_id:$e[te+ci],point_count:pe,point_count_abbreviated:ze})}function Gs($e){return $e/360+.5}function Hs($e){let te=Math.sin($e*Math.PI/180),ie=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return ie<0?0:ie>1?1:ie}function Hc($e){let te=(180-360*$e)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}var Pa={exports:{}};Pa.exports=function(){function $e(Se,Ae,Ve,Ge){for(var We,Ke=Ge,Qe=Ve-Ae>>1,Xe=Ve-Ae,ct=Se[Ae],qe=Se[Ae+1],Nt=Se[Ve],pn=Se[Ve+1],vt=Ae+3;vt<Ve;vt+=3){var vn=te(Se[vt],Se[vt+1],ct,qe,Nt,pn);if(vn>Ke)We=vt,Ke=vn;else if(vn===Ke){var Qn=Math.abs(vt-Qe);Qn<Xe&&(We=vt,Xe=Qn)}}Ke>Ge&&(We-Ae>3&&$e(Se,Ae,We,Ge),Se[We+2]=Ke,Ve-We>3&&$e(Se,We,Ve,Ge))}function te(Se,Ae,Ve,Ge,We,Ke){var Qe=We-Ve,Xe=Ke-Ge;if(Qe!==0||Xe!==0){var ct=((Se-Ve)*Qe+(Ae-Ge)*Xe)/(Qe*Qe+Xe*Xe);ct>1?(Ve=We,Ge=Ke):ct>0&&(Ve+=Qe*ct,Ge+=Xe*ct)}return(Qe=Se-Ve)*Qe+(Xe=Ae-Ge)*Xe}function ie(Se,Ae,Ve,Ge){var We={id:Se===void 0?null:Se,type:Ae,geometry:Ve,tags:Ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ke){var Qe=Ke.geometry,Xe=Ke.type;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")pe(Ke,Qe);else if(Xe==="Polygon"||Xe==="MultiLineString")for(var ct=0;ct<Qe.length;ct++)pe(Ke,Qe[ct]);else if(Xe==="MultiPolygon")for(ct=0;ct<Qe.length;ct++)for(var qe=0;qe<Qe[ct].length;qe++)pe(Ke,Qe[ct][qe])}(We),We}function pe(Se,Ae){for(var Ve=0;Ve<Ae.length;Ve+=3)Se.minX=Math.min(Se.minX,Ae[Ve]),Se.minY=Math.min(Se.minY,Ae[Ve+1]),Se.maxX=Math.max(Se.maxX,Ae[Ve]),Se.maxY=Math.max(Se.maxY,Ae[Ve+1])}function ze(Se,Ae,Ve,Ge){if(Ae.geometry){var We=Ae.geometry.coordinates,Ke=Ae.geometry.type,Qe=Math.pow(Ve.tolerance/((1<<Ve.maxZoom)*Ve.extent),2),Xe=[],ct=Ae.id;if(Ve.promoteId?ct=Ae.properties[Ve.promoteId]:Ve.generateId&&(ct=Ge||0),Ke==="Point")Fe(We,Xe);else if(Ke==="MultiPoint")for(var qe=0;qe<We.length;qe++)Fe(We[qe],Xe);else if(Ke==="LineString")lt(We,Xe,Qe,!1);else if(Ke==="MultiLineString"){if(Ve.lineMetrics){for(qe=0;qe<We.length;qe++)lt(We[qe],Xe=[],Qe,!1),Se.push(ie(ct,"LineString",Xe,Ae.properties));return}pt(We,Xe,Qe,!1)}else if(Ke==="Polygon")pt(We,Xe,Qe,!0);else{if(Ke!=="MultiPolygon"){if(Ke==="GeometryCollection"){for(qe=0;qe<Ae.geometry.geometries.length;qe++)ze(Se,{id:ct,geometry:Ae.geometry.geometries[qe],properties:Ae.properties},Ve,Ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(qe=0;qe<We.length;qe++){var Nt=[];pt(We[qe],Nt,Qe,!0),Xe.push(Nt)}}Se.push(ie(ct,Ke,Xe,Ae.properties))}}function Fe(Se,Ae){Ae.push(je(Se[0])),Ae.push(Tt(Se[1])),Ae.push(0)}function lt(Se,Ae,Ve,Ge){for(var We,Ke,Qe=0,Xe=0;Xe<Se.length;Xe++){var ct=je(Se[Xe][0]),qe=Tt(Se[Xe][1]);Ae.push(ct),Ae.push(qe),Ae.push(0),Xe>0&&(Qe+=Ge?(We*qe-ct*Ke)/2:Math.sqrt(Math.pow(ct-We,2)+Math.pow(qe-Ke,2))),We=ct,Ke=qe}var Nt=Ae.length-3;Ae[2]=1,$e(Ae,0,Nt,Ve),Ae[Nt+2]=1,Ae.size=Math.abs(Qe),Ae.start=0,Ae.end=Ae.size}function pt(Se,Ae,Ve,Ge){for(var We=0;We<Se.length;We++){var Ke=[];lt(Se[We],Ke,Ve,Ge),Ae.push(Ke)}}function je(Se){return Se/360+.5}function Tt(Se){var Ae=Math.sin(Se*Math.PI/180),Ve=.5-.25*Math.log((1+Ae)/(1-Ae))/Math.PI;return Ve<0?0:Ve>1?1:Ve}function Mt(Se,Ae,Ve,Ge,We,Ke,Qe,Xe){if(Ge/=Ae,Ke>=(Ve/=Ae)&&Qe<Ge)return Se;if(Qe<Ve||Ke>=Ge)return null;for(var ct=[],qe=0;qe<Se.length;qe++){var Nt=Se[qe],pn=Nt.geometry,vt=Nt.type,vn=We===0?Nt.minX:Nt.minY,Qn=We===0?Nt.maxX:Nt.maxY;if(vn>=Ve&&Qn<Ge)ct.push(Nt);else if(!(Qn<Ve||vn>=Ge)){var nr=[];if(vt==="Point"||vt==="MultiPoint")Ct(pn,nr,Ve,Ge,We);else if(vt==="LineString")In(pn,nr,Ve,Ge,We,!1,Xe.lineMetrics);else if(vt==="MultiLineString")pr(pn,nr,Ve,Ge,We,!1);else if(vt==="Polygon")pr(pn,nr,Ve,Ge,We,!0);else if(vt==="MultiPolygon")for(var cr=0;cr<pn.length;cr++){var Br=[];pr(pn[cr],Br,Ve,Ge,We,!0),Br.length&&nr.push(Br)}if(nr.length){if(Xe.lineMetrics&&vt==="LineString"){for(cr=0;cr<nr.length;cr++)ct.push(ie(Nt.id,vt,nr[cr],Nt.tags));continue}vt!=="LineString"&&vt!=="MultiLineString"||(nr.length===1?(vt="LineString",nr=nr[0]):vt="MultiLineString"),vt!=="Point"&&vt!=="MultiPoint"||(vt=nr.length===3?"Point":"MultiPoint"),ct.push(ie(Nt.id,vt,nr,Nt.tags))}}}return ct.length?ct:null}function Ct(Se,Ae,Ve,Ge,We){for(var Ke=0;Ke<Se.length;Ke+=3){var Qe=Se[Ke+We];Qe>=Ve&&Qe<=Ge&&(Ae.push(Se[Ke]),Ae.push(Se[Ke+1]),Ae.push(Se[Ke+2]))}}function In(Se,Ae,Ve,Ge,We,Ke,Qe){for(var Xe,ct,qe=Bn(Se),Nt=We===0?jn:Dn,pn=Se.start,vt=0;vt<Se.length-3;vt+=3){var vn=Se[vt],Qn=Se[vt+1],nr=Se[vt+2],cr=Se[vt+3],Br=Se[vt+4],xi=We===0?vn:Qn,Di=We===0?cr:Br,bi=!1;Qe&&(Xe=Math.sqrt(Math.pow(vn-cr,2)+Math.pow(Qn-Br,2))),xi<Ve?Di>Ve&&(ct=Nt(qe,vn,Qn,cr,Br,Ve),Qe&&(qe.start=pn+Xe*ct)):xi>Ge?Di<Ge&&(ct=Nt(qe,vn,Qn,cr,Br,Ge),Qe&&(qe.start=pn+Xe*ct)):Nn(qe,vn,Qn,nr),Di<Ve&&xi>=Ve&&(ct=Nt(qe,vn,Qn,cr,Br,Ve),bi=!0),Di>Ge&&xi<=Ge&&(ct=Nt(qe,vn,Qn,cr,Br,Ge),bi=!0),!Ke&&bi&&(Qe&&(qe.end=pn+Xe*ct),Ae.push(qe),qe=Bn(Se)),Qe&&(pn+=Xe)}var jr=Se.length-3;vn=Se[jr],Qn=Se[jr+1],nr=Se[jr+2],(xi=We===0?vn:Qn)>=Ve&&xi<=Ge&&Nn(qe,vn,Qn,nr),jr=qe.length-3,Ke&&jr>=3&&(qe[jr]!==qe[0]||qe[jr+1]!==qe[1])&&Nn(qe,qe[0],qe[1],qe[2]),qe.length&&Ae.push(qe)}function Bn(Se){var Ae=[];return Ae.size=Se.size,Ae.start=Se.start,Ae.end=Se.end,Ae}function pr(Se,Ae,Ve,Ge,We,Ke){for(var Qe=0;Qe<Se.length;Qe++)In(Se[Qe],Ae,Ve,Ge,We,Ke,!1)}function Nn(Se,Ae,Ve,Ge){Se.push(Ae),Se.push(Ve),Se.push(Ge)}function jn(Se,Ae,Ve,Ge,We,Ke){var Qe=(Ke-Ae)/(Ge-Ae);return Se.push(Ke),Se.push(Ve+(We-Ve)*Qe),Se.push(1),Qe}function Dn(Se,Ae,Ve,Ge,We,Ke){var Qe=(Ke-Ve)/(We-Ve);return Se.push(Ae+(Ge-Ae)*Qe),Se.push(Ke),Se.push(1),Qe}function Ir(Se,Ae){for(var Ve=[],Ge=0;Ge<Se.length;Ge++){var We,Ke=Se[Ge],Qe=Ke.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")We=kr(Ke.geometry,Ae);else if(Qe==="MultiLineString"||Qe==="Polygon"){We=[];for(var Xe=0;Xe<Ke.geometry.length;Xe++)We.push(kr(Ke.geometry[Xe],Ae))}else if(Qe==="MultiPolygon")for(We=[],Xe=0;Xe<Ke.geometry.length;Xe++){for(var ct=[],qe=0;qe<Ke.geometry[Xe].length;qe++)ct.push(kr(Ke.geometry[Xe][qe],Ae));We.push(ct)}Ve.push(ie(Ke.id,Qe,We,Ke.tags))}return Ve}function kr(Se,Ae){var Ve=[];Ve.size=Se.size,Se.start!==void 0&&(Ve.start=Se.start,Ve.end=Se.end);for(var Ge=0;Ge<Se.length;Ge+=3)Ve.push(Se[Ge]+Ae,Se[Ge+1],Se[Ge+2]);return Ve}function Ii(Se,Ae){if(Se.transformed)return Se;var Ve,Ge,We,Ke=1<<Se.z,Qe=Se.x,Xe=Se.y;for(Ve=0;Ve<Se.features.length;Ve++){var ct=Se.features[Ve],qe=ct.geometry,Nt=ct.type;if(ct.geometry=[],Nt===1)for(Ge=0;Ge<qe.length;Ge+=2)ct.geometry.push(Zr(qe[Ge],qe[Ge+1],Ae,Ke,Qe,Xe));else for(Ge=0;Ge<qe.length;Ge++){var pn=[];for(We=0;We<qe[Ge].length;We+=2)pn.push(Zr(qe[Ge][We],qe[Ge][We+1],Ae,Ke,Qe,Xe));ct.geometry.push(pn)}}return Se.transformed=!0,Se}function Zr(Se,Ae,Ve,Ge,We,Ke){return[Math.round(Ve*(Se*Ge-We)),Math.round(Ve*(Ae*Ge-Ke))]}function Ao(Se,Ae,Ve,Ge,We){for(var Ke=Ae===We.maxZoom?0:We.tolerance/((1<<Ae)*We.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ve,y:Ge,z:Ae,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Xe=0;Xe<Se.length;Xe++){Qe.numFeatures++,Lr(Qe,Se[Xe],Ke,We);var ct=Se[Xe].minX,qe=Se[Xe].minY,Nt=Se[Xe].maxX,pn=Se[Xe].maxY;ct<Qe.minX&&(Qe.minX=ct),qe<Qe.minY&&(Qe.minY=qe),Nt>Qe.maxX&&(Qe.maxX=Nt),pn>Qe.maxY&&(Qe.maxY=pn)}return Qe}function Lr(Se,Ae,Ve,Ge){var We=Ae.geometry,Ke=Ae.type,Qe=[];if(Ke==="Point"||Ke==="MultiPoint")for(var Xe=0;Xe<We.length;Xe+=3)Qe.push(We[Xe]),Qe.push(We[Xe+1]),Se.numPoints++,Se.numSimplified++;else if(Ke==="LineString")Ro(Qe,We,Se,Ve,!1,!1);else if(Ke==="MultiLineString"||Ke==="Polygon")for(Xe=0;Xe<We.length;Xe++)Ro(Qe,We[Xe],Se,Ve,Ke==="Polygon",Xe===0);else if(Ke==="MultiPolygon")for(var ct=0;ct<We.length;ct++){var qe=We[ct];for(Xe=0;Xe<qe.length;Xe++)Ro(Qe,qe[Xe],Se,Ve,!0,Xe===0)}if(Qe.length){var Nt=Ae.tags||null;if(Ke==="LineString"&&Ge.lineMetrics){for(var pn in Nt={},Ae.tags)Nt[pn]=Ae.tags[pn];Nt.mapbox_clip_start=We.start/We.size,Nt.mapbox_clip_end=We.end/We.size}var vt={geometry:Qe,type:Ke==="Polygon"||Ke==="MultiPolygon"?3:Ke==="LineString"||Ke==="MultiLineString"?2:1,tags:Nt};Ae.id!==null&&(vt.id=Ae.id),Se.features.push(vt)}}function Ro(Se,Ae,Ve,Ge,We,Ke){var Qe=Ge*Ge;if(Ge>0&&Ae.size<(We?Qe:Ge))Ve.numPoints+=Ae.length/3;else{for(var Xe=[],ct=0;ct<Ae.length;ct+=3)(Ge===0||Ae[ct+2]>Qe)&&(Ve.numSimplified++,Xe.push(Ae[ct]),Xe.push(Ae[ct+1])),Ve.numPoints++;We&&function(qe,Nt){for(var pn=0,vt=0,vn=qe.length,Qn=vn-2;vt<vn;Qn=vt,vt+=2)pn+=(qe[vt]-qe[Qn])*(qe[vt+1]+qe[Qn+1]);if(pn>0===Nt)for(vt=0,vn=qe.length;vt<vn/2;vt+=2){var nr=qe[vt],cr=qe[vt+1];qe[vt]=qe[vn-2-vt],qe[vt+1]=qe[vn-1-vt],qe[vn-2-vt]=nr,qe[vn-1-vt]=cr}}(Xe,Ke),Se.push(Xe)}}function os(Se,Ae){var Ve=(Ae=this.options=function(We,Ke){for(var Qe in Ke)We[Qe]=Ke[Qe];return We}(Object.create(this.options),Ae)).debug;if(Ve&&console.time("preprocess data"),Ae.maxZoom<0||Ae.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ae.promoteId&&Ae.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ge=function(We,Ke){var Qe=[];if(We.type==="FeatureCollection")for(var Xe=0;Xe<We.features.length;Xe++)ze(Qe,We.features[Xe],Ke,Xe);else ze(Qe,We.type==="Feature"?We:{geometry:We},Ke);return Qe}(Se,Ae);this.tiles={},this.tileCoords=[],Ve&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ae.indexMaxZoom,Ae.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ge=function(We,Ke){var Qe=Ke.buffer/Ke.extent,Xe=We,ct=Mt(We,1,-1-Qe,Qe,0,-1,2,Ke),qe=Mt(We,1,1-Qe,2+Qe,0,-1,2,Ke);return(ct||qe)&&(Xe=Mt(We,1,-Qe,1+Qe,0,-1,2,Ke)||[],ct&&(Xe=Ir(ct,1).concat(Xe)),qe&&(Xe=Xe.concat(Ir(qe,-1)))),Xe}(Ge,Ae)).length&&this.splitTile(Ge,0,0,0),Ve&&(Ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Fr(Se,Ae,Ve){return 32*((1<<Se)*Ve+Ae)+Se}return os.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},os.prototype.splitTile=function(Se,Ae,Ve,Ge,We,Ke,Qe){for(var Xe=[Se,Ae,Ve,Ge],ct=this.options,qe=ct.debug;Xe.length;){Ge=Xe.pop(),Ve=Xe.pop(),Ae=Xe.pop(),Se=Xe.pop();var Nt=1<<Ae,pn=Fr(Ae,Ve,Ge),vt=this.tiles[pn];if(!vt&&(qe>1&&console.time("creation"),vt=this.tiles[pn]=Ao(Se,Ae,Ve,Ge,ct),this.tileCoords.push({z:Ae,x:Ve,y:Ge}),qe)){qe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ae,Ve,Ge,vt.numFeatures,vt.numPoints,vt.numSimplified),console.timeEnd("creation"));var vn="z"+Ae;this.stats[vn]=(this.stats[vn]||0)+1,this.total++}if(vt.source=Se,We){if(Ae===ct.maxZoom||Ae===We)continue;var Qn=1<<We-Ae;if(Ve!==Math.floor(Ke/Qn)||Ge!==Math.floor(Qe/Qn))continue}else if(Ae===ct.indexMaxZoom||vt.numPoints<=ct.indexMaxPoints)continue;if(vt.source=null,Se.length!==0){qe>1&&console.time("clipping");var nr,cr,Br,xi,Di,bi,jr=.5*ct.buffer/ct.extent,ui=.5-jr,Po=.5+jr,ka=1+jr;nr=cr=Br=xi=null,Di=Mt(Se,Nt,Ve-jr,Ve+Po,0,vt.minX,vt.maxX,ct),bi=Mt(Se,Nt,Ve+ui,Ve+ka,0,vt.minX,vt.maxX,ct),Se=null,Di&&(nr=Mt(Di,Nt,Ge-jr,Ge+Po,1,vt.minY,vt.maxY,ct),cr=Mt(Di,Nt,Ge+ui,Ge+ka,1,vt.minY,vt.maxY,ct),Di=null),bi&&(Br=Mt(bi,Nt,Ge-jr,Ge+Po,1,vt.minY,vt.maxY,ct),xi=Mt(bi,Nt,Ge+ui,Ge+ka,1,vt.minY,vt.maxY,ct),bi=null),qe>1&&console.timeEnd("clipping"),Xe.push(nr||[],Ae+1,2*Ve,2*Ge),Xe.push(cr||[],Ae+1,2*Ve,2*Ge+1),Xe.push(Br||[],Ae+1,2*Ve+1,2*Ge),Xe.push(xi||[],Ae+1,2*Ve+1,2*Ge+1)}}},os.prototype.getTile=function(Se,Ae,Ve){var Ge=this.options,We=Ge.extent,Ke=Ge.debug;if(Se<0||Se>24)return null;var Qe=1<<Se,Xe=Fr(Se,Ae=(Ae%Qe+Qe)%Qe,Ve);if(this.tiles[Xe])return Ii(this.tiles[Xe],We);Ke>1&&console.log("drilling down to z%d-%d-%d",Se,Ae,Ve);for(var ct,qe=Se,Nt=Ae,pn=Ve;!ct&&qe>0;)qe--,Nt=Math.floor(Nt/2),pn=Math.floor(pn/2),ct=this.tiles[Fr(qe,Nt,pn)];return ct&&ct.source?(Ke>1&&console.log("found parent tile z%d-%d-%d",qe,Nt,pn),Ke>1&&console.time("drilling down"),this.splitTile(ct.source,qe,Nt,pn,Se,Ae,Ve),Ke>1&&console.timeEnd("drilling down"),this.tiles[Xe]?Ii(this.tiles[Xe],We):null):null},function(Se,Ae){return new os(Se,Ae)}}();var Oa=r.dc(Pa.exports);function Sl($e,te){let ie=$e.tileID.canonical;if(!this._geoJSONIndex)return te(null,null);let pe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!pe)return te(null,null);let ze=new class{constructor(lt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.J,this.length=lt.length,this._features=lt}feature(lt){return new class{constructor(pt){this._feature=pt,this.extent=r.J,this.type=pt.type,this.properties=pt.tags,"id"in pt&&!isNaN(pt.id)&&(this.id=parseInt(pt.id,10))}loadGeometry(){if(this._feature.type===1){let pt=[];for(let je of this._feature.geometry)pt.push([new r.P(je[0],je[1])]);return pt}{let pt=[];for(let je of this._feature.geometry){let Tt=[];for(let Mt of je)Tt.push(new r.P(Mt[0],Mt[1]));pt.push(Tt)}return pt}}toGeoJSON(pt,je,Tt){return at.call(this,pt,je,Tt)}}(this._features[lt])}}(pe.features),Fe=$c(ze);Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),te(null,{vectorTile:ze,rawData:Fe.buffer})}class qc extends r.dh{constructor(te,ie,pe,ze,Fe,lt){super(te,ie,pe,ze,Sl,lt),Fe&&(this.loadGeoJSON=Fe)}loadData(te,ie){let pe=te&&te.request,ze=pe&&pe.collectResourceTiming;this.loadGeoJSON(te,(Fe,lt)=>{if(Fe||!lt)return ie(Fe);if(typeof lt!="object")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{Oe(lt,!0);try{if(te.filter){let je=r.cw(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(je.result==="error")throw new Error(je.value.map(Mt=>`${Mt.key}: ${Mt.message}`).join(", "));lt={type:"FeatureCollection",features:lt.features.filter(Mt=>je.value.evaluate({zoom:0},Mt))}}this._geoJSONIndex=te.cluster?new Tr(function({superclusterOptions:je,clusterProperties:Tt}){if(!Tt||!je)return je;let Mt={},Ct={},In={accumulated:null,zoom:0},Bn={properties:null},pr=Object.keys(Tt);for(let Nn of pr){let[jn,Dn]=Tt[Nn],Ir=r.cw(Dn),kr=r.cw(typeof jn=="string"?[jn,["accumulated"],["get",Nn]]:jn);Mt[Nn]=Ir.value,Ct[Nn]=kr.value}return je.map=Nn=>{Bn.properties=Nn;let jn={};for(let Dn of pr)jn[Dn]=Mt[Dn].evaluate(In,Bn);return jn},je.reduce=(Nn,jn)=>{Bn.properties=jn;for(let Dn of pr)In.accumulated=Nn[Dn],Nn[Dn]=Ct[Dn].evaluate(In,Bn)},je}(te)).load(lt.features):Oa(lt,te.geojsonVtOptions)}catch(je){return ie(je)}this.loaded={};let pt={};if(ze){let je=r.di(pe);je&&(pt.resourceTiming={},pt.resourceTiming[te.source]=JSON.parse(JSON.stringify(je)))}ie(null,pt)}})}reloadTile(te,ie){let pe=this.loaded;return pe&&pe[te.uid]?super.reloadTile(te,ie):this.loadTile(te,ie)}loadGeoJSON(te,ie){if(te.request)r.a1(te.request,ie);else{if(typeof te.data!="string")return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(te.data))}catch{return ie(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(te,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(pe){ie(pe)}}getClusterChildren(te,ie){try{ie(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(pe){ie(pe)}}getClusterLeaves(te,ie){try{ie(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(pe){ie(pe)}}}class qi{constructor(te,ie){this.tileID=new r.O(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=ie}parse(te,ie,pe,ze){this.status="parsing";let Fe=new r.O(pe.tileID.overscaledZ,pe.tileID.wrap,pe.tileID.canonical.z,pe.tileID.canonical.x,pe.tileID.canonical.y),lt={},pt=ie.familiesBySource[pe.source],je=new r.dk(Fe,pe.promoteId);return je.bucketLayerIDs=[],r.dl(te).then(Tt=>{if(!Tt)return ze(new Error("Could not parse tile"));let Mt=r.dm(Tt,1/r.cg(pe.tileID.canonical)),Ct=Tt.json.extensionsUsed&&Tt.json.extensionsUsed.includes("MAPBOX_mesh_features"),In=new r.al(this.zoom,{brightness:this.brightness});for(let Bn in pt)for(let pr of pt[Bn]){let Nn=pr[0],jn=Tt.json.extensionsUsed;Nn.recalculate(In,[]);let Dn=new r.dn(Mt,Fe,jn&&jn.includes("MAPBOX_mesh_features"),this.brightness);Ct||(Dn.needsUpload=!0),lt[Nn.fqid]=Dn,Dn.evaluate(Nn)}this.status="done",ze(null,{buckets:lt,featureIndex:je})}).catch(Tt=>ze(new Error(Tt.message)))}}class Wc{constructor(te,ie,pe,ze,Fe,lt){this.actor=te,this.layerIndex=ie,this.brightness=lt,this.loading={},this.loaded={}}loadTile(te,ie){let pe=te.uid,ze=this.loading[pe]=new qi(te,this.brightness);r.dj(te.request,(Fe,lt)=>{let pt=!this.loading[pe];return delete this.loading[pe],pt||Fe?(ze.status="done",pt||(this.loaded[pe]=ze),ie(Fe)):lt&&lt.byteLength!==0?void ze.parse(lt,this.layerIndex,te,(je,Tt)=>{ze.status="done",this.loaded=this.loaded||{},this.loaded[pe]=ze,je||!Tt?ie(je):ie(null,Tt)}):(ze.status="done",this.loaded[pe]=ze,ie())})}reloadTile(te,ie){let pe=this.loaded,ze=te.uid;if(pe&&pe[ze]){let Fe=pe[ze];Fe.projection=te.projection,Fe.brightness=te.brightness;let lt=(pt,je)=>{Fe.reloadCallback&&(delete Fe.reloadCallback,this.loadTile(te,ie)),ie(pt,je)};Fe.status==="parsing"?Fe.reloadCallback=lt:Fe.status==="done"&&this.loadTile(te,ie)}}abortTile(te,ie){let pe=te.uid;this.loading[pe]&&delete this.loading[pe],ie()}removeTile(te,ie){let pe=this.loaded,ze=te.uid;pe&&pe[ze]&&delete pe[ze],ie()}}class Zn{constructor(te){this.self=te,this.actor=new r.dp(te,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.o({name:"mercator"}),this.workerSourceTypes={vector:r.dh,geojson:qc,"batched-model":Wc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,pe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=pe},this.self.registerRTLTextPlugin=ie=>{if(r.dq.isParsed())throw new Error("RTL text plugin already registered.");r.dq.applyArabicShaping=ie.applyArabicShaping,r.dq.processBidirectionalText=ie.processBidirectionalText,r.dq.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(te,ie,pe){delete this.layerIndexes[te],delete this.availableImages[te],delete this.workerSources[te],delete this.demWorkerSources[te],pe()}checkIfReady(te,ie,pe){pe()}setReferrer(te,ie){this.referrer=ie}spriteLoaded(te,{scope:ie,isLoaded:pe}){if(this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),this.isSpriteLoaded[te][ie]=pe,this.workerSources[te]&&this.workerSources[te][ie])for(let ze in this.workerSources[te][ie]){let Fe=this.workerSources[te][ie][ze];for(let lt in Fe)Fe[lt]instanceof r.dh&&(Fe[lt].isSpriteLoaded=pe,Fe[lt].fire(new r.a8("isSpriteLoaded")))}}setImages(te,{scope:ie,images:pe},ze){if(this.availableImages[te]||(this.availableImages[te]={}),this.availableImages[te][ie]=pe,this.workerSources[te]&&this.workerSources[te][ie]){for(let Fe in this.workerSources[te][ie]){let lt=this.workerSources[te][ie][Fe];for(let pt in lt)lt[pt].availableImages=pe}ze()}else ze()}setProjection(te,ie){this.projections[te]=r.o(ie)}setBrightness(te,ie,pe){this.brightness=ie,pe()}setLayers(te,ie,pe){this.getLayerIndex(te,ie.scope).replace(ie.layers,ie.options),pe()}updateLayers(te,ie,pe){this.getLayerIndex(te,ie.scope).update(ie.layers,ie.removedIds,ie.options),pe()}loadTile(te,ie,pe){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).loadTile(ie,pe)}loadDEMTile(te,ie,pe){this.getDEMWorkerSource(te,ie.source,ie.scope).loadTile(ie,pe)}reloadTile(te,ie,pe){ie.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,ie.type,ie.source,ie.scope).reloadTile(ie,pe)}abortTile(te,ie,pe){this.getWorkerSource(te,ie.type,ie.source,ie.scope).abortTile(ie,pe)}removeTile(te,ie,pe){this.getWorkerSource(te,ie.type,ie.source,ie.scope).removeTile(ie,pe)}removeSource(te,ie,pe){if(!(this.workerSources[te]&&this.workerSources[te][ie.scope]&&this.workerSources[te][ie.scope][ie.type]&&this.workerSources[te][ie.scope][ie.type][ie.source]))return;let ze=this.workerSources[te][ie.scope][ie.type][ie.source];delete this.workerSources[te][ie.scope][ie.type][ie.source],ze.removeSource!==void 0?ze.removeSource(ie,pe):pe()}loadWorkerSource(te,ie,pe){try{this.self.importScripts(ie.url),pe()}catch(ze){pe(ze.toString())}}syncRTLPluginState(te,ie,pe){try{r.dq.setState(ie);let ze=r.dq.getPluginURL();if(r.dq.isLoaded()&&!r.dq.isParsed()&&ze!=null){this.self.importScripts(ze);let Fe=r.dq.isParsed();pe(Fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ze}`),Fe)}}catch(ze){pe(ze.toString())}}setDracoUrl(te,ie){this.dracoUrl=ie}getAvailableImages(te,ie){this.availableImages[te]||(this.availableImages[te]={});let pe=this.availableImages[te][ie];return pe||(pe=[]),pe}getLayerIndex(te,ie){this.layerIndexes[te]||(this.layerIndexes[te]={});let pe=this.layerIndexes[te][ie];return pe||(pe=this.layerIndexes[te][ie]=new B,pe.scope=ie),pe}getWorkerSource(te,ie,pe,ze){if(this.workerSources[te]||(this.workerSources[te]={}),this.workerSources[te][ze]||(this.workerSources[te][ze]={}),this.workerSources[te][ze][ie]||(this.workerSources[te][ze][ie]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),!this.workerSources[te][ze][ie][pe]){let Fe={send:(lt,pt,je,Tt,Mt,Ct)=>{this.actor.send(lt,pt,je,te,Mt,Ct)},scheduler:this.actor.scheduler};this.workerSources[te][ze][ie][pe]=new this.workerSourceTypes[ie](Fe,this.getLayerIndex(te,ze),this.getAvailableImages(te,ze),this.isSpriteLoaded[te][ze],void 0,this.brightness)}return this.workerSources[te][ze][ie][pe]}getDEMWorkerSource(te,ie,pe){return this.demWorkerSources[te]||(this.demWorkerSources[te]={}),this.demWorkerSources[te][pe]||(this.demWorkerSources[te][pe]={}),this.demWorkerSources[te][pe][ie]||(this.demWorkerSources[te][pe][ie]=new X),this.demWorkerSources[te][pe][ie]}enforceCacheSizeLimit(te,ie){r.dr(ie)}getWorkerPerformanceMetrics(te,ie,pe){pe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Zn(self)),Zn}),d(["./shared"],function(r){"use strict";function M(p,o){if(Array.isArray(p)){if(!Array.isArray(o)||p.length!==o.length)return!1;for(let c=0;c<p.length;c++)if(!M(p[c],o[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&o!==null){if(typeof o!="object"||Object.keys(p).length!==Object.keys(o).length)return!1;for(let c in p)if(!M(p[c],o[c]))return!1;return!0}return p===o}var L=B;function B(p){return!function(o){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(b);try{v=new Worker(E),g=!0}catch{g=!1}return v&&v.terminate(),URL.revokeObjectURL(E),g}()?function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()?(X[c=o&&o.failIfMajorPerformanceCaveat]===void 0&&(X[c]=function(g){var v,b=function(E){var I=document.createElement("canvas"),C=Object.create(B.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=E,I.getContext("webgl2",C)}(g);if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),b.getShaderParameter(v,b.COMPILE_STATUS)===!0)}(c)),X[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var c}(p)}var X={};function se(p,o,c){let g=document.createElement(p);return o!=null&&(g.className=o),c&&c.appendChild(g),g}function ge(p,o,c){let g=document.createElementNS("http://www.w3.org/2000/svg",p);for(let v of Object.keys(o))g.setAttributeNS(null,v,String(o[v]));return c&&c.appendChild(g),g}B.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let Oe=typeof document<"u"?document.documentElement&&document.documentElement.style:null,at=Oe&&Oe.userSelect!==void 0?"userSelect":"WebkitUserSelect",Dt;function Vt(){Oe&&at&&(Dt=Oe[at],Oe[at]="none")}function kt(){Oe&&at&&(Oe[at]=Dt)}function St(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",St,!0)}function Fn(){window.addEventListener("click",St,!0),window.setTimeout(()=>{window.removeEventListener("click",St,!0)},0)}function zn(p,o){let c=p.getBoundingClientRect();return tr(p,c,o)}function An(p,o){let c=p.getBoundingClientRect(),g=[];for(let v=0;v<o.length;v++)g.push(tr(p,c,o[v]));return g}function Pr(p){return window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function tr(p,o,c){let g=p.offsetWidth===o.width?1:p.offsetWidth/o.width;return new r.P((c.clientX-o.left)*g,(c.clientY-o.top)*g)}class Ue{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,c){this._updatedSourceCaches[o]=c,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){let c=o.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(o.id),this.setDirty()}removeLayer(o){let c=o.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][o.id]=o,this._updatedLayers[c].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){let o={};for(let c in this._updatedLayers)o[c]=o[c]||{},o[c].updatedIds=Array.from(this._updatedLayers[c].values());for(let c in this._removedLayers)o[c]=o[c]||{},o[c].removedIds=Object.keys(this._removedLayers[c]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(o){this._updatedImages.add(o),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vs{constructor(o,c,g,v,b,E){this.length=c.length,this.attributes=g,this.itemSize=c.bytesPerElement,this.dynamicDraw=v,this.instanceCount=E,this.context=o;let I=o.gl;this.buffer=I.createBuffer(),o.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){let c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,c){for(let g=0;g<this.attributes.length;g++){let v=c.attributes[this.attributes[g].name];v!==void 0&&o.enableVertexAttribArray(v)}}setVertexAttribPointers(o,c,g){for(let v=0;v<this.attributes.length;v++){let b=this.attributes[v],E=c.attributes[b.name];E!==void 0&&o.vertexAttribPointer(E,b.components,o[js[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}setVertexAttribDivisor(o,c,g){for(let v=0;v<this.attributes.length;v++){let b=c.attributes[this.attributes[v].name];b!==void 0&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(b,g)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class gt{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Or extends gt{getDefault(){return r.C.transparent}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Vh extends gt{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Uc extends gt{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class $c extends gt{getDefault(){return[!0,!0,!0,!0]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Uh extends gt{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Bt extends gt{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Us extends gt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){let c=this.current;(o.func!==c.func||o.ref!==c.ref||o.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class ci extends gt{getDefault(){let o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class vi extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=o,this.dirty=!1}}class $s extends gt{getDefault(){return[0,1]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Tr extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=o,this.dirty=!1}}class Gc extends gt{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ra extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.BLEND):c.disable(c.BLEND),this.current=o,this.dirty=!1}}class Gs extends gt{getDefault(){let o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Hs extends gt{getDefault(){return r.C.transparent}set(o){let c=this.current;(o.r!==c.r||o.g!==c.g||o.b!==c.b||o.a!==c.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Hc extends gt{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class Pa extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;o?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=o,this.dirty=!1}}class Oa extends gt{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Sl extends gt{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let qc=class extends gt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class qi extends gt{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Wc extends gt{getDefault(){let o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){let c=this.current;(o[0]!==c[0]||o[1]!==c[1]||o[2]!==c[2]||o[3]!==c[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Zn extends gt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class $e extends gt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class te extends gt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindTexture(c.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class ie extends gt{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class pe extends gt{getDefault(){return null}set(o){let c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class ze extends gt{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Fe extends gt{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class lt extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class pt extends gt{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;let c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class je extends gt{constructor(o,c){super(o),this.context=o,this.parent=c}getDefault(){return null}}class Tt extends je{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Mt extends je{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ct extends je{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class In extends Mt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Bn{constructor(o,c,g,v,b){this.context=o,this.width=c,this.height=g;let E=this.framebuffer=o.gl.createFramebuffer();v&&(this.colorAttachment=new Tt(o,E)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Mt(o,E):new Ct(o,E))}destroy(){let o=this.context.gl;if(this.colorAttachment){let c=this.colorAttachment.get();c&&o.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let c=this.depthAttachment.get();c&&o.deleteRenderbuffer(c)}else{let c=this.depthAttachment.get();c&&o.deleteTexture(c)}o.deleteFramebuffer(this.framebuffer)}}class pr{constructor(o,c){this.gl=o,this.clearColor=new Or(this),this.clearDepth=new Vh(this),this.clearStencil=new Uc(this),this.colorMask=new $c(this),this.depthMask=new Uh(this),this.stencilMask=new Bt(this),this.stencilFunc=new Us(this),this.stencilOp=new ci(this),this.stencilTest=new vi(this),this.depthRange=new $s(this),this.depthTest=new Tr(this),this.depthFunc=new Gc(this),this.blend=new Ra(this),this.blendFunc=new Gs(this),this.blendColor=new Hs(this),this.blendEquation=new Hc(this),this.cullFace=new Pa(this),this.cullFaceSide=new Oa(this),this.frontFace=new Sl(this),this.program=new qc(this),this.activeTexture=new qi(this),this.viewport=new Wc(this),this.bindFramebuffer=new Zn(this),this.bindRenderbuffer=new $e(this),this.bindTexture=new te(this),this.bindVertexBuffer=new ie(this),this.bindElementBuffer=new pe(this),this.bindVertexArrayOES=new ze(this),this.pixelStoreUnpack=new Fe(this),this.pixelStoreUnpackPremultiplyAlpha=new lt(this),this.pixelStoreUnpackFlipY=new pt(this),this.options=c?It({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,c,g){return new r.I(this,o,c,g)}createVertexBuffer(o,c,g,v,b){return new Vs(this,o,c,g,v,b)}createRenderbuffer(o,c,g){let v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,o,c,g),this.bindRenderbuffer.set(null),b}createFramebuffer(o,c,g,v){return new Bn(this,o,c,g,v)}clear({color:o,depth:c,stencil:g,colorMask:v}){let b=this.gl,E=0;o&&(E|=b.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set(v||[!0,!0,!0,!0])),c!==void 0&&(E|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),g!==void 0&&(E|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),b.clear(E)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){M(o.blendFunction,r.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Nn{constructor(o=0,c=0,g=0,v=0){if(isNaN(o)||o<0||isNaN(c)||c<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=c,this.left=g,this.right=v}interpolate(o,c,g){return c.top!=null&&o.top!=null&&(this.top=r.n(o.top,c.top,g)),c.bottom!=null&&o.bottom!=null&&(this.bottom=r.n(o.bottom,c.bottom,g)),c.left!=null&&o.left!=null&&(this.left=r.n(o.left,c.left,g)),c.right!=null&&o.right!=null&&(this.right=r.n(o.right,c.right,g)),this}getCenter(o,c){let g=r.c((this.left+o-this.right)/2,0,o),v=r.c((this.top+c-this.bottom)/2,0,c);return new r.P(g,v)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Nn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function jn(p,o){let c=r.g(p,3);r.m.fromQuat(p,o),r.s(p,3,c)}function Dn(p,o){let c=r.q.identity([]);return r.q.rotateZ(c,c,-o),r.q.rotateX(c,c,-p),c}function Ir(p,o){let c=[p[0],p[1],0],g=[o[0],o[1],0];if(r.v.length(c)>=1e-15){let E=r.v.normalize([],c);r.v.scale(g,E,r.v.dot(g,E)),o[0]=g[0],o[1]=g[1]}let v=r.v.cross([],o,p);if(r.v.len(v)<1e-15)return null;let b=Math.atan2(-v[1],v[0]);return Dn(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class kr{constructor(o,c){this.position=o,this.orientation=c}get position(){return this._position}set position(o){if(o){let c=o instanceof r.M?o:new r.M(o[0],o[1],o[2]);this._renderWorldCopies&&(c.x=r.w(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(o,c){if(this.orientation=null,!this.position)return;let g=this.position,v=this._elevation?this._elevation.getAtPointOrZero(r.M.fromLngLat(o)):0,b=r.M.fromLngLat(o,v),E=[b.x-g.x,b.y-g.y,b.z-g.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Ir(E,c)}setPitchBearing(o,c){this.orientation=Dn(r.d(o),r.d(-c))}}class Ii{constructor(o,c){this._transform=r.m.identity([]),this.orientation=c,this.position=o}get mercatorPosition(){let o=this.position;return new r.M(o[0],o[1],o[2])}get position(){let o=r.g(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var c;o&&r.s(this._transform,3,[(c=o)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.q.identity([]),o&&jn(this._transform,this._orientation)}getPitchBearing(){let o=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,c){this._orientation=Dn(o,c),jn(this._transform,this._orientation)}forward(){let o=r.g(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){let o=r.g(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){let o=r.g(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,c){let g=new Float64Array(16);return r.m.invert(g,this.getWorldToCamera(o,c)),g}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,c,g){let v=this.position;r.v.scale(v,v,-o);let b=new Float64Array(16);return r.m.fromScaling(b,[g,g,g]),r.m.translate(b,b,v),b[10]*=c,b}getWorldToCamera(o,c){let g=new Float64Array(16),v=new Float64Array(4),b=this.position;return r.q.conjugate(v,this._orientation),r.v.scale(b,b,-o),r.m.fromQuat(g,v),r.m.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=c,g[9]*=c,g[10]*=c,g[11]*=c,g}getCameraToClipPerspective(o,c,g,v){let b=new Float64Array(16);return r.m.perspective(b,o,c,g,v),b}getCameraToClipOrthographic(o,c,g,v,b,E){let I=new Float64Array(16);return r.m.ortho(I,o,c,g,v,b,E),I}getDistanceToElevation(o,c=!1){let g=o===0?0:r.b(o,c?r.l(this.position[1]):this.position[1]),v=this.forward();return(g-this.position[2])/v[2]}clone(){return new Ii([...this.position],[...this.orientation])}}let Zr={unknown:0,flipRequired:1,flipNotRequired:2},Ao=Math.tan(85*Math.PI/180);function Lr(p,o,c,g,v,b,E){let I=r.m.create();if(c)if(b.name==="globe"){let C=r.f(v,o);r.m.multiply(I,I,C)}else{let C=r.h.invert([],E);I[0]=C[0],I[1]=C[1],I[4]=C[2],I[5]=C[3],g||r.m.rotateZ(I,I,v.angle)}else r.m.multiply(I,v.labelPlaneMatrix,p);return I}function Ro(p,o,c,g,v,b,E){let I=Lr(p,o,c,g,v,b,E);return b.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function os(p,o,c,g,v,b,E){if(c){if(b.name==="globe"){let I=Lr(p,o,c,g,v,b,E);return r.m.invert(I,I),r.m.multiply(I,p,I),I}{let I=r.m.clone(p),C=r.m.identity([]);return C[0]=E[0],C[1]=E[1],C[4]=E[2],C[5]=E[3],r.m.multiply(I,I,C),g||r.m.rotateZ(I,I,-v.angle),I}}return v.glCoordMatrix}function Fr(p,o,c,g){let v=[p,o,c,1];c?r.e.transformMat4(v,v,g):Nt(v,v,g);let b=v[3];return v[0]/=b,v[1]/=b,v[2]/=b,v}function Se(p,o){return Math.min(.5+p/o*.5,1.5)}function Ae(p,o){let c=p[0]/p[3],g=p[1]/p[3];return c>=-o[0]&&c<=o[0]&&g>=-o[1]&&g<=o[1]}function Ve(p,o,c,g,v,b,E,I,C,R){let O=c.transform,F=g?p.textSizeData:p.iconSizeData,z=r.i(F,c.transform.zoom),j=O.projection.name==="globe",U=[256/c.width*2+1,256/c.height*2+1],G=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;G.clear();let $=null;j&&($=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);let V=p.lineVertexArray,Y=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,ne=c.transform.width/c.transform.height,re,W=!1;for(let J=0;J<Y.length;J++){let oe=Y.get(J),{numGlyphs:ce,writingMode:ae}=oe;if(ae!==r.W.vertical||W||re===r.W.horizontal||(W=!0),re=ae,(oe.hidden||ae===r.W.vertical)&&!W){qe(ce,G);continue}W=!1;let ue=new r.P(oe.tileAnchorX,oe.tileAnchorY),{x:De,y:ve,z:we}=O.projection.projectTilePoint(ue.x,ue.y,R.canonical);if(C){let[et,mt,tt]=C(ue);De+=et,ve+=mt,we+=tt}let de=[De,ve,we,1];if(r.e.transformMat4(de,de,o),!Ae(de,U)){qe(ce,G);continue}let Ie=de[3],be=Se(c.transform.getCameraToCenterDistance(O.projection),Ie),Ce=r.j(F,z,oe),Q=E?Ce/be:Ce*be,me=Fr(De,ve,we,v);if(me[3]<=0){qe(ce,G);continue}let Le={},Re=E?null:C,ot=Ke(oe,Q,!1,I,o,v,b,p.glyphOffsetArray,V,G,$,me,ue,Le,ne,Re,O.projection,R,E);W=ot.useVertical,Re&&ot.needsFlipping&&(Le={}),(ot.notEnoughRoom||W||ot.needsFlipping&&Ke(oe,Q,!0,I,o,v,b,p.glyphOffsetArray,V,G,$,me,ue,Le,ne,Re,O.projection,R,E).notEnoughRoom)&&qe(ce,G)}g?(p.text.dynamicLayoutVertexBuffer.updateData(G),$&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData($)):(p.icon.dynamicLayoutVertexBuffer.updateData(G),$&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData($))}function Ge(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G){let{lineStartIndex:$,glyphStartIndex:V,segment:Y}=I,ne=V+I.numGlyphs,re=$+I.lineLength,W=o.getoffsetX(V),J=o.getoffsetX(ne-1),oe=ct(p*W,c,g,v,b,E,Y,$,re,C,R,O,F,z,!0,j,U,G);if(!oe)return null;let ce=ct(p*J,c,g,v,b,E,Y,$,re,C,R,O,F,z,!0,j,U,G);return ce?{first:oe,last:ce}:null}function We(p,o,c,g){return p===r.W.horizontal&&Math.abs(g)>Math.abs(c)?{useVertical:!0}:p===r.W.vertical?g>0?{needsFlipping:!0}:null:o!==Zr.unknown&&function(v,b){return v===0||Math.abs(b/v)>Ao}(c,g)?o===Zr.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Ke(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V,Y){let ne=o/24,re=p.lineOffsetX*ne,W=p.lineOffsetY*ne,{lineStartIndex:J,glyphStartIndex:oe,numGlyphs:ce,segment:ae,writingMode:ue,flipState:De}=p,ve=J+p.lineLength,we=de=>{if(O){let[Q,me,Le]=de.up,Re=R.length;r.u(O,Re+0,Q,me,Le),r.u(O,Re+1,Q,me,Le),r.u(O,Re+2,Q,me,Le),r.u(O,Re+3,Q,me,Le)}let[Ie,be,Ce]=de.point;r.k(R,Ie,be,Ce,de.angle)};if(ce>1){let de=Ge(ne,I,re,W,c,F,z,p,C,b,j,G,!1,$,V,Y);if(!de)return{notEnoughRoom:!0};if(g&&!c){let[Ie,be,Ce]=de.first.point,[Q,me,Le]=de.last.point;[Ie,be]=Fr(Ie,be,Ce,E),[Q,me]=Fr(Q,me,Le,E);let Re=We(ue,De,(Q-Ie)*U,me-be);if(p.flipState=Re&&Re.needsFlipping?Zr.flipRequired:Zr.flipNotRequired,Re)return Re}we(de.first);for(let Ie=oe+1;Ie<oe+ce-1;Ie++){let be=ct(ne*I.getoffsetX(Ie),re,W,c,F,z,ae,J,ve,C,b,j,G,!1,!1,$,V,Y);if(!be)return R.length-=4*(Ie-oe),{notEnoughRoom:!0};we(be)}we(de.last)}else{if(g&&!c){let Ie=Fr(z.x,z.y,0,v),be=J+ae+1,Ce=new r.P(C.getx(be),C.gety(be)),Q=Fr(Ce.x,Ce.y,0,v),me=Q[3]>0?Q:Xe(z,Ce,Ie,1,v,void 0,$,V.canonical),Le=We(ue,De,(me[0]-Ie[0])*U,me[1]-Ie[1]);if(p.flipState=Le&&Le.needsFlipping?Zr.flipRequired:Zr.flipNotRequired,Le)return Le}let de=ct(ne*I.getoffsetX(oe),re,W,c,F,z,ae,J,ve,C,b,j,G,!1,!1,$,V,Y);if(!de)return{notEnoughRoom:!0};we(de)}return{}}function Qe(p,o,c,g,v){let{x:b,y:E,z:I}=g.projectTilePoint(p.x,p.y,o);if(!v)return Fr(b,E,I,c);let[C,R,O]=v(p);return Fr(b+C,E+R,I+O,c)}function Xe(p,o,c,g,v,b,E,I){let C=Qe(p.sub(o)._unit()._add(p),I,v,E,b);return r.v.sub(C,c,C),r.v.normalize(C,C),r.v.scaleAndAdd(C,c,C,g)}function ct(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V){let Y=g?p-o:p+o,ne=Y>0?1:-1,re=0;g&&(ne*=-1,re=Math.PI),ne<0&&(re+=Math.PI);let W=I+E+(ne>0?0:1)|0,J=v,oe=v,ce=0,ae=0,ue=Math.abs(Y),De=[],ve=[],we=b,de=we,Ie=()=>Xe(de,we,oe,ue-ce+1,O,z,G,$.canonical);for(;ce+ae<=ue;){if(W+=ne,W<I||W>=C)return null;if(oe=J,de=we,De.push(oe),j&&ve.push(de),we=new r.P(R.getx(W),R.gety(W)),J=F[W],!J){let mt=Qe(we,$.canonical,O,G,z);J=mt[3]>0?F[W]=mt:Ie()}ce+=ae,ae=r.v.distance(oe,J)}U&&z&&(F[W]&&(J=Ie(),ae=r.v.distance(oe,J)),F[W]=J);let be=(ue-ce)/ae,Ce=we.sub(de)._mult(be)._add(de),Q=r.v.sub([],J,oe),me=r.v.scaleAndAdd([],oe,Q,be),Le=[0,0,1],Re=Q[0],ot=Q[1];if(V&&(Le=G.upVector($.canonical,Ce.x,Ce.y),Le[0]!==0||Le[1]!==0||Le[2]!==1)){let mt=[Le[2],0,-Le[0]],tt=r.v.cross([],Le,mt);r.v.normalize(mt,mt),r.v.normalize(tt,tt),Re=r.v.dot(Q,mt),ot=r.v.dot(Q,tt)}if(c){let mt=r.v.cross([],Le,Q);r.v.normalize(mt,mt),r.v.scaleAndAdd(me,me,mt,c*ne)}let et=re+Math.atan2(ot,Re);return De.push(me),j&&ve.push(Ce),{point:me,angle:et,path:De,tilePath:ve,up:Le}}function qe(p,o){let c=o.length,g=c+4*p;o.resize(g),o.float32.fill(-1/0,4*c,4*g)}function Nt(p,o,c){let g=o[0],v=o[1];return p[0]=c[0]*g+c[4]*v+c[12],p[1]=c[1]*g+c[5]*v+c[13],p[3]=c[3]*g+c[7]*v+c[15],p}let pn=(p,o,c)=>(1-c)*p+c*o,vt=p=>p*p*p*p*p;class vn{constructor(o,c,g,v,b,E,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=o||0,this._maxZoom=c||22,this._minPitch=g??0,this._maxPitch=v??60,this.setProjection(E),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Nn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ii,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let o=new vn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,c=!1){let g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||g)&&this._updateCameraOnTerrain(),(o||g)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.p(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};let c=this.projection?this.getProjection():void 0;this.projection=r.o(this.projectionOptions);let g=!M(c,this.getProjection());return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){let o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.o({name:"mercator"});let c=o!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){let o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.P(this.width,this.height)}get bearing(){return r.w(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){let c=-o*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=r.h.create(),r.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){let c=r.c(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=r.d(o),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){let c=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){let o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let g=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&g.exaggeration()&&this._centerAltitudeValidForExaggeration!==g.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*g.exaggeration(),this._centerAltitudeValidForExaggeration=g.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=g.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let o=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop(),v=0,b=0;for(let E=0;E<c.length;E++){let I=new r.P(c[E][0]*this.width,g+c[E][1]*(this.height-g)),C=o.pointCoordinate(I);if(!C)continue;let R=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);v+=C[3]*R,b+=R}return b===0?NaN:v/b}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let o=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*c,v=this._mercatorZfromZoom(o),b=this._mercatorZfromZoom(this._maxZoom),E=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(E))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){let c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude())),g;g=o.z<this._camera.position[2]?[c.x,c.y,c.z]:[o.x,o.y,o.z];let v=r.v.length(r.v.sub([],this._camera.position,g));return r.c(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let c=!1;if(o.orientation&&!r.q.exactEquals(o.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(o.orientation)),o.position){let g=[o.position.x,o.position.y,o.position.z];r.v.exactEquals(g,this._camera.position)||(this._setCameraPosition(g),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let o=this._camera.position,c=new kr;return c.position=new r.M(o[0],o[1],o[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(o){if(!r.q.length(o))return!1;r.q.normalize(o,o);let c=r.v.transformQuat([],[0,0,-1],o),g=r.v.transformQuat([],[0,-1,0],o);if(g[2]<0)return!1;let v=Ir(c,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(o){let c=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;o[2]=r.c(o[2],v/g,v/c),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,c,g){this._unmodified=!1,this._edgeInsets.interpolate(o,c,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){let c=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(o){let c=[new r.U(0,o)];if(this.renderWorldCopies){let g=this.pointCoordinate(new r.P(0,0)),v=this.pointCoordinate(new r.P(this.width,0)),b=this.pointCoordinate(new r.P(this.width,this.height)),E=this.pointCoordinate(new r.P(0,this.height)),I=Math.floor(Math.min(g.x,v.x,b.x,E.x)),C=Math.floor(Math.max(g.x,v.x,b.x,E.x)),R=1;for(let O=I-R;O<=C+R;O++)O!==0&&c.push(new r.U(O,o))}return c}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(o,c,g){let v=[];if(c[0]===0&&c[1]===0)return v;for(let E of o){let I=E.canonical,C=E.overscaledZ,R=E.wrap,O=1<<I.z,F=I.x+1<O,z=I.x>0,j=I.y+1<O,U=I.y>0,G=E.wrap-(z?0:1),$=E.wrap+(F?0:1),V=z?I.x-1:O-1,Y=F?I.x+1:0;c[0]<0?(v.push(new r.O(C,$,I.z,Y,I.y)),c[1]<0&&j&&(v.push(new r.O(C,R,I.z,I.x,I.y+1)),v.push(new r.O(C,$,I.z,Y,I.y+1))),c[1]>0&&U&&(v.push(new r.O(C,R,I.z,I.x,I.y-1)),v.push(new r.O(C,$,I.z,Y,I.y-1)))):c[0]>0?(v.push(new r.O(C,G,I.z,V,I.y)),c[1]<0&&j&&(v.push(new r.O(C,R,I.z,I.x,I.y+1)),v.push(new r.O(C,G,I.z,V,I.y+1))),c[1]>0&&U&&(v.push(new r.O(C,R,I.z,I.x,I.y-1)),v.push(new r.O(C,G,I.z,V,I.y-1)))):c[1]<0&&j?v.push(new r.O(C,R,I.z,I.x,I.y+1)):U&&v.push(new r.O(C,R,I.z,I.x,I.y-1))}if(v.length>1){v.sort((C,R)=>C.overscaledZ-R.overscaledZ||C.wrap-R.wrap||C.canonical.z-R.canonical.z||C.canonical.x-R.canonical.x||C.canonical.y-R.canonical.y);let E=0,I=0;for(;I<v.length;)v[I].equals(v[E])?++I:v[++E]=v[I++];v.length=E+1}let b=[];for(let E of v)v.some(I=>E.isChildOf(I))||b.push(E);return v=b.filter(E=>!o.some(I=>!!(E.overscaledZ<g&&I.isChildOf(E))||E.equals(I)||E.isChildOf(I))),v}coveringTiles(o){let c=this.coveringZoomLevel(o),g=c,v=this.elevation&&this.elevation.exaggeration(),b=v&&!o.isTerrainDEM,E=this.projection.name==="mercator";if(o.minzoom!==void 0&&c<o.minzoom)return[];o.maxzoom!==void 0&&c>o.maxzoom&&(c=o.maxzoom);let I=this.locationCoordinate(this.center),C=this.center.lat,R=1<<c,O=[R*I.x,R*I.y,0],F=this.projection.name==="globe",z=!F,j=r.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,z),U=F?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),G=R*r.b(1,this.center.lat),$=this._camera.position[2]/r.b(1,this.center.lat),V=[R*U.x,R*U.y,$*(z?1:G)],Y=F||v,ne=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),re=this.isLODDisabled(!0)?c:0,W;if(this._elevation&&o.isTerrainDEM)W=1e4*this._elevation.exaggeration();else if(this._elevation){let Q=this._elevation.getMinMaxForVisibleTiles();W=Q?Q.max:this._centerAltitude}else W=this._centerAltitude;let J=o.isTerrainDEM?-W:this._elevation?this._elevation.getMinElevationBelowMSL():0,oe=this.projection.isReprojectedInTileSpace?r.r(this):1,ce=Q=>{let Le=new r.M(Q.x+25e-6,Q.y,Q.z),Re=new r.M(Q.x,Q.y+25e-6,Q.z),ot=Q.toLngLat(),et=Le.toLngLat(),mt=Re.toLngLat(),tt=this.locationCoordinate(ot),xt=this.locationCoordinate(et),bt=this.locationCoordinate(mt),ht=Math.hypot(xt.x-tt.x,xt.y-tt.y),dt=Math.hypot(bt.x-tt.x,bt.y-tt.y);return Math.sqrt(ht*dt)*oe/25e-6},ae=Q=>{let me=W,Le=J;return{aabb:r.y(this,R,0,0,0,Q,Le,me,this.projection),zoom:0,x:0,y:0,minZ:Le,maxZ:me,wrap:Q,fullyVisible:!1}},ue=[],De=[],ve=c,we=o.reparseOverscaled?g:c,de=Q=>Q*Q,Ie=de(($-this._centerAltitude)*G),be=Q=>{if(!this._elevation||!Q.tileID||!E)return;let me=this._elevation.getMinMaxForTile(Q.tileID),Le=Q.aabb;me?(Le.min[2]=me.min,Le.max[2]=me.max,Le.center[2]=(Le.min[2]+Le.max[2])/2):(Q.shouldSplit=Ce(Q),Q.shouldSplit||(Le.min[2]=Le.max[2]=Le.center[2]=this._centerAltitude))},Ce=Q=>{if(Q.zoom<re)return!0;if(Q.zoom===ve)return!1;if(Q.shouldSplit!=null)return Q.shouldSplit;let me=Q.aabb.distanceX(V),Le=Q.aabb.distanceY(V),Re=Ie,ot=1;if(F){Re=de(Q.aabb.distanceZ(V));let tt=Math.pow(2,Q.zoom),xt=r.l((Q.y+1)/tt),bt=r.l(Q.y/tt),ht=Math.min(Math.max(C,xt),bt),dt=r.a0(ht)/r.a0(C);if(ot=ht===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,dt/this._mercatorScaleRatio),this.zoom<=r.Z&&Q.zoom===ve-1&&dt>=.9)return!0}else if(b&&(Re=de(Q.aabb.distanceZ(V)*G)),this.projection.isReprojectedInTileSpace&&g<=5){let tt=Math.pow(2,Q.zoom),xt=ce(new r.M((Q.x+.5)/tt,(Q.y+.5)/tt));ot=xt>.85?1:xt}let et=me*me+Le*Le+Re,mt=de((1<<ve-Q.zoom)*ne*ot*((tt,xt)=>{if(xt*de(.707)<tt)return 1;let bt=Math.sqrt(xt/tt);return bt/(1.4144271570014144+(Math.pow(1.1,bt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Re,Ie),et));return et<mt};if(this.renderWorldCopies)for(let Q=1;Q<=3;Q++)ue.push(ae(-Q)),ue.push(ae(Q));for(ue.push(ae(0));ue.length>0;){let Q=ue.pop(),me=Q.x,Le=Q.y,Re=Q.fullyVisible,ot=()=>this.projection.name==="globe"&&(Q.y===0||Q.y===(1<<Q.zoom)-1);if(!Re){let et=Y?Q.aabb.intersects(j):Q.aabb.intersectsFlat(j);if(et===0&&ot()){let mt=new r.t(Q.zoom,me,Le);et=r.x(this,R,mt,!0).intersects(j)}if(et===0)continue;Re=et===2}if(Q.zoom!==ve&&Ce(Q))for(let et=0;et<4;et++){let mt=(me<<1)+et%2,tt=(Le<<1)+(et>>1),xt={aabb:E?Q.aabb.quadrant(et):r.y(this,R,Q.zoom+1,mt,tt,Q.wrap,Q.minZ,Q.maxZ,this.projection),zoom:Q.zoom+1,x:mt,y:tt,wrap:Q.wrap,fullyVisible:Re,tileID:void 0,shouldSplit:void 0,minZ:Q.minZ,maxZ:Q.maxZ};b&&!F&&(xt.tileID=new r.O(Q.zoom+1===ve?we:Q.zoom+1,Q.wrap,Q.zoom+1,mt,tt),be(xt)),ue.push(xt)}else{let et=Q.zoom===ve?we:Q.zoom;if(o.minzoom&&o.minzoom>et)continue;if(!Re){let bt=Y?Q.aabb.intersectsPrecise(j):Q.aabb.intersectsPreciseFlat(j);if(bt===0&&ot()){let ht=new r.t(Q.zoom,me,Le);bt=r.x(this,R,ht,!0).intersectsPrecise(j)}if(bt===0)continue}let mt=O[0]-(.5+me+(Q.wrap<<Q.zoom))*(1<<c-Q.zoom),tt=O[1]-.5-Le,xt=Q.tileID?Q.tileID:new r.O(et,Q.wrap,Q.zoom,me,Le);De.push({tileID:xt,distanceSq:mt*mt+tt*tt})}}if(this.fogCullDistSq){let Q=this.fogCullDistSq,me=this.horizonLineFromTop();De=De.filter(Le=>{let Re=[0,0,0,1],ot=[r.J,r.J,0,1],et=this.calculateFogTileMatrix(Le.tileID.toUnwrapped());r.e.transformMat4(Re,Re,et),r.e.transformMat4(ot,ot,et);let mt=r.e.min([],Re,ot),tt=r.e.max([],Re,ot),xt=r.z(mt,tt);if(xt===0)return!0;let bt=!1,ht=this._elevation;if(ht&&xt>Q&&me!==0){let dt=this.calculateProjMatrix(Le.tileID.toUnwrapped()),nn;o.isTerrainDEM||(nn=ht.getMinMaxForTile(Le.tileID)),nn||(nn={min:J,max:W});let Lt=r._(this.rotation),Rn=[Lt[0]*r.J,Lt[1]*r.J,nn.max];r.v.transformMat4(Rn,Rn,dt),bt=(1-Rn[1])*this.height*.5<me}return xt<Q||bt})}return De.sort((Q,me)=>Q.distanceSq-me.distanceSq).map(Q=>Q.tileID)}resize(o,c){this.width=o,this.height=c,this.pixelsToGLUnits=[2/o,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){let c=r.c(o.lat,-r.A,r.A),g=this.projection.project(o.lng,c);return new r.P(g.x*this.worldSize,g.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,c){let g,v,b=this.centerPoint;if(this.projection.name==="globe"){let I=this.worldSize;g=(c.x-b.x)/I,v=(c.y-b.y)/I}else{let I=this.pointCoordinate(c),C=this.pointCoordinate(b);g=I.x-C.x,v=I.y-C.y}let E=this.locationCoordinate(o);this.setLocation(new r.M(E.x-g,E.y-v))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this.projection.locationPoint(this,o,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,c){let g=c?r.b(c,o.lat):void 0,v=this.projection.project(o.lng,o.lat);return new r.M(v.x,v.y,g)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,c){let g=c??this._centerAltitude,v=[o.x,o.y,0,1],b=[o.x,o.y,1,1];r.e.transformMat4(v,v,this.pixelMatrixInverse),r.e.transformMat4(b,b,this.pixelMatrixInverse);let E=b[3];r.e.scale(v,v,1/v[3]),r.e.scale(b,b,1/E);let I=v[2],C=b[2];return{p0:v,p1:b,t:I===C?0:(g-I)/(C-I)}}screenPointToMercatorRay(o){let c=[o.x,o.y,0,1],g=[o.x,o.y,1,1];return r.e.transformMat4(c,c,this.pixelMatrixInverse),r.e.transformMat4(g,g,this.pixelMatrixInverse),r.e.scale(c,c,1/c[3]),r.e.scale(g,g,1/g[3]),c[2]=r.b(c[2],this._center.lat)*this.worldSize,g[2]=r.b(g[2],this._center.lat)*this.worldSize,r.e.scale(c,c,1/this.worldSize),r.e.scale(g,g,1/this.worldSize),new r.R([c[0],c[1],c[2]],r.v.normalize([],r.v.sub([],g,c)))}rayIntersectionCoordinate(o){let{p0:c,p1:g,t:v}=o,b=r.b(c[2],this._center.lat),E=r.b(g[2],this._center.lat);return new r.M(r.n(c[0],g[0],v)/this.worldSize,r.n(c[1],g[1],v)/this.worldSize,r.n(b,E,v))}pointCoordinate(o,c=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,c)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);let c=this.projection.pointCoordinate3D(this,o.x,o.y);if(c)return new r.M(c[0],c[1],c[2]);let g=0,v=this.horizonLineFromTop();if(o.y>v)return this.pointCoordinate(o);let b=.02*v,E=o.clone();for(let I=0;I<10&&v-g>b;I++){E.y=r.n(g,v,.66);let C=this.projection.pointCoordinate3D(this,E.x,E.y);C?(v=E.y,c=C):g=E.y}return c?new r.M(c[0],c[1],c[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=r.G)return!this.isPointAboveHorizon(o);let c=this.pointCoordinate(o);return c.y>=0&&c.y<=1}_coordinatePoint(o,c){let g=c&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,v=[o.x*this.worldSize,o.y*this.worldSize,g+o.toAltitude(),1];return r.e.transformMat4(v,v,this.pixelMatrix),v[3]>0?new r.P(v[0]/v[3],v[1]/v[3]):new r.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:o,left:c}=this._edgeInsets,g=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.P(c,o)),E=this.pointLocation3D(new r.P(v,o)),I=this.pointLocation3D(new r.P(v,g)),C=this.pointLocation3D(new r.P(c,g)),R=Math.min(b.lng,E.lng,I.lng,C.lng),O=Math.max(b.lng,E.lng,I.lng,C.lng),F=Math.min(b.lat,E.lat,I.lat,C.lat),z=Math.max(b.lat,E.lat,I.lat,C.lat),j=Math.pow(2,-this.zoom)/16*270,U=this.projection.name==="globe"?1:4,G=($,V,Y,ne,re)=>{let W=($+Y)/2,J=(V+ne)/2,oe=new r.P(W,J),{lng:ce,lat:ae}=this.pointLocation3D(oe),ue=Math.max(0,R-ce,F-ae,ce-O,ae-z);R=Math.min(R,ce),O=Math.max(O,ce),F=Math.min(F,ae),z=Math.max(z,ae),(re<U||ue>j)&&(G($,V,W,J,re+1),G(W,J,Y,ne,re+1))};if(G(c,o,v,o,1),G(v,o,v,g,1),G(v,g,c,g,1),G(c,g,c,o,1),this.projection.name==="globe"){let[$,V]=r.B(this);$?(z=90,O=180,R=-180):V&&(F=-90,O=180,R=-180)}return new r.D(new r.L(R,F),new r.L(O,z))}_getBoundsRectangular(o,c){let{top:g,left:v}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,I=new r.P(v,g),C=new r.P(E,g),R=new r.P(E,b),O=new r.P(v,b),F=this.pointCoordinate(I,o),z=this.pointCoordinate(C,o),j=this.pointCoordinate(R,c),U=this.pointCoordinate(O,c),G=($,V)=>(V.y-$.y)/(V.x-$.x);return F.y>1&&z.y>=0?F=new r.M((1-U.y)/G(U,F)+U.x,1):F.y<0&&z.y<=1&&(F=new r.M(-U.y/G(U,F)+U.x,0)),z.y>1&&F.y>=0?z=new r.M((1-j.y)/G(j,z)+j.x,1):z.y<0&&F.y<=1&&(z=new r.M(-j.y/G(j,z)+j.x,0)),new r.D().extend(this.coordinateLocation(F)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j))}_getBoundsRectangularTerrain(){let o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);let c=o.visibleDemTiles.reduce((g,v)=>{if(v.dem){let b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*o.exaggeration(),c.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){let c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,g=this.height/2-c*(1-this._horizonShift);return o?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.A,this.maxLat=r.A,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.E(this.minLng)*this.tileSize,this.worldMaxX=r.E(this.maxLng)*this.tileSize,this.worldMinY=r.H(this.maxLat)*this.tileSize,this.worldMaxY=r.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,c){return this.projection.createTileMatrix(this,c,o)}calculateDistanceTileData(o){let c=o.key,g=this._distanceTileDataCache;if(g[c])return g[c];let v=o.canonical,b=1/this.height,E=this.cameraWorldSize,I=E/this.zoomScale(v.z),C=(v.x+Math.pow(2,v.z)*o.wrap)*I,R=v.y*I,O=this.point;O.x*=E/this.worldSize,O.y*=E/this.worldSize;let F=this.angle,z=Math.sin(-F),j=-Math.cos(-F);return g[c]={bearing:[z,j],center:[(O.x-C)*b,(O.y-R)*b],scale:I/r.J*b},g[c]}calculateFogTileMatrix(o){let c=o.key,g=this._fogTileMatrixCache;if(g[c])return g[c];let v=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return r.m.multiply(v,this.worldToFogMatrix,v),g[c]=new Float32Array(v),g[c]}calculateProjMatrix(o,c=!1,g=!1){let v=o.key,b;if(b=g?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,b[v])return b[v];let E=this.calculatePosMatrix(o,this.worldSize),I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,r.m.multiply(E,I,E),b[v]=new Float32Array(E),b[v]}calculatePixelsToTileUnitsMatrix(o){let c=o.tileID.key,g=this._pixelsToTileUnitsCache;if(g[c])return g[c];let v=r.K(o,this);return g[c]=v,g[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let o=1/this.worldSize,c=r.m.fromScaling([],[o,o,o]);return r.m.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let o=this._elevation;this._updateCameraState();let c=r.b(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(c),v=this._camera.forward(),b=r.b(1,this._center.lat);g[2]/=b,v[2]/=b,r.v.normalize(v,v);let E=o.raycast(g,v,o.exaggeration());if(E){let I=r.v.scaleAndAdd([],g,v,E),C=new r.M(I[0],I[1],r.b(I[2],r.l(I[1]))),R=(C.z+r.v.length([C.x-g[0],C.y-g[1],C.z-g[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(R),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;let c=this._elevation,g=r.b(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(g),b=c.getAtPointOrZero(new r.M(...v)),E=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),C=v[2]-E;if(C<=I)if(C<0||o){let R=this.locationCoordinate(this._center,this._centerAltitude),O=[v[0],v[1],R.z-v[2]],F=r.v.length(O);O[2]-=(I-C)/this._pixelsPerMercatorPixel;let z=r.v.length(O);if(z===0)return;r.v.scale(O,O,F/z*this._pixelsPerMercatorPixel),this._camera.position=[v[0],v[1],R.z*this._pixelsPerMercatorPixel-O[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){let z=this.center;return z.lat=r.c(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(z.lng=r.c(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}let c=this._unmodified,{x:g,y:v}=this.point,b=0,E=g,I=v,C=this.width/2,R=this.height/2,O=this.worldMinY*this.scale,F=this.worldMaxY*this.scale;if(v-R<O&&(I=O+R),v+R>F&&(I=F-R),F-O<this.height&&(b=Math.max(b,this.height/(F-O)),I=(F+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let z=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,U=this.worldSize/2-(z+j)/2;E=(g+U+this.worldSize)%this.worldSize-U,E-C<z&&(E=z+C),E+C>j&&(E=j-C),j-z<this.width&&(b=Math.max(b,this.width/(j-z)),E=(j+z)/2)}E===g&&I===v||(this.center=this.unproject(new r.P(E,I))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let o=this.centerOffset,c=this.projection.name==="globe",g=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.b(1,this.center.lat)/r.b(1,r.$));let v=r.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,v),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let b=this.projection.zAxisUnit==="meters"?g:1,E=this._camera.getWorldToCamera(this.worldSize,b),I,C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-o.x/this.width,C[9]=2*o.y/this.height,this.isOrthographic){let ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ue=ae*this.aspect,De=-ue,ve=-ae;ue-=o.x,De-=o.x,ae+=o.y,ve+=o.y,I=this._camera.getCameraToClipOrthographic(De,ue,ve,ae,this._nearZ,this._farZ),((we,de,Ie,be)=>{for(let Ce=0;Ce<16;Ce++)we[Ce]=pn(de[Ce],Ie[Ce],be)})(I,I,C,vt(this.pitch>=15?1:this.pitch/15))}else I=C;let R=r.m.mul([],C,E),O=r.m.mul([],I,E);if(this.projection.isReprojectedInTileSpace){let ae=this.locationCoordinate(this.center),ue=r.m.identity([]);r.m.translate(ue,ue,[ae.x*this.worldSize,ae.y*this.worldSize,0]),r.m.multiply(ue,ue,r.Q(this)),r.m.translate(ue,ue,[-ae.x*this.worldSize,-ae.y*this.worldSize,0]),r.m.multiply(O,O,ue),r.m.multiply(R,R,ue),this.inverseAdjustmentMatrix=r.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=r.m.scale([],O,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=O,this.invProjMatrix=r.m.invert(new Float64Array(16),this.projMatrix),c){let ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ae[8]=2*-o.x/this.width,ae[9]=2*o.y/this.height,this.expandedFarZProjMatrix=r.m.mul([],ae,E)}else this.expandedFarZProjMatrix=this.projMatrix;let F=r.m.invert([],I);this.frustumCorners=r.T.fromInvProjectionMatrix(F,this.horizonLineFromTop(),this.height),this.cameraFrustum=r.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);let z=new Float32Array(16);r.m.identity(z),r.m.scale(z,z,[1,-1,1]),r.m.rotateX(z,z,this._pitch),r.m.rotateZ(z,z,this.angle);let j=r.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=r.m.clone(j);let U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;j[8]=2*-o.x/this.width,j[9]=2*(o.y+U)/this.height,this.skyboxMatrix=r.m.multiply(z,j,z);let G=this.point,$=G.x,V=G.y,Y=this.width%2/2,ne=this.height%2/2,re=Math.cos(this.angle),W=Math.sin(this.angle),J=$-Math.round($)+re*Y+W*ne,oe=V-Math.round(V)+re*ne+W*Y,ce=new Float64Array(O);if(r.m.translate(ce,ce,[J>.5?J-1:J,oe>.5?oe-1:oe,0]),this.alignedProjMatrix=ce,O=r.m.create(),r.m.scale(O,O,[this.width/2,-this.height/2,1]),r.m.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=r.m.create(),r.m.scale(O,O,[1,-1,1]),r.m.translate(O,O,[-1,-1,0]),r.m.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=r.m.multiply(new Float64Array(16),this.labelPlaneMatrix,R),this._calcFogMatrices(),this._distanceTileDataCache={},O=r.m.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.V(this);let ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.v.transformMat4(ae,ae,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let o=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._pixelsPerMercatorPixel,b=[o,o,c];r.v.scale(b,b,v),r.v.scale(g,g,-1),r.v.multiply(g,g,b);let E=r.m.create();r.m.translate(E,E,g),r.m.scale(E,E,b),this.mercatorFogMatrix=E,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,c,v)}_computeCameraPosition(o){let c=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-o/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,o/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){let c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=this._camera.position[2],v=o[2],b=1;this.projection.wrap&&(this.center=this.center.wrap()),v>0&&(b=Math.min((c-g)/v,1)),this._camera.position=r.v.scaleAndAdd([],this._camera.position,o,b),this._updateStateFromCamera()}_updateStateFromCamera(){let o=this._camera.position,c=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=r.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,E=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.d(this._maxPitch)),I=Math.max((o[2]-b)/Math.cos(g),E),C=this._zoomFromMercatorZ(I);r.v.scaleAndAdd(o,o,c,I),this._pitch=r.c(g,r.d(this.minPitch),r.d(this.maxPitch)),this.angle=r.w(v,-Math.PI,Math.PI),this._setZoom(r.c(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.M(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){let o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}zoomFromMercatorZAdjusted(o){let c=0,g=r.G,v=0,b=1/0;for(;g-c>1e-6&&g>c;){let E=c+.5*(g-c),I=this.tileSize*Math.pow(2,E),C=this.getCameraToCenterDistance(this.projection,E,I),R=this.scaleZoom(C/(o*this.tileSize)),O=Math.abs(E-R);O<b&&(b=O,v=E),E<R?c=E:g=E}return v}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,c){let g=Math.min(o.x,c.x),v=Math.max(o.x,c.x),b=Math.min(o.y,c.y),E=Math.max(o.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let I=[new r.P(g,b),new r.P(v,E),new r.P(g,E),new r.P(v,b)],C=this.renderWorldCopies?-3:0,R=this.renderWorldCopies?4:1;for(let O of I){let F=this.pointRayIntersection(O);if(F.t<0)return!0;let z=this.rayIntersectionCoordinate(F);if(z.x<C||z.y<0||z.x>R||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.P(0,0),new r.P(this.width,this.height))}zoomDeltaToMovement(o,c){let g=r.v.length(r.v.sub([],this._camera.position,o)),v=this._zoomFromMercatorZ(g)+c;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if(this.projection.name==="globe"){let o=function([c,g,v],b){let E=[c,g,v,1];r.e.transformMat4(E,E,b);let I=E[3]=Math.max(E[3],1e-6);return E[0]/=I,E[1]/=I,E[2]/=I,E}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.P(o[0],o[1])}{let o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.P(0,o))}}getCameraToCenterDistance(o,c=this.zoom,g=this.worldSize){let v=r.N(o,c,this.width,this.height,1024),b=o.pixelSpaceConversion(this.center.lat,g,v),E=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(E=pn(1,E,vt(this.pitch>=15?1:this.pitch/15))),E}getWorldToCameraMatrix(){let o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.m.multiply(o,o,this.globeMatrix),o}getFrustum(o){return r.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}function Qn(p){let{userImage:o}=p;return!!(o&&o.render&&o.render())&&(p.data.replace(new Uint8Array(o.data.buffer)),!0)}class nr extends r.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(o){this.images[o]={},this.loaded[o]=!1,this.updatedImages[o]={},this.patterns[o]={},this.callbackDispatchedThisFrame[o]={},this.atlasImage[o]=new r.a5({width:1,height:1})}isLoaded(){for(let o in this.loaded)if(!this.loaded[o])return!1;return!0}setLoaded(o,c){if(this.loaded[c]!==o&&(this.loaded[c]=o,o)){for(let{ids:g,callback:v}of this.requestors)this._notify(g,c,v);this.requestors=[]}}hasImage(o,c){return!!this.getImage(o,c)}getImage(o,c){return this.images[c][o]}addImage(o,c,g){this._validate(o,g)&&(this.images[c][o]=g)}_validate(o,c){let g=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.a7(new Error(`Image "${o}" has invalid "stretchX" value`))),g=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.a7(new Error(`Image "${o}" has invalid "stretchY" value`))),g=!1),this._validateContent(c.content,c)||(this.fire(new r.a7(new Error(`Image "${o}" has invalid "content" value`))),g=!1),g}_validateStretch(o,c){if(!o)return!0;let g=0;for(let v of o){if(v[0]<g||v[1]<v[0]||c<v[1])return!1;g=v[1]}return!0}_validateContent(o,c){return!(o&&(o.length!==4||o[0]<0||c.data.width<o[0]||o[1]<0||c.data.height<o[1]||o[2]<0||c.data.width<o[2]||o[3]<0||c.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,c,g){g.version=this.images[c][o].version+1,this.images[c][o]=g,this.updatedImages[c][o]=!0}removeImage(o,c){let g=this.images[c][o];delete this.images[c][o],delete this.patterns[c][o],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(o){return Object.keys(this.images[o])}getImages(o,c,g){let v=!0,b=!!this.loaded[c];if(!b)for(let E of o)this.images[c][E]||(v=!1);b||v?this._notify(o,c,g):this.requestors.push({ids:o,scope:c,callback:g})}getUpdatedImages(o){return this.updatedImages[o]}_notify(o,c,g){let v={};for(let b of o){this.images[c][b]||this.fire(new r.a8("styleimagemissing",{id:b}));let E=this.images[c][b];E?v[b]={data:E.data.clone(),pixelRatio:E.pixelRatio,sdf:E.sdf,version:E.version,stretchX:E.stretchX,stretchY:E.stretchY,content:E.content,hasRenderCallback:!!(E.userImage&&E.userImage.render)}:r.X(`Image "${b}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,v)}getPixelSize(o){let{width:c,height:g}=this.atlasImage[o];return{width:c,height:g}}getPattern(o,c){let g=this.patterns[c][o],v=this.getImage(o,c);if(!v)return null;if(g&&g.position.version===v.version)return g.position;if(g)g.position.version=v.version;else{let b={w:v.data.width+2,h:v.data.height+2,x:0,y:0},E=new r.ab(b,v);this.patterns[c][o]={bin:b,position:E}}return this._updatePatternAtlas(c),this.patterns[c][o].position}bind(o,c){let g=o.gl,v=this.atlasTexture[c];v?this.dirty&&(v.update(this.atlasImage[c]),this.dirty=!1):(v=new r.a9(o,this.atlasImage[c],g.RGBA),this.atlasTexture[c]=v),v.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(o){let c=[];for(let E in this.patterns[o])c.push(this.patterns[o][E].bin);let{w:g,h:v}=r.aa(c),b=this.atlasImage[o];b.resize({width:g||1,height:v||1});for(let E in this.patterns[o]){let{bin:I}=this.patterns[o][E],C=I.x+1,R=I.y+1,O=this.images[o][E].data,F=O.width,z=O.height;r.a5.copy(O,b,{x:0,y:0},{x:C,y:R},{width:F,height:z}),r.a5.copy(O,b,{x:0,y:z-1},{x:C,y:R-1},{width:F,height:1}),r.a5.copy(O,b,{x:0,y:0},{x:C,y:R+z},{width:F,height:1}),r.a5.copy(O,b,{x:F-1,y:0},{x:C-1,y:R},{width:1,height:z}),r.a5.copy(O,b,{x:0,y:0},{x:C+F,y:R},{width:1,height:z})}this.dirty=!0}beginFrame(){for(let o in this.images)this.callbackDispatchedThisFrame[o]={}}dispatchRenderCallbacks(o,c){for(let g of o){if(this.callbackDispatchedThisFrame[c][g])continue;this.callbackDispatchedThisFrame[c][g]=!0;let v=this.images[c][g];Qn(v)&&this.updateImage(g,c,v)}}}let cr=new r.ac({anchor:new r.ad(r.ae.light.anchor),position:new r.af(r.ae.light.position),color:new r.ad(r.ae.light.color),intensity:new r.ad(r.ae.light.intensity)});class Br extends r.a6{constructor(o,c="flat"){super(),this._transitionable=new r.ag(cr),this.setLight(o,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,c,g={}){this._validate(r.ah,o,g)||(this._transitionable.setTransitionOrValue(o),this.id=c)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,g){return(!g||g.validate!==!1)&&r.ai(this,o.call(r.aj,r.ak({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.ae})))}}let xi=new r.ac({source:new r.ad(r.ae.terrain.source),exaggeration:new r.ad(r.ae.terrain.exaggeration)}),Di=class extends r.a6{constructor(p,o,c,g){super(),this.scope=c,this._transitionable=new r.ag(xi,c,g),this._transitionable.setTransitionOrValue(p,g),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o}get(){return this._transitionable.serialize()}set(p,o){this._transitionable.setTransitionOrValue(p,o)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new r.al(p)).get("exaggeration")}isZoomDependent(){let p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof r.am}},bi=45,jr=65,ui=.05;function Po(p,o,c,g){let v=r.an(bi,jr,c),[b,E]=ka(p,g),I=1-Math.min(1,Math.exp((o-b)/(E-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*v*p.alpha}function ka(p,o){let c=.5/Math.tan(.5*o);return[p.range[0]+c,p.range[1]+c]}function $h(p,o,c,g,v){let b=r.v.transformMat4([],[o,c,g],v.mercatorFogMatrix);return Po(p,r.v.length(b),v.pitch,v._fov)}function Zc(p,o,c,g,v,b,E){let I=[[c,g,0],[v,g,0],[v,b,0],[c,b,0]],C=Number.MAX_VALUE,R=-Number.MAX_VALUE;for(let O of I){let F=r.v.transformMat4([],O,o),z=r.v.length(F);C=Math.min(C,z),R=Math.max(R,z)}return[Po(p,C,E.pitch,E._fov),Po(p,R,E.pitch,E._fov)]}let Xc=new r.ac({range:new r.ad(r.ae.fog.range),color:new r.ad(r.ae.fog.color),"high-color":new r.ad(r.ae.fog["high-color"]),"space-color":new r.ad(r.ae.fog["space-color"]),"horizon-blend":new r.ad(r.ae.fog["horizon-blend"]),"star-intensity":new r.ad(r.ae.fog["star-intensity"]),"vertical-range":new r.ad(r.ae.fog["vertical-range"])});class Gh extends r.a6{constructor(o,c){super(),this._transitionable=new r.ag(Xc),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){let o=this._transform,c=o.projection.name==="globe",g=r.ao(o.zoom),v=this.properties.get("range"),b=[.5,3];return{range:c?[r.n(b[0],v[0],g),r.n(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,c={}){if(this._validate(r.ap,o,c))return;let g=r.ak({},o);for(let v of Object.keys(r.ae.fog))g[v]===void 0&&(g[v]=r.ae.fog[v].default);this._transitionable.setTransitionOrValue(g)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;let c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.an(bi,jr,o))*c.a}getOpacityAtLatLng(o,c){return this._transform.projection.supportsFog?function(g,v,b){let E=r.M.fromLngLat(v),I=b.elevation?b.elevation.getAtPointOrZero(E):0;return $h(g,E.x,E.y,I,b)}(this.state,o,c):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];let c=this._transform.calculateFogTileMatrix(o.toUnwrapped());return Zc(this.state,c,0,0,r.J,r.J,this._transform)}getOpacityForBounds(o,c,g,v,b){return this._transform.projection.supportsFog?Zc(this.state,o,c,g,v,b,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?ka(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;let c=[4,5,6,7];for(let g of c){let v=o.points[g],b;if(v[2]>=0)b=v;else{let E=o.points[g-4];b=r.aq(E,v,E[2]/(E[2]-v[2]))}if($h(this.state,b[0],b[1],0,this._transform)>=ui)return!0}return!1}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,c,g){return(!g||g.validate!==!1)&&r.ai(this,o.call(r.aj,r.ak({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.ae})))}}class Cl extends r.a6{constructor(o,c,g,v){super(),this.scope=g,this._options=o,this.properties=new r.ar(c),this._transitionable=new r.ag(c,g,new Map(v)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,c){this._options=o,this._transitionable.setTransitionOrValue(o.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let qs=new r.ac({color:new r.ad(r.ae.properties_light_ambient.color),intensity:new r.ad(r.ae.properties_light_ambient.intensity)}),Rp=new r.ac({direction:new r.as(r.ae.properties_light_directional.direction),color:new r.ad(r.ae.properties_light_directional.color),intensity:new r.ad(r.ae.properties_light_directional.intensity),"cast-shadows":new r.ad(r.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new r.ad(r.ae.properties_light_directional["shadow-intensity"])});class Xr{constructor(o,c,g,v){this.screenBounds=o,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(o,c){let g,v;if(o instanceof r.P||typeof o[0]=="number"){let b=r.P.convert(o);g=[b],v=c.isPointAboveHorizon(b)}else{let b=r.P.convert(o[0]),E=r.P.convert(o[1]);g=[b,E],v=r.at(b,E).every(I=>c.isPointAboveHorizon(I))}return new Xr(g,c.getCameraPoint(),v,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){let c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.at(c,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(v[3]=this.cameraPoint)),r.au(v,o)}bufferedCameraGeometryGlobe(o){let c=this.screenBounds[0],g=this.screenBounds.length===1?this.screenBounds[0].add(new r.P(1,1)):this.screenBounds[1],v=r.at(c,g,o),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>g.y))+((b.x>c.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(o,c,g,v=0){let b=o.queryPadding/c._pixelsPerMercatorPixel+1,E=g?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c),I=o.tileID.wrap+(E.unwrapped?v:0),C=E.polygon.map($=>r.av(o.tileTransform,$,I));if(!r.aw(C,0,0,r.J,r.J))return;I=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);let R=this.screenGeometryMercator.polygon.map($=>r.ax(o.tileTransform,$,I)),O=R.map($=>new r.P($[0],$[1])),F=c.getFreeCameraOptions().position||new r.M(0,0,0),z=r.ax(o.tileTransform,F,I),j=R.map($=>{let V=r.v.sub($,$,z);return r.v.normalize(V,V),new r.R(z,V)}),U=r.ay(o,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:j,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(G=r.az(C),G.min.x=r.c(G.min.x,0,r.J),G.min.y=r.c(G.min.y,0,r.J),G.max.x=r.c(G.max.x,0,r.J),G.max.y=r.c(G.max.y,0,r.J),G),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:U};var G}_bufferedScreenMercator(o,c){let g=Wi(o);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),c):{polygon:this.bufferedScreenGeometry(o).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(o,c){let g=Wi(o);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),c):{polygon:this.bufferedCameraGeometry(o).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(o,c){let g=function(b,E){let I=r.m.multiply([],E.pixelMatrix,E.globeMatrix),C=[0,-r.aC,0,1],R=[0,r.aC,0,1],O=[0,0,0,1];r.e.transformMat4(C,C,I),r.e.transformMat4(R,R,I),r.e.transformMat4(O,O,I);let F=new r.P(C[0]/C[3],C[1]/C[3]),z=new r.P(R[0]/R[3],R[1]/R[3]),j=r.aA(b,F)&&C[3]<O[3],U=r.aA(b,z)&&R[3]<O[3];if(!j&&!U)return null;let G=function(oe,ce,ae){for(let ue=1;ue<oe.length;ue++){let De=Ws(ce.pointCoordinate3D(oe[ue-1]).x),ve=Ws(ce.pointCoordinate3D(oe[ue]).x);if(ae<0){if(De<ve)return{idx:ue,t:-De/(ve-1-De)}}else if(ve<De)return{idx:ue,t:(1-De)/(ve+1-De)}}return null}(b,E,j?-1:1);if(!G)return null;let{idx:$,t:V}=G,Y=$>1?Yc(b.slice(0,$),E):[],ne=$<b.length?Yc(b.slice($),E):[];Y=Y.map(oe=>new r.P(Ws(oe.x),oe.y)),ne=ne.map(oe=>new r.P(Ws(oe.x),oe.y));let re=[...Y];re.length===0&&re.push(ne[ne.length-1]);let W=r.n(re[re.length-1].y,(ne.length===0?Y[0]:ne[0]).y,V),J;return J=j?[new r.P(0,W),new r.P(0,0),new r.P(1,0),new r.P(1,W)]:[new r.P(1,W),new r.P(1,1),new r.P(0,1),new r.P(0,W)],re.push(...J),ne.length===0?re.push(Y[0]):re.push(...ne),{polygon:re.map(oe=>new r.M(oe.x,oe.y)),unwrapped:!1}}(o,c);if(g)return g;let v=function(b,E){let I=!1,C=-1/0,R=0;for(let F=0;F<b.length-1;F++)b[F].x>C&&(C=b[F].x,R=F);for(let F=0;F<b.length-1;F++){let z=(R+F)%(b.length-1),j=b[z],U=b[z+1];Math.abs(j.x-U.x)>.5&&(j.x<U.x?(j.x+=1,z===0&&(b[b.length-1].x+=1)):(U.x+=1,z+1===b.length-1&&(b[0].x+=1)),I=!0)}let O=r.E(E.center.lng);return I&&O<Math.abs(O-1)&&b.forEach(F=>{F.x-=1}),{polygon:b,unwrapped:I}}(Yc(o,c).map(b=>new r.P(Ws(b.x),b.y)),c);return{polygon:v.polygon.map(b=>new r.M(b.x,b.y)),unwrapped:v.unwrapped}}}function Yc(p,o){return r.aB(p,c=>{let g=o.pointCoordinate3D(c);c.x=g.x,c.y=g.y},1/256)}function Ws(p){return p<0?1+p%1:p%1}function Wi(p){return 100*p|0}function Zs(p,o,c,g,v){let b=function(E,I){if(E)return v(E);if(I){p.url&&I.tiles&&p.tiles&&delete p.tiles;let C=r.p(r.ak(I,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);I.vector_layers&&(C.vectorLayers=I.vector_layers,C.vectorLayerIds=C.vectorLayers.map(R=>R.id)),C.tiles=o.canonicalizeTileset(C,p.url),v(null,C)}};return p.url?r.a1(o.transformRequest(o.normalizeSourceURL(p.url,null,c,g),r.a2.Source),b):r.a4.frame(()=>b(null,p))}class uo{constructor(o,c,g){this.bounds=r.D.convert(this.validateBounds(o)),this.minzoom=c||0,this.maxzoom=g||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){let c=Math.pow(2,o.z),g=Math.floor(r.E(this.bounds.getWest())*c),v=Math.floor(r.H(this.bounds.getNorth())*c),b=Math.ceil(r.E(this.bounds.getEast())*c),E=Math.ceil(r.H(this.bounds.getSouth())*c);return o.x>=g&&o.x<b&&o.y>=v&&o.y<E}}class ye extends r.a6{constructor(o,c,g,v){if(super(),this.id=o,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.ak(this,r.p(c,["url","scheme","tileSize","promoteId"])),this._options=r.ak({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(v),this._tileWorkers={},this._deduped=new r.aD}load(o){this._loaded=!1,this.fire(new r.a8("dataloading",{dataType:"source"}));let c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Zs(this._options,this.map._requestManager,c,g,(v,b)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),g&&g.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new r.a7(v))):b&&(r.ak(this,b),b.bounds&&(this.tileBounds=new uo(b.bounds,this.minzoom,this.maxzoom)),r.aH(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"content"}))),o&&o(v)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.ak({},this._options)}loadTile(o,c){let g=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(g,r.a2.Tile),data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:r.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster};if(v.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=c:o.request=o.actor.send("reloadTile",v,b.bind(this));else if(o.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",v,b.bind(this),void 0,!0);else{let E=r.aF.call({deduped:this._deduped},v,(I,C)=>{I||!C?b.call(this,I):(v.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},o.actor&&o.actor.send("loadTile",v,b.bind(this),void 0,!0))},!0);o.request={cancel:E}}function b(E,I){return delete o.request,o.aborted?c(null):E&&E.status!==404?c(E):(I&&I.resourceTiming&&(o.resourceTiming=I.resourceTiming),this.map._refreshExpiredTiles&&I&&o.setExpiryData(I),o.loadVectorData(I,this.map.painter),r.aG(this.dispatcher),c(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends r.a6{constructor(o,c,g,v){super(),this.id=o,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.ak({type:"raster"},c),r.ak(this,r.p(c,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new r.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=Zs(this._options,this.map._requestManager,null,null,(c,g)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.a7(c)):g&&(r.ak(this,g),g.bounds&&(this.tileBounds=new uo(g.bounds,this.minzoom,this.maxzoom)),r.aH(g.tiles),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"content"}))),o&&o(c)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();let o=r.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.ak({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,c){let g=r.a4.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);o.request=r.a3(this.map._requestManager.transformRequest(v,r.a2.Tile),(b,E,I,C)=>(delete o.request,o.aborted?(o.state="unloaded",c(null)):b?(o.state="errored",c(b)):E?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:I,expires:C}),o.setTexture(E,this.map.painter),o.state="loaded",r.aG(this.dispatcher),void c(null)):c(null)))}abortTile(o,c){o.request&&(o.request.cancel(),delete o.request),c()}unloadTile(o,c){o.texture&&o.texture instanceof r.a9?(o.destroy(!0),o.texture&&o.texture instanceof r.a9&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let ho={vector:ye,raster:ut,"raster-dem":class extends ut{constructor(p,o,c,g){super(p,o,c,g),this.type="raster-dem",this.maxzoom=22,this._options=r.ak({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(p.state="errored",o(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",o(null))}p.request=r.a3(this.map._requestManager.transformRequest(c,r.a2.Tile),(function(v,b,E,I){if(delete p.request,p.aborted)p.state="unloaded",o(null);else if(v)p.state="errored",o(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:E,expires:I});let C=ImageBitmap&&b instanceof ImageBitmap&&r.aI(),R=1-(b.width-r.aJ(b.width))/2;R<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));let O=C?b:r.a4.getImageData(b,R),F={uid:p.uid,coord:p.tileID,source:this.id,scope:this.scope,rawImageData:O,encoding:this.encoding,padding:R};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",F,g.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){let o=p.canonical,c=Math.pow(2,o.z),g=(o.x-1+c)%c,v=o.x===0?p.wrap-1:p.wrap,b=(o.x+1+c)%c,E=o.x+1===c?p.wrap+1:p.wrap,I={};return I[new r.O(p.overscaledZ,v,o.z,g,o.y).key]={backfilled:!1},I[new r.O(p.overscaledZ,E,o.z,b,o.y).key]={backfilled:!1},o.y>0&&(I[new r.O(p.overscaledZ,v,o.z,g,o.y-1).key]={backfilled:!1},I[new r.O(p.overscaledZ,p.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new r.O(p.overscaledZ,E,o.z,b,o.y-1).key]={backfilled:!1}),o.y+1<c&&(I[new r.O(p.overscaledZ,v,o.z,g,o.y+1).key]={backfilled:!1},I[new r.O(p.overscaledZ,p.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new r.O(p.overscaledZ,E,o.z,b,o.y+1).key]={backfilled:!1}),I}},geojson:class extends r.a6{constructor(p,o,c,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(g),this._data=o.data,this._options=r.ak({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;let v=r.J/this.tileSize;this.workerOptions=r.ak({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*v,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*v,extent:r.J,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.J,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*v,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterChildren(p,o){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},o),this}getClusterLeaves(p,o,c,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:o,offset:c},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.a8("dataloading",{dataType:"source"})),this._loaded=!1;let p=r.ak({},this.workerOptions);p.scope=this.scope;let o=this._data;typeof o=="string"?(p.request=this.map._requestManager.transformRequest(r.a4.resolveURL(o),r.a2.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,g)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.a7(c));else{let v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new r.a8("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,o){let c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;let g={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:r.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};p.request=this.actor.send(c,g,(v,b)=>(delete p.request,p.destroy(),p.aborted?o(null):v?o(v):(p.loadVectorData(b,this.map.painter,c==="reloadTile"),o(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends r.aK{constructor(p,o,c,g){super(p,o,c,g),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;let p=this.options;this.urls=[];for(let o of p.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.a2.Source).url);r.aL(this.urls,(o,c)=>{this._loaded=!0,o?this.fire(new r.a7(o)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){let o=this.video.seekable;p<o.start(0)||p>o.end(0)?this.fire(new r.a7(new r.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let p=this.map.painter.context,o=p.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.a9(p,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:r.aK,model:class extends r.a6{constructor(p,o,c,g){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=o}load(){let p=[];for(let o in this._options.models){let c=this._options.models[o],g=r.aO(this.map._requestManager.transformRequest(c.uri,r.a2.Model).url).then(v=>{if(!v)return;let b=r.aP(v),E=new r.aQ(o,c.position,c.orientation,b);E.computeBoundsAndApplyParent(),this.models.push(E)}).catch(v=>{this.fire(new r.a7(new Error(`Could not load model ${o} from ${c.uri}: ${v.message}`)))});p.push(g)}return Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new r.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(o=>{this.fire(new r.a7(new Error(`Could not load models: ${o.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,o){}serialize(){return{type:"model"}}},"batched-model":class extends r.a6{constructor(p,o,c,g){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(g)}onAdd(p){this.map=p,this.load()}load(p){this._loaded=!1,this.fire(new r.a8("dataloading",{dataType:"source"}));let o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map._worldview;this._tileJSONRequest=Zs(this._options,this.map._requestManager,o,c,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new r.a7(g))):v&&(r.ak(this,v),v.bounds&&(this.tileBounds=new uo(v.bounds,this.minzoom,this.maxzoom)),r.aH(v.tiles,this.map._requestManager._customAccessToken),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"content"}))),p&&p(g)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,o){let c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(c,r.a2.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=o;else{if(p.buckets){let b=Object.values(p.buckets);for(let E of b)E.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",g,v.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",g,v.bind(this),void 0,!0);function v(b,E){return p.aborted?o(null):b&&b.status!==404?o(b):(E&&(E.resourceTiming&&(p.resourceTiming=E.resourceTiming),this.map._refreshExpiredTiles&&p.setExpiryData(E),p.buckets=It(It({},p.buckets),E.buckets)),p.state="loaded",void o(null))}}serialize(){return r.ak({},this._options)}},canvas:class extends r.aK{constructor(p,o,c,g){super(p,o,c,g),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(v=>!Array.isArray(v)||v.length!==2||v.some(b=>typeof b!="number"))||this.fire(new r.a7(new r.aM(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.a7(new r.aM(`sources.${p}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.a7(new r.aM(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new r.a7(new r.aM(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.a7(new r.aM(`sources.${p}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let o=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof r.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.a9(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.a6{constructor(p,o,c,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=o,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new uo(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),r.ak(this,r.p(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new r.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){let{x:o,y:c,z:g}=p.canonical;return this._implementation.hasTile({x:o,y:c,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,o){let{x:c,y:g,z:v}=p.tileID.canonical,b=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:g,z:v},{signal:b.signal})).then((function(E){return delete p.request,p.aborted?(p.state="unloaded",o(null)):E===void 0?(p.state="errored",o(null)):E===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",o(null)):function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement}(E)?(this.loadTileData(p,E),p.state="loaded",void o(null)):(p.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(E=>{E.code!==20&&(p.state="errored",o(E))}),p.request.cancel=()=>b.abort()}loadTileData(p,o){p.setTexture(o,this._map.painter)}unloadTile(p,o){if(p.texture&&p.texture instanceof r.a9?(p.destroy(!0),p.texture&&p.texture instanceof r.a9&&this._map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){let{x:c,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:g,z:v})}o()}abortTile(p,o){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){let p=r.aE(this.id,this.scope);this._map.style.clearSource(p)}_update(){this.fire(new r.a8("data",{dataType:"source",sourceDataType:"content"}))}}},Zi=function(p,o,c,g){let v=new ho[o.type](p,o,c,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return r.aR(["load","abort","unload","serialize","prepare"],v),v};function ur(p,o){let c=r.m.identity([]);return r.m.scale(c,c,[.5*p.width,.5*-p.height,1]),r.m.translate(c,c,[1,-1,0]),r.m.multiply(c,c,p.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(c)}function Oo(p,o,c,g,v,b,E,I=!1){let C=p.tilesIn(g,E,I);C.sort(Xi);let R=[];for(let F of C)R.push({wrappedTileID:F.tile.tileID.wrapped().key,queryResults:F.tile.queryRenderedFeatures(o,c,p._state,F,v,b,ur(p.transform,F.tile.tileID),I)});let O=function(F){let z={},j={};for(let U of F){let G=U.queryResults,$=U.wrappedTileID,V=j[$]=j[$]||{};for(let Y in G){let ne=G[Y],re=V[Y]=V[Y]||{},W=z[Y]=z[Y]||[];for(let J of ne)re[J.featureIndex]||(re[J.featureIndex]=!0,W.push(J))}}return z}(R);for(let F in O)O[F].forEach(z=>{let j=z.feature,U=j.layer;U&&U.type!=="background"&&U.type!=="sky"&&U.type!=="slot"&&(j.source=U.source,U["source-layer"]&&(j.sourceLayer=U["source-layer"]),j.state=j.id!==void 0?p.getFeatureState(U["source-layer"],j.id):{})});return O}function Hy(p,o){let c=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],v={};for(let b=0;b<c.length;b++){let E=c[b],I=E.tileID.canonical.key;v[I]||(v[I]=!0,E.querySourceFeatures(g,o))}return g}function Xi(p,o){let c=p.tileID,g=o.tileID;return c.overscaledZ-g.overscaledZ||c.canonical.y-g.canonical.y||c.wrap-g.wrap||c.canonical.x-g.canonical.x}class Hh{constructor(o){this.style=o}processLayersChanged(){this.layers=[];for(let o in this.style._mergedLayers){let c=this.style._mergedLayers[o];if(c.type==="fill-extrusion")this.layers.push(c);else if(c.type==="model"){let g=this.style.getLayerSource(c);g&&g.type==="batched-model"&&this.layers.push(c)}}}updateZOffset(o,c){this.currentBuildingBuckets=[];for(let v=0;v<this.layers.length;++v){let b=this.layers[v],E=this.style.getLayerSourceCache(b),I=1;b.type==="fill-extrusion"&&(I=b.paint.get("fill-extrusion-opacity")>0?b.paint.get("fill-extrusion-vertical-scale"):0);let C=E?E.getTile(c):null;if(!C&&E&&c.canonical.z>E.getSource().minzoom){let R=c.scaledTo(Math.min(E.getSource().maxzoom,c.overscaledZ-1));for(;R.overscaledZ>=E.getSource().minzoom&&(C=E.getTile(R),!C&&R.overscaledZ!==0);)R=R.scaledTo(R.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:C?C.getBucket(b):null,tileID:C?C.tileID:c,verticalScale:I})}o.hasAnyZOffset=!1;let g=!1;for(let v=0;v<o.symbolInstances.length;v++){let b=o.symbolInstances.get(v),E=b.zOffset,I=this._getHeightAtTileOffset(c,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==-1?I:E,g||E===b.zOffset||(g=!0),o.hasAnyZOffset||b.zOffset===0||(o.hasAnyZOffset=!0)}g&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,c,g,v){let b=c,E=g;if(o.canonical.z!==v.canonical.z){let I=v.canonical,C=1/(1<<o.canonical.z-I.z);b=(c+o.canonical.x*r.J)*C-I.x*r.J|0,E=(g+o.canonical.y*r.J)*C-I.y*r.J|0}return{tileX:b,tileY:E}}_getHeightAtTileOffset(o,c,g){let v,b;for(let E=0;E<this.layers.length;++E){if(this.layers[E].type!=="fill-extrusion")continue;let{bucket:I,tileID:C,verticalScale:R}=this.currentBuildingBuckets[E];if(!I)continue;let{tileX:O,tileY:F}=this._mapCoordToOverlappingTile(o,c,g,C),z=I.getHeightAtTileCoord(O,F);z&&z.height!==void 0&&(z.hidden?v=z.height:b=Math.max(z.height*R,b||0))}if(b!==void 0)return b;for(let E=0;E<this.layers.length;++E){if(this.layers[E].type!=="model")continue;let{bucket:I,tileID:C}=this.currentBuildingBuckets[E];if(!I)continue;let{tileX:R,tileY:O}=this._mapCoordToOverlappingTile(o,c,g,C),F=I.getHeightAtTileCoord(R,O);if(F&&!F.hidden)return F.height===void 0&&v!==void 0?Math.min(F.maxHeight,v)*F.verticalScale:(F.height||0)*F.verticalScale}return-1}}function qy(p,o){let c={};for(let g in p)g!=="ref"&&(c[g]=p[g]);return r.aS.forEach(g=>{g in o&&(c[g]=o[g])}),c}function Xs(p){p=p.slice();let o=Object.create(null);for(let c=0;c<p.length;c++)o[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=qy(p[c],o[p[c].ref]));return p}let Pe={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function tn(p,o,c){c.push({command:Pe.addSource,args:[p,o[p]]})}function sn(p,o,c){o.push({command:Pe.removeSource,args:[p]}),c[p]=!0}function Mi(p,o,c,g){sn(p,c,g),tn(p,o,c)}function La(p,o,c){let g;for(g in p[c])if(p[c].hasOwnProperty(g)&&g!=="data"&&!M(p[c][g],o[c][g]))return!1;for(g in o[c])if(o[c].hasOwnProperty(g)&&g!=="data"&&!M(p[c][g],o[c][g]))return!1;return!0}function Kt(p,o,c,g,v,b){let E;for(E in o=o||{},p=p||{})p.hasOwnProperty(E)&&(M(p[E],o[E])||c.push({command:b,args:[g,E,o[E],v]}));for(E in o)o.hasOwnProperty(E)&&!p.hasOwnProperty(E)&&(M(p[E],o[E])||c.push({command:b,args:[g,E,o[E],v]}))}function Ys(p){return p.id}function ss(p,o){return p[o.id]=o,p}class Al{constructor(o,c){this.reset(o,c)}reset(o,c){this.points=o||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.c(o,0,1);let c=1,g=this._distances[c],v=o*this.paddedLength+this.padding;for(;g<v&&c<this._distances.length;)g=this._distances[++c];let b=c-1,E=this._distances[b],I=g-E,C=I>0?(v-E)/I:0;return this.points[b].mult(1-C).add(this.points[c].mult(C))}}class Yr{constructor(o,c,g){let v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(o/g),this.yCellCount=Math.ceil(c/g);for(let E=0;E<this.xCellCount*this.yCellCount;E++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=c,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,c,g,v,b){this._forEachCell(c,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(c),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(o,c,g,v){this._forEachCell(c-v,g-v,c+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(c),this.circles.push(g),this.circles.push(v)}_insertBoxCell(o,c,g,v,b,E){this.boxCells[b].push(E)}_insertCircleCell(o,c,g,v,b,E){this.circleCells[b].push(E)}_query(o,c,g,v,b,E){if(g<0||o>this.width||v<0||c>this.height)return!b&&[];let I=[];if(o<=0&&c<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let C=0;C<this.boxKeys.length;C++)I.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){let R=this.circles[3*C],O=this.circles[3*C+1],F=this.circles[3*C+2];I.push({key:this.circleKeys[C],x1:R-F,y1:O-F,x2:R+F,y2:O+F})}return E?I.filter(E):I}return this._forEachCell(o,c,g,v,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},E),b?I.length>0:I}_queryCircle(o,c,g,v,b){let E=o-g,I=o+g,C=c-g,R=c+g;if(I<0||E>this.width||R<0||C>this.height)return!v&&[];let O=[];return this._forEachCell(E,C,I,R,this._queryCellCircle,O,{hitTest:v,circle:{x:o,y:c,radius:g},seenUids:{box:{},circle:{}}},b),v?O.length>0:O}query(o,c,g,v,b){return this._query(o,c,g,v,!1,b)}hitTest(o,c,g,v,b){return this._query(o,c,g,v,!0,b)}hitTestCircle(o,c,g,v){return this._queryCircle(o,c,g,!0,v)}_queryCell(o,c,g,v,b,E,I,C){let R=I.seenUids,O=this.boxCells[b];if(O!==null){let z=this.bboxes;for(let j of O)if(!R.box[j]){R.box[j]=!0;let U=4*j;if(o<=z[U+2]&&c<=z[U+3]&&g>=z[U+0]&&v>=z[U+1]&&(!C||C(this.boxKeys[j]))){if(I.hitTest)return E.push(!0),!0;E.push({key:this.boxKeys[j],x1:z[U],y1:z[U+1],x2:z[U+2],y2:z[U+3]})}}}let F=this.circleCells[b];if(F!==null){let z=this.circles;for(let j of F)if(!R.circle[j]){R.circle[j]=!0;let U=3*j;if(this._circleAndRectCollide(z[U],z[U+1],z[U+2],o,c,g,v)&&(!C||C(this.circleKeys[j]))){if(I.hitTest)return E.push(!0),!0;{let G=z[U],$=z[U+1],V=z[U+2];E.push({key:this.circleKeys[j],x1:G-V,y1:$-V,x2:G+V,y2:$+V})}}}}}_queryCellCircle(o,c,g,v,b,E,I,C){let R=I.circle,O=I.seenUids,F=this.boxCells[b];if(F!==null){let j=this.bboxes;for(let U of F)if(!O.box[U]){O.box[U]=!0;let G=4*U;if(this._circleAndRectCollide(R.x,R.y,R.radius,j[G+0],j[G+1],j[G+2],j[G+3])&&(!C||C(this.boxKeys[U])))return E.push(!0),!0}}let z=this.circleCells[b];if(z!==null){let j=this.circles;for(let U of z)if(!O.circle[U]){O.circle[U]=!0;let G=3*U;if(this._circlesCollide(j[G],j[G+1],j[G+2],R.x,R.y,R.radius)&&(!C||C(this.circleKeys[U])))return E.push(!0),!0}}}_forEachCell(o,c,g,v,b,E,I,C){let R=this._convertToXCellCoord(o),O=this._convertToYCellCoord(c),F=this._convertToXCellCoord(g),z=this._convertToYCellCoord(v);for(let j=R;j<=F;j++)for(let U=O;U<=z;U++)if(b.call(this,o,c,g,v,this.xCellCount*U+j,E,I,C))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,c,g,v,b,E){let I=v-o,C=b-c,R=g+E;return R*R>I*I+C*C}_circleAndRectCollide(o,c,g,v,b,E,I){let C=(E-v)/2,R=Math.abs(o-(v+C));if(R>C+g)return!1;let O=(I-b)/2,F=Math.abs(c-(b+O));if(F>O+g)return!1;if(R<=C||F<=O)return!0;let z=R-C,j=F-O;return z*z+j*j<=g*g}}let Mn=100;class Wy{constructor(o,c,g=new Yr(o.width+200,o.height+200,25),v=new Yr(o.width+200,o.height+200,25)){this.transform=o,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Mn,this.screenBottomBoundary=o.height+Mn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=c}placeCollisionBox(o,c,g,v,b,E,I,C){let R=g.projectedAnchorX,O=g.projectedAnchorY,F=g.projectedAnchorZ,z=g.elevation,j=g.tileID,U=o.getProjection();if(z&&j){let[J,oe,ce]=U.upVector(j.canonical,g.tileAnchorX,g.tileAnchorY),ae=U.upVectorScale(j.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;R+=J*z*ae,O+=oe*z*ae,F+=ce*z*ae}let G=this.projectAndGetPerspectiveRatio(I,R,O,F,g.tileID,U.name==="globe"||!!z||this.transform.pitch>0,U),$=E*G.perspectiveRatio,V=(g.x1*c+v.x-g.padding)*$+G.point.x,Y=(g.y1*c+v.y-g.padding)*$+G.point.y,ne=(g.x2*c+v.x+g.padding)*$+G.point.x,re=(g.y2*c+v.y+g.padding)*$+G.point.y,W=G.perspectiveRatio<=.55||G.occluded;return!this.isInsideGrid(V,Y,ne,re)||!b&&this.grid.hitTest(V,Y,ne,re,C)||W?{box:[],offscreen:!1,occluded:G.occluded}:{box:[V,Y,ne,re],offscreen:this.isOffscreen(V,Y,ne,re),occluded:!1}}placeCollisionCircles(o,c,g,v,b,E,I,C,R,O,F,z,j,U,G){let $=[],V=this.transform.elevation,Y=o.getProjection(),ne=V?V.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,Y):null,re=new r.P(g.tileAnchorX,g.tileAnchorY),{x:W,y:J,z:oe}=Y.projectTilePoint(re.x,re.y,G.canonical);if(ne){let[Ce,Q,me]=ne(re);W+=Ce,J+=Q,oe+=me}let ce=Y.name==="globe",ae=this.projectAndGetPerspectiveRatio(I,W,J,oe,G,ce||!!V||this.transform.pitch>0,Y),{perspectiveRatio:ue}=ae,De=(F?E/ue:E*ue)/r.aV,ve=Fr(W,J,oe,C),we=ae.signedDistanceFromCamera>0?Ge(De,b,g.lineOffsetX*De,g.lineOffsetY*De,!1,ve,re,g,v,C,{},V&&!F?ne:null,F&&!!V,Y,G,F):null,de=!1,Ie=!1,be=!0;if(we&&!ae.occluded){let Ce=.5*j*ue+U,Q=new r.P(-100,-100),me=new r.P(this.screenRightBoundary,this.screenBottomBoundary),Le=new Al,{first:Re,last:ot}=we,et=Re.path.length,mt=[];for(let bt=et-1;bt>=1;bt--)mt.push(Re.path[bt]);for(let bt=1;bt<ot.path.length;bt++)mt.push(ot.path[bt]);let tt=2.5*Ce;R&&(mt=mt.map(([bt,ht,dt],nn)=>(ne&&!ce&&(dt=ne(nn<et-1?Re.tilePath[et-1-nn]:ot.tilePath[nn-et+2])[2]),Fr(bt,ht,dt,R))),mt.some(bt=>bt[3]<=0)&&(mt=[]));let xt=[];if(mt.length>0){let bt=1/0,ht=-1/0,dt=1/0,nn=-1/0;for(let Lt of mt)bt=Math.min(bt,Lt[0]),dt=Math.min(dt,Lt[1]),ht=Math.max(ht,Lt[0]),nn=Math.max(nn,Lt[1]);ht>=Q.x&&bt<=me.x&&nn>=Q.y&&dt<=me.y&&(xt=[mt.map(Lt=>new r.P(Lt[0],Lt[1]))],(bt<Q.x||ht>me.x||dt<Q.y||nn>me.y)&&(xt=r.aT(xt,Q.x,Q.y,me.x,me.y)))}for(let bt of xt){Le.reset(bt,.25*Ce);let ht=0;ht=Le.length<=.5*Ce?1:Math.ceil(Le.paddedLength/tt)+1;for(let dt=0;dt<ht;dt++){let nn=dt/Math.max(ht-1,1),Lt=Le.lerp(nn),Rn=Lt.x+Mn,xn=Lt.y+Mn;$.push(Rn,xn,Ce,0);let Qr=Rn-Ce,Ri=xn-Ce,mn=Rn+Ce,an=xn+Ce;if(be=be&&this.isOffscreen(Qr,Ri,mn,an),Ie=Ie||this.isInsideGrid(Qr,Ri,mn,an),!c&&this.grid.hitTestCircle(Rn,xn,Ce,z)&&(de=!0,!O))return{circles:[],offscreen:!1,collisionDetected:de,occluded:!1}}}}return{circles:!O&&de||!Ie?[]:$,offscreen:be,collisionDetected:de,occluded:ae.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let c=[],g=1/0,v=1/0,b=-1/0,E=-1/0;for(let O of o){let F=new r.P(O.x+Mn,O.y+Mn);g=Math.min(g,F.x),v=Math.min(v,F.y),b=Math.max(b,F.x),E=Math.max(E,F.y),c.push(F)}let I=this.grid.query(g,v,b,E).concat(this.ignoredGrid.query(g,v,b,E)),C={},R={};for(let O of I){let F=O.key;if(C[F.bucketInstanceId]===void 0&&(C[F.bucketInstanceId]={}),C[F.bucketInstanceId][F.featureIndex])continue;let z=[new r.P(O.x1,O.y1),new r.P(O.x2,O.y1),new r.P(O.x2,O.y2),new r.P(O.x1,O.y2)];r.aU(c,z)&&(C[F.bucketInstanceId][F.featureIndex]=!0,R[F.bucketInstanceId]===void 0&&(R[F.bucketInstanceId]=[]),R[F.bucketInstanceId].push(F.featureIndex))}return R}insertCollisionBox(o,c,g,v,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,c,g,v,b){let E=c?this.ignoredGrid:this.grid,I={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let C=0;C<o.length;C+=4)E.insertCircle(I,o[C],o[C+1],o[C+2])}projectAndGetPerspectiveRatio(o,c,g,v,b,E,I){let C=[c,g,v,1],R=!1;v||this.transform.pitch>0?(r.e.transformMat4(C,C,o),this.fogState&&b&&I.name!=="globe"&&(R=function(z,j,U,G,$,V){let Y=V.calculateFogTileMatrix($),ne=[j,U,G];return r.v.transformMat4(ne,ne,Y),Po(z,r.v.length(ne),V.pitch,V._fov)}(this.fogState,c,g,v,b.toUnwrapped(),this.transform)>.9)):Nt(C,C,o);let O=C[3];return{point:new r.P((C[0]/O+1)/2*this.transform.width+Mn,(-C[1]/O+1)/2*this.transform.height+Mn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/O*.5,1.5),signedDistanceFromCamera:O,occluded:E&&C[2]>O||R}}isOffscreen(o,c,g,v){return g<Mn||o>=this.screenRightBoundary||v<Mn||c>this.screenBottomBoundary}isInsideGrid(o,c,g,v){return g>=0&&o<this.gridRightBoundary&&v>=0&&c<this.gridBottomBoundary}getViewportMatrix(){let o=r.m.identity([]);return r.m.translate(o,o,[-100,-100,0]),o}}function Js(p,o,c){let g=o.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.m.multiply(new Float32Array(16),p.projMatrix,g)}function qh(p,o,c){if(o.projection.name===c.projection.name)return p.projMatrix;let g=c.clone();return g.setProjection(o.projection),Js(g,o.getProjection(),p)}function Ks(p,o,c){return o.name===c.projection.name?p.projMatrix:Js(c,o,p)}class Jc{constructor(o,c,g,v){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?c:-c))):v&&g?1:0,this.placed=g}isHidden(){return this.opacity===0&&!this.placed}}class Fa{constructor(o,c,g,v,b,E=!1){this.text=new Jc(o?o.text:null,c,g,b),this.icon=new Jc(o?o.icon:null,c,v,b),this.clipped=E}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Na{constructor(o,c,g,v=!1){this.text=o,this.icon=c,this.skipFade=g,this.clipped=v}}class Wh{constructor(){this.invProjMatrix=r.m.create(),this.viewportMatrix=r.m.create(),this.circles=[]}}class Kc{constructor(o,c,g,v,b){this.bucketInstanceId=o,this.featureIndex=c,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class Zh{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){let c=++this.maxGroupID;this.collisionGroups[o]={ID:c,predicate:g=>g.collisionGroupID===c}}return this.collisionGroups[o]}}function Jr(p,o,c,g,v){let{horizontalAlign:b,verticalAlign:E}=r.aY(p),I=-(b-.5)*o,C=-(E-.5)*c,R=r.aW(p,g);return new r.P(I+R[0]*v,C+R[1]*v)}function Vn(p,o,c,g,v){let b=new r.P(p,o);return c&&b._rotate(g?v:-v),b}class Xh{constructor(o,c,g,v,b,E){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new Wy(this.transform,b),this.buildingIndex=E,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Zh(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,c,g,v){let b=g.getBucket(c),E=g.latestFeatureIndex;if(!b||!E||c.fqid!==b.layerIds[0])return;let I=b.layers[0].layout,C=g.collisionBoxArray,R=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),O=g.tileSize/r.J,F=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);let z=(j=g.tileID,U=b.getProjection(),G=this.transform,U.name===this.projection?G.calculateProjMatrix(j.toUnwrapped()):Js(G,U,j));var j,U,G;let $=I.get("text-pitch-alignment")==="map",V=I.get("text-rotation-alignment")==="map";c.compileFilter();let Y=c.dynamicFilter(),ne=c.dynamicFilterNeedsFeature(),re=this.transform.calculatePixelsToTileUnitsMatrix(g),W=Ro(z,g.tileID.canonical,$,V,this.transform,b.getProjection(),re),J=null;if($){let ae=os(z,g.tileID.canonical,$,V,this.transform,b.getProjection(),re);J=r.m.multiply([],this.transform.labelPlaneMatrix,ae)}let oe=null;Y&&g.latestFeatureIndex&&(oe={unwrappedTileID:F,dynamicFilter:Y,dynamicFilterNeedsFeature:ne,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new Kc(b.bucketInstanceId,E,b.sourceLayerIndex,b.index,g.tileID);let ce={bucket:b,layout:I,posMatrix:z,textLabelPlaneMatrix:W,labelToScreenMatrix:J,clippingData:oe,scale:R,textPixelRatio:O,holdingForFade:g.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:r.i(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.i(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(let ae of b.sortKeyRanges){let{sortKey:ue,symbolInstanceStart:De,symbolInstanceEnd:ve}=ae;o.push({sortKey:ue,symbolInstanceStart:De,symbolInstanceEnd:ve,parameters:ce})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V,Y){let{textOffset0:ne,textOffset1:re,crossTileID:W}=z,J=[ne,re],oe=Jr(o,g,v,J,b),ce=this.collisionIndex.placeCollisionBox(U,b,c,Vn(oe.x,oe.y,E,I,this.transform.angle),F,C,R,O.predicate);if($){let ae=U.getSymbolInstanceIconSize(Y,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(U,ae,$,Vn(oe.x,oe.y,E,I,this.transform.angle),F,C,R,O.predicate).box.length===0)return}if(ce.box.length>0){let ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[W]&&this.prevPlacement.placements[W]&&this.prevPlacement.placements[W].text&&(ae=this.prevPlacement.variableOffsets[W].anchor),this.variableOffsets[W]={textOffset:J,width:g,height:v,anchor:o,textScale:b,prevAnchor:ae},this.markUsedJustification(U,o,z,G),U.allowVerticalPlacement&&(this.markUsedOrientation(U,G,z),this.placedOrientations[W]=G),{shift:oe,placedGlyphBoxes:ce}}}placeLayerBucketPart(o,c,g,v){let{bucket:b,layout:E,posMatrix:I,textLabelPlaneMatrix:C,labelToScreenMatrix:R,clippingData:O,textPixelRatio:F,holdingForFade:z,collisionBoxArray:j,partiallyEvaluatedTextSize:U,partiallyEvaluatedIconSize:G,collisionGroup:$}=o.parameters,V=E.get("text-optional"),Y=E.get("icon-optional"),ne=E.get("text-allow-overlap"),re=E.get("icon-allow-overlap"),W=E.get("text-rotation-alignment")==="map",J=E.get("text-pitch-alignment")==="map",oe=E.get("symbol-z-order")==="viewport-y",ce=E.get("symbol-z-elevate");this.transform.setProjection(b.projection);let ae=ne&&(re||!b.hasIconData()||Y),ue=re&&(ne||!b.hasTextData()||V);!b.collisionArrays&&j&&b.deserializeCollisionBoxes(j),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,j);let De=(ve,we,de)=>{let{crossTileID:Ie,numVerticalGlyphVertices:be}=ve;if(O){let mn={zoom:this.transform.zoom,pitch:this.transform.pitch},an=null;if(O.dynamicFilterNeedsFeature){let cn=this.retainedQueryData[b.bucketInstanceId];an=O.featureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:cn.bucketIndex,sourceLayerIndex:cn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,O.dynamicFilter)(mn,an,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.P(ve.tileAnchorX,ve.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Ie]=new Na(!1,!1,!1,!0),void c.add(Ie)}if(c.has(Ie))return;if(z)return void(this.placements[Ie]=new Na(!1,!1,!1));let Ce=!1,Q=!1,me=!0,Le=!1,Re=!1,ot=null,et={box:null,offscreen:null,occluded:null},mt={box:null,offscreen:null,occluded:null},tt=null,xt=null,bt=null,ht=0,dt=0,nn=0;de.textFeatureIndex?ht=de.textFeatureIndex:ve.useRuntimeCollisionCircles&&(ht=ve.featureIndex),de.verticalTextFeatureIndex&&(dt=de.verticalTextFeatureIndex);let Lt=mn=>{mn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;let an=this.transform.elevation;mn.elevation=ve.zOffset+(an?an.getAtTileOffset(mn.tileID,mn.tileAnchorX,mn.tileAnchorY):0)},Rn=de.textBox;if(Rn){Lt(Rn);let mn=cn=>{let Un=r.W.horizontal;if(b.allowVerticalPlacement&&!cn&&this.prevPlacement){let Dr=this.prevPlacement.placedOrientations[Ie];Dr&&(this.placedOrientations[Ie]=Dr,Un=Dr,this.markUsedOrientation(b,Un,ve))}return Un},an=(cn,Un)=>{if(b.allowVerticalPlacement&&be>0&&de.verticalTextBox){for(let Dr of b.writingModes)if(Dr===r.W.vertical?(et=Un(),mt=et):et=cn(),et&&et.box&&et.box.length)break}else et=cn()};if(E.get("text-variable-anchor")){let cn=E.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ie]){let kn=this.prevPlacement.variableOffsets[Ie];cn.indexOf(kn.anchor)>0&&(cn=cn.filter(Vr=>Vr!==kn.anchor),cn.unshift(kn.anchor))}let Un=(kn,Vr,ei)=>{let Ur=b.getSymbolInstanceTextSize(U,ve,this.transform.zoom,we),Pi=(kn.x2-kn.x1)*Ur+2*kn.padding,Fo=(kn.y2-kn.y1)*Ur+2*kn.padding,eo=ve.hasIconTextFit&&!re?Vr:null;eo&&Lt(eo);let En={box:[],offscreen:!1,occluded:!1},to=ne?2*cn.length:cn.length;for(let go=0;go<to;++go){let No=this.attemptAnchorPlacement(cn[go%cn.length],kn,Pi,Fo,Ur,W,J,F,I,$,go>=cn.length,ve,we,b,ei,eo,U,G);if(No&&(En=No.placedGlyphBoxes,En&&En.box&&En.box.length)){Ce=!0,ot=No.shift;break}}return En};an(()=>Un(Rn,de.iconBox,r.W.horizontal),()=>{let kn=de.verticalTextBox;return kn&&Lt(kn),b.allowVerticalPlacement&&!(et&&et.box&&et.box.length)&&be>0&&kn?Un(kn,de.verticalIconBox,r.W.vertical):{box:null,offscreen:null,occluded:null}}),et&&(Ce=et.box,me=et.offscreen,Le=et.occluded);let Dr=mn(!(!et||!et.box));if(!Ce&&this.prevPlacement){let kn=this.prevPlacement.variableOffsets[Ie];kn&&(this.variableOffsets[Ie]=kn,this.markUsedJustification(b,kn.anchor,ve,Dr))}}else{let cn=(Un,Dr)=>{let kn=b.getSymbolInstanceTextSize(U,ve,this.transform.zoom,we),Vr=this.collisionIndex.placeCollisionBox(b,kn,Un,new r.P(0,0),ne,F,I,$.predicate);return Vr&&Vr.box&&Vr.box.length&&(this.markUsedOrientation(b,Dr,ve),this.placedOrientations[Ie]=Dr),Vr};an(()=>cn(Rn,r.W.horizontal),()=>{let Un=de.verticalTextBox;return b.allowVerticalPlacement&&be>0&&Un?(Lt(Un),cn(Un,r.W.vertical)):{box:null,offscreen:null,occluded:null}}),mn(!!(et&&et.box&&et.box.length))}}if(tt=et,Ce=tt&&tt.box&&tt.box.length>0,me=tt&&tt.offscreen,Le=tt&&tt.occluded,ve.useRuntimeCollisionCircles){let mn=b.text.placedSymbolArray.get(ve.centerJustifiedTextSymbolIndex>=0?ve.centerJustifiedTextSymbolIndex:ve.verticalPlacedTextSymbolIndex),an=r.j(b.textSizeData,U,mn),cn=E.get("text-padding");xt=this.collisionIndex.placeCollisionCircles(b,ne,mn,b.lineVertexArray,b.glyphOffsetArray,an,I,C,R,g,J,$.predicate,ve.collisionCircleDiameter*an/r.aV,cn,this.retainedQueryData[b.bucketInstanceId].tileID),Ce=ne||xt.circles.length>0&&!xt.collisionDetected,me=me&&xt.offscreen,Le=xt.occluded}if(de.iconFeatureIndex&&(nn=de.iconFeatureIndex),de.iconBox){let mn=an=>{Lt(an);let cn=ve.hasIconTextFit&&ot?Vn(ot.x,ot.y,W,J,this.transform.angle):new r.P(0,0),Un=b.getSymbolInstanceIconSize(G,this.transform.zoom,ve.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Un,an,cn,re,F,I,$.predicate)};mt&&mt.box&&mt.box.length&&de.verticalIconBox?(bt=mn(de.verticalIconBox),Q=bt.box.length>0):(bt=mn(de.iconBox),Q=bt.box.length>0),me=me&&bt.offscreen,Re=bt.occluded}let xn=V||ve.numHorizontalGlyphVertices===0&&be===0,Qr=Y||ve.numIconVertices===0;if(xn||Qr?Qr?xn||(Q=Q&&Ce):Ce=Q&&Ce:Q=Ce=Q&&Ce,Ce&&tt&&tt.box&&this.collisionIndex.insertCollisionBox(tt.box,E.get("text-ignore-placement"),b.bucketInstanceId,mt&&mt.box&&dt?dt:ht,$.ID),Q&&bt&&this.collisionIndex.insertCollisionBox(bt.box,E.get("icon-ignore-placement"),b.bucketInstanceId,nn,$.ID),xt&&(Ce&&this.collisionIndex.insertCollisionCircles(xt.circles,E.get("text-ignore-placement"),b.bucketInstanceId,ht,$.ID),g)){let mn=b.bucketInstanceId,an=this.collisionCircleArrays[mn];an===void 0&&(an=this.collisionCircleArrays[mn]=new Wh);for(let cn=0;cn<xt.circles.length;cn+=4)an.circles.push(xt.circles[cn+0]),an.circles.push(xt.circles[cn+1]),an.circles.push(xt.circles[cn+2]),an.circles.push(xt.collisionDetected?1:0)}let Ri=b.projection.name!=="globe";ae=ae&&(Ri||!Le),ue=ue&&(Ri||!Re),this.placements[Ie]=new Na(Ce||ae,Q||ue,me||b.justReloaded),c.add(Ie)};if(ce&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,this.retainedQueryData[b.bucketInstanceId].tileID),b.updateZOffset()),oe){let ve=b.getSortedSymbolIndexes(this.transform.angle);for(let we=ve.length-1;we>=0;--we){let de=ve[we];De(b.symbolInstances.get(de),de,b.collisionArrays[de])}b.hasAnyZOffset&&r.X(`${b.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(b.hasAnyZOffset){let ve=b.getSortedIndexesByZOffset();for(let we=0;we<ve.length;++we){let de=ve[we];De(b.symbolInstances.get(de),de,b.collisionArrays[de])}}else for(let ve=o.symbolInstanceStart;ve<o.symbolInstanceEnd;ve++)De(b.symbolInstances.get(ve),ve,b.collisionArrays[ve]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){let ve=this.collisionCircleArrays[b.bucketInstanceId];r.m.invert(ve.invProjMatrix,I),ve.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(o,c,g,v){let{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:E,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:C,crossTileID:R}=g,O=r.aX(c),F=v===r.W.vertical?C:O==="left"?b:O==="center"?E:O==="right"?I:-1;b>=0&&(o.text.placedSymbolArray.get(b).crossTileID=F>=0&&b!==F?0:R),E>=0&&(o.text.placedSymbolArray.get(E).crossTileID=F>=0&&E!==F?0:R),I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=F>=0&&I!==F?0:R),C>=0&&(o.text.placedSymbolArray.get(C).crossTileID=F>=0&&C!==F?0:R)}markUsedOrientation(o,c,g){let v=c===r.W.horizontal||c===r.W.horizontalOnly?c:0,b=c===r.W.vertical?c:0,{leftJustifiedTextSymbolIndex:E,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:R}=g,O=o.text.placedSymbolArray;E>=0&&(O.get(E).placedOrientation=v),I>=0&&(O.get(I).placedOrientation=v),C>=0&&(O.get(C).placedOrientation=v),R>=0&&(O.get(R).placedOrientation=b)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;let c=this.prevPlacement,g=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;let v=c?c.symbolFadeChange(o):1,b=c?c.opacities:{},E=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(let C in this.placements){let R=this.placements[C],O=b[C];O?(this.opacities[C]=new Fa(O,v,R.text,R.icon,null,R.clipped),g=g||R.text!==O.text.placed||R.icon!==O.icon.placed):(this.opacities[C]=new Fa(null,v,R.text,R.icon,R.skipFade,R.clipped),g=g||R.text||R.icon)}for(let C in b){let R=b[C];if(!this.opacities[C]){let O=new Fa(R,v,!1,!1);O.isHidden()||(this.opacities[C]=O,g=g||R.text.placed||R.icon.placed)}}for(let C in E)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=E[C]);for(let C in I)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=I[C]);g?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:o)}updateLayerOpacities(o,c){let g=new Set;for(let v of c){let b=v.getBucket(o);b&&v.latestFeatureIndex&&o.fqid===b.layerIds[0]&&(this.updateBucketOpacities(b,g,v.collisionBoxArray),b.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(b,v.tileID),b.updateZOffset()))}}updateBucketOpacities(o,c,g){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();let v=o.layers[0].layout,b=!!o.layers[0].dynamicFilter(),E=new Fa(null,0,!1,!1,!0),I=v.get("text-allow-overlap"),C=v.get("icon-allow-overlap"),R=v.get("text-variable-anchor"),O=v.get("text-rotation-alignment")==="map",F=v.get("text-pitch-alignment")==="map",z=new Fa(null,0,I&&(C||!o.hasIconData()||v.get("icon-optional")),C&&(I||!o.hasTextData()||v.get("text-optional")),!0);!o.collisionArrays&&g&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(g);let j=(G,$,V)=>{for(let Y=0;Y<$/4;Y++)G.opacityVertexArray.emplaceBack(V)},U=0;for(let G=0;G<o.symbolInstances.length;G++){let $=o.symbolInstances.get(G),{numHorizontalGlyphVertices:V,numVerticalGlyphVertices:Y,crossTileID:ne,numIconVertices:re}=$,W=c.has(ne),J=this.opacities[ne];W?J=E:J||(J=z,this.opacities[ne]=J),c.add(ne);let oe=V>0||Y>0,ce=re>0,ae=this.placedOrientations[ne],ue=ae===r.W.vertical,De=ae===r.W.horizontal||ae===r.W.horizontalOnly;if(!oe&&!ce||J.isHidden()||U++,oe){let ve=Ba(J.text);j(o.text,V,ue?hr:ve),j(o.text,Y,De?hr:ve);let we=J.text.isHidden(),{leftJustifiedTextSymbolIndex:de,centerJustifiedTextSymbolIndex:Ie,rightJustifiedTextSymbolIndex:be,verticalPlacedTextSymbolIndex:Ce}=$,Q=o.text.placedSymbolArray,me=we||ue?1:0;de>=0&&(Q.get(de).hidden=me),Ie>=0&&(Q.get(Ie).hidden=me),be>=0&&(Q.get(be).hidden=me),Ce>=0&&(Q.get(Ce).hidden=we||De?1:0);let Le=this.variableOffsets[ne];Le&&this.markUsedJustification(o,Le.anchor,$,ae);let Re=this.placedOrientations[ne];Re&&(this.markUsedJustification(o,"left",$,Re),this.markUsedOrientation(o,Re,$))}if(ce){let ve=Ba(J.icon),{placedIconSymbolIndex:we,verticalPlacedIconSymbolIndex:de}=$,Ie=o.icon.placedSymbolArray,be=J.icon.isHidden()?1:0;we>=0&&(j(o.icon,re,ue?hr:ve),Ie.get(we).hidden=be),de>=0&&(j(o.icon,$.numVerticalIconVertices,De?hr:ve),Ie.get(de).hidden=be)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){let ve=o.collisionArrays[G];if(ve){let we=new r.P(0,0),de=!0;if(ve.textBox||ve.verticalTextBox){if(R){let be=this.variableOffsets[ne];be?(we=Jr(be.anchor,be.width,be.height,be.textOffset,be.textScale),O&&we._rotate(F?this.transform.angle:-this.transform.angle)):de=!1}b&&(de=!J.clipped),ve.textBox&&Qs(o.textCollisionBox.collisionVertexArray,J.text.placed,!de||ue,we.x,we.y),ve.verticalTextBox&&Qs(o.textCollisionBox.collisionVertexArray,J.text.placed,!de||De,we.x,we.y)}let Ie=de&&!!(!De&&ve.verticalIconBox);ve.iconBox&&Qs(o.iconCollisionBox.collisionVertexArray,J.icon.placed,Ie,$.hasIconTextFit?we.x:0,$.hasIconTextFit?we.y:0),ve.verticalIconBox&&Qs(o.iconCollisionBox.collisionVertexArray,J.icon.placed,!Ie,$.hasIconTextFit?we.x:0,$.hasIconTextFit?we.y:0)}}}if(o.fullyClipped=U===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){let G=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=G.invProjMatrix,o.placementViewportMatrix=G.viewportMatrix,o.collisionCircleArray=G.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,c){let g=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*g>o}setStale(){this.stale=!0}}function Qs(p,o,c,g,v){p.emplaceBack(o?1:0,c?1:0,g||0,v||0),p.emplaceBack(o?1:0,c?1:0,g||0,v||0),p.emplaceBack(o?1:0,c?1:0,g||0,v||0),p.emplaceBack(o?1:0,c?1:0,g||0,v||0)}let Kr=Math.pow(2,25),Si=Math.pow(2,24),Pp=Math.pow(2,17),za=Math.pow(2,16),gr=Math.pow(2,9),Rl=Math.pow(2,8),Yh=Math.pow(2,1);function Ba(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;let o=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Kr+o*Si+c*Pp+o*za+c*gr+o*Rl+c*Yh+o}let hr=0;class Jh{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,c,g,v,b){let E=this._bucketParts;for(;this._currentTileIndex<o.length;)if(c.getBucketParts(E,v,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,E.sort((I,C)=>I.sortKey-C.sortKey));this._currentPartIndex<E.length;){let I=E[this._currentPartIndex];if(c.placeLayerBucketPart(I,this._seenCrossTileIDs,g,I.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class Kh{constructor(o,c,g,v,b,E,I,C,R){this.placement=new Xh(o,b,E,I,C,R),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(o,c,g,v){let b=r.a4.now(),E=()=>{let I=r.a4.now()-b;return!this._forceFullPlacement&&I>2};for(;this._currentPlacementIndex>=0;){let I=c[o[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(I.type==="symbol"&&(!I.minzoom||I.minzoom<=C)&&(!I.maxzoom||I.maxzoom>C)){let R=I,O=R.layout.get("symbol-z-elevate"),F=this._inProgressLayer=this._inProgressLayer||new Jh(R),z=r.aE(I.source,I.scope);if(F.continuePlacement(O?v[z]:g[z],this.placement,this._showCollisionBoxes,I,E))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}let Yi=512/r.J/2;class Pl{constructor(o,c,g){this.tileID=o,this.bucketInstanceId=g,this.index=new r.aZ(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let v=o.canonical.x*r.J,b=o.canonical.y*r.J;for(let E=0;E<c.length;E++){let{key:I,crossTileID:C,tileAnchorX:R,tileAnchorY:O}=c.get(E),F=Math.floor((v+R)*Yi),z=Math.floor((b+O)*Yi);this.index.add(F,z),this.keys.push(I),this.crossTileIDs.push(C)}this.index.finish()}findMatches(o,c,g){let v=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=Yi/Math.pow(2,c.canonical.z-this.tileID.canonical.z),E=c.canonical.x*r.J,I=c.canonical.y*r.J;for(let C=0;C<o.length;C++){let R=o.get(C);if(R.crossTileID)continue;let{key:O,tileAnchorX:F,tileAnchorY:z}=R,j=Math.floor((E+F)*b),U=Math.floor((I+z)*b),G=this.index.range(j-v,U-v,j+v,U+v);for(let $ of G){let V=this.crossTileIDs[$];if(this.keys[$]===O&&!g.has(V)){g.add(V),R.crossTileID=V;break}}}}}class Ol{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class dn{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){let c=Math.round((o-this.lng)/360);if(c!==0)for(let g in this.indexes){let v=this.indexes[g],b={};for(let E in v){let I=v[E];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),b[I.tileID.key]=I}this.indexes[g]=b}this.lng=o}addBucket(o,c,g){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);let v=this.usedCrossTileIDs[o.overscaledZ];for(let b in this.indexes){let E=this.indexes[b];if(Number(b)>o.overscaledZ)for(let I in E){let C=E[I];C.tileID.isChildOf(o)&&C.findMatches(c.symbolInstances,o,v)}else{let I=E[o.scaledTo(Number(b)).key];I&&I.findMatches(c.symbolInstances,o,v)}}for(let b=0;b<c.symbolInstances.length;b++){let E=c.symbolInstances.get(b);E.crossTileID||(E.crossTileID=g.generate(),v.add(E.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Pl(o,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(o,c){for(let g of c.crossTileIDs)this.usedCrossTileIDs[o].delete(g)}removeStaleBuckets(o){let c=!1;for(let g in this.indexes){let v=this.indexes[g];for(let b in v)o[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],c=!0)}return c}}class Zy{constructor(){this.layerIndexes={},this.crossTileIDs=new Ol,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,c,g,v){let b=this.layerIndexes[o.fqid];b===void 0&&(b=this.layerIndexes[o.fqid]=new dn);let E=!1,I={};v.name!=="globe"&&b.handleWrapJump(g);for(let C of c){let R=C.getBucket(o);R&&o.fqid===R.layerIds[0]&&(R.bucketInstanceId||(R.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(C.tileID,R,this.crossTileIDs)&&(E=!0),I[R.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(E=!0),E}pruneUnusedLayers(o){let c={};o.forEach(g=>{c[g]=!0});for(let g in this.layerIndexes)c[g]||delete this.layerIndexes[g]}}var Qc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,as=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,Op=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Qh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ls=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,kp=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ji=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,kl=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,ed=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Lp=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let eu=[];ko(Qc,eu),ko(Op,eu),ko(as,eu);let cs={"_prelude_fog.vertex.glsl":kp,"_prelude_terrain.vertex.glsl":ls,"_prelude_shadow.vertex.glsl":ed,"_prelude_fog.fragment.glsl":Ji,"_prelude_shadow.fragment.glsl":Lp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":kl},us={};Yt("",ls),Yt(Ji,kp),Yt(Lp,ed),Yt(kl,"");let Fp=Yt(as,Op),ea=Qc;var td={background:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Yt("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Yt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yt("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Yt("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Yt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Yt(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Yt(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Yt(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Yt(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Yt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Yt(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Yt("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Yt(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Qh),skyboxGradient:Yt(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Qh),skyboxCapture:Yt(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Yt(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Yt(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Yt(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Yt(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function ko(p,o){let c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let g of c)if(g=g.trim(),g[0]==="#"&&g.includes("if")&&!g.includes("endif")){g=g.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let v=g.split(" ");for(let b of v)o.includes(b)||o.push(b)}}function Yt(p,o){let c=/#include\s+"([^"]+)"/g,g=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,v=o.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);v&&(v=v.map(R=>{let O=R.split(" ");return O[O.length-1]}),v=[...new Set(v)]);let b={},E=[],I=[];if(p=p.replace(c,(R,O)=>(I.push(O),"")),(o=o.replace(c,(R,O)=>(E.push(O),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...eu];ko(p,C),ko(o,C);for(let R of[...E,...I])cs[R]||console.error(`Undefined include: ${R}`),us[R]||(us[R]=[],ko(cs[R],us[R])),C=[...C,...us[R]];return{fragmentSource:p=p.replace(g,(R,O,F,z,j)=>(b[j]=!0,O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
in ${F} ${z} ${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:O==="initialize"?`
#ifdef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = u_${j};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${z} ${j};
#endif
`:O==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(g,(R,O,F,z,j)=>{let U=z==="float"?"vec2":z,G=j.match(/color/)?"color":U;return O==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${j}
in ${F} ${z} a_${j};
#endif
`:b[j]?O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${U} a_${j};
out ${F} ${z} ${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:O==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = a_${j};
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:O==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    in ${F} ${z} a_${j};
    out ${F} ${z} ${j};
#endif
`:O==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${j} = a_${j};
#endif
`:void 0:O==="define"?`
#ifndef HAS_UNIFORM_u_${j}
uniform lowp float u_${j}_t;
in ${F} ${U} a_${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:O==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${j}0;
in vec4 a_${j}1;
in vec4 a_${j}2;
in vec4 a_${j}3;
#else
uniform ${F} ${z} u_${j};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${F} ${U} a_${j};
#else
uniform ${F} ${z} u_${j};
#endif
`:O==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${j}
    ${F} ${z} ${j} = a_${j};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = a_${j};
#else
    ${F} ${z} ${j} = u_${j};
#endif
`:`
#ifndef HAS_UNIFORM_u_${j}
    ${F} ${z} ${j} = unpack_mix_${G}(a_${j}, u_${j}_t);
#else
    ${F} ${z} ${j} = u_${j};
#endif
`}),staticAttributes:v,usedDefines:C,vertexIncludes:E,fragmentIncludes:I}}class Xy{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,c,g,v,b,E,I,C){this.context=o;let R=this.boundPaintVertexBuffers.length!==v.length;for(let F=0;!R&&F<v.length;F++)this.boundPaintVertexBuffers[F]!==v[F]&&(R=!0);let O=this.boundDynamicVertexBuffers.length!==I.length;for(let F=0;!O&&F<I.length;F++)this.boundDynamicVertexBuffers[F]!==I[F]&&(O=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==g||R||O||this.boundIndexBuffer!==b||this.boundVertexOffset!==E)this.freshBind(c,g,v,b,E,I,C);else{o.bindVertexArrayOES.set(this.vao);for(let F of I)F&&(F.bind(),C&&F.instanceCount&&F.setVertexAttribDivisor(o.gl,c,C));b&&b.dynamicDraw&&b.bind()}}freshBind(o,c,g,v,b,E,I){let C=o.numAttributes,R=this.context,O=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=E,c.enableAttributes(O,o),c.bind(),c.setVertexAttribPointers(O,o,b);for(let F of g)F.enableAttributes(O,o),F.bind(),F.setVertexAttribPointers(O,o,b);for(let F of E)F&&(F.enableAttributes(O,o),F.bind(),F.setVertexAttribPointers(O,o,b),I&&F.instanceCount&&F.setVertexAttribDivisor(O,o,I));v&&v.bind(),R.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Yy(p,o){let c=Math.pow(2,o.canonical.z),g=o.canonical.y;return[new r.M(0,g/c).toLngLat().lat,new r.M(0,(g+1)/c).toLngLat().lat]}function Jy(p,o,c,g,v,b,E){let I=p.context,C=I.gl,R=c.hillshadeFBO;if(!R)return;p.prepareDrawTile();let O=p.isTileAffectedByFog(o),F=p.getOrCreateProgram("hillshade",{overrideFog:O});I.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,R.colorAttachment.get());let z=(($,V,Y,ne)=>{let re=Y.paint.get("hillshade-shadow-color"),W=Y.paint.get("hillshade-highlight-color"),J=Y.paint.get("hillshade-accent-color"),oe=Y.paint.get("hillshade-emissive-strength"),ce=r.d(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")ce-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){let ue=$.style.directionalLight.properties.get("direction"),De=r.b3(ue.x,ue.y,ue.z);ce=r.d(De[1])}let ae=!$.options.moving;return{u_matrix:ne||$.transform.calculateProjMatrix(V.tileID.toUnwrapped(),ae),u_image:0,u_latrange:Yy(0,V.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),ce],u_shadow:re,u_highlight:W,u_emissive_strength:oe,u_accent:J}})(p,c,g,p.terrain?o.projMatrix:null);p.uploadCommonUniforms(I,F,o.toUnwrapped());let{tileBoundsBuffer:j,tileBoundsIndexBuffer:U,tileBoundsSegments:G}=p.getTileBoundsBuffers(c);F.draw(p,C.TRIANGLES,v,b,E,r.b5.disabled,z,g.id,j,U,G)}function nd(p,o,c){if(!o.needsDEMTextureUpload)return;let g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||p.getTileTexture(c.stride);let b=c.getPixels();o.demTexture?o.demTexture.update(b,{premultiply:!1}):o.demTexture=new r.a9(g,b,v.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Ky(p,o,c){let g=p.context,v=g.gl;if(!o.dem)return;let b=o.dem;if(g.activeTexture.set(v.TEXTURE1),nd(p,o,b),!o.demTexture)return;o.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);let E=b.dim;g.activeTexture.set(v.TEXTURE0);let I=o.hillshadeFBO;if(!I){let z=new r.a9(g,{width:E,height:E,data:null},v.RGBA);z.bind(v.LINEAR,v.CLAMP_TO_EDGE),I=o.hillshadeFBO=g.createFramebuffer(E,E,!0,"renderbuffer"),I.colorAttachment.set(z.texture)}g.bindFramebuffer.set(I.framebuffer),g.viewport.set([0,0,E,E]);let{tileBoundsBuffer:C,tileBoundsIndexBuffer:R,tileBoundsSegments:O}=p.getMercatorTileBoundsBuffers(),F=[];p.linearFloatFilteringSupported()&&F.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:F}).draw(p,v.TRIANGLES,r.b4.disabled,r.b6.disabled,r.a.unblended,r.b5.disabled,((z,j)=>{let U=j.stride,G=r.m.create();return r.m.ortho(G,0,r.J,-r.J,0,0,1),r.m.translate(G,G,[0,-r.J,0]),{u_matrix:G,u_image:1,u_dimension:[U,U],u_zoom:z.overscaledZ}})(o.tileID,b),c.id,C,R,O),o.needsHillshadePrepare=!1}let tu=p=>({u_matrix:new r.a_(p),u_image0:new r.a$(p),u_skirt_height:new r.b2(p),u_ground_shadow_factor:new r.b7(p)}),rd=(p,o,c)=>({u_matrix:p,u_image0:0,u_skirt_height:o,u_ground_shadow_factor:c}),id=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:c,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:E,u_frustum_tr:I,u_frustum_br:C,u_frustum_bl:R,u_globe_pos:O,u_globe_radius:F,u_viewport:z,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:j}),ta=(p,o)=>{if(o>0&&p.terrain&&r.X("Cutoff is currently disabled on terrain"),o<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};let c=p.transform,g=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),v=c.isLODDisabled(!1)?r.an(60,45,c.pitch):r.an(30,15,c.pitch),b=c._farZ-c._nearZ,E=o*c.height,I=((1-(C=v))*c.cameraToCenterDistance+C*(c._farZ+E))*g;var C;return{shouldRenderCutoff:v<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/b,(I-E-c._nearZ)/b]}}};function od(p,o){return p!=null&&o!=null&&!(!p.hasData()||!o.hasData())&&p.demTexture!=null&&o.demTexture!=null&&p.tileID.key!==o.tileID.key}let fo=new class{constructor(){this.operations={}}newMorphing(p,o,c,g,v){if(p in this.operations){let b=this.operations[p];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[p]={startTime:g,phase:0,duration:v,from:o,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;let o=this.operations[p];return{from:o.from,to:o.to,phase:o.phase}}update(p){for(let o in this.operations){let c=this.operations[o];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[o];break}}}_nextOp(p,o){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=o,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},nu={0:null,1:"TERRAIN_VERTEX_MORPHING"};function sd(p,o,c){if(o===0)return 0;let g=o<1&&c===514?.25/o:1;return 6*Math.pow(1.5,22-p)*Math.max(o,1)*g}function ad(p,o){let c=1<<p.z;return!o&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}let ru=p=>({u_matrix:p});function iu(p,o,c,g,v){if(v>0){let b=r.a4.now(),E=(b-p.timeAdded)/v,I=o?(b-o.timeAdded)/v:-1,C=c.getSource(),R=g.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),O=!o||Math.abs(o.tileID.overscaledZ-R)>Math.abs(p.tileID.overscaledZ-R),F=O&&p.refreshedUponExpiration?1:r.c(O?E:1-I,0,1);return p.refreshedUponExpiration&&E>=1&&(p.refreshedUponExpiration=!1),o?{opacity:1,mix:1-F}:{opacity:F,mix:0}}return{opacity:1,mix:0}}class Ze extends r.bq{constructor(o){let c={type:"raster-dem",maxzoom:o.transform.maxZoom},g=new r.br(r.bs(),null),v=Zi("mock-dem",c,g,o.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,c){o.state="loaded",c(null)}}class Np extends r.bq{constructor(o){let c=Zi("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new r.br(r.bs(),null),o.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,c,g){if(o.freezeTileCoverage)return;this.transform=o;let v=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,E)=>{if(b[E.key]="",!this._tiles[E.key]){let I=new r.bt(E,this._source.tileSize*E.overscaleFactor(),o.tileZoom);I.state="loaded",this._tiles[E.key]=I}return b},{});for(let b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(o){let c=this.proxyCachedFBO[o];if(c!==void 0){let g=Object.values(c);this.renderCachePool.push(...g),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ou extends r.O{constructor(o,c,g){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=c,this.projMatrix=g}}class ld extends r.bk{constructor(o,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},o.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),o.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[g,v,b]=function(C){let R=new r.bo,O=new r.bp,F=131;R.reserve(17161),O.reserve(33800);let z=r.J/128,j=r.J+z/2,U=j+z;for(let $=-z;$<U;$+=z)for(let V=-z;V<U;V+=z){let Y=V<0||V>j||$<0||$>j?24575:0,ne=r.c(Math.round(V),0,r.J),re=r.c(Math.round($),0,r.J);R.emplaceBack(ne+Y,re)}let G=($,V)=>{let Y=V*F+$;O.emplaceBack(Y+1,Y,Y+F),O.emplaceBack(Y+F,Y+F+1,Y+1)};for(let $=1;$<129;$++)for(let V=1;V<129;V++)G(V,$);return[0,129].forEach($=>{for(let V=0;V<130;V++)G(V,$),G($,V)}),[R,O,32768]}(),E=o.context;this.gridBuffer=E.createVertexBuffer(g,r.bl.members),this.gridIndexBuffer=E.createIndexBuffer(v),this.gridSegments=r.bm.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=r.bm.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Np(c.map),this.orthoMatrix=r.m.create(),r.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.J,0,r.J,0,1);let I=E.gl;this._overlapStencilMode=new r.b6({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ze(c.map),this._pendingGroundEffectLayers=[]}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,c,g){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);let v=o.terrain.properties,b=o.terrain.drapeRenderMode===0,E=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=r.a4.now();let I=o.terrain&&o.terrain.scope,C=v.get("source"),R=b?this._mockSourceCache:o.getSourceCache(C,I);if(!R)return void r.X(`Couldn't find terrain source "${C}".`);if(this.sourceCache=R,this._exaggeration=E?this.calculateExaggeration(c):v.get("exaggeration"),!c.projection.requiresDraping&&E&&this._exaggeration===0)return void this._disable();this.enabled=!0;let O=()=>{this.sourceCache.used&&r.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let F=this.getScaledDemTileSize();this.sourceCache.update(c,F,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,O(),this._initializing=!0),O(),c.updateElevation(!0,g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(o){let c=this._previousCameraAltitude,g=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=g;let v=c!=null?g-c:Number.MAX_VALUE;if(Math.abs(v)<2)return this._exaggeration;let b=o.zoom,E=this._style.terrain;if(!this._previousUpdateTimestamp)return E.getExaggeration(b);let I=b-this._previousZoom,C=this._previousUpdateTimestamp,R=b;this._evaluationZoom!=null&&(R=this._evaluationZoom,Math.abs(b-R)>.5&&(I=.5*(b-R+I)),I*v<0&&(R+=I)),this._evaluationZoom=R;let O=E.getExaggeration(R),F=O===E.getExaggeration(Math.max(0,R-.1));if(F&&Math.abs(O-this._exaggeration)<.01)return O;let z=Math.min(.1,.00375*(this._updateTimestamp-C));return(F||O<.1||Math.abs(I)<1e-4)&&(z=Math.min(.2,4*z)),r.n(this._exaggeration,O,z)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let c=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=g._centerAltitude===0&&this.getAtPointOrZero(r.M.fromLngLat(g.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let v=this.proxyCoords=c.getIds().map(C=>{let R=c.getTileByID(C).tileID;return R.projMatrix=g.calculateProjMatrix(R.toUnwrapped()),R});(function(C,R){let O=R.transform.pointCoordinate(R.transform.getCameraPoint()),F=new r.P(O.x,O.y);C.sort((z,j)=>{if(j.overscaledZ-z.overscaledZ)return j.overscaledZ-z.overscaledZ;let U=new r.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),G=new r.P(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),$=F.mult(1<<z.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(U)-$.distSqr(G)})})(v,this.painter);let b=this.proxyToSource||{};this.proxyToSource={},v.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};let E=this._style._mergedSourceCaches;for(let C in E){let R=E[C];if(!R.used||(R!==this.sourceCache&&this.resetTileLookupCache(R.id),this._setupProxiedCoordsForOrtho(R,o[C],b),R.usedForTerrain))continue;let O=o[C];R.getSource().reparseOverscaled&&this._assignTerrainTiles(O)}this.proxiedCoords[c.id]=v.map(C=>new ou(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;let I={};this._visibleDemTiles=[];for(let C of this.proxyCoords){let R=this.terrainTileForTile[C.key];if(!R)continue;let O=R.tileID.key;O in I||(this._visibleDemTiles.push(R),I[O]=O)}}_assignTerrainTiles(o){this._initializing||o.forEach(c=>{if(this.terrainTileForTile[c.key])return;let g=this._findTileCoveringTileID(c,this.sourceCache);g&&(this.terrainTileForTile[c.key]=g)})}_prepareDEMTextures(){let o=this.painter.context,c=o.gl;for(let g in this.terrainTileForTile){let v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(o.activeTexture.set(c.TEXTURE1),nd(this.painter,v,b))}}_prepareDemTileUniforms(o,c,g,v){if(!c||c.demTexture==null)return!1;let b=o.tileID.canonical,E=Math.pow(2,c.tileID.canonical.z-b.z),I=v||"";return g[`u_dem_tl${I}`]=[b.x*E%1,b.y*E%1],g[`u_dem_scale${I}`]=E,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let o=this.painter.context,c=o.gl;if(!this._emptyDepthBufferTexture){let g=new r.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.a9(o,g,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0,c=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;let b=v.dem.tree.minimums[0];return b>0&&o++,g+b},0);return o?c/o:0}_updateEmptyDEMTexture(){let o=this.painter.context,c=o.gl;o.activeTexture.set(c.TEXTURE2);let g=this._getLoadedAreaMinimum(),[v,b]=(()=>{let I=new r.bu({width:1,height:1},new Float32Array([g]));return[c.R32F,I]})();this._emptyDEMTextureDirty=!1;let E=this._emptyDEMTexture;return E?E.update(b,{premultiply:!1}):E=this._emptyDEMTexture=new r.a9(o,b,v,{premultiply:!1}),E}setupElevationDraw(o,c,g){let v=this.painter.context,b=v.gl,E={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};E.u_exaggeration=this.exaggeration();let I=null,C=null,R=1;if(g&&g.morphing&&this._useVertexMorphing){let z=g.morphing.srcDemTile,j=g.morphing.dstDemTile;R=g.morphing.phase,z&&j&&(this._prepareDemTileUniforms(o,z,E,"_prev")&&(C=z),this._prepareDemTileUniforms(o,j,E)&&(I=j))}let O=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST,F=z=>{E.u_dem_size=z.size[0]===1?1:z.size[0]-2};if(C&&I)v.activeTexture.set(b.TEXTURE2),I.demTexture.bind(O(I),b.CLAMP_TO_EDGE),v.activeTexture.set(b.TEXTURE4),C.demTexture.bind(O(C),b.CLAMP_TO_EDGE),I.demTexture&&F(I.demTexture),E.u_dem_lerp=R;else{I=this.terrainTileForTile[o.tileID.key],v.activeTexture.set(b.TEXTURE2);let z=this._prepareDemTileUniforms(o,I,E)?I.demTexture:this.emptyDEMTexture;z.bind(O(I),b.CLAMP_TO_EDGE),F(z)}if(v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(E.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),E.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&I){let z=(1<<I.tileID.canonical.z)*r.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;E.u_meter_to_dem=z}if(g&&g.labelPlaneMatrixInv&&(E.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),c.setTerrainUniformValues(v,E),this.painter.transform.projection.name==="globe"){let z=this.globeUniformValues(this.painter.transform,o.tileID.canonical,g&&g.useDenormalizedUpVectorScale);c.setGlobeUniformValues(v,z)}}globeUniformValues(o,c,g){let v=o.projection;return{u_tile_tl_up:v.upVector(c,0,0),u_tile_tr_up:v.upVector(c,r.J,0),u_tile_br_up:v.upVector(c,r.J,r.J),u_tile_bl_up:v.upVector(c,0,r.J),u_tile_up_scale:g?r.bn(1):v.upVectorScale(c,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){let c=this.painter,g=this.painter.context;o.length!==0&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,E,I,C){if(v.transform.projection.name==="globe")(function(R,O,F,z,j){let U=R.context,G=U.gl,$,V,Y=R.transform,ne=r.bb(R,U,Y),re=(we,de)=>{if(V===de)return;let Ie=[nu[de],"PROJECTION_GLOBE_VIEW"];ne&&Ie.push("CUSTOM_ANTIALIASING");let be=R.isTileAffectedByFog(we);$=R.getOrCreateProgram("globeRaster",{defines:Ie,overrideFog:be}),V=de},W=R.colorModeForRenderPass(),J=new r.b4(G.LEQUAL,r.b4.ReadWrite,R.depthRangeFor3D);fo.update(j);let oe=r.bc(Y),ce=[r.E(Y.center.lng),r.H(Y.center.lat)],ae=R.globeSharedBuffers,ue=[Y.width*r.a4.devicePixelRatio,Y.height*r.a4.devicePixelRatio],De=Float32Array.from(Y.globeMatrix),ve={useDenormalizedUpVectorScale:!0};{let we=R.transform,de=sd(we.zoom,O.exaggeration(),O.sourceCache._source.tileSize);V=-1;let Ie=G.TRIANGLES;for(let be of z){let Ce=F.getTile(be),Q=r.b6.disabled,me=O.prevTerrainTileForTile[be.key],Le=O.terrainTileForTile[be.key];od(me,Le)&&fo.newMorphing(be.key,me,Le,j,250),U.activeTexture.set(G.TEXTURE0),Ce.texture&&Ce.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Re=fo.getMorphValuesForProxy(be.key),ot=Re?1:0;Re&&r.bd(ve,{morphing:{srcDemTile:Re.from,dstDemTile:Re.to,phase:r.ba(Re.phase)}});let et=r.be(be.canonical),mt=r.bf(et.getCenter().lat),tt=r.bg(be.canonical,et,mt,we.worldSize/we._pixelsPerMercatorPixel),xt=r.bh(r.bi(be.canonical)),bt=id(we.expandedFarZProjMatrix,De,oe,xt,r.ao(we.zoom),ce,we.frustumCorners.TL,we.frustumCorners.TR,we.frustumCorners.BR,we.frustumCorners.BL,we.globeCenterInViewSpace,we.globeRadius,ue,de,tt);if(re(be,ot),$&&(O.setupElevationDraw(Ce,$,ve),R.uploadCommonUniforms(U,$,be.toUnwrapped()),ae)){let[ht,dt,nn]=ae.getGridBuffers(mt,de!==0);$.draw(R,Ie,J,Q,W,r.b5.backCCW,bt,"globe_raster",ht,dt,nn)}}}if(ae&&(R.renderDefaultNorthPole||R.renderDefaultSouthPole)){let we=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&we.push("CUSTOM_ANTIALIASING"),$=R.getOrCreateProgram("globeRaster",{defines:we});for(let de of z){let{x:Ie,y:be,z:Ce}=de.canonical,Q=be===0,me=be===(1<<Ce)-1,[Le,Re,ot,et]=ae.getPoleBuffers(Ce,!1);if(et&&(Q||me)){let mt=F.getTile(de);U.activeTexture.set(G.TEXTURE0),mt.texture&&mt.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let tt=r.bj(Ce,Ie,Y),xt=r.bh(r.bi(de.canonical)),bt=(ht,dt)=>ht.draw(R,G.TRIANGLES,J,r.b6.disabled,W,r.b5.disabled,id(Y.expandedFarZProjMatrix,tt,tt,xt,0,ce,Y.frustumCorners.TL,Y.frustumCorners.TR,Y.frustumCorners.BR,Y.frustumCorners.BL,Y.globeCenterInViewSpace,Y.globeRadius,ue,0),"globe_pole_raster",dt,ot,et);O.setupElevationDraw(mt,$,ve),R.uploadCommonUniforms(U,$,de.toUnwrapped()),Q&&R.renderDefaultNorthPole&&bt($,Le),me&&R.renderDefaultSouthPole&&(tt=r.m.scale(r.m.create(),tt,[1,-1,1]),bt($,Re))}}}})(v,b,E,I,C);else{let R=v.context,O=R.gl,F,z,j=v.shadowRenderer,U=ta(v,v.longestCutoffRange),G=W=>{if(z===W)return;let J=[];J.push(nu[W]),U.shouldRenderCutoff&&J.push("RENDER_CUTOFF"),F=v.getOrCreateProgram("terrainRaster",{defines:J}),z=W},$=v.colorModeForRenderPass(),V=new r.b4(O.LEQUAL,r.b4.ReadWrite,v.depthRangeFor3D);fo.update(C);let Y=v.transform,ne=sd(Y.zoom,b.exaggeration(),b.sourceCache._source.tileSize),re=[0,0,0];if(j){let W=v.style.directionalLight,J=v.style.ambientLight;W&&J&&(re=yu(W,J))}{z=-1;let W=O.TRIANGLES,[J,oe]=[b.gridIndexBuffer,b.gridSegments];for(let ce of I){let ae=E.getTile(ce),ue=r.b6.disabled,De=b.prevTerrainTileForTile[ce.key],ve=b.terrainTileForTile[ce.key];od(De,ve)&&fo.newMorphing(ce.key,De,ve,C,250),R.activeTexture.set(O.TEXTURE0),ae.texture&&ae.texture.bind(O.LINEAR,O.CLAMP_TO_EDGE);let we=fo.getMorphValuesForProxy(ce.key),de=we?1:0,Ie;we&&(Ie={morphing:{srcDemTile:we.from,dstDemTile:we.to,phase:r.ba(we.phase)}});let be=rd(ce.projMatrix,ad(ce.canonical,Y.renderWorldCopies)?ne/10:ne,re);if(G(de),!F)continue;b.setupElevationDraw(ae,F,Ie);let Ce=ce.toUnwrapped();j&&j.setupShadows(Ce,F),v.uploadCommonUniforms(R,F,Ce,null,U),F.draw(v,W,V,ue,$,r.b5.backCCW,be,"terrain_raster",b.gridBuffer,J,oe)}}}}(c,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;let c=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],E=this._drapedRenderBatches.shift(),I=c.style.order,C=[],R=0;for(let O of b){let F=v.getTileByID(O.proxyTileKey),z=v.proxyCachedFBO[O.key]?v.proxyCachedFBO[O.key][o]:void 0,j=z!==void 0?v.renderCache[z]:this.pool[R++],U=z!==void 0;if(F.texture=j.tex,U&&!j.dirty){C.push(F.tileID);continue}let G;g.bindFramebuffer.set(j.fb.framebuffer),this.renderedToTile=!1,j.dirty&&(g.clear({color:r.C.transparent,stencil:0}),j.dirty=!1);for(let $=E.start;$<=E.end;++$){let V=c.style._mergedLayers[I[$]];if(V.isHidden(c.transform.zoom))continue;let Y=c.style.getLayerSourceCache(V),ne=Y?this.proxyToSource[O.key][Y.id]:[O];if(!ne)continue;let re=ne;g.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(j,ne,V,Y),G=Y?Y.id:null),c.renderLayer(c,Y,V,re)}if(this._drapedRenderBatches.length===0)for(let $ of this._pendingGroundEffectLayers){let V=c.style._mergedLayers[I[$]];if(V.isHidden(c.transform.zoom))continue;let Y=c.style.getLayerSourceCache(V),ne=Y?this.proxyToSource[O.key][Y.id]:[O];if(!ne)continue;let re=ne;g.viewport.set([0,0,j.fb.width,j.fb.height]),G!==(Y?Y.id:null)&&(this._setupStencil(j,ne,V,Y),G=Y?Y.id:null),c.renderLayer(c,Y,V,re)}this.renderedToTile?(j.dirty=!0,C.push(F.tileID)):U||--R,R===5&&(R=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,c.width,c.height]),E.end+1}postRender(){}isLayerOrderingCorrect(o){let c=o.order.length,g=-1,v=c;for(let b=0;b<c;++b)this._style.isLayerDraped(o._mergedLayers[o.order[b]])?g=Math.max(g,b):v=Math.min(v,b);return v>g}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{o=Math.min(o,c.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,c,g){if(!this._visibleDemTiles)return null;let v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{let E=b.tileID,I=1<<E.overscaledZ,{x:C,y:R}=E.canonical,O=C/I,F=(C+1)/I,z=R/I,j=(R+1)/I;return{minx:O,miny:z,maxx:F,maxy:j,t:b.dem.tree.raycastRoot(O,z,F,j,o,c,g),tile:b}});v.sort((b,E)=>(b.t!==null?b.t:Number.MAX_VALUE)-(E.t!==null?E.t:Number.MAX_VALUE));for(let b of v){if(b.t==null)return null;let E=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,o,c,g);if(E!=null)return E}return null}_createFBO(){let o=this.painter.context,c=o.gl,g=this.drapeBufferSize;o.activeTexture.set(c.TEXTURE0);let v=new r.a9(o,{width:g[0],height:g[1],data:null},c.RGBA);v.bind(c.LINEAR,c.CLAMP_TO_EDGE);let b=o.createFramebuffer(g[0],g[1],!0,null);return b.colorAttachment.set(v.texture),b.depthAttachment=new In(o,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(let o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{let c=this._style._mergedLayers[o],g=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!g&&c.shouldRedrape():!g&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(let g of this._style.getSources())if(g instanceof ye){o=!0;break}if(!o)return;let c={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(v);if(b&&!c[b.id]&&!v.isHidden(this.painter.transform.zoom)&&v.type==="line"&&v.widthExpression()instanceof r.am){c[b.id]=!0;for(let E of this.proxyCoords){let I=this.proxyToSource[E.key][b.id];if(I)for(let C of I)this._clearRenderCacheForTile(b.id,C)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(let g in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[g]._source instanceof ut){o=!0;break}if(!o)return;let c={};for(let g=0;g<this._style.order.length;++g){let v=this._style._mergedLayers[this._style.order[g]],b=this._style.getLayerSourceCache(v);if(!b||c[b.id]||v.isHidden(this.painter.transform.zoom)||v.type!=="raster")continue;let E=v.paint.get("raster-fade-duration");for(let I of this.proxyCoords){let C=this.proxyToSource[I.key][b.id];if(C)for(let R of C){let O=iu(b.getTile(R),b.findLoadedParent(R,0),b,this.painter.transform,E);(O.opacity!==1||O.mix!==0)&&this._clearRenderCacheForTile(b.id,R)}}}}_setupDrapedRenderBatches(){let o=this._style.order,c=o.length;if(c===0)return;let g=[];this._pendingGroundEffectLayers=[];let v,b=0,E=this._style._mergedLayers[o[b]];for(;!this._style.isLayerDraped(E)&&E.isHidden(this.painter.transform.zoom)&&++b<c;)E=this._style._mergedLayers[o[b]];for(;b<c;++b){let I=this._style._mergedLayers[o[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?v===void 0&&(v=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),v!==void 0&&(g.push({start:v,end:b-1}),v=void 0)))}if(v!==void 0&&g.push({start:v,end:b-1}),g.length!==0){let I=g[g.length-1];this._pendingGroundEffectLayers.every(C=>C>I.end)||r.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=g}_setupRenderCache(o){let c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){let E=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<E.length;++I){let C=Object.values(E[I]);c.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();let g=this.proxyCoords,v=this._tilesDirty;for(let E=g.length-1;E>=0;E--){let I=g[E];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){let C=o[I.key],R=this.proxyToSource[I.key],O=0;for(let F in R){let z=R[F],j=C[F];if(!j||j.length!==z.length||z.some((U,G)=>U!==j[G]||v[F]&&v[F].hasOwnProperty(U.key))){O=-1;break}++O}for(let F in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][F]].dirty=O<0||O!==Object.values(C).length}}let b=[...this._drapedRenderBatches];b.sort((E,I)=>I.end-I.start-(E.end-E.start));for(let E of b)for(let I of g){if(c.proxyCachedFBO[I.key])continue;let C=c.renderCachePool.pop();C===void 0&&c.renderCache.length<50&&(C=c.renderCache.length,c.renderCache.push(this._createFBO())),C!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][E.start]=C,c.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(o,c,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let b=this.painter.context,E=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(g.isTileClipped())I=c.length,this._overlapStencilMode.test={func:E.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:E.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):r.b6.disabled}_renderTileClippingMasks(o,c){let g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(r.a.disabled),v.setDepthMode(r.b4.disabled);let E=g.getOrCreateProgram("clippingMask");for(let I of o){let C=g._tileClippingMaskIDs[I.key]=--c;E.draw(g,b.TRIANGLES,r.b4.disabled,new r.b6({func:b.ALWAYS,mask:0},C,255,b.KEEP,b.KEEP,b.REPLACE),r.a.disabled,r.b5.disabled,ru(I.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(o){let c=this.painter.transform;if(o.x<0||o.x>c.width||o.y<0||o.y>c.height)return null;let g=[o.x,o.y,1,1];r.e.transformMat4(g,g,c.pixelMatrixInverse),r.e.scale(g,g,1/g[3]),g[0]/=c.worldSize,g[1]/=c.worldSize;let v=c._camera.position,b=r.b(1,c.center.lat),E=[v[0],v[1],v[2]/b,0],I=r.v.subtract([],g.slice(0,3),E);r.v.normalize(I,I);let C=this.raycast(E,I,this._exaggeration);return C!==null&&C?(r.v.scaleAndAdd(E,E,I,C),E[3]=E[2],E[2]*=b,E):null}drawDepth(){let o=this.painter,c=o.context,g=this.proxySourceCache,v=Math.ceil(o.width),b=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let E=c.gl,I=c.createFramebuffer(v,b,!0,"renderbuffer");c.activeTexture.set(E.TEXTURE0);let C=new r.a9(c,{width:v,height:b,data:null},E.RGBA);C.bind(E.NEAREST,E.CLAMP_TO_EDGE),I.colorAttachment.set(C.texture);let R=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,v,b);I.depthAttachment.set(R),this._depthFBO=I,this._depthTexture=C}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,v,b]),function(E,I,C,R){if(E.transform.projection.name==="globe")return;let O=E.context,F=O.gl;O.clear({depth:1});let z=E.getOrCreateProgram("terrainDepth"),j=new r.b4(F.LESS,r.b4.ReadWrite,E.depthRangeFor3D);for(let U of R){let G=C.getTile(U),$=rd(U.projMatrix,0,[0,0,0]);I.setupElevationDraw(G,z),z.draw(E,F.TRIANGLES,j,r.b6.disabled,r.a.unblended,r.b5.backCCW,$,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(o,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,c,g){if(o.getSource()instanceof r.aK)return this._setupProxiedCoordsForImageSource(o,c,g);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};let v=this.proxiedCoords[o.id]=[],b=this.proxyCoords;for(let C=0;C<b.length;C++){let R=b[C],O=this._findTileCoveringTileID(R,o);if(O){let F=this._createProxiedId(R,O,g[R.key]&&g[R.key][o.id]);v.push(F),this.proxyToSource[R.key][o.id]=[F]}}let E=!1,I=new Set;for(let C=0;C<c.length;C++){let R=o.getTile(c[C]);if(!R||!R.hasData())continue;let O=this._findTileCoveringTileID(R.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==R.tileID.canonical.z){let F=this.proxyToSource[O.tileID.key][o.id],z=this._createProxiedId(O.tileID,R,g[O.tileID.key]&&g[O.tileID.key][o.id]);F?F.splice(F.length-1,0,z):this.proxyToSource[O.tileID.key][o.id]=[z];let j=this.proxyToSource[O.tileID.key][o.id];I.has(j)||I.add(j),v.push(z),E=!0}}if(this._sourceTilesOverlap[o.id]=E,E&&this._debugParams.sortTilesHiZFirst)for(let C of I)C.sort((R,O)=>O.overscaledZ-R.overscaledZ)}_setupProxiedCoordsForImageSource(o,c,g){if(!o.getSource().loaded())return;let v=this.proxiedCoords[o.id]=[],b=this.proxyCoords,E=o.getSource(),I=E.tileID;if(!I)return;let C=new r.P(I.x,I.y)._div(1<<I.z),R=E.coordinates.map(r.M.fromLngLat).reduce((F,z)=>(F.min.x=Math.min(F.min.x,z.x-C.x),F.min.y=Math.min(F.min.y,z.y-C.y),F.max.x=Math.max(F.max.x,z.x-C.x),F.max.y=Math.max(F.max.y,z.y-C.y),F),{min:new r.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(F,z)=>{let j=F.wrap+F.canonical.x/(1<<F.canonical.z),U=F.canonical.y/(1<<F.canonical.z),G=r.J/(1<<F.canonical.z),$=z.wrap+z.canonical.x/(1<<z.canonical.z),V=z.canonical.y/(1<<z.canonical.z);return j+G<$+R.min.x||j>$+R.max.x||U+G<V+R.min.y||U>V+R.max.y};for(let F=0;F<b.length;F++){let z=b[F];for(let j=0;j<c.length;j++){let U=o.getTile(c[j]);if(!U||!U.hasData()||O(z,U.tileID))continue;let G=this._createProxiedId(z,U,g[z.key]&&g[z.key][o.id]),$=this.proxyToSource[z.key][o.id];$?$.push(G):this.proxyToSource[z.key][o.id]=[G],v.push(G)}}}_createProxiedId(o,c,g){let v=this.orthoMatrix;if(g){let b=g.find(E=>E.key===c.tileID.key);if(b)return b}if(c.tileID.key!==o.key){let b=o.canonical.z-c.tileID.canonical.z,E,I,C;v=r.m.create();let R=c.tileID.wrap-o.wrap<<o.overscaledZ;b>0?(E=r.J>>b,I=E*((c.tileID.canonical.x<<b)-o.canonical.x+R),C=E*((c.tileID.canonical.y<<b)-o.canonical.y)):(E=r.J<<-b,I=r.J*(c.tileID.canonical.x-(o.canonical.x+R<<-b)),C=r.J*(c.tileID.canonical.y-(o.canonical.y<<-b))),r.m.ortho(v,0,E,0,E,0,1),r.m.translate(v,v,[I,C,0])}return new ou(c.tileID,o.key,v)}_findTileCoveringTileID(o,c){let g=c.getTile(o);if(g&&g.hasData())return g;let v=this._findCoveringTileCache[c.id],b=v[o.key];if(g=b?c.getTileByID(b):null,g&&g.hasData()||b===null)return g;let E=g?g.tileID:o,I=E.overscaledZ,C=c.getSource().minzoom,R=[];if(!b){let F=c.getSource().maxzoom;if(o.canonical.z>=F){let z=o.canonical.z-F;c.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,c.transform.tileZoom),E=new r.O(I,o.wrap,F,o.canonical.x>>z,o.canonical.y>>z)):z!==0&&(I=F,E=new r.O(I,o.wrap,F,o.canonical.x>>z,o.canonical.y>>z))}E.key!==o.key&&(R.push(E.key),g=c.getTile(E))}let O=F=>{R.forEach(z=>{v[z]=F}),R.length=0};for(I-=1;I>=C&&(!g||!g.hasData());I--){g&&O(g.tileID.key);let F=E.calculateScaledKey(I);if(g=c.getTileByID(F),g&&g.hasData())break;let z=v[F];if(z===null)break;z===void 0?R.push(F):g=c.getTileByID(z)}return O(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,c){let g=this._tilesDirty[o];g||(g=this._tilesDirty[o]={}),g[c.key]=!0}}function zp(p,o,c){let g=function(I,C,R){let O=r.v.dot(C,I),F=r.v.dot(R,[.2126,.7152,.0722]),z=(U,G,$)=>(1-$)*U+$*G,j=z(1-.3*Math.min(F,1),1,Math.min(O+1,1));return z(.92,1,Math.asin(r.c(C[2],-1,1))/Math.PI+.5)*j}(p,[0,0,1],o),v=[0,0,0];r.v.scale(v,c.slice(0,3),g);let b=[0,0,0];r.v.scale(b,o.slice(0,3),p[2]);let E=[0,0,0];return r.v.add(E,v,b),r.bw(E)}let su=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Lo=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class au{static cacheKey(o,c,g,v){let b=`${c}${v?v.cacheKey:""}`;for(let E of g)o.usedDefines.includes(E)&&(b+=`/${E}`);return b}constructor(o,c,g,v,b,E){let I=o.gl;this.program=I.createProgram(),this.configuration=v,this.name=c,this.fixedDefines=[...E];let C=v?v.getBinderAttributes():[],R=(g.staticAttributes||[]).concat(C),O=v?v.defines():[];O=O.concat(E.map($=>`#define ${$}`));let F=`#version 300 es
`,z=F+O.concat("precision mediump float;",ea,Fp.fragmentSource).join(`
`);for(let $ of g.fragmentIncludes)z+=`
${cs[$]}`;z+=`
${g.fragmentSource}`;let j=F+O.concat("precision highp float;",ea,Fp.vertexSource).join(`
`);for(let $ of g.vertexIncludes)j+=`
${cs[$]}`;j+=`
${g.vertexSource}`;let U=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(U,z),I.compileShader(U),I.attachShader(this.program,U);let G=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())this.failedToCreate=!0;else{I.shaderSource(G,j),I.compileShader(G),I.attachShader(this.program,G),this.attributes={},this.numAttributes=R.length;for(let $=0;$<this.numAttributes;$++)if(R[$]){let V=R[$].startsWith("a_")?R[$]:`a_${R[$]}`;I.bindAttribLocation(this.program,$,V),this.attributes[V]=$}I.linkProgram(this.program),I.deleteShader(G),I.deleteShader(U),this.fixedUniforms=b(o),this.binderUniforms=v?v.getUniforms(o):[],E.includes("TERRAIN")&&(this.terrainUniforms=($=>({u_dem:new r.a$($),u_dem_prev:new r.a$($),u_dem_tl:new r.b0($),u_dem_scale:new r.b2($),u_dem_tl_prev:new r.b0($),u_dem_scale_prev:new r.b2($),u_dem_size:new r.b2($),u_dem_lerp:new r.b2($),u_exaggeration:new r.b2($),u_depth:new r.a$($),u_depth_size_inv:new r.b0($),u_meter_to_dem:new r.b2($),u_label_plane_matrix_inv:new r.a_($)}))(o)),E.includes("GLOBE")&&(this.globeUniforms=($=>({u_tile_tl_up:new r.b7($),u_tile_tr_up:new r.b7($),u_tile_br_up:new r.b7($),u_tile_bl_up:new r.b7($),u_tile_up_scale:new r.b2($)}))(o)),E.includes("FOG")&&(this.fogUniforms=($=>({u_fog_matrix:new r.a_($),u_fog_range:new r.b0($),u_fog_color:new r.b9($),u_fog_horizon_blend:new r.b2($),u_fog_vertical_limit:new r.b0($),u_fog_temporal_offset:new r.b2($),u_frustum_tl:new r.b7($),u_frustum_tr:new r.b7($),u_frustum_br:new r.b7($),u_frustum_bl:new r.b7($),u_globe_pos:new r.b7($),u_globe_radius:new r.b2($),u_globe_transition:new r.b2($),u_is_globe:new r.a$($),u_viewport:new r.b0($)}))(o)),E.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=($=>({u_cutoff_params:new r.b9($)}))(o)),E.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=($=>({u_lighting_ambient_color:new r.b7($),u_lighting_directional_dir:new r.b7($),u_lighting_directional_color:new r.b7($),u_ground_radiance:new r.b7($)}))(o)),E.includes("RENDER_SHADOWS")&&(this.shadowUniforms=($=>({u_light_matrix_0:new r.a_($),u_light_matrix_1:new r.a_($),u_fade_range:new r.b0($),u_shadow_normal_offset:new r.b7($),u_shadow_intensity:new r.b2($),u_shadow_texel_size:new r.b2($),u_shadow_map_resolution:new r.b2($),u_shadow_direction:new r.b7($),u_shadow_bias:new r.b7($),u_shadowmap_0:new r.a$($),u_shadowmap_1:new r.a$($)}))(o))}}setTerrainUniformValues(o,c){if(!this.terrainUniforms)return;let g=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in c)g[v]&&g[v].set(this.program,v,c[v])}}setGlobeUniformValues(o,c){if(!this.globeUniforms)return;let g=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in c)g[v]&&g[v].set(this.program,v,c[v])}}setFogUniformValues(o,c){if(!this.fogUniforms)return;let g=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in c)g[v].set(this.program,v,c[v])}}setCutoffUniformValues(o,c){if(!this.cutoffUniforms)return;let g=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in c)g[v].set(this.program,v,c[v])}}setLightsUniformValues(o,c){if(!this.lightsUniforms)return;let g=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(let v in c)g[v].set(this.program,v,c[v])}}setShadowUniformValues(o,c){if(this.failedToCreate||!this.shadowUniforms)return;let g=this.shadowUniforms;o.program.set(this.program);for(let v in c)g[v].set(this.program,v,c[v])}_drawDebugWireframe(o,c,g,v,b,E,I,C,R,O){let F=o.options.wireframe;if(F.terrain===!1&&F.layers2D===!1&&F.layers3D===!1)return;let z=o.context;if(!(!(!F.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!F.layers2D||o._terrain&&o._terrain.renderingToTexture||!su.includes(this.name))||!(!F.layers3D||!Lo.includes(this.name))))return;let j=z.gl,U=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,b,z);if(!U)return;let G=[...this.fixedDefines];G.push("DEBUG_WIREFRAME");let $=o.getOrCreateProgram(this.name,{config:this.configuration,defines:G});z.program.set($.program);let V=(re,W,J)=>{if(W[re]&&J[re])for(let oe in W[re])J[re][oe]&&J[re][oe].set(J.program,oe,W[re][oe].current)};R&&R.setUniforms($.program,z,$.binderUniforms,I,{zoom:C}),V("fixedUniforms",this,$),V("terrainUniforms",this,$),V("globeUniforms",this,$),V("fogUniforms",this,$),V("lightsUniforms",this,$),V("shadowUniforms",this,$),U.bind(),z.setColorMode(new r.a([j.ONE,j.ONE_MINUS_SRC_ALPHA,j.ZERO,j.ONE],r.C.transparent,[!0,!0,!0,!1])),z.setDepthMode(new r.b4(c.func===j.LESS?j.LEQUAL:c.func,r.b4.ReadOnly,c.range)),z.setStencilMode(r.b6.disabled);let Y=3*E.primitiveLength*2,ne=3*E.primitiveOffset*2*2;O&&O>1?j.drawElementsInstanced(j.LINES,Y,j.UNSIGNED_SHORT,ne,O):j.drawElements(j.LINES,Y,j.UNSIGNED_SHORT,ne),b.bind(),z.program.set(this.program),z.setDepthMode(c),z.setStencilMode(g),z.setColorMode(v)}draw(o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$){let V=o.context,Y=V.gl;if(this.failedToCreate)return;V.program.set(this.program),V.setDepthMode(g),V.setStencilMode(v),V.setColorMode(b),V.setCullFace(E);for(let W of Object.keys(this.fixedUniforms))this.fixedUniforms[W].set(this.program,W,I[W]);U&&U.setUniforms(this.program,V,this.binderUniforms,z,{zoom:j});let ne={[Y.LINES]:2,[Y.TRIANGLES]:3,[Y.LINE_STRIP]:1}[c],re=$&&$>0?1:void 0;for(let W of F.get()){let J=W.vaos||(W.vaos={});(J[C]||(J[C]=new Xy)).bind(V,this,R,U?U.getPaintVertexBuffers():[],O,W.vertexOffset,G||[],re),$&&$>1?Y.drawElementsInstanced(c,W.primitiveLength*ne,Y.UNSIGNED_SHORT,W.primitiveOffset*ne*2,$):Y.drawElements(c,W.primitiveLength*ne,Y.UNSIGNED_SHORT,W.primitiveOffset*ne*2),c===Y.TRIANGLES&&this._drawDebugWireframe(o,g,v,b,O,W,z,j,U,$)}}}function hs(p,o){let c=Math.pow(2,o.tileID.overscaledZ),g=o.tileSize*Math.pow(2,p.transform.tileZoom)/c,v=g*(o.tileID.canonical.x+o.tileID.wrap*c),b=g*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/r.ay(o,1,p.transform.tileZoom),u_pixel_coord_upper:[v>>16,b>>16],u_pixel_coord_lower:[65535&v,65535&b]}}let lu=r.m.create(),na=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G)=>{let $=o.style.light,V=$.properties.get("position"),Y=[V.x,V.y,V.z],ne=r.bx.create();$.properties.get("anchor")==="viewport"&&(r.bx.fromRotation(ne,-o.transform.angle),r.v.transformMat3(Y,Y,ne));let re=$.properties.get("color"),W=o.transform,J={u_matrix:p,u_lightpos:Y,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[re.r,re.g,re.b],u_vertical_gradient:+c,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:lu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:v,u_edge_radius:b,u_flood_light_color:F,u_vertical_scale:z,u_flood_light_intensity:j,u_ground_shadow_factor:U,u_emissive_strength:G};return W.projection.name==="globe"&&(J.u_tile_id=[E.canonical.x,E.canonical.y,1<<E.canonical.z],J.u_zoom_transition=C,J.u_inv_rot_matrix=O,J.u_merc_center=R,J.u_up_dir=W.projection.upVector(new r.t(0,0,0),R[0]*r.J,R[1]*r.J),J.u_height_lift=I),J},cd=(p,o,c)=>({u_matrix:p,u_edge_radius:o,u_vertical_scale:c}),Qy=(p,o,c,g,v,b,E,I,C,R,O,F,z,j)=>{let U=na(p,o,c,g,v,b,E,C,R,O,F,z,j,1,[0,0,0],0),G={u_height_factor:-Math.pow(2,E.overscaledZ)/I.tileSize/8};return r.ak(U,hs(o,I),G)},ud=(p,o)=>({u_matrix:p,u_emissive_strength:o}),hd=(p,o,c,g)=>r.ak(ud(p,o),hs(c,g)),dd=(p,o,c)=>({u_matrix:p,u_world:c,u_emissive_strength:o}),ev=(p,o,c,g,v)=>r.ak(hd(p,o,c,g),{u_world:v}),tv=(p,o,c,g)=>{let v=r.J/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:o.getCameraToCenterDistance(g),u_extrude_scale:[o.pixelsToGLUnits[0]/v,o.pixelsToGLUnits[1]/v]}},Bp=(p,o,c=1)=>({u_matrix:p,u_color:o,u_overlay:0,u_overlay_scale:c}),nv=r.m.create(),jp=(p,o,c,g,v,b,E)=>{let I=p.transform,C=I.projection.name==="globe",R=C?r.by(I.zoom,o.canonical)*I._pixelsPerMercatorPixel:r.ay(c,1,b),O={u_matrix:o.projMatrix,u_extrude_scale:R,u_intensity:E,u_inv_rot_matrix:nv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){O.u_inv_rot_matrix=g,O.u_merc_center=v,O.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],O.u_zoom_transition=r.ao(I.zoom);let F=v[0]*r.J,z=v[1]*r.J;O.u_up_dir=I.projection.upVector(new r.t(0,0,0),F,z)}return O},Vp=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V,Y,ne,re)=>{return{u_matrix:p,u_normalize_matrix:o,u_globe_matrix:c,u_merc_matrix:g,u_grid_matrix:v,u_tl_parent:b,u_scale_parent:R,u_fade_t:O.mix,u_opacity:O.opacity*F.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:F.paint.get("raster-brightness-min"),u_brightness_high:F.paint.get("raster-brightness-max"),u_saturation_factor:(J=F.paint.get("raster-saturation"),J>0?1-1/(1.001-J):-J),u_contrast_factor:(W=F.paint.get("raster-contrast"),W>0?1/(1-W):1+W),u_spin_weights:cu(F.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:j,u_zoom_transition:E,u_merc_center:I,u_cutoff_params:C,u_colorization_mix:rv(G,V),u_colorization_offset:Up($,V),u_color_ramp:U,u_texture_offset:[ne/(Y+2*ne),Y/(Y+2*ne)],u_texture_res:[Y+2*ne,Y+2*ne],u_emissive_strength:re};var W,J};function cu(p){p*=Math.PI/180;let o=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*o-c+1)/3,(Math.sqrt(3)*o-c+1)/3]}function rv([p,o,c,g],[v,b]){if(v===b)return[0,0,0,0];let E=(r.bz+3)/(r.bz+1)/(b-v);return[p*E,o*E,c*E,g*E]}function Up(p,[o,c]){return o===c?0:((p-o)/(c-o)*(r.bz+3)-1)/(r.bz+1)}let uu=r.m.create(),Ll=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V)=>{let Y=v.transform,ne={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:Y.getCameraToCenterDistance(G),u_rotate_symbol:+c,u_aspect_ratio:Y.width/Y.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:E,u_coord_matrix:I,u_is_text:+C,u_pitch_with_map:+g,u_texsize:R,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:uu,u_up_vector:[0,-1,0],u_icon_transition:V||0,u_icon_saturation:$};return G.name==="globe"&&(ne.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],ne.u_zoom_transition=F,ne.u_inv_rot_matrix=j,ne.u_merc_center=z,ne.u_camera_forward=Y._camera.forward(),ne.u_ecef_origin=r.bA(Y.globeMatrix,O.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(Y.globeMatrix),ne.u_up_vector=U),ne},hu=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$)=>r.ak(Ll(p,o,c,g,v,b,E,I,C,R,F,z,j,U,G,$,1),{u_gamma_scale:g?v.transform.getCameraToCenterDistance($)*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:r.a4.devicePixelRatio,u_is_halo:+O,undefined:void 0}),Fl=(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G)=>r.ak(hu(p,o,c,g,v,b,E,I,!0,C,!0,O,F,z,j,U,G),{u_texsize_icon:R,u_texture_icon:1}),fd=(p,o,c,g)=>({u_matrix:p,u_emissive_strength:o,u_opacity:c,u_color:g}),ja=(p,o,c,g,v,b,E)=>r.ak(function(I,C,R,O){let F=R.imageManager.getPattern(I.toString(),C),{width:z,height:j}=R.imageManager.getPixelSize(C),U=Math.pow(2,O.tileID.overscaledZ),G=O.tileSize*Math.pow(2,R.transform.tileZoom)/U,$=G*(O.tileID.canonical.x+O.tileID.wrap*U),V=G*O.tileID.canonical.y;return{u_image:0,u_pattern_tl:F.tl,u_pattern_br:F.br,u_texsize:[z,j],u_pattern_size:F.displaySize,u_tile_units_to_pixels:1/r.ay(O,1,R.transform.tileZoom),u_pixel_coord_upper:[$>>16,V>>16],u_pixel_coord_lower:[65535&$,65535&V]}}(v,b,g,E),{u_matrix:p,u_emissive_strength:o,u_opacity:c}),Nr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Nl=(p,o,c,g,v,b,E,I,C,R,O,F,z=[0,0,0])=>{let j=g.style.light,U=j.properties.get("position"),G=[-U.x,-U.y,U.z],$=r.bx.create();j.properties.get("anchor")==="viewport"&&(r.bx.fromRotation($,-g.transform.angle),r.v.transformMat3(G,G,$));let V=R.alphaMode==="MASK",Y=j.properties.get("color"),ne=F.paint.get("model-ambient-occlusion-intensity"),re=F.paint.get("model-color").constantOr(r.C.white),W=F.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:p,u_lighting_matrix:o,u_normal_matrix:c,u_lightpos:G,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[Y.r,Y.g,Y.b],u_camera_pos:z,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+V,u_alphaCutoff:R.alphaCutoff,u_baseColorFactor:[b.r,b.g,b.b,b.a],u_emissiveFactor:[E[0],E[1],E[2],1],u_metallicFactor:I,u_roughnessFactor:C,u_baseColorTexture:Nr.BaseColor,u_metallicRoughnessTexture:Nr.MetallicRoughness,u_normalTexture:Nr.Normal,u_occlusionTexture:Nr.Occlusion,u_emissionTexture:Nr.Emission,u_color_mix:[re.r,re.g,re.b,W],u_aoIntensity:ne,u_emissive_strength:O}},ra=new Float32Array(16),du=(p,o=ra,c=ra)=>({u_matrix:p,u_instance:o,u_node_matrix:c}),$p={fillExtrusion:p=>({u_matrix:new r.a_(p),u_lightpos:new r.b7(p),u_lightintensity:new r.b2(p),u_lightcolor:new r.b7(p),u_vertical_gradient:new r.b2(p),u_opacity:new r.b2(p),u_edge_radius:new r.b2(p),u_ao:new r.b0(p),u_tile_id:new r.b7(p),u_zoom_transition:new r.b2(p),u_inv_rot_matrix:new r.a_(p),u_merc_center:new r.b0(p),u_up_dir:new r.b7(p),u_height_lift:new r.b2(p),u_flood_light_color:new r.b7(p),u_vertical_scale:new r.b2(p),u_flood_light_intensity:new r.b2(p),u_ground_shadow_factor:new r.b7(p),u_emissive_strength:new r.b2(p)}),fillExtrusionDepth:p=>({u_matrix:new r.a_(p),u_edge_radius:new r.b2(p),u_vertical_scale:new r.b2(p)}),fillExtrusionPattern:p=>({u_matrix:new r.a_(p),u_lightpos:new r.b7(p),u_lightintensity:new r.b2(p),u_lightcolor:new r.b7(p),u_vertical_gradient:new r.b2(p),u_height_factor:new r.b2(p),u_edge_radius:new r.b2(p),u_ao:new r.b0(p),u_tile_id:new r.b7(p),u_zoom_transition:new r.b2(p),u_inv_rot_matrix:new r.a_(p),u_merc_center:new r.b0(p),u_up_dir:new r.b7(p),u_height_lift:new r.b2(p),u_image:new r.a$(p),u_texsize:new r.b0(p),u_pixel_coord_upper:new r.b0(p),u_pixel_coord_lower:new r.b0(p),u_tile_units_to_pixels:new r.b2(p),u_opacity:new r.b2(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new r.a_(p),u_opacity:new r.b2(p),u_ao_pass:new r.b2(p),u_meter_to_tile:new r.b2(p),u_ao:new r.b0(p),u_flood_light_intensity:new r.b2(p),u_flood_light_color:new r.b7(p),u_attenuation:new r.b2(p),u_edge_radius:new r.b2(p),u_fb:new r.a$(p),u_fb_size:new r.b2(p)}),fill:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p)}),fillPattern:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p),u_image:new r.a$(p),u_texsize:new r.b0(p),u_pixel_coord_upper:new r.b0(p),u_pixel_coord_lower:new r.b0(p),u_tile_units_to_pixels:new r.b2(p)}),fillOutline:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p),u_world:new r.b0(p)}),fillOutlinePattern:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p),u_world:new r.b0(p),u_image:new r.a$(p),u_texsize:new r.b0(p),u_pixel_coord_upper:new r.b0(p),u_pixel_coord_lower:new r.b0(p),u_tile_units_to_pixels:new r.b2(p)}),circle:r.bB,collisionBox:p=>({u_matrix:new r.a_(p),u_camera_to_center_distance:new r.b2(p),u_extrude_scale:new r.b0(p)}),collisionCircle:p=>({u_matrix:new r.a_(p),u_inv_matrix:new r.a_(p),u_camera_to_center_distance:new r.b2(p),u_viewport_size:new r.b0(p)}),debug:p=>({u_color:new r.b1(p),u_matrix:new r.a_(p),u_overlay:new r.a$(p),u_overlay_scale:new r.b2(p)}),clippingMask:p=>({u_matrix:new r.a_(p)}),heatmap:p=>({u_extrude_scale:new r.b2(p),u_intensity:new r.b2(p),u_matrix:new r.a_(p),u_inv_rot_matrix:new r.a_(p),u_merc_center:new r.b0(p),u_tile_id:new r.b7(p),u_zoom_transition:new r.b2(p),u_up_dir:new r.b7(p)}),heatmapTexture:p=>({u_image:new r.a$(p),u_color_ramp:new r.a$(p),u_opacity:new r.b2(p)}),hillshade:p=>({u_matrix:new r.a_(p),u_image:new r.a$(p),u_latrange:new r.b0(p),u_light:new r.b0(p),u_shadow:new r.b1(p),u_highlight:new r.b1(p),u_emissive_strength:new r.b2(p),u_accent:new r.b1(p)}),hillshadePrepare:p=>({u_matrix:new r.a_(p),u_image:new r.a$(p),u_dimension:new r.b0(p),u_zoom:new r.b2(p)}),line:r.bC,linePattern:r.bD,raster:p=>({u_matrix:new r.a_(p),u_normalize_matrix:new r.a_(p),u_globe_matrix:new r.a_(p),u_merc_matrix:new r.a_(p),u_grid_matrix:new r.b8(p),u_tl_parent:new r.b0(p),u_scale_parent:new r.b2(p),u_fade_t:new r.b2(p),u_opacity:new r.b2(p),u_image0:new r.a$(p),u_image1:new r.a$(p),u_brightness_low:new r.b2(p),u_brightness_high:new r.b2(p),u_saturation_factor:new r.b2(p),u_contrast_factor:new r.b2(p),u_spin_weights:new r.b7(p),u_perspective_transform:new r.b0(p),u_raster_elevation:new r.b2(p),u_zoom_transition:new r.b2(p),u_merc_center:new r.b0(p),u_cutoff_params:new r.b9(p),u_colorization_mix:new r.b9(p),u_colorization_offset:new r.b2(p),u_color_ramp:new r.a$(p),u_texture_offset:new r.b0(p),u_texture_res:new r.b0(p),u_emissive_strength:new r.b2(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.a$(p),u_is_size_feature_constant:new r.a$(p),u_size_t:new r.b2(p),u_size:new r.b2(p),u_camera_to_center_distance:new r.b2(p),u_rotate_symbol:new r.a$(p),u_aspect_ratio:new r.b2(p),u_fade_change:new r.b2(p),u_matrix:new r.a_(p),u_label_plane_matrix:new r.a_(p),u_coord_matrix:new r.a_(p),u_is_text:new r.a$(p),u_pitch_with_map:new r.a$(p),u_texsize:new r.b0(p),u_tile_id:new r.b7(p),u_zoom_transition:new r.b2(p),u_inv_rot_matrix:new r.a_(p),u_merc_center:new r.b0(p),u_camera_forward:new r.b7(p),u_tile_matrix:new r.a_(p),u_up_vector:new r.b7(p),u_ecef_origin:new r.b7(p),u_texture:new r.a$(p),u_icon_transition:new r.b2(p),u_icon_saturation:new r.b2(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.a$(p),u_is_size_feature_constant:new r.a$(p),u_size_t:new r.b2(p),u_size:new r.b2(p),u_camera_to_center_distance:new r.b2(p),u_rotate_symbol:new r.a$(p),u_aspect_ratio:new r.b2(p),u_fade_change:new r.b2(p),u_matrix:new r.a_(p),u_label_plane_matrix:new r.a_(p),u_coord_matrix:new r.a_(p),u_is_text:new r.a$(p),u_pitch_with_map:new r.a$(p),u_texsize:new r.b0(p),u_texture:new r.a$(p),u_gamma_scale:new r.b2(p),u_device_pixel_ratio:new r.b2(p),u_tile_id:new r.b7(p),u_zoom_transition:new r.b2(p),u_inv_rot_matrix:new r.a_(p),u_merc_center:new r.b0(p),u_camera_forward:new r.b7(p),u_tile_matrix:new r.a_(p),u_up_vector:new r.b7(p),u_ecef_origin:new r.b7(p),u_is_halo:new r.a$(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.a$(p),u_is_size_feature_constant:new r.a$(p),u_size_t:new r.b2(p),u_size:new r.b2(p),u_camera_to_center_distance:new r.b2(p),u_rotate_symbol:new r.a$(p),u_aspect_ratio:new r.b2(p),u_fade_change:new r.b2(p),u_matrix:new r.a_(p),u_label_plane_matrix:new r.a_(p),u_coord_matrix:new r.a_(p),u_is_text:new r.a$(p),u_pitch_with_map:new r.a$(p),u_texsize:new r.b0(p),u_texsize_icon:new r.b0(p),u_texture:new r.a$(p),u_texture_icon:new r.a$(p),u_gamma_scale:new r.b2(p),u_device_pixel_ratio:new r.b2(p),u_is_halo:new r.a$(p)}),background:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p),u_opacity:new r.b2(p),u_color:new r.b1(p)}),backgroundPattern:p=>({u_matrix:new r.a_(p),u_emissive_strength:new r.b2(p),u_opacity:new r.b2(p),u_image:new r.a$(p),u_pattern_tl:new r.b0(p),u_pattern_br:new r.b0(p),u_texsize:new r.b0(p),u_pattern_size:new r.b0(p),u_pixel_coord_upper:new r.b0(p),u_pixel_coord_lower:new r.b0(p),u_tile_units_to_pixels:new r.b2(p)}),terrainRaster:tu,terrainDepth:tu,skybox:p=>({u_matrix:new r.a_(p),u_sun_direction:new r.b7(p),u_cubemap:new r.a$(p),u_opacity:new r.b2(p),u_temporal_offset:new r.b2(p)}),skyboxGradient:p=>({u_matrix:new r.a_(p),u_color_ramp:new r.a$(p),u_center_direction:new r.b7(p),u_radius:new r.b2(p),u_opacity:new r.b2(p),u_temporal_offset:new r.b2(p)}),skyboxCapture:p=>({u_matrix_3f:new r.b8(p),u_sun_direction:new r.b7(p),u_sun_intensity:new r.b2(p),u_color_tint_r:new r.b9(p),u_color_tint_m:new r.b9(p),u_luminance:new r.b2(p)}),globeRaster:p=>({u_proj_matrix:new r.a_(p),u_globe_matrix:new r.a_(p),u_normalize_matrix:new r.a_(p),u_merc_matrix:new r.a_(p),u_zoom_transition:new r.b2(p),u_merc_center:new r.b0(p),u_image0:new r.a$(p),u_grid_matrix:new r.b8(p),u_skirt_height:new r.b2(p),u_frustum_tl:new r.b7(p),u_frustum_tr:new r.b7(p),u_frustum_br:new r.b7(p),u_frustum_bl:new r.b7(p),u_globe_pos:new r.b7(p),u_globe_radius:new r.b2(p),u_viewport:new r.b0(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.b7(p),u_frustum_tr:new r.b7(p),u_frustum_br:new r.b7(p),u_frustum_bl:new r.b7(p),u_horizon:new r.b2(p),u_transition:new r.b2(p),u_fadeout_range:new r.b2(p),u_color:new r.b9(p),u_high_color:new r.b9(p),u_space_color:new r.b9(p),u_temporal_offset:new r.b2(p),u_horizon_angle:new r.b2(p)}),model:p=>({u_matrix:new r.a_(p),u_lighting_matrix:new r.a_(p),u_normal_matrix:new r.a_(p),u_lightpos:new r.b7(p),u_lightintensity:new r.b2(p),u_lightcolor:new r.b7(p),u_camera_pos:new r.b7(p),u_opacity:new r.b2(p),u_baseColorFactor:new r.b9(p),u_emissiveFactor:new r.b9(p),u_metallicFactor:new r.b2(p),u_roughnessFactor:new r.b2(p),u_baseTextureIsAlpha:new r.a$(p),u_alphaMask:new r.a$(p),u_alphaCutoff:new r.b2(p),u_baseColorTexture:new r.a$(p),u_metallicRoughnessTexture:new r.a$(p),u_normalTexture:new r.a$(p),u_occlusionTexture:new r.a$(p),u_emissionTexture:new r.a$(p),u_color_mix:new r.b9(p),u_aoIntensity:new r.b2(p),u_emissive_strength:new r.b2(p)}),modelDepth:p=>({u_matrix:new r.a_(p),u_instance:new r.a_(p),u_node_matrix:new r.a_(p)}),groundShadow:p=>({u_matrix:new r.a_(p),u_ground_shadow_factor:new r.b7(p)}),stars:p=>({u_matrix:new r.a_(p),u_up:new r.b7(p),u_right:new r.b7(p),u_intensity_multiplier:new r.b2(p)})},Va;function pd(p,o,c,g,v,b,E){let I=p.context,C=I.gl,R=p.transform,O=p.getOrCreateProgram("collisionBox"),F=[],z=0,j=0;for(let re=0;re<g.length;re++){let W=g[re],J=o.getTile(W),oe=J.getBucket(c);if(!oe)continue;let ce=qh(W,oe,R),ae=ce;v[0]===0&&v[1]===0||(ae=p.translatePosMatrix(ce,J,v,b));let ue=E?oe.textCollisionBox:oe.iconCollisionBox,De=oe.collisionCircleArray;if(De.length>0){let ve=r.m.create(),we=ae;r.m.mul(ve,oe.placementInvProjMatrix,R.glCoordMatrix),r.m.mul(ve,ve,oe.placementViewportMatrix),F.push({circleArray:De,circleOffset:j,transform:we,invTransform:ve,projection:oe.getProjection()}),z+=De.length/4,j=z}ue&&(p.terrain&&p.terrain.setupElevationDraw(J,O),O.draw(p,C.LINES,r.b4.disabled,r.b6.disabled,p.colorModeForRenderPass(),r.b5.disabled,tv(ae,R,J,oe.getProjection()),c.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,null,R.zoom,null,[ue.collisionVertexBuffer,ue.collisionVertexBufferExt]))}if(!E||!F.length)return;let U=p.getOrCreateProgram("collisionCircle"),G=new r.bE;G.resize(4*z),G._trim();let $=0;for(let re of F)for(let W=0;W<re.circleArray.length/4;W++){let J=4*W,oe=re.circleArray[J+0],ce=re.circleArray[J+1],ae=re.circleArray[J+2],ue=re.circleArray[J+3];G.emplace($++,oe,ce,ae,ue,0),G.emplace($++,oe,ce,ae,ue,1),G.emplace($++,oe,ce,ae,ue,2),G.emplace($++,oe,ce,ae,ue,3)}(!Va||Va.length<2*z)&&(Va=function(re){let W=2*re,J=new r.bp;J.resize(W),J._trim();for(let oe=0;oe<W;oe++){let ce=6*oe;J.uint16[ce+0]=4*oe+0,J.uint16[ce+1]=4*oe+1,J.uint16[ce+2]=4*oe+2,J.uint16[ce+3]=4*oe+2,J.uint16[ce+4]=4*oe+3,J.uint16[ce+5]=4*oe+0}return J}(z));let V=I.createIndexBuffer(Va,!0),Y=I.createVertexBuffer(G,r.bF.members,!0);for(let re of F){let W={u_matrix:re.transform,u_inv_matrix:re.invTransform,u_camera_to_center_distance:(ne=R).getCameraToCenterDistance(re.projection),u_viewport_size:[ne.width,ne.height]};U.draw(p,C.TRIANGLES,r.b4.disabled,r.b6.disabled,p.colorModeForRenderPass(),r.b5.disabled,W,c.id,Y,V,r.bm.simpleSegment(0,2*re.circleOffset,re.circleArray.length,re.circleArray.length/2),null,R.zoom)}var ne;Y.destroy(),V.destroy()}let fu=r.m.create();function pu({width:p,height:o,anchor:c,textOffset:g,textScale:v},b){let{horizontalAlign:E,verticalAlign:I}=r.aY(c),C=-(E-.5)*p,R=-(I-.5)*o,O=r.aW(c,g);return new r.P((C/v+O[0])*b,(R/v+O[1])*b)}function md(p,o,c,g,v,b,E,I,C,R,O){let F=p.text.placedSymbolArray,z=p.text.dynamicLayoutVertexArray,j=p.icon.dynamicLayoutVertexArray,U={},G=p.getProjection(),$=Ks(I,G,b),V=b.elevation,Y=G.upVectorScale(I.canonical,b.center.lat,b.worldSize).metersToTile;z.clear();for(let ne=0;ne<F.length;ne++){let re=F.get(ne),{tileAnchorX:W,tileAnchorY:J,numGlyphs:oe}=re,ce=re.hidden||!re.crossTileID||p.allowVerticalPlacement&&!re.placedOrientation?null:g[re.crossTileID];if(ce){let ae=0,ue=0,De=0;if(V){let Le=V?V.getAtTileOffset(I,W,J):0,[Re,ot,et]=G.upVector(I.canonical,W,J);ae=Le*Re*Y,ue=Le*ot*Y,De=Le*et*Y}let[ve,we,de,Ie]=Fr(re.projectedAnchorX+ae,re.projectedAnchorY+ue,re.projectedAnchorZ+De,c?$:E),be=Se(b.getCameraToCenterDistance(G),Ie),Ce=v.evaluateSizeForFeature(p.textSizeData,R,re)*be/r.aV;c&&(Ce*=p.tilePixelRatio/C);let Q=pu(ce,Ce);c?({x:ve,y:we,z:de}=G.projectTilePoint(W+Q.x,J+Q.y,I.canonical),[ve,we,de]=Fr(ve+ae,we+ue,de+De,E)):(o&&Q._rotate(-b.angle),ve+=Q.x,we+=Q.y,de=0);let me=p.allowVerticalPlacement&&re.placedOrientation===r.W.vertical?Math.PI/2:0;for(let Le=0;Le<oe;Le++)r.k(z,ve,we,de,me);O&&re.associatedIconIndex>=0&&(U[re.associatedIconIndex]={x:ve,y:we,z:de,angle:me})}else qe(oe,z)}if(O){j.clear();let ne=p.icon.placedSymbolArray;for(let re=0;re<ne.length;re++){let W=ne.get(re),{numGlyphs:J}=W,oe=U[re];if(W.hidden||!oe)qe(J,j);else{let{x:ce,y:ae,z:ue,angle:De}=oe;for(let ve=0;ve<J;ve++)r.k(j,ce,ae,ue,De)}}p.icon.dynamicLayoutVertexBuffer.updateData(j)}p.text.dynamicLayoutVertexBuffer.updateData(z)}function gd(p,o,c){return c.iconsInText&&o?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Wt(p,o,c,g,v,b,E,I,C,R,O,F,z){let j=p.context,U=j.gl,G=p.transform,$=I==="map",V=C==="map",Y=$&&c.layout.get("symbol-placement")!=="point",ne=$&&!V&&!Y,re=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,W=!1,J=p.depthModeForSublayer(0,r.b4.ReadOnly),oe=[r.E(G.center.lng),r.H(G.center.lat)],ce=c.layout.get("text-variable-anchor"),ae=G.projection.name==="globe",ue=[],De=[0,-1,0],ve=De;!ae&&!G.mercatorFromTransition||$||(ve=function(we){let de=we._camera.getWorldToCamera(we.worldSize,1),Ie=r.m.multiply([],de,we.globeMatrix);r.m.invert(Ie,Ie);let be=[0,0,0],Ce=[0,1,0,0];return r.e.transformMat4(Ce,Ce,Ie),be[0]=Ce[0],be[1]=Ce[1],be[2]=Ce[2],r.v.normalize(be,be),be}(G));for(let we of g){let de=o.getTile(we),Ie=de.getBucket(c);if(!Ie||Ie.projection.name==="mercator"&&ae)continue;let be=v?Ie.text:Ie.icon;if(!be||Ie.fullyClipped||!be.segments.get().length)continue;let Ce=be.programConfigurations.get(c.id),Q=v||Ie.sdfIcons,me=v?Ie.textSizeData:Ie.iconSizeData,Le=V||G.pitch!==0,Re=r.i(me,G.zoom),ot,et,mt,tt,xt=[0,0],bt=null;if(v)et=de.glyphAtlasTexture?de.glyphAtlasTexture:null,mt=U.LINEAR,ot=de.glyphAtlasTexture?de.glyphAtlasTexture.size:[0,0],Ie.iconsInText&&(xt=de.imageAtlasTexture?de.imageAtlasTexture.size:[0,0],bt=de.imageAtlasTexture?de.imageAtlasTexture:null,tt=Le||p.options.rotating||p.options.zooming||me.kind==="composite"||me.kind==="camera"?U.LINEAR:U.NEAREST);else{let En=c.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;et=de.imageAtlasTexture?de.imageAtlasTexture:null,mt=Q||p.options.rotating||p.options.zooming||En||Le?U.LINEAR:U.NEAREST,ot=de.imageAtlasTexture?de.imageAtlasTexture.size:[0,0]}let ht=Ie.projection.name==="globe",dt=ht?ve:De,nn=ht?r.ao(G.zoom):0,Lt=Ks(we,Ie.getProjection(),G),Rn=G.calculatePixelsToTileUnitsMatrix(de),xn=Lr(Lt,de.tileID.canonical,V,$,G,Ie.getProjection(),Rn),Qr=p.terrain&&V&&Y?r.m.invert(r.m.create(),xn):fu,Ri=os(Lt,de.tileID.canonical,V,$,G,Ie.getProjection(),Rn),mn=ce&&Ie.hasTextData(),an=Ie.hasIconTextFit()&&mn&&Ie.hasIconData();if(Y){let En=G.elevation,to=En?En.getAtTileOffsetFunc(we,G.center.lat,G.worldSize,Ie.getProjection()):null,go=Ro(Lt,de.tileID.canonical,V,$,G,Ie.getProjection(),Rn);Ve(Ie,Lt,p,v,go,Ri,V,R,to,we)}let cn=Y||v&&ce||an,Un=p.translatePosMatrix(Lt,de,b,E),Dr=cn?fu:xn,kn=p.translatePosMatrix(Ri,de,b,E,!0),Vr=Ie.getProjection().createInversionMatrix(G,we.canonical),ei=c.paint.get("icon-image-cross-fade").constantOr(0),Ur=[];p.terrainRenderModeElevated()&&V&&Ur.push("PITCH_WITH_MAP_TERRAIN"),ht&&(Ur.push("PROJECTION_GLOBE_VIEW"),cn&&Ur.push("PROJECTED_POS_ON_VIEWPORT")),ei>0&&Ur.push("ICON_TRANSITION"),be.zOffsetVertexBuffer&&Ur.push("Z_OFFSET");let Pi=Q&&c.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Fo;Q?Fo=Ie.iconsInText?Fl(me.kind,Re,ne,V,p,Un,Dr,kn,ot,xt,we,nn,oe,Vr,dt,Ie.getProjection()):hu(me.kind,Re,ne,V,p,Un,Dr,kn,v,ot,!0,we,nn,oe,Vr,dt,Ie.getProjection()):(O<1&&Ur.push("SATURATION"),Fo=Ll(me.kind,Re,ne,V,p,Un,Dr,kn,v,ot,we,nn,oe,Vr,dt,Ie.getProjection(),O,ei));let eo={program:p.getOrCreateProgram(gd(Q,v,Ie),{config:Ce,defines:Ur}),buffers:be,uniformValues:Fo,atlasTexture:et,atlasTextureIcon:bt,atlasInterpolation:mt,atlasInterpolationIcon:tt,isSDF:Q,hasHalo:Pi,tile:de,labelPlaneMatrixInv:Qr};if(re&&Ie.canOverlap){W=!0;let En=be.segments.get();for(let to of En)ue.push({segments:new r.bm([to]),sortKey:to.sortKey,state:eo})}else ue.push({segments:be.segments,sortKey:0,state:eo})}W&&ue.sort((we,de)=>we.sortKey-de.sortKey);for(let we of ue){let de=we.state;if(p.terrain&&p.terrain.setupElevationDraw(de.tile,de.program,{useDepthForOcclusion:G.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:de.labelPlaneMatrixInv}),j.activeTexture.set(U.TEXTURE0),de.atlasTexture&&de.atlasTexture.bind(de.atlasInterpolation,U.CLAMP_TO_EDGE,!0),de.atlasTextureIcon&&(j.activeTexture.set(U.TEXTURE1),de.atlasTextureIcon&&de.atlasTextureIcon.bind(de.atlasInterpolationIcon,U.CLAMP_TO_EDGE,!0)),p.uploadCommonLightUniforms(p.context,de.program),de.hasHalo){let Ie=de.uniformValues;Ie.u_is_halo=1,mu(de.buffers,we.segments,c,p,de.program,J,F,z,Ie,2),Ie.u_is_halo=0}else{if(de.isSDF){let Ie=de.uniformValues;de.hasHalo&&(Ie.u_is_halo=1,mu(de.buffers,we.segments,c,p,de.program,J,F,z,Ie,1)),Ie.u_is_halo=0}mu(de.buffers,we.segments,c,p,de.program,J,F,z,de.uniformValues,1)}}}function mu(p,o,c,g,v,b,E,I,C,R){let O=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer];v.draw(g,g.context.gl.TRIANGLES,b,E,I,r.b5.disabled,C,c.id,p.layoutVertexBuffer,p.indexBuffer,o,c.paint,g.transform.zoom,p.programConfigurations.get(c.id),O,R)}function zl(p,o,c,g,v,b,E){let I=p.context.gl,C=c.paint.get("fill-pattern"),R=C&&C.constantOr(1),O,F,z,j,U;E?(F=R&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=I.LINES):(F=R?"fillPattern":"fill",O=I.TRIANGLES);for(let G of g){let $=o.getTile(G);if(R&&!$.patternsLoaded())continue;let V=$.getBucket(c);if(!V)continue;p.prepareDrawTile();let Y=V.programConfigurations.get(c.id),ne=p.isTileAffectedByFog(G),re=p.getOrCreateProgram(F,{config:Y,overrideFog:ne});R&&(p.context.activeTexture.set(I.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Y.updatePaintBuffers());let W=C.constantOr(null);if(W&&$.imageAtlas){let ce=$.imageAtlas.patternPositions[W.toString()];ce&&Y.setConstantPatternPositions(ce)}let J=p.translatePosMatrix(G.projMatrix,$,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),oe=c.paint.get("fill-emissive-strength");if(E){j=V.indexBuffer2,U=V.segments2;let ce=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];z=F==="fillOutlinePattern"&&R?ev(J,oe,p,$,ce):dd(J,oe,ce)}else j=V.indexBuffer,U=V.segments,z=R?hd(J,oe,p,$):ud(J,oe);p.uploadCommonUniforms(p.context,re,G.toUnwrapped()),re.draw(p,O,v,p.stencilModeForClipping(G),b,r.b5.disabled,z,c.id,V.layoutVertexBuffer,j,U,c.paint,p.transform.zoom,Y,void 0)}}function Bl(p,o,c,g,v,b,E,I){c.resetLayerRenderingStats();let C=p.context,R=C.gl,O=p.transform,F=c.paint.get("fill-extrusion-pattern"),z=F.constantOr(1),j=c.paint.get("fill-extrusion-opacity"),U=p.style.enable3dLights(),G=c.paint.get(U&&!z?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],V=c.layout.get("fill-extrusion-edge-radius"),Y=V>0&&!c.paint.get("fill-extrusion-rounded-roof"),ne=Y?0:V,re=O.projection.name==="globe"?r.bO():0,W=O.projection.name==="globe",J=W?r.ao(O.zoom):0,oe=[r.E(O.center.lng),r.H(O.center.lat)],ce=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ae=c.paint.get("fill-extrusion-flood-light-intensity"),ue=c.paint.get("fill-extrusion-vertical-scale"),De=ta(p,c.paint.get("fill-extrusion-cutoff-fade-range")),ve=c.paint.get("fill-extrusion-emissive-strength"),we=[],de;W&&we.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&we.push("FAUX_AO"),Y&&we.push("ZERO_ROOF_RADIUS"),I&&we.push("HAS_CENTROID"),ae>0&&we.push("FLOOD_LIGHT"),De.shouldRenderCutoff&&we.push("RENDER_CUTOFF");let Ie=p.renderPass==="shadow",be=p.shadowRenderer,Ce=Ie&&!!be;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Q=[0,0,0];if(be){let Re=p.style.directionalLight,ot=p.style.ambientLight;Re&&ot&&(Q=yu(Re,ot)),de=we.concat(["SHADOWS_SINGLE_CASCADE"])}let me=Ce?"fillExtrusionDepth":z?"fillExtrusionPattern":"fillExtrusion",Le=c.getLayerRenderingStats();for(let Re of g){let ot=o.getTile(Re),et=ot.getBucket(c);if(!et||et.projection.name!==O.projection.name)continue;let mt=!1;be&&(mt=be.getMaxCascadeForTile(Re.toUnwrapped())===0);let tt=p.isTileAffectedByFog(Re),xt=et.programConfigurations.get(c.id),bt=p.getOrCreateProgram(me,{config:xt,defines:mt?de:we,overrideFog:tt});if(p.terrain&&p.terrain.setupElevationDraw(ot,bt,{useMeterToDem:!0}),!et.centroidVertexBuffer){let xn=bt.attributes.a_centroid_pos;xn!==void 0&&R.vertexAttrib2f(xn,0,0)}!Ie&&be&&be.setupShadows(ot.tileID.toUnwrapped(),bt,"vector-tile",ot.tileID.overscaledZ),z&&(p.context.activeTexture.set(R.TEXTURE0),ot.imageAtlasTexture&&ot.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),xt.updatePaintBuffers());let ht=F.constantOr(null);if(ht&&ot.imageAtlas){let xn=ot.imageAtlas.patternPositions[ht.toString()];xn&&xt.setConstantPatternPositions(xn)}let dt=c.paint.get("fill-extrusion-vertical-gradient"),nn;if(Ie&&be){if(ov(ot.tileID,et,p))continue;let xn=be.calculateShadowPassMatrixFromTile(ot.tileID.toUnwrapped());nn=cd(xn,ne,ue)}else{let xn=p.translatePosMatrix(Re.expandedProjMatrix,ot,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Qr=O.projection.createInversionMatrix(O,Re.canonical);nn=z?Qy(xn,p,dt,j,$,ne,Re,ot,re,J,oe,Qr,ce,ue):na(xn,p,dt,j,$,ne,Re,re,J,oe,Qr,ce,ue,ae,Q,ve)}p.uploadCommonUniforms(C,bt,Re.toUnwrapped(),null,De);let Lt=et.segments;if(O.projection.name==="mercator"&&!Ie&&(Lt=et.getVisibleSegments(ot.tileID,p.terrain,p.transform.getFrustum(0)),!Lt.get().length))continue;if(Le)if(Ie)for(let xn of Lt.get())Le.numRenderedVerticesInShadowPass+=xn.primitiveLength;else for(let xn of Lt.get())Le.numRenderedVerticesInTransparentPass+=xn.primitiveLength;let Rn=[];(p.terrain||I)&&Rn.push(et.centroidVertexBuffer),W&&Rn.push(et.layoutVertexExtBuffer),bt.draw(p,C.gl.TRIANGLES,v,b,E,r.b5.backCCW,nn,c.id,et.layoutVertexBuffer,et.indexBuffer,Lt,c.paint,p.transform.zoom,xt,Rn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}function ia(p,o,c,g,v,b,E,I,C,R,O,F,z,j,U,G,$,V,Y){let ne=p.context,re=ne.gl,W=p.transform,J=p.transform.zoom,oe=[],ce=ta(p,c.paint.get("fill-extrusion-cutoff-fade-range"));R==="clear"?(oe.push("CLEAR_SUBPASS"),Y&&(oe.push("CLEAR_FROM_TEXTURE"),ne.activeTexture.set(re.TEXTURE0),Y.bind(re.LINEAR,re.CLAMP_TO_EDGE))):R==="sdf"&&oe.push("SDF_SUBPASS"),$&&oe.push("HAS_CENTROID"),ce.shouldRenderCutoff&&oe.push("RENDER_CUTOFF");let ae=c.layout.get("fill-extrusion-edge-radius"),ue=(De,ve,we,de,Ie)=>{let be=ve.programConfigurations.get(c.id),Ce=p.isTileAffectedByFog(De),Q=p.getOrCreateProgram("fillExtrusionGroundEffect",{config:be,defines:oe,overrideFog:Ce}),me=((Re,ot,et,mt,tt,xt,bt,ht,dt,nn,Lt)=>({u_matrix:ot,u_opacity:et,u_ao_pass:mt?1:0,u_meter_to_tile:tt,u_ao:xt,u_flood_light_intensity:bt,u_flood_light_color:ht,u_attenuation:dt,u_edge_radius:nn,u_fb:0,u_fb_size:Lt}))(0,de,O,C,Ie,[F,z*Ie],j,U,G,J>=17?0:ae*Ie,Y?Y.size[0]:0),Le=[];$&&Le.push(ve.hiddenByLandmarkVertexBuffer),p.uploadCommonUniforms(ne,Q,De.toUnwrapped(),null,ce),Q.draw(p,ne.gl.TRIANGLES,v,b,E,I,me,c.id,ve.vertexBuffer,ve.indexBuffer,we,c.paint,J,be,Le)};for(let De of g){let ve=o.getTile(De),we=ve.getBucket(c);if(!we||we.projection.name!==W.projection.name||!we.groundEffect||we.groundEffect&&!we.groundEffect.hasData())continue;let de=we.groundEffect,Ie=1/we.tileToMeter;{let be=p.translatePosMatrix(De.projMatrix,ve,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ce=de.getDefaultSegment();ue(De,de,Ce,be,Ie)}if(V)for(let be=0;be<4;be++){let Ce=r.bP[be](De),Q=o.getTile(Ce);if(!Q)continue;let me=Q.getBucket(c);if(!me||me.projection.name!==W.projection.name||!me.groundEffect||me.groundEffect&&!me.groundEffect.hasData())continue;let Le=me.groundEffect,Re,ot;be===0?(Re=[-r.J,0,0],ot=1):be===1?(Re=[r.J,0,0],ot=0):be===2?(Re=[0,-r.J,0],ot=3):(Re=[0,r.J,0],ot=2);let et=Le.regionSegments[ot];if(!et)continue;let mt=new Float32Array(16);r.m.translate(mt,De.projMatrix,Re),ue(De,Le,et,p.translatePosMatrix(mt,ve,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Ie)}}}function Gp(p,o,c,g,v,b,E){g.centroidVertexArray.length===0&&g.createCentroidsBuffer();let I=b?b.findDEMTileFor(c):null;if(!(I&&I.dem||E))return;let C=V=>new r.P(Math.ceil((V+r.bS)*r.bT),0),R=V=>{let Y=o.getSource().minzoom,ne=W=>{let J=o.getTileByID(W);if(J&&J.hasData())return J.getBucket(v)},re=[0,-1,1];for(let W of re){if(V.overscaledZ+W<Y)continue;let J=ne(V.calculateScaledKey(V.overscaledZ+W));if(J)return J}},O=[0,0,0],F=(V,Y)=>(O[0]=Math.min(V.min.y,Y.min.y),O[1]=Math.max(V.max.y,Y.max.y),O[2]=r.J-Y.min.x>V.max.x?Y.min.x-r.J:V.max.x,O),z=(V,Y)=>(O[0]=Math.min(V.min.x,Y.min.x),O[1]=Math.max(V.max.x,Y.max.x),O[2]=r.J-Y.min.y>V.max.y?Y.min.y-r.J:V.max.y,O),j=[(V,Y)=>F(V,Y),(V,Y)=>F(Y,V),(V,Y)=>z(V,Y),(V,Y)=>z(Y,V)],U=(V,Y,ne,re,W,J,oe)=>{if(!b)return 0;let ce=[[J?ne:V,J?V:ne,0],[J?ne:Y,J?Y:ne,0]],ae=oe<0?r.J+oe:oe,ue=[J?ae:(V+Y)/2,J?(V+Y)/2:ae,0];return ne===0&&oe<0||ne!==0&&oe>0?b.getForTilePoints(W,[ue],!0,re):ce.push(ue),b.getForTilePoints(c,ce,!0,I),Math.max(ce[0][2],ce[1][2],ue[2])/b.exaggeration()};for(let V=0;V<4;V++){let Y=g.borderFeatureIndices[V];if(Y.length===0)continue;let ne=r.bP[V](c),re=R(ne);if(!(re&&re instanceof r.bQ)||g.borderDoneWithNeighborZ[V]===re.canonical.z)continue;re.centroidVertexArray.length===0&&re.createCentroidsBuffer();let W=b?b.findDEMTileFor(ne):null;if(!(W&&W.dem||E))continue;let J=(V<2?1:5)-V,oe=re.borderDoneWithNeighborZ[J]!==g.canonical.z,ce=re.borderFeatureIndices[J],ae=0;if(g.canonical.z!==re.canonical.z){for(let ue of Y)g.showCentroid(g.featuresOnBorder[ue]);if(oe)for(let ue of ce)re.showCentroid(re.featuresOnBorder[ue]);g.borderDoneWithNeighborZ[V]=re.canonical.z,re.borderDoneWithNeighborZ[J]=g.canonical.z}for(let ue of Y){let De=g.featuresOnBorder[ue],ve=g.centroidData[De.centroidDataIndex],we=De.borders[V],de;for(;ae<ce.length;){de=re.featuresOnBorder[ce[ae]];let Ie=de.borders[J];if(Ie[1]>we[0]+3||Ie[0]>we[0]-3)break;re.showCentroid(de),ae++}if(de&&ae<ce.length){let Ie=ae,be=0;for(;!(de.borders[J][0]>we[1]-3)&&(be++,++ae!==ce.length);)de=re.featuresOnBorder[ce[ae]];if(de=re.featuresOnBorder[ce[Ie]],be>1){let me=de.borders[J];Math.abs(we[0]-me[0])<3&&Math.abs(we[1]-me[1])<3&&(be=1,ae=Ie+1)}else if(be===0){g.showCentroid(De);continue}let Ce=re.centroidData[de.centroidDataIndex];E&&be===1&&(((G=ve).flags|($=Ce).flags)&r.bR?(G.flags|=r.bR,$.flags|=r.bR):(G.flags&=~r.bR,$.flags&=~r.bR));let Q=De.intersectsCount()>1||de.intersectsCount()>1;if(be>1)ae=Ie,ve.centroidXY=Ce.centroidXY=new r.P(0,0);else if(W&&W.dem&&!Q){let me=j[V](ve,Ce),Le=V%2?r.J-1:0,Re=U(me[0],Math.min(r.J-1,me[1]),Le,W,ne,V<2,me[2]);ve.centroidXY=Ce.centroidXY=C(Re)}else Q?ve.centroidXY=Ce.centroidXY=new r.P(0,0):(ve.centroidXY=g.encodeBorderCentroid(De),Ce.centroidXY=re.encodeBorderCentroid(de));g.writeCentroidToBuffer(ve),re.writeCentroidToBuffer(Ce)}else g.showCentroid(De)}g.borderDoneWithNeighborZ[V]=re.canonical.z,re.borderDoneWithNeighborZ[J]=g.canonical.z}var G,$;(g.needsCentroidUpdate||!g.centroidVertexBuffer&&g.centroidVertexArray.length!==0)&&g.uploadCentroid(p)}let Ua=[1,0,0],Hp=[0,1,0],iv=[0,0,1];function ov(p,o,c){let g=c.transform,v=c.shadowRenderer;if(!v)return!0;let b=p.toUnwrapped(),E=g.tileSize*v._cascades[c.currentShadowCascade].scale,I=o.maxHeight;if(g.elevation){let G=g.elevation.getMinMaxForTile(p);G&&(I+=G.max)}let C=[...v.shadowDirection];C[2]=-C[2];let R=v.computeSimplifiedTileShadowVolume(b,I,E,C);if(!R)return!1;let O=[Ua,Hp,iv,C,[C[0],0,C[2]],[0,C[1],C[2]]],F=g.projection.name==="globe",z=g.scaleZoom(E),j=r.F.fromInvProjectionMatrix(g.invProjMatrix,g.worldSize,z,!F),U=v.getCurrentCascadeFrustum();return j.intersectsPrecise(R.vertices,R.planes,O)===0||U.intersectsPrecise(R.vertices,R.planes,O)===0}function sv(p){let o=p._nearZ,c=p.projection.farthestPixelDistance(p),g=c-o,v=.2*p.height,b=o+v;return[o,c,(b-v-o)/g,(b-o)/g]}let _d=new r.C(1,0,0,1),yd=new r.C(0,1,0,1),vd=new r.C(0,0,1,1),xd=new r.C(1,0,1,1),qp=new r.C(0,1,1,1);function oa(p,o,c,g,v,b){let E=p.context,I=p.transform,C=E.gl,R=I.projection.name==="globe",O=R?["PROJECTION_GLOBE_VIEW"]:[],F=r.m.clone(c.projMatrix);if(R&&r.ao(I.zoom)>0){let de=r.bU(c.canonical,I),Ie=r.bV(de);F=r.m.multiply(new Float32Array(16),I.globeMatrix,Ie),r.m.multiply(F,I.projMatrix,F)}let z=r.m.create();z[12]+=2*v/(r.a4.devicePixelRatio*I.width),z[13]+=2*b/(r.a4.devicePixelRatio*I.height),r.m.multiply(F,z,F);let j=p.getOrCreateProgram("debug",{defines:O}),U=o.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(U,j);let G=r.b4.disabled,$=r.b6.disabled,V=p.colorModeForRenderPass(),Y="$debug";E.activeTexture.set(C.TEXTURE0),p.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),R?U._makeGlobeTileDebugBuffers(p.context,I):U._makeDebugTileBoundsBuffers(p.context,I.projection);let ne=U._tileDebugBuffer||p.debugBuffer,re=U._tileDebugIndexBuffer||p.debugIndexBuffer,W=U._tileDebugSegments||p.debugSegments;j.draw(p,C.LINE_STRIP,G,$,V,r.b5.disabled,Bp(F,g),Y,ne,re,W,null,null,null,[U._globeTileDebugBorderBuffer]);let J=U.latestRawTileData,oe=Math.floor((J&&J.byteLength||0)/1024),ce=o.getTile(c).tileSize,ae=512/Math.min(ce,512)*(c.overscaledZ/I.zoom)*.5,ue=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ue+=` => ${c.overscaledZ}`),ue+=` ${oe}kb`,function(de,Ie){de.initDebugOverlayCanvas();let be=de.debugOverlayCanvas,Ce=de.context.gl,Q=de.debugOverlayCanvas.getContext("2d");Q.clearRect(0,0,be.width,be.height),Q.shadowColor="white",Q.shadowBlur=2,Q.lineWidth=1.5,Q.strokeStyle="white",Q.textBaseline="top",Q.font="bold 36px Open Sans, sans-serif",Q.fillText(Ie,5,5),Q.strokeText(Ie,5,5),de.debugOverlayTexture.update(be),de.debugOverlayTexture.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE)}(p,ue);let De=U._tileDebugTextBuffer||p.debugBuffer,ve=U._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,we=U._tileDebugTextSegments||p.debugSegments;j.draw(p,C.TRIANGLES,G,$,r.a.alphaBlended,r.b5.disabled,Bp(F,r.C.transparent,ae),Y,De,ve,we,null,null,null,[U._globeTileDebugTextBuffer])}function Wp(p,o,c,g){ds(p,0,o+c/2,p.transform.width,c,g)}function $a(p,o,c,g){ds(p,o-c/2,0,c,p.transform.height,g)}function ds(p,o,c,g,v,b){let E=p.context,I=E.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*r.a4.devicePixelRatio,c*r.a4.devicePixelRatio,g*r.a4.devicePixelRatio,v*r.a4.devicePixelRatio),E.clear({color:b}),I.disable(I.SCISSOR_TEST)}let Zp=r.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:gu}=Zp;function po(p,o,c,g){p.emplaceBack(o,c,g)}class Ki{constructor(o){this.vertexArray=new r.bX,this.indices=new r.bp,po(this.vertexArray,-1,-1,1),po(this.vertexArray,1,-1,1),po(this.vertexArray,-1,1,1),po(this.vertexArray,1,1,1),po(this.vertexArray,-1,-1,-1),po(this.vertexArray,1,-1,-1),po(this.vertexArray,-1,1,-1),po(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,gu),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.bm.simpleSegment(0,0,36,12)}}function fs(p,o,c,g,v,b){let E=p.context.gl,I=o.paint.get("sky-atmosphere-color"),C=o.paint.get("sky-atmosphere-halo-color"),R=o.paint.get("sky-atmosphere-sun-intensity"),O=((F,z,j,U,G)=>({u_matrix_3f:F,u_sun_direction:z,u_sun_intensity:j,u_color_tint_r:[U.r,U.g,U.b,U.a],u_color_tint_m:[G.r,G.g,G.b,G.a],u_luminance:5e-5}))(r.bx.fromMat4(r.bx.create(),g),v,R,I,C);E.framebufferTexture2D(E.FRAMEBUFFER,E.COLOR_ATTACHMENT0,E.TEXTURE_CUBE_MAP_POSITIVE_X+b,o.skyboxTexture,0),c.draw(p,E.TRIANGLES,r.b4.disabled,r.b6.disabled,r.a.unblended,r.b5.frontCW,O,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}let Xp=r.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class bd{constructor(o){let c=new r.bY;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);let g=new r.bp;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(c,Xp.members),this.indexBuffer=o.createIndexBuffer(g),this.segments=r.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let Yp=r.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wd{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class av{constructor(o){this.colorModeAlphaBlendedWriteRGB=new r.a([r.bZ,r.b_,r.bZ,r.b_],r.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new r.a([r.bZ,r.b$,r.bZ,r.b$],r.C.transparent,[!1,!1,!1,!0]),this.params=new wd,this.allocatedStarsCount=0,o.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),o.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(o){let c=o.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new bd(c),this.allocatedStarsCount=this.params.starsCount;let g=100,v=200,b=function(O){let F=r.c2(30),z=[];for(let j=0;j<O;++j){let U=2*Math.PI*F(),G=Math.acos(1-2*F())-.5*Math.PI;z.push(r.v.fromValues(Math.cos(G)*Math.cos(U),Math.cos(G)*Math.sin(U),Math.sin(G)))}return z}(this.allocatedStarsCount),E=r.c2(300),I=new r.c0,C=new r.bp,R=0;for(let O=0;O<b.length;++O){let F=r.v.scale([],b[O],200),z=Math.max(0,1+.01*g*(1*E()-.5)),j=Math.max(0,1+.01*v*(1*E()-.5));I.emplaceBack(F[0],F[1],F[2],-1,-1,z,j),I.emplaceBack(F[0],F[1],F[2],1,-1,z,j),I.emplaceBack(F[0],F[1],F[2],1,1,z,j),I.emplaceBack(F[0],F[1],F[2],-1,1,z,j),C.emplaceBack(R+0,R+1,R+2),C.emplaceBack(R+0,R+2,R+3),R+=4}this.starsVx=c.createVertexBuffer(I,Yp.members),this.starsIdx=c.createIndexBuffer(C),this.starsSegments=r.bm.simpleSegment(0,0,I.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,c){let g=o.context,v=g.gl,b=o.transform,E=new r.b4(v.LEQUAL,r.b4.ReadOnly,[0,1]),I=r.ao(b.zoom),C=c.properties.get("color").toArray01(),R=c.properties.get("high-color").toArray01(),O=c.properties.get("space-color").toArray01PremultipliedAlpha(),F=5e-4,z=r.c1(c.properties.get("horizon-blend"),0,1,F,.25),j=r.bb(o,g,b)&&z===F?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,U=o.frameCounter/1e3%1,G=r.v.length(b.globeCenterInViewSpace),$=Math.sqrt(Math.pow(G,2)-Math.pow(j,2)),V=Math.acos($/G),Y=ne=>{let re=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ne&&re.push("ALPHA_PASS");let W=o.getOrCreateProgram("globeAtmosphere",{defines:re}),J=((ce,ae,ue,De,ve,we,de,Ie,be,Ce,Q,me)=>({u_frustum_tl:ce,u_frustum_tr:ae,u_frustum_br:ue,u_frustum_bl:De,u_horizon:ve,u_transition:we,u_fadeout_range:de,u_color:Ie,u_high_color:be,u_space_color:Ce,u_temporal_offset:Q,u_horizon_angle:me}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,z,C,R,O,U,V);o.uploadCommonUniforms(g,W);let oe=this.atmosphereBuffer;oe&&W.draw(o,v.TRIANGLES,E,r.b6.disabled,ne?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,r.b5.backCW,J,ne?"atmosphere_glow_alpha":"atmosphere_glow",oe.vertexBuffer,oe.indexBuffer,oe.segments)};Y(!1),Y(!0)}drawStars(o,c){let g=r.c(c.properties.get("star-intensity"),0,1);if(g===0)return;let v=o.context,b=v.gl,E=o.transform,I=o.getOrCreateProgram("stars"),C=r.q.identity([]);r.q.rotateX(C,C,-E._pitch),r.q.rotateZ(C,C,-E.angle),r.q.rotateX(C,C,r.d(E._center.lat)),r.q.rotateY(C,C,-r.d(E._center.lng));let R=r.m.fromQuat(new Float32Array(16),C),O=r.m.multiply([],E.starsProjMatrix,R),F=r.bx.fromMat4([],R),z=r.bx.invert([],F),j=[0,1,0];r.v.transformMat3(j,j,z),r.v.scale(j,j,this.params.sizeMultiplier);let U=[1,0,0];r.v.transformMat3(U,U,z),r.v.scale(U,U,this.params.sizeMultiplier);let G=($=j,V=U,Y=g,{u_matrix:Float32Array.from(O),u_up:$,u_right:V,u_intensity_multiplier:Y});var $,V,Y;o.uploadCommonUniforms(v,I),this.starsVx&&this.starsIdx&&I.draw(o,b.TRIANGLES,r.b4.disabled,r.b6.disabled,this.colorModeAlphaBlendedWriteRGB,r.b5.disabled,G,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function _u(p,o){let c=[...p],g=o.cameraWorldSizeForFog/o.worldSize,v=r.m.identity([]);return r.m.scale(v,v,[g,g,1]),r.m.multiply(c,v,c),r.m.multiply(c,o.worldToFogMatrix,c),c}function Ed(p,o,c,g){let v=c.material,b=g.context,{baseColorTexture:E,metallicRoughnessTexture:I}=v.pbrMetallicRoughness,{normalTexture:C,occlusionTexture:R,emissionTexture:O}=v;function F(z,j,U){if(z&&(p.push(j),b.activeTexture.set(b.gl.TEXTURE0+U),z.gfxTexture)){let{minFilter:G,magFilter:$,wrapS:V,wrapT:Y}=z.sampler;z.gfxTexture.bindExtraParam(G,$,V,Y)}}F(E,"HAS_TEXTURE_u_baseColorTexture",Nr.BaseColor),F(I,"HAS_TEXTURE_u_metallicRoughnessTexture",Nr.MetallicRoughness),F(C,"HAS_TEXTURE_u_normalTexture",Nr.Normal),F(R,"HAS_TEXTURE_u_occlusionTexture",Nr.Occlusion),F(O,"HAS_TEXTURE_u_emissionTexture",Nr.Emission),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(c.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||p.push("DIFFUSE_SHADED"),p.push("USE_STANDARD_DERIVATIVES")}function sa(p,o,c,g,v,b){let E=c.paint.get("model-opacity"),I=o.context,C=new r.b4(o.context.gl.LEQUAL,r.b4.ReadWrite,o.depthRangeFor3D),R=o.transform,O=p.mesh,F=O.material,z=F.pbrMetallicRoughness,j=o.style.fog,U;U=o.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:r.m.multiply([],g.zScaleMatrix,p.nodeModelMatrix),r.m.multiply(U,g.negCameraPosMatrix,U);let G=r.m.invert([],U);r.m.transpose(G,G);let $=c.paint.get("model-emissive-strength").constantOr(0),V=Nl(new Float32Array(p.worldViewProjection),new Float32Array(U),new Float32Array(G),o,E,z.baseColorFactor,F.emissiveFactor,z.metallicFactor,z.roughnessFactor,F,$,c),Y={defines:[]},ne=[];Ed(Y.defines,ne,O,o);let re=o.shadowRenderer;re&&(re.useNormalOffset=!1);let W=null;if(j){let ce=_u(p.nodeModelMatrix,o.transform);if(W=new Float32Array(ce),R.projection.name!=="globe"){let ae=O.aabb.min,ue=O.aabb.max,[De,ve]=j.getOpacityForBounds(ce,ae[0],ae[1],ue[0],ue[1]);Y.overrideFog=De>=ui||ve>=ui}}let J=ta(o,c.paint.get("model-cutoff-fade-range"));J.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");let oe=o.getOrCreateProgram("model",Y);o.uploadCommonUniforms(I,oe,null,W,J),o.renderPass!=="shadow"&&re&&re.setupShadowsFromMatrix(p.nodeModelMatrix,oe),oe.draw(o,I.gl.TRIANGLES,C,v,b,O.material.doubleSided?r.b5.disabled:r.b5.backCCW,V,c.id,O.vertexBuffer,O.indexBuffer,O.segments,c.paint,o.transform.zoom,void 0,ne)}function Jp(p,o,c,g,v,b,E){let I;I=p.projection.name==="globe"?r.c5(c,p):[...c],r.m.multiply(I,I,o.matrix);let C=r.m.multiply([],g,I);if(o.meshes)for(let R of o.meshes){if(R.material.alphaMode!=="BLEND"){E.push({mesh:R,depth:0,modelIndex:v,worldViewProjection:C,nodeModelMatrix:I});continue}let O=r.v.transformMat4([],R.centroid,C);O[2]>0&&b.push({mesh:R,depth:O[2],modelIndex:v,worldViewProjection:C,nodeModelMatrix:I})}if(o.children)for(let R of o.children)Jp(p,R,c,g,v,b,E)}function jl(p,o,c,g){let v=c.shadowRenderer;if(!v)return;let b=v.getShadowPassDepthMode(),E=v.getShadowPassColorMode(),I=v.calculateShadowPassMatrixFromMatrix(o),C=du(I);c.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,b,r.b6.disabled,E,r.b5.backCCW,C,g.id,p.vertexBuffer,p.indexBuffer,p.segments,g.paint,c.transform.zoom,void 0,void 0)}function lv(p,o,c){let g=o.updateZoomBasedPaintProperties(),v=function(b,E,I){let C,R,O,F=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&F>0){let z=b.terrain,j=z.findDEMTileFor(I);j&&j.dem?C=r.c7.create(z,I,j):F=0}if(F===0&&(E.terrainElevationMin=0,E.terrainElevationMax=0),F===E.validForExaggeration&&(F===0||C&&C._demTile&&C._demTile.tileID===E.validForDEMTile.id&&C._dem._timestamp===E.validForDEMTile.timestamp))return!1;for(let z in E.instancesPerModel){let j=E.instancesPerModel[z];for(let U=0;U<j.instancedDataArray.length;++U){let G=(C?F*C.getElevationAt(0|j.instancedDataArray.float32[16*U],0|j.instancedDataArray.float32[16*U+1],!0,!0):0)+j.instancesEvaluatedElevation[U];j.instancedDataArray.float32[16*U+6]=G,R=R?Math.min(E.terrainElevationMin,G):G,O=O?Math.max(E.terrainElevationMax,G):G}}return E.terrainElevationMin=R||0,E.terrainElevationMax=O||0,E.validForExaggeration=F,E.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,o,c);(g||v)&&(o.uploaded=!1,o.upload(p.context))}let Ci={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new r.c3([0,0,0],[r.J,r.J,0])};function cv(p,o){let c=1<<p.canonical.z,g=o.getFreeCameraOptions().position,v=o.elevation,b=p.canonical.x/c,E=(p.canonical.x+1)/c,I=p.canonical.y/c,C=(p.canonical.y+1)/c,R=o._centerAltitude;if(v){let j=v.getMinMaxForTile(p);j&&j.max>R&&(R=j.max)}let O=r.c(g.x,b,E)-g.x,F=r.c(g.y,I,C)-g.y,z=r.b(R,o.center.lat)-g.z;return o._zoomFromMercatorZ(Math.sqrt(O*O+F*F+z*z))}function Vl(p,o,c,g,v,b,E){let I=p.context,C=p.renderPass==="shadow",R=p.shadowRenderer,O=C&&R?R.getShadowPassDepthMode():new r.b4(I.gl.LEQUAL,r.b4.ReadWrite,p.depthRangeFor3D),F=p.isTileAffectedByFog(b);if(c.meshes)for(let z of c.meshes){let j=["MODEL_POSITION_ON_GPU"],U=[],G,$,V;g.instancedDataArray.length>20&&j.push("INSTANCED_ARRAYS");let Y=ta(p,o.paint.get("model-cutoff-fade-range"));if(Y.shouldRenderCutoff&&j.push("RENDER_CUTOFF"),C&&R)G=p.getOrCreateProgram("modelDepth",{defines:j}),$=du(E.shadowTileMatrix,E.shadowTileMatrix,Float32Array.from(c.matrix)),V=R.getShadowPassColorMode();else{Ed(j,U,z,p),G=p.getOrCreateProgram("model",{defines:j,overrideFog:F});let re=z.material,W=re.pbrMetallicRoughness,J=o.paint.get("model-opacity"),oe=o.paint.get("model-emissive-strength").constantOr(0);$=Nl(b.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),p,J,W.baseColorFactor,re.emissiveFactor,W.metallicFactor,W.roughnessFactor,re,oe,o,v),R&&(E.shadowUniformsInitialized?G.setShadowUniformValues(I,R.getShadowUniformValues()):(R.setupShadows(b.toUnwrapped(),G,"model-tile",b.overscaledZ),E.shadowUniformsInitialized=!0)),V=Y.shouldRenderCutoff||J<1||re.alphaMode!=="OPAQUE"?r.a.alphaBlended:r.a.unblended}p.uploadCommonUniforms(I,G,b.toUnwrapped(),null,Y);let ne=z.material.doubleSided?r.b5.disabled:r.b5.backCCW;if(g.instancedDataArray.length>20)U.push(g.instancedDataBuffer),G.draw(p,I.gl.TRIANGLES,O,r.b6.disabled,V,ne,$,o.id,z.vertexBuffer,z.indexBuffer,z.segments,o.paint,p.transform.zoom,void 0,U,g.instancedDataArray.length);else{let re=C?"u_instance":"u_normal_matrix";for(let W=0;W<g.instancedDataArray.length;++W)$[re]=new Float32Array(g.instancedDataArray.arrayBuffer,64*W,16),G.draw(p,I.gl.TRIANGLES,O,r.b6.disabled,V,ne,$,o.id,z.vertexBuffer,z.indexBuffer,z.segments,o.paint,p.transform.zoom,void 0,U)}}if(c.children)for(let z of c.children)Vl(p,o,z,g,v,b,E)}let uv=[1,-1,1];function Kp(p,o,c,g){if(!c.modelManager)return!0;let v=c.modelManager;if(!c.shadowRenderer)return!0;let b=c.shadowRenderer,E=o.aabb,I=!0,C=p.maxHeight;if(C===0){let O=0;for(let F in p.instancesPerModel){let z=v.getModel(F,g);z?O=Math.max(O,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):I=!1}C=p.maxScale*O*1.41+p.maxVerticalOffset,I&&(p.maxHeight=C)}E.max[2]=C,E.min[2]+=p.terrainElevationMin,E.max[2]+=p.terrainElevationMax,r.v.transformMat4(E.min,E.min,o.tileMatrix),r.v.transformMat4(E.max,E.max,o.tileMatrix);let R=E.intersects(b.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=R===2),R===0}class Qp{}class Ga{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,c,g){{let F=this._storage.get(c.id);if(F)return F.lastUsedFrameIdx=o,F.buf}let v=g.gl,b=v.getBufferParameter(v.ELEMENT_ARRAY_BUFFER,v.BUFFER_SIZE),E=new ArrayBuffer(b),I=new Int16Array(E);v.getBufferSubData(v.ELEMENT_ARRAY_BUFFER,0,new Int16Array(E));let C=new r.c9;for(let F=0;F<b/2;F+=3){let z=I[F],j=I[F+1],U=I[F+2];C.emplaceBack(z,j),C.emplaceBack(j,U),C.emplaceBack(U,z)}let R=g.bindVertexArrayOES.current,O=new Qp;return O.buf=new r.I(g,C),O.lastUsedFrameIdx=o,this._storage.set(c.id,O),g.bindVertexArrayOES.set(R),O.buf}update(o){for(let[c,g]of this._storage)o-g.lastUsedFrameIdx>30&&(g.buf.destroy(),this._storage.delete(c))}destroy(){for(let[o,c]of this._storage)c.buf.destroy(),this._storage.delete(o)}}class em{registerParameter(o,c,g,v,b){}registerButton(o,c,g){}}let Td={symbol:function(p,o,c,g,v){if(p.renderPass!=="translucent")return;let b=r.b6.disabled,E=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(I,C,R,O,F,z,j){let U=C.transform,G=F==="map",$=z==="map";for(let V of I){let Y=O.getTile(V),ne=Y.getBucket(R);if(!ne||!ne.text||!ne.text.segments.get().length)continue;let re=r.i(ne.textSizeData,U.zoom),W=Ks(V,ne.getProjection(),U),J=U.calculatePixelsToTileUnitsMatrix(Y),oe=Lr(W,Y.tileID.canonical,$,G,U,ne.getProjection(),J),ce=ne.hasIconTextFit()&&ne.hasIconData();if(re){let ae=Math.pow(2,U.zoom-Y.tileID.overscaledZ);md(ne,G,$,j,r.bG,U,oe,V,ae,re,ce)}}}(g,p,c,o,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),v),c.paint.get("icon-opacity").constantOr(1)!==0&&Wt(p,o,c,g,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),c.paint.get("icon-color-saturation"),b,E),c.paint.get("text-opacity").constantOr(1)!==0&&Wt(p,o,c,g,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),c.paint.get("icon-color-saturation"),b,E),o.map.showCollisionBoxes&&(pd(p,o,c,g,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),pd(p,o,c,g,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,o,c,g){if(p.renderPass!=="translucent")return;let v=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),E=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,C=c.paint.get("circle-emissive-strength");if(v.constantOr(1)===0&&(b.constantOr(1)===0||E.constantOr(1)===0))return;let R=p.context,O=R.gl,F=p.transform,z=p.depthModeForSublayer(0,r.b4.ReadOnly),j=r.b6.disabled,U=p.colorModeForDrapableLayerRenderPass(C),G=F.projection.name==="globe",$=[r.E(F.center.lng),r.H(F.center.lat)],V=[];for(let ne=0;ne<g.length;ne++){let re=g[ne],W=o.getTile(re),J=W.getBucket(c);if(!J||J.projection.name!==F.projection.name)continue;let oe=J.programConfigurations.get(c.id),ce=r.bH(c),ae=p.isTileAffectedByFog(re);G&&ce.push("PROJECTION_GLOBE_VIEW");let ue=p.getOrCreateProgram("circle",{config:oe,defines:ce,overrideFog:ae}),De=J.layoutVertexBuffer,ve=J.globeExtVertexBuffer,we=J.indexBuffer,de=F.projection.createInversionMatrix(F,re.canonical),Ie={programConfiguration:oe,program:ue,layoutVertexBuffer:De,globeExtVertexBuffer:ve,indexBuffer:we,uniformValues:r.bI(p,re,W,de,$,c),tile:W};if(I){let be=J.segments.get();for(let Ce of be)V.push({segments:new r.bm([Ce]),sortKey:Ce.sortKey,state:Ie})}else V.push({segments:J.segments,sortKey:0,state:Ie})}I&&V.sort((ne,re)=>ne.sortKey-re.sortKey);let Y={useDepthForOcclusion:F.depthOcclusionForSymbolsAndCircles};for(let ne of V){let{programConfiguration:re,program:W,layoutVertexBuffer:J,globeExtVertexBuffer:oe,indexBuffer:ce,uniformValues:ae,tile:ue}=ne.state,De=ne.segments;p.terrain&&p.terrain.setupElevationDraw(ue,W,Y),p.uploadCommonUniforms(R,W,ue.tileID.toUnwrapped()),W.draw(p,O.TRIANGLES,z,j,U,r.b5.disabled,ae,c.id,J,ce,De,c.paint,F.zoom,re,[oe])}},heatmap:function(p,o,c,g){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){let v=p.context,b=v.gl,E=r.b6.disabled,I=new r.a([b.ONE,b.ONE,b.ONE,b.ONE],r.C.transparent,[!0,!0,!0,!0]);(function(j,U,G,$){let V=j.gl,Y=U.width*$,ne=U.height*$;j.activeTexture.set(V.TEXTURE1),j.viewport.set([0,0,Y,ne]);let re=G.heatmapFbo;if(!re||re&&(re.width!==Y||re.height!==ne)){re&&re.destroy();let W=V.createTexture();V.bindTexture(V.TEXTURE_2D,W),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MIN_FILTER,V.LINEAR),V.texParameteri(V.TEXTURE_2D,V.TEXTURE_MAG_FILTER,V.LINEAR),re=G.heatmapFbo=j.createFramebuffer(Y,ne,!0,null),function(J,oe,ce,ae,ue,De){let ve=J.gl;ve.texImage2D(ve.TEXTURE_2D,0,J.extRenderToTextureHalfFloat?ve.RGBA16F:ve.RGBA,ue,De,0,ve.RGBA,J.extRenderToTextureHalfFloat?ve.HALF_FLOAT:ve.UNSIGNED_BYTE,null),ae.colorAttachment.set(ce)}(j,0,W,re,Y,ne)}else V.bindTexture(V.TEXTURE_2D,re.colorAttachment.get()),j.bindFramebuffer.set(re.framebuffer)})(v,p,c,p.transform.projection.name==="globe"?.5:.25),v.clear({color:r.C.transparent});let C=p.transform,R=C.projection.name==="globe",O=R?["PROJECTION_GLOBE_VIEW"]:[],F=R?r.b5.frontCCW:r.b5.disabled,z=[r.E(C.center.lng),r.H(C.center.lat)];for(let j=0;j<g.length;j++){let U=g[j];if(o.hasRenderableParent(U))continue;let G=o.getTile(U),$=G.getBucket(c);if(!$||$.projection.name!==C.projection.name)continue;let V=p.isTileAffectedByFog(U),Y=$.programConfigurations.get(c.id),ne=p.getOrCreateProgram("heatmap",{config:Y,defines:O,overrideFog:V}),{zoom:re}=p.transform;p.terrain&&p.terrain.setupElevationDraw(G,ne),p.uploadCommonUniforms(v,ne,U.toUnwrapped());let W=C.projection.createInversionMatrix(C,U.canonical);ne.draw(p,b.TRIANGLES,r.b4.disabled,E,I,F,jp(p,U,G,W,z,re,c.paint.get("heatmap-intensity")),c.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,c.paint,p.transform.zoom,Y,R?[$.globeExtVertexBuffer]:null)}v.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){let E=v.context,I=E.gl,C=b.heatmapFbo;if(!C)return;E.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,C.colorAttachment.get()),E.activeTexture.set(I.TEXTURE1);let R=b.colorRampTexture;R||(R=b.colorRampTexture=new r.a9(E,b.colorRamp,I.RGBA)),R.bind(I.LINEAR,I.CLAMP_TO_EDGE),v.getOrCreateProgram("heatmapTexture").draw(v,I.TRIANGLES,r.b4.disabled,r.b6.disabled,v.colorModeForRenderPass(),r.b5.disabled,((O,F,z,j)=>({u_image:0,u_color_ramp:1,u_opacity:F.paint.get("heatmap-opacity")}))(0,b),b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,c))},line:function(p,o,c,g){if(p.renderPass!=="translucent")return;let v=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(v.constantOr(1)===0||b.constantOr(1)===0)return;let E=c.paint.get("line-emissive-strength"),I=p.depthModeForSublayer(0,r.b4.ReadOnly),C=p.colorModeForDrapableLayerRenderPass(E),R=p.terrain&&p.terrain.renderingToTexture?1:r.a4.devicePixelRatio,O=c.paint.get("line-dasharray"),F=O.constantOr(1),z=c.layout.get("line-cap"),j=c.paint.get("line-pattern"),U=j.constantOr(1),G=c.paint.get("line-pattern").constantOr(1),$=c.paint.get("line-opacity").constantOr(1)!==1,V=!G&&$,Y=c.paint.get("line-gradient"),ne=U?"linePattern":"line",re=p.context,W=re.gl,J=r.bJ(c);p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(V=!1);for(let oe of g){let ce=o.getTile(oe);if(U&&!ce.patternsLoaded())continue;let ae=ce.getBucket(c);if(!ae)continue;p.prepareDrawTile();let ue=ae.programConfigurations.get(c.id),De=p.isTileAffectedByFog(oe),ve=p.getOrCreateProgram(ne,{config:ue,defines:J,overrideFog:De}),we=j.constantOr(null);if(we&&ce.imageAtlas){let Re=ce.imageAtlas.patternPositions[we.toString()];Re&&ue.setConstantPatternPositions(Re)}let de=O.constantOr(null),Ie=z.constantOr(null);if(!U&&de&&Ie&&ce.lineAtlas){let Re=ce.lineAtlas.getDash(de,Ie);Re&&ue.setConstantPatternPositions(Re)}let[be,Ce]=c.paint.get("line-trim-offset");(Ie==="round"||Ie==="square")&&be!==Ce&&(be===0&&(be-=1),Ce===1&&(Ce+=1));let Q=p.terrain?oe.projMatrix:null,me=U?r.bK(p,ce,c,Q,R):r.bL(p,ce,c,Q,ae.lineClipsArray.length,R,[be,Ce]);if(Y){let Re=ae.gradients[c.id],ot=Re.texture;if(c.gradientVersion!==Re.version){let et=256;if(c.stepInterpolant){let mt=o.getSource().maxzoom,tt=oe.canonical.z===mt?Math.ceil(1<<p.transform.maxZoom-oe.canonical.z):1;et=r.c(r.bM(ae.maxLineLength/r.J*1024*tt),256,re.maxTextureSize)}Re.gradient=r.bN({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:et,image:Re.gradient||void 0,clips:ae.lineClipsArray}),Re.texture?Re.texture.update(Re.gradient):Re.texture=new r.a9(re,Re.gradient,W.RGBA),Re.version=c.gradientVersion,ot=Re.texture}re.activeTexture.set(W.TEXTURE1),ot.bind(c.stepInterpolant?W.NEAREST:W.LINEAR,W.CLAMP_TO_EDGE)}F&&(re.activeTexture.set(W.TEXTURE0),ce.lineAtlasTexture&&ce.lineAtlasTexture.bind(W.LINEAR,W.REPEAT),ue.updatePaintBuffers()),U&&(re.activeTexture.set(W.TEXTURE0),ce.imageAtlasTexture&&ce.imageAtlasTexture.bind(W.LINEAR,W.CLAMP_TO_EDGE),ue.updatePaintBuffers()),p.uploadCommonUniforms(re,ve,oe.toUnwrapped());let Le=Re=>{ve.draw(p,W.TRIANGLES,I,Re,C,r.b5.disabled,me,c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,c.paint,p.transform.zoom,ue,[ae.layoutVertexBuffer2])};if(V){let Re=p.stencilModeForClipping(oe).ref;Re===0&&p.terrain&&re.clear({stencil:0});let ot={func:W.EQUAL,mask:255};me.u_alpha_discard_threshold=.8,Le(new r.b6(ot,Re,255,W.KEEP,W.KEEP,W.INVERT)),me.u_alpha_discard_threshold=0,Le(new r.b6(ot,Re,255,W.KEEP,W.KEEP,W.KEEP))}else Le(p.stencilModeForClipping(oe))}V&&(p.resetStencilClippingMasks(),p.terrain&&re.clear({stencil:0}))},fill:function(p,o,c,g){let v=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;let E=c.paint.get("fill-emissive-strength"),I=p.colorModeForDrapableLayerRenderPass(E),C=c.paint.get("fill-pattern"),R=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&v.constantOr(r.C.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===R){let O=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.b4.ReadWrite:r.b4.ReadOnly);zl(p,o,c,g,O,I,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){let O=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.b4.ReadOnly);zl(p,o,c,g,O,I,!0)}},"fill-extrusion":function(p,o,c,g){let v=c.paint.get("fill-extrusion-opacity"),b=p.context,E=b.gl,I=p.terrain,C=I&&I.renderingToTexture;if(v===0)return;let R=p.conflationActive&&p.layerUsedInConflation(c,o.getSource());if(R&&function(O,F,z,j){for(let U of j){let G=F.getTile(U).getBucket(z);G&&(G.updateReplacement(U,O.replacementSource),G.uploadCentroid(O.context))}}(p,o,c,g),I||R)for(let O of g){let F=o.getTile(O).getBucket(c);F&&Gp(p.context,o,O,F,c,I,R)}if(p.renderPass==="shadow"&&p.shadowRenderer){let O=p.shadowRenderer;if(I&&v<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof r.am)return;let F=O.getShadowPassDepthMode(),z=O.getShadowPassColorMode();Bl(p,o,c,g,F,r.b6.disabled,z,R)}else if(p.renderPass==="translucent"){let O=!c.paint.get("fill-extrusion-pattern").constantOr(1),F=c.paint.get("fill-extrusion-color").constantOr(r.C.white);if(!C&&F.a!==0){let z=new r.b4(p.context.gl.LEQUAL,r.b4.ReadWrite,p.depthRangeFor3D);v===1&&O?Bl(p,o,c,g,z,r.b6.disabled,r.a.unblended,R):(Bl(p,o,c,g,z,r.b6.disabled,r.a.disabled,R),Bl(p,o,c,g,z,p.stencilModeFor3D(),p.colorModeForRenderPass(),R),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&O&&(!I&&p.transform.projection.name!=="globe"||C)){let z=c.paint.get("fill-extrusion-opacity"),j=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),U=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=c.paint.get("fill-extrusion-flood-light-intensity"),$=c.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),V=j>0&&U>0,Y=G>0,ne=(W,J,oe)=>(1-oe)*W+oe*J,re=W=>{let J=p.depthModeForSublayer(1,r.b4.ReadOnly,E.LEQUAL,!0),oe=c.paint.get(W?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ce=ne(.1,3,oe),ae=p._showOverdrawInspector;if(!ae){let ue=new r.b6({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),De=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);ia(p,o,c,g,J,ue,De,r.b5.disabled,W,"sdf",z,j,U,G,$,ce,R,!1)}{let ue=ae?r.b6.disabled:new r.b6({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),De=ae?p.colorModeForRenderPass():new r.a([E.ONE_MINUS_DST_ALPHA,E.DST_ALPHA,E.ONE,E.ONE],r.C.transparent,[!0,!0,!0,!0]);ia(p,o,c,g,J,ue,De,r.b5.disabled,W,"color",z,j,U,G,$,ce,R,!1)}};if(C){let W=(J,oe,ce)=>{let ae=p.depthModeForSublayer(1,r.b4.ReadOnly,E.LEQUAL,!1),ue=c.paint.get(J?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),De=ne(.1,3,ue);{let ve=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0]);ia(p,o,c,g,ae,r.b6.disabled,ve,r.b5.disabled,J,"clear",z,j,U,G,$,De,R,oe)}{let ve=new r.b6({func:E.ALWAYS,mask:255},255,255,E.KEEP,E.KEEP,E.REPLACE),we=new r.a([E.ONE,E.ONE,E.ONE,E.ONE],r.C.transparent,[!1,!1,!1,!0],E.MIN);ia(p,o,c,g,ae,ve,we,r.b5.disabled,J,"sdf",z,j,U,G,$,De,R,oe)}{let ve=J?E.ZERO:E.ONE_MINUS_DST_ALPHA,we=new r.b6({func:E.EQUAL,mask:255},255,255,E.KEEP,E.DECR,E.DECR),de=new r.a([ve,E.DST_ALPHA,E.ONE_MINUS_DST_ALPHA,E.ZERO],r.C.transparent,[!0,!0,!0,!0]);ia(p,o,c,g,ae,we,de,r.b5.disabled,J,"color",z,j,U,G,$,De,R,oe)}{let ve=new r.a([E.ONE,E.ONE,E.ONE,J?E.ZERO:E.ONE],r.C.transparent,[!1,!1,!1,!0],J?E.FUNC_ADD:E.MAX);ia(p,o,c,g,ae,r.b6.disabled,ve,r.b5.disabled,J,"clear",z,j,U,G,$,De,R,oe,ce)}};if(V||Y){let J;if(p.prepareDrawTile(),I){let oe=I.drapeBufferSize[0],ce=I.drapeBufferSize[1];J=I.framebufferCopyTexture,J&&(!J||J.size[0]===oe&&J.size[1]===ce)||(J&&J.destroy(),J=I.framebufferCopyTexture=new r.a9(b,new r.a5({width:oe,height:ce}),E.RGBA)),J.bind(E.LINEAR,E.CLAMP_TO_EDGE),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,oe,ce,0)}V&&W(!0,!1,J),Y&&W(!1,!0,J)}}else V&&re(!0),Y&&re(!1)}}},hillshade:function(p,o,c,g){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;let v=p.context,b=p.terrain&&p.terrain.renderingToTexture,[E,I]=p.renderPass!=="translucent"||b?[{},g]:p.stencilConfigForOverlap(g);for(let C of I){let R=o.getTile(C);if(R.needsHillshadePrepare&&p.renderPass==="offscreen")Ky(p,R,c);else if(p.renderPass==="translucent"){let O=p.depthModeForSublayer(0,r.b4.ReadOnly),F=c.paint.get("hillshade-emissive-strength"),z=p.colorModeForDrapableLayerRenderPass(F),j=b&&p.terrain?p.terrain.stencilModeForRTTOverlap(C):E[C.overscaledZ];Jy(p,C,R,c,O,j,z)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,o,c,g,v,b){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;let E=p.context,I=E.gl,C=o.getSource(),R=function(oe,ce,ae){let ue=oe.paint.get("raster-color"),De=[],ve=oe.paint.get("raster-resampling"),we=oe.paint.get("raster-color-mix"),de=oe.paint.get("raster-color-range"),Ie=[we[0],we[1],we[2],0],be=we[3],Ce=ve==="nearest"?ae.NEAREST:ae.LINEAR;if(ue&&De.push("RASTER_COLOR"),ue){ce.activeTexture.set(ae.TEXTURE2);let Q=oe.colorRampTexture;Q||(Q=oe.colorRampTexture=new r.a9(ce,oe.colorRamp,ae.RGBA)),Q.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}return{mix:Ie,range:de,offset:be,defines:De,resampling:Ce}}(c,E,I),O=R.defines,F=p.transform.projection.name==="globe",z=!1;if(C instanceof r.aK&&!g.length){if(!F)return;if(C.onNorthPole)z=!0,O.push("GLOBE_POLES");else{if(!C.onSouthPole)return;z=!0,O.push("GLOBE_POLES")}}let j=c.paint.get("raster-emissive-strength"),U=p.colorModeForDrapableLayerRenderPass(j),G=p.terrain&&p.terrain.renderingToTexture,$=C instanceof r.aK&&c.paint.get("raster-elevation")!==0,V=!p.options.moving,Y=c.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(z){let oe=o.getSource();if(!(oe instanceof r.aK))return;let ce=oe.texture;if(!ce)return;let ae=p.globeSharedBuffers;if(!ae)return;let ue=new r.b4(I.LEQUAL,r.b4.ReadWrite,p.depthRangeFor3D),De=Float32Array.from(p.transform.expandedFarZProjMatrix),ve=r.bj(0,0,p.transform),we=Float32Array.from(r.bh(r.bi(new r.t(0,0,0)))),de={opacity:1,mix:0};p.terrain&&p.terrain.prepareDrawTile(),E.activeTexture.set(I.TEXTURE0),ce.bind(Y,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),ce.bind(Y,I.CLAMP_TO_EDGE),ce.useMipmap&&E.extTextureFilterAnisotropic&&p.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);let[Ie,be,Ce,Q]=ae.getPoleBuffers(0,!0),me;oe.onNorthPole?(me=Ie,p.renderDefaultNorthPole=!1):(ve=r.m.scale(r.m.create(),ve,[1,-1,1]),me=be,p.renderDefaultSouthPole=!1);let Le=((ot,et,mt,tt,xt,bt,ht,dt,nn,Lt,Rn,xn)=>Vp(ot,et,mt,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,tt,xt,[0,0],ht,2,nn,Lt,Rn,1,0,xn))(De,we,ve,de,c,0,c.paint.get("raster-elevation"),0,R.mix,R.offset,R.range,j),Re=p.getOrCreateProgram("raster",{defines:R.defines});return p.uploadCommonUniforms(E,Re,null),void Re.draw(p,I.TRIANGLES,ue,r.b6.disabled,U,r.b5.disabled,Le,c.id,me,Ce,Q)}if(!g.length)return;let[ne,re]=C instanceof r.aK||G?[{},g]:p.stencilConfigForOverlap(g),W=re[re.length-1].overscaledZ,J=$&&F;J&&R.defines.push("PROJECTION_GLOBE_VIEW"),$&&R.defines.push("RENDER_CUTOFF");for(let oe of re){let ce=oe.toUnwrapped(),ae=o.getTile(oe);if(G&&(!ae||!ae.hasData())||!ae.texture)continue;let ue,De;G?(ue=r.b4.disabled,De=oe.projMatrix):$?(ue=new r.b4(I.LEQUAL,r.b4.ReadWrite,p.depthRangeFor3D),De=F?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(ce,V)):(ue=p.depthModeForSublayer(oe.overscaledZ-W,c.paint.get("raster-opacity")===1?r.b4.ReadWrite:r.b4.ReadOnly,I.LESS),De=p.transform.calculateProjMatrix(ce,V));let ve=p.terrain&&G?p.terrain.stencilModeForRTTOverlap(oe):ne[oe.overscaledZ],we=b?0:c.paint.get("raster-fade-duration");ae.registerFadeDuration(we);let de=o.findLoadedParent(oe,0),Ie=iu(ae,de,o,p.transform,we),be,Ce;p.terrain&&p.terrain.prepareDrawTile(),E.activeTexture.set(I.TEXTURE0),ae.texture&&ae.texture.bind(Y,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),de?(de.texture&&de.texture.bind(Y,I.CLAMP_TO_EDGE),be=Math.pow(2,de.tileID.overscaledZ-ae.tileID.overscaledZ),Ce=[ae.tileID.canonical.x*be%1,ae.tileID.canonical.y*be%1]):ae.texture&&ae.texture.bind(Y,I.CLAMP_TO_EDGE),ae.texture&&ae.texture.useMipmap&&E.extTextureFilterAnisotropic&&p.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);let Q=p.transform,me,Le=$?sv(Q):[0,0,0,0],Re,ot,et,mt,tt;J&&C instanceof r.aK&&C.coordinates.length>3?(Re=Float32Array.from(r.bh(r.bi(new r.t(0,0,0)))),ot=Float32Array.from(Q.globeMatrix),et=Float32Array.from(r.bc(Q)),mt=[r.E(Q.center.lng),r.H(Q.center.lat)],me=C.elevatedGlobePerspectiveTransform,tt=C.elevatedGlobeGridMatrix||new Float32Array(9)):(me=C instanceof r.aK?C.perspectiveTransform:[0,0],Re=new Float32Array(16),ot=new Float32Array(9),et=new Float32Array(16),mt=[0,0],tt=new Float32Array(9));let xt=Vp(De,Re,ot,et,tt,Ce||[0,0],r.ao(p.transform.zoom),mt,Le,be||1,Ie,c,me,$?c.paint.get("raster-elevation"):0,2,R.mix,R.offset,R.range,1,0,j),bt=p.isTileAffectedByFog(oe),ht=p.getOrCreateProgram("raster",{defines:R.defines,overrideFog:bt});if(p.uploadCommonUniforms(E,ht,ce),C instanceof r.aK){let dt=C.elevatedGlobeVertexBuffer,nn=C.elevatedGlobeIndexBuffer;if(G||!F)C.boundsBuffer&&C.boundsSegments&&ht.draw(p,I.TRIANGLES,ue,r.b6.disabled,U,r.b5.disabled,xt,c.id,C.boundsBuffer,p.quadTriangleIndexBuffer,C.boundsSegments);else if(dt&&nn){let Lt=Q.zoom<=r.Z?C.elevatedGlobeSegments:C.getSegmentsForLongitude(Q.center.lng);Lt&&(ht.draw(p,I.TRIANGLES,ue,r.b6.disabled,U,r.b5.backCW,xt,c.id,dt,nn,Lt),ht.draw(p,I.TRIANGLES,ue,r.b6.disabled,U,r.b5.frontCW,xt,c.id,dt,nn,Lt))}}else{let{tileBoundsBuffer:dt,tileBoundsIndexBuffer:nn,tileBoundsSegments:Lt}=p.getTileBoundsBuffers(ae);ht.draw(p,I.TRIANGLES,ue,ve,U,r.b5.disabled,xt,c.id,dt,nn,Lt)}}p.resetStencilClippingMasks()},background:function(p,o,c,g){let v=c.paint.get("background-color"),b=c.paint.get("background-opacity"),E=c.paint.get("background-emissive-strength");if(b===0)return;let I=p.context,C=I.gl,R=p.transform,O=R.tileSize,F=c.paint.get("background-pattern");if(p.isPatternMissing(F,c.scope))return;let z=!F&&v.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==z)return;let j=r.b6.disabled,U=p.depthModeForSublayer(0,z==="opaque"?r.b4.ReadWrite:r.b4.ReadOnly),G=p.colorModeForDrapableLayerRenderPass(E),$=F?"backgroundPattern":"background",V,Y=g;Y||(V=p.getBackgroundTiles(),Y=Object.values(V).map(ne=>ne.tileID)),F&&(I.activeTexture.set(C.TEXTURE0),p.imageManager.bind(p.context,c.scope));for(let ne of Y){let re=p.isTileAffectedByFog(ne),W=p.getOrCreateProgram($,{overrideFog:re}),J=ne.toUnwrapped(),oe=g?ne.projMatrix:p.transform.calculateProjMatrix(J);p.prepareDrawTile();let ce=o?o.getTile(ne):V?V[ne.key]:new r.bt(ne,O,R.zoom,p),ae=F?ja(oe,E,b,p,F,c.scope,{tileID:ne,tileSize:O}):fd(oe,E,b,v);p.uploadCommonUniforms(I,W,J);let{tileBoundsBuffer:ue,tileBoundsIndexBuffer:De,tileBoundsSegments:ve}=p.getTileBoundsBuffers(ce);W.draw(p,C.TRIANGLES,U,j,G,r.b5.disabled,ae,c.id,ue,De,ve)}},sky:function(p,o,c){let g=p._atmosphere?r.ao(p.transform.zoom):1,v=c.paint.get("sky-opacity")*g;if(v===0)return;let b=p.context,E=c.paint.get("sky-type"),I=new r.b4(b.gl.LEQUAL,r.b4.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;E==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(R,O,F,z){let j=R.context,U=j.gl,G=O.skyboxFbo;if(!G){G=O.skyboxFbo=j.createFramebuffer(32,32,!0,null),O.skyboxGeometry=new Ki(j),O.skyboxTexture=j.gl.createTexture(),U.bindTexture(U.TEXTURE_CUBE_MAP,O.skyboxTexture),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MIN_FILTER,U.LINEAR),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_MAG_FILTER,U.LINEAR);for(let ne=0;ne<6;++ne)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+ne,0,U.RGBA,32,32,0,U.RGBA,U.UNSIGNED_BYTE,null)}j.bindFramebuffer.set(G.framebuffer),j.viewport.set([0,0,32,32]);let $=O.getCenter(R,!0),V=R.getOrCreateProgram("skyboxCapture"),Y=new Float64Array(16);r.m.identity(Y),r.m.rotateY(Y,Y,.5*-Math.PI),fs(R,O,V,Y,$,0),r.m.identity(Y),r.m.rotateY(Y,Y,.5*Math.PI),fs(R,O,V,Y,$,1),r.m.identity(Y),r.m.rotateX(Y,Y,.5*-Math.PI),fs(R,O,V,Y,$,2),r.m.identity(Y),r.m.rotateX(Y,Y,.5*Math.PI),fs(R,O,V,Y,$,3),r.m.identity(Y),fs(R,O,V,Y,$,4),r.m.identity(Y),r.m.rotateY(Y,Y,Math.PI),fs(R,O,V,Y,$,5),j.viewport.set([0,0,R.width,R.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(R,O,F,z,j){let U=R.context,G=U.gl,$=R.transform,V=R.getOrCreateProgram("skybox");U.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_CUBE_MAP,O.skyboxTexture);let Y=((ne,re,W,J,oe)=>({u_matrix:ne,u_sun_direction:re,u_cubemap:0,u_opacity:J,u_temporal_offset:oe}))($.skyboxMatrix,O.getCenter(R,!1),0,z,j);R.uploadCommonUniforms(U,V),V.draw(R,G.TRIANGLES,F,r.b6.disabled,R.colorModeForRenderPass(),r.b5.backCW,Y,"skybox",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(p,c,I,v,C):E==="gradient"&&p.renderPass==="sky"&&function(R,O,F,z,j){let U=R.context,G=U.gl,$=R.transform,V=R.getOrCreateProgram("skyboxGradient");O.skyboxGeometry||(O.skyboxGeometry=new Ki(U)),U.activeTexture.set(G.TEXTURE0);let Y=O.colorRampTexture;Y||(Y=O.colorRampTexture=new r.a9(U,O.colorRamp,G.RGBA)),Y.bind(G.LINEAR,G.CLAMP_TO_EDGE);let ne=((re,W,J,oe,ce)=>({u_matrix:re,u_color_ramp:0,u_center_direction:W,u_radius:r.d(J),u_opacity:oe,u_temporal_offset:ce}))($.skyboxMatrix,O.getCenter(R,!1),O.paint.get("sky-gradient-radius"),z,j);R.uploadCommonUniforms(U,V),V.draw(R,G.TRIANGLES,F,r.b6.disabled,R.colorModeForRenderPass(),r.b5.backCW,ne,"skyboxGradient",O.skyboxGeometry.vertexBuffer,O.skyboxGeometry.indexBuffer,O.skyboxGeometry.segment)}(p,c,I,v,C)},debug:function(p,o,c,g,v){for(let b=0;b<c.length;b++)if(v){let C=new r.C(g.r*.8,g.g*.8,g.b*.8,1);oa(p,o,c[b],g,-1,-1),oa(p,o,c[b],g,-1,1),oa(p,o,c[b],g,1,1),oa(p,o,c[b],g,1,-1),oa(p,o,c[b],C,0,0)}else oa(p,o,c[b],g,0,0)},custom:function(p,o,c,g){let v=p.context,b=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isLayerDraped(o)){if(p.renderPass==="offscreen"){let E=b.prerender;if(E){if(p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){let I=p.transform.pointMerc;E.call(b,v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.ao(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else E.call(b,v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){let I=b.renderToTile;if(I){let C=g[0].canonical,R=new r.M(C.x+g[0].wrap*(1<<C.z),C.y,C.z);v.setDepthMode(r.b4.disabled),v.setStencilMode(r.b6.disabled),v.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),I.call(b,v.gl,R),v.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),v.setColorMode(p.colorModeForRenderPass()),v.setStencilMode(r.b6.disabled);let E=b.renderingMode==="3d"?new r.b4(p.context.gl.LEQUAL,r.b4.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.b4.ReadOnly);if(v.setDepthMode(E),p.transform.projection.name==="globe"){let I=p.transform.pointMerc;b.render(v.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.ao(p.transform.zoom),[I.x,I.y],p.transform.pixelsPerMeterRatio)}else b.render(v.gl,p.transform.customLayerMatrix());v.setDirty(),p.setBaseState(),v.bindFramebuffer.set(null)}}else r.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,o,c,g){if(p.renderPass==="opaque")return;let v=c.paint.get("model-opacity");if(v===0)return;let b=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!b||p.terrain&&v<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof r.am))return;let E=p.shadowRenderer,I=c.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,I||(E.enabled=!1));let C=()=>{E&&(E.useNormalOffset=!0,I||(E.enabled=!0))},R=o.getSource();if(p.renderPass==="light-beam"&&R.type!=="batched-model")return;if(R.type==="vector"||R.type==="geojson")return function(V,Y,ne,re){let W=V.transform;if(W.projection.name!=="mercator")return void r.X(`Drawing 3D models for ${W.projection.name} projection is not yet implemented`);let J=W.getFreeCameraOptions().position;if(!V.modelManager)return;let oe=V.modelManager,ce=V.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let ae=ne._unevaluatedLayout._values["model-id"],ue=It({},ne.layout.get("model-id").parameters);for(let De of re){let ve=Y.getTile(De).getBucket(ne);if(!ve||ve.projection.name!==W.projection.name)continue;let we=cv(De,W);ue.zoom=we;let de=ae.possiblyEvaluate(ue);if(lv(V,ve,De),Ci.shadowUniformsInitialized=!1,Ci.useSingleShadowCascade=!!ce&&ce.getMaxCascadeForTile(De.toUnwrapped())===0,V.renderPass==="shadow"&&ce){if(V.currentShadowCascade===1&&ve.isInsideFirstShadowMapFrustum)continue;let Ce=W.calculatePosMatrix(De.toUnwrapped(),W.worldSize);if(Ci.tileMatrix.set(Ce),Ci.shadowTileMatrix=Float32Array.from(ce.calculateShadowPassMatrixFromMatrix(Ce)),Ci.aabb.min.fill(0),Ci.aabb.max[0]=Ci.aabb.max[1]=r.J,Ci.aabb.max[2]=0,Kp(ve,Ci,V,ne.scope))continue}let Ie=1<<De.canonical.z,be=[((J.x-De.wrap)*Ie-De.canonical.x)*r.J,(J.y*Ie-De.canonical.y)*r.J,J.z*Ie*r.J];for(let Ce in ve.instancesPerModel){let Q=ve.instancesPerModel[Ce];Q.features.length>0&&(Ce=de.evaluate(Q.features[0].feature,{}));let me=oe.getModel(Ce,ne.scope);if(me&&me.uploaded)for(let Le of me.nodes)Vl(V,ne,Le,Q,be,De,Ci)}}}(p,o,c,g),void C();if(!R.loaded())return;if(R.type==="batched-model")return function(V,Y,ne,re){let W=V.context,J=V.transform,oe=V.style.fog,ce=V.shadowRenderer;if(J.projection.name!=="mercator")return void r.X(`Drawing 3D landmark models for ${J.projection.name} projection is not yet implemented`);let ae=V.transform.getFreeCameraOptions().position,ue=r.v.scale([],[ae.x,ae.y,ae.z],V.transform.worldSize);r.v.negate(ue,ue);let De=r.m.identity([]),ve=r.c4(J.center.lat,J.zoom),we=r.m.fromScaling([],[1,1,1/ve]);r.m.translate(De,De,ue);let de=ne.paint.get("model-opacity"),Ie=new r.b4(W.gl.LEQUAL,r.b4.ReadWrite,V.depthRangeFor3D),be=new r.b4(W.gl.LEQUAL,r.b4.ReadOnly,V.depthRangeFor3D),Ce=function(Q,me){for(let Le of re){let Re=Y.getTile(Le).getBucket(ne);if(!Re||!Re.uploaded)continue;let ot=!1;ce&&(ot=ce.getMaxCascadeForTile(Le.toUnwrapped())===0);let et=J.calculatePosMatrix(Le.toUnwrapped(),J.worldSize),mt=Re.modelTraits;for(let tt of Re.getNodesInfo()){if(tt.hiddenByReplacement||!tt.node.meshes)continue;let xt=tt.node,bt=V.renderPass==="light-beam",ht=[...et],dt=tt.evaluatedScale,nn=0;V.terrain&&xt.elevation&&(nn=xt.elevation*V.terrain.exaggeration()),r.m.translate(ht,ht,[(xt.anchor?xt.anchor[0]:0)*(dt[0]-1),(xt.anchor?xt.anchor[1]:0)*(dt[1]-1),nn]),dt!==r.c6&&r.m.scale(ht,ht,dt),r.m.multiply(ht,ht,xt.matrix);let Lt=r.m.multiply([],we,ht);r.m.multiply(Lt,De,Lt);let Rn=r.m.invert([],Lt);r.m.transpose(Rn,Rn),r.m.scale(Rn,Rn,uv);let xn=r.m.multiply([],J.expandedFarZProjMatrix,ht),Qr=mt&r.c8.HasMapboxMeshFeatures,Ri=Qr?0:tt.evaluatedRMEA[0][2];for(let mn=0;mn<xt.meshes.length;++mn){let an=xt.meshes[mn],cn=mn===xt.lightMeshIndex;if(cn){if(!bt&&!V.terrain&&V.shadowRenderer){V.currentLayer<V.firstLightBeamLayer&&(V.firstLightBeamLayer=V.currentLayer);continue}}else if(bt)continue;let Un={defines:[]},Dr=[];Ed(Un.defines,Dr,an,V),Qr||Un.defines.push("DIFFUSE_SHADED"),ot&&Un.defines.push("SHADOWS_SINGLE_CASCADE");let kn=V.renderPass==="shadow";if(kn){jl(an,ht,V,ne);continue}let Vr=null;if(oe){let eo=_u(ht,V.transform);if(Vr=new Float32Array(eo),J.projection.name!=="globe"){let En=an.aabb.min,to=an.aabb.max,[go,No]=oe.getOpacityForBounds(eo,En[0],En[1],to[0],to[1]);Un.overrideFog=go>=ui||No>=ui}}let ei=V.getOrCreateProgram("model",Un);!kn&&ce&&(ce.useNormalOffset=!!an.normalBuffer,ce.setupShadowsFromMatrix(ht,ei,ce.useNormalOffset)),V.uploadCommonUniforms(W,ei,Le.toUnwrapped(),Vr);let Ur=an.material,Pi=Ur.pbrMetallicRoughness;Pi.metallicFactor=.9,Pi.roughnessFactor=.5;let Fo=Nl(new Float32Array(xn),new Float32Array(Lt),new Float32Array(Rn),V,de,Pi.baseColorFactor,Ur.emissiveFactor,Pi.metallicFactor,Pi.roughnessFactor,Ur,Ri,ne);ei.draw(V,W.gl.TRIANGLES,me&&!cn?Ie:be,r.b6.disabled,Q?cn||de<1||tt.hasTranslucentParts?r.a.alphaBlended:r.a.unblended:r.a.disabled,r.b5.backCCW,Fo,ne.id,an.vertexBuffer,an.indexBuffer,an.segments,ne.paint,V.transform.zoom,void 0,Dr)}}}};(function(Q,me,Le,Re){let ot=Q.terrain?Q.terrain.exaggeration():0,et=Q.transform.zoom;for(let mt of Re){let tt=me.getTile(mt).getBucket(Le);tt&&(Q.conflationActive&&tt.updateReplacement(mt,Q.replacementSource),tt.evaluateScale(Q,Le),Q.terrain&&ot>0&&tt.elevationUpdate(Q.terrain,ot,mt,Le.source),tt.needsReEvaluation(Q,et,Le)&&tt.evaluate(Le))}})(V,Y,ne,re),de===1?Ce(!0,!0):(Ce(!1,!0),Ce(!0,!1))}(p,o,c,g),void C();let O=R.getModels(),F=[],z=p.transform.getFreeCameraOptions().position,j=r.v.scale([],[z.x,z.y,z.z],p.transform.worldSize);r.v.negate(j,j);let U=[],G=[],$=0;for(let V of O){let Y=c.paint.get("model-rotation").constantOr(null),ne=c.paint.get("model-scale").constantOr(null),re=c.paint.get("model-translation").constantOr(null);V.computeModelMatrix(p,Y,ne,re,!0,!0,!1);let W=r.m.identity([]),J=r.c4(V.position.lat,p.transform.zoom),oe=r.m.fromScaling([],[1,1,1/J]);r.m.translate(W,W,j),F.push({zScaleMatrix:oe,negCameraPosMatrix:W});for(let ce of V.nodes)Jp(p.transform,ce,V.matrix,p.transform.expandedFarZProjMatrix,$,U,G);$++}if(U.sort((V,Y)=>Y.depth-V.depth),p.renderPass!=="shadow"){if(v===1)for(let V of G)sa(V,p,c,F[V.modelIndex],r.b6.disabled,p.colorModeForRenderPass());else{for(let V of G)sa(V,p,c,F[V.modelIndex],r.b6.disabled,r.a.disabled);for(let V of G)sa(V,p,c,F[V.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(let V of U)sa(V,p,c,F[V.modelIndex],r.b6.disabled,p.colorModeForRenderPass());C()}else{for(let V of G)jl(V.mesh,V.nodeModelMatrix,p,c);for(let V of U)jl(V.mesh,V.nodeModelMatrix,p,c);C()}}},tm={modelUpload:function(p,o,c){let g=o.getSource();if(!g.loaded())return;if(g.type==="vector"||g.type==="geojson")return void(p.modelManager&&p.modelManager.upload(p,c));if(g.type==="batched-model")return;let v=g.getModels();for(let b of v)b.upload(p.context)}};class hv{constructor(o,c,g,v){this.context=new pr(o,c),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._debugParams={showTerrainProxyTiles:!1},v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=r.bq.maxUnderzooming+r.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new r.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Dd(this),this._wireframeDebugCache=new Ga,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(o,c){let g=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new ld(this,o));let v=this._terrain;this.transform.elevation=g?v:null,v.update(o,this.transform,c),this.transform.elevation&&!v.enabled&&(this.transform.elevation=null)}_updateFog(o){let c=o.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[g,v]=c.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);let b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,c){if(this.width=o*r.a4.devicePixelRatio,this.height=c*r.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let g of this.style.order)this.style._mergedLayers[g].resize()}setup(){let o=this.context,c=new r.bo;c.emplaceBack(0,0),c.emplaceBack(r.J,0),c.emplaceBack(0,r.J),c.emplaceBack(r.J,r.J),this.tileExtentBuffer=o.createVertexBuffer(c,r.bl.members),this.tileExtentSegments=r.bm.simpleSegment(0,0,4,2);let g=new r.bo;g.emplaceBack(0,0),g.emplaceBack(r.J,0),g.emplaceBack(0,r.J),g.emplaceBack(r.J,r.J),this.debugBuffer=o.createVertexBuffer(g,r.bl.members),this.debugSegments=r.bm.simpleSegment(0,0,4,5);let v=new r.bo;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(v,r.bl.members),this.viewportSegments=r.bm.simpleSegment(0,0,4,2);let b=new r.cb;b.emplaceBack(0,0,0,0),b.emplaceBack(r.J,0,r.J,0),b.emplaceBack(0,r.J,0,r.J),b.emplaceBack(r.J,r.J,r.J,r.J),this.mercatorBoundsBuffer=o.createVertexBuffer(b,r.cc.members),this.mercatorBoundsSegments=r.bm.simpleSegment(0,0,4,2);let E=new r.bp;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(E);let I=new r.cd;for(let R of[0,1,3,2,0])I.emplaceBack(R);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new r.a9(o,new r.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=r.m.create();let C=this.context.gl;this.stencilClearMode=new r.b6({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,r.b4.disabled,this.stencilClearMode,r.a.disabled,r.b5.disabled,ru(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,c,g){if(!c||this.currentStencilSource===c.id||!o.isTileClipped()||!g||g.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(let C of g)if(this._tileClippingMaskIDs[C.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;let v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(r.a.disabled),v.setDepthMode(r.b4.disabled);let E=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let I of g){let C=c.getTile(I),R=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:O,tileBoundsIndexBuffer:F,tileBoundsSegments:z}=this.getTileBoundsBuffers(C);E.draw(this,b.TRIANGLES,r.b4.disabled,new r.b6({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),r.a.disabled,r.b5.disabled,ru(I.projMatrix),"$clipping",O,F,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let o=this.nextStencilID++,c=this.context.gl;return new r.b6({func:c.NOTEQUAL,mask:255},o,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);let c=this.context.gl;return new r.b6({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(o){let c=this.context.gl,g=o.sort((E,I)=>I.overscaledZ-E.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();let E={};for(let I=0;I<b;I++)E[I+v]=new r.b6({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[E,g]}return[{[v]:r.b6.disabled},g]}colorModeForRenderPass(){let o=this.context.gl;return this._showOverdrawInspector?new r.a([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new r.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.a.unblended:r.a.alphaBlended}colorModeForDrapableLayerRenderPass(o){let c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new r.a([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new r.C(0,0,0,o===void 0?0:o),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(o,c,g,v=!1){if(!this.opaquePassEnabledForLayer()&&!v)return r.b4.disabled;let b=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new r.b4(g||this.context.gl.LEQUAL,c,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,c){this._wireframeDebugCache.update(this.frameCounter),this.style=o,this.options=c;let g=this.style._mergedLayers,v=this.style.order,b=v.map(W=>g[W]),E=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.a4.now()),this.imageManager.beginFrame();let I=0,C=!1;for(let W in E){let J=E[W];J.used&&(J.prepare(this.context),J.getSource().usedInConflation&&++I)}let R={},O={},F={},z={},j={};for(let W in E){let J=E[W];R[W]=J.getVisibleCoordinates(),O[W]=R[W].slice().reverse(),F[W]=J.getVisibleCoordinates(!0).reverse(),z[W]=J.getShadowCasterCoordinates(),j[W]=J.sortCoordinatesByDistance(R[W])}let U=W=>{let J=this.style.getLayerSourceCache(W);return J&&J.used?J.getSource():null};if(I){let W=[];for(let J of b)this.layerUsedInConflation(J,U(J))&&W.push(J);if(W&&W.length>1){let J=[];for(let oe of W){let ce=this.style.getLayerSourceCache(oe);ce&&ce.used&&ce.getSource().usedInConflation&&J.push({layer:oe.fqid,cache:ce})}this.replacementSource.setSources(J),C=!0}}C||this.replacementSource.clear(),this.conflationActive=C,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let W of b){let J=W.cutoffRange();if(this.longestCutoffRange=Math.max(J,this.longestCutoffRange),J>0){let oe=U(W);oe&&(this.minCutoffZoom=Math.max(oe.minzoom,this.minCutoffZoom)),W.minzoom&&(this.minCutoffZoom=Math.max(W.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let W=0;W<b.length;W++)if(b[W].is3D()){this.opaquePassCutoff=W;break}let G=this.style&&this.style.fog;G?(this._fogVisible=G.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=G.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(F),this.opaquePassCutoff=0);let $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(let W in E)for(let J of R[W]){let oe={min:0,max:0};this.terrain&&(oe=this.terrain.getMinMaxForTile(J)||oe),$.addShadowReceiver(J.toUnwrapped(),oe.min,oe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.ce(this.context));for(let W of b){if(W.isHidden(this.transform.zoom))continue;let J=o.getLayerSourceCache(W);this.uploadLayer(this,W,J)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new av(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!r.cf(this.context.gl))return;this.renderPass="offscreen";for(let W of b){let J=o.getLayerSourceCache(W);if(!W.hasOffscreenPass()||W.isHidden(this.transform.zoom))continue;let oe=J?O[J.id]:void 0;(W.type==="custom"||W.type==="raster"||W.isSky()||oe&&oe.length)&&this.renderLayer(this,J,W,oe)}this.depthRangeFor3D=[0,1-(b.length+2)*this.numSublayers*this.depthEpsilon];let V=this.terrain;V&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&V.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,z)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let Y=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ne=(()=>{if(c.showOverdrawInspector)return r.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!Y){let W=this.style.fog.properties.get("color").toArray01();return new r.C(...W)}if(this.style.fog&&this.transform.projection.supportsFog&&Y){let W=this.style.fog.properties.get("space-color").toArray01();return new r.C(...W)}return r.C.transparent})();if(this.context.clear({color:ne,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=v.length-1;this.currentLayer>=0;this.currentLayer--){let W=b[this.currentLayer],J=o.getLayerSourceCache(W);if(W.isSky())continue;let oe=J?(W.is3D()?j:O)[J.id]:void 0;this._renderTileClippingMasks(W,J,oe),this.renderLayer(this,J,W,oe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Y&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||r.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<v.length;this.currentLayer++){let W=b[this.currentLayer],J=o.getLayerSourceCache(W);W.isSky()&&this.renderLayer(this,J,W,J?O[J.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let re=0;for($&&(re=$.getShadowCastingLayerCount());this.currentLayer<v.length;){let W=b[this.currentLayer],J=o.getLayerSourceCache(W);if(W.isSky()){++this.currentLayer;continue}if(V&&this.style.isLayerDraped(W)){if(W.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=V.renderBatch(this.currentLayer);continue}let oe;if(J&&(oe=(W.type==="symbol"?F:W.is3D()?j:O)[J.id]),this._renderTileClippingMasks(W,J,J?R[J.id]:void 0),this.renderLayer(this,J,W,oe),!V&&$&&re>0&&W.hasShadowPass()&&--re==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let ce=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ce;this.currentLayer++){let ae=b[this.currentLayer];if(!ae.hasLightBeamPass())continue;let ue=o.getLayerSourceCache(ae);this.renderLayer(this,ue,ae,ue?O[ue.id]:void 0)}this.currentLayer=ce,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let W=null;b.forEach(J=>{let oe=o.getLayerSourceCache(J);oe&&!J.isHidden(this.transform.zoom)&&oe.getVisibleCoordinates().length&&(!W||W.getSource().maxzoom<oe.getSource().maxzoom)&&(W=oe)}),W&&this.options.showTileBoundaries&&Td.debug(this,W,W.getVisibleCoordinates(),r.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Td.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new r.C(1,.8,.1,1),!0),this.options.showPadding&&function(W){let J=W.transform.padding;Wp(W,W.transform.height-(J.top||0),3,_d),Wp(W,J.bottom||0,3,yd),$a(W,J.left||0,3,vd),$a(W,W.transform.width-(J.right||0),3,xd);let oe=W.transform.centerPoint;(function(ce,ae,ue,De){ds(ce,ae-1,ue-10,2,20,De),ds(ce,ae-10,ue-1,20,2,De)})(W,oe.x,W.transform.height-oe.y,qp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),C||(this.conflationActive=!1)}uploadLayer(o,c,g){this.gpuTimingStart(c),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(c.type)||o.terrain&&c.type==="custom")&&tm[`${c.type}Upload`]&&tm[`${c.type}Upload`](o,g,c.scope),this.gpuTimingEnd()}renderLayer(o,c,g,v){g.isHidden(this.transform.zoom)||(g.type==="background"||g.type==="sky"||g.type==="custom"||g.type==="model"||g.type==="raster"||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),(!o.transform.projection.unsupportedLayers||!o.transform.projection.unsupportedLayers.includes(g.type)||o.terrain&&g.type==="custom")&&Td[g.type](o,c,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;let c=this.context.extTimerQuery,g=this.context.gl,v=this.gpuTimers[o.id];v||(v=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:g.createQuery()}),v.calls++,g.beginQuery(c.TIME_ELAPSED_EXT,v.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let o=this.context.extTimerQuery,c=this.context.gl,g=c.createQuery();this.deferredRenderGpuTimeQueries.push(g),c.beginQuery(o.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){let o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){let c={};for(let g in o){let v=o[g],b=this.context.extTimerQuery,E=b.getQueryParameter(v.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(v.query),c[g]=E}return c}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;let c=this.context.extTimerQuery,g=this.context.gl,v=0;for(let b of o)v+=c.getQueryParameter(b,g.QUERY_RESULT)/1e6,c.deleteQueryEXT(b);return v}translatePosMatrix(o,c,g,v,b){if(!g[0]&&!g[1])return o;let E=b?v==="map"?this.transform.angle:0:v==="viewport"?-this.transform.angle:0;if(E){let R=Math.sin(E),O=Math.cos(E);g=[g[0]*O-g[1]*R,g[0]*R+g[1]*O]}let I=[b?g[0]:r.ay(c,g[0],this.transform.zoom),b?g[1]:r.ay(c,g[1],this.transform.zoom),0],C=new Float32Array(16);return r.m.translate(C,o,I),C}saveTileTexture(o){let c=o.size[0],g=this._tileTextures[c];g?g.push(o):this._tileTextures[c]=[o]}getTileTexture(o){let c=this._tileTextures[o];return c&&c.length>0?c.pop():null}isPatternMissing(o,c){return o===null||o!==void 0&&!this.imageManager.getPattern(o.toString(),c)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,c,g){let v=g===void 0?this.terrain&&this.terrain.renderingToTexture:g,b=this.terrain&&this.terrain.exaggeration()===0,E=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(E.push("LIGHTING_3D_MODE"),E.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):v||E.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||E.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?E.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):E.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(E.push("TERRAIN"),this.linearFloatFilteringSupported()&&E.push("TERRAIN_DEM_FLOAT_FORMAT"),b&&E.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&E.push("GLOBE"),!this._fogVisible||v||c!==void 0&&!c||E.push("FOG","FOG_DITHERING"),v&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}getOrCreateProgram(o,c){this.cache=this.cache||{};let g=c&&c.defines||[],v=c&&c.config,b=this.currentGlobalDefines(o,c&&c.overrideFog,c&&c.overrideRtt).concat(g),E=au.cacheKey(td[o],o,b,v);return this.cache[E]||(this.cache[E]=new au(this.context,o,td[o],v,$p[o],b)),this.cache[E]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,c){if(this.style.enable3dLights()){let g=this.style.directionalLight,v=this.style.ambientLight;if(g&&v){let b=((E,I)=>{let C=E.properties.get("direction"),R=E.properties.get("color").toArray01(),O=E.properties.get("intensity"),F=I.properties.get("color").toArray01(),z=I.properties.get("intensity"),j=[C.x,C.y,C.z],U=r.bv(F,z),G=r.bv(R,O);return{u_lighting_ambient_color:U,u_lighting_directional_dir:j,u_lighting_directional_color:G,u_ground_radiance:zp(j,G,U)}})(g,v);c.setLightsUniformValues(o,b)}}}uploadCommonUniforms(o,c,g,v,b){if(this.uploadCommonLightUniforms(o,c),this.terrain&&this.terrain.renderingToTexture)return;let E=this.style.fog;if(E){let I=E.getOpacity(this.transform.pitch),C=((R,O,F,z,j,U,G,$,V,Y,ne,re)=>{let W=R.transform,J=O.properties.get("color").toArray01();J[3]=z;let oe=R.frameCounter/1e3%1,[ce,ae]=O.properties.get("vertical-range");return{u_fog_matrix:F?W.calculateFogTileMatrix(F):re||R.identityMat,u_fog_range:O.getFovAdjustedRange(W._fov),u_fog_color:J,u_fog_horizon_blend:O.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ce,ae),ae],u_fog_temporal_offset:oe,u_frustum_tl:j,u_frustum_tr:U,u_frustum_br:G,u_frustum_bl:$,u_globe_pos:V,u_globe_radius:Y,u_viewport:ne,u_globe_transition:r.ao(W.zoom),u_is_globe:+(W.projection.name==="globe")}})(this,E,g,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.a4.devicePixelRatio,this.transform.height*r.a4.devicePixelRatio],v);c.setFogUniformValues(o,C)}b&&c.setCutoffUniformValues(o,b.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){let o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){let o=this.context.gl,c=o.createTexture();return o.bindTexture(o.TEXTURE_2D,c),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let o=this._backgroundTiles,c=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(let v of g)c[v.key]=o[v.key]||new r.bt(v,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(o,c){return!(!o.is3D()||o.minzoom&&o.minzoom>this.transform.zoom||o.sourceLayer!=="building"&&(!c||c.type!=="batched-model"))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[o.key];return c||(this._cachedTileFogOpacities[o.key]=c=this.style.fog.getOpacityForTile(o)),c[0]>=ui||c[1]>=ui}}let hi={cascadeCount:2,shadowMapResolution:2048};class dv{constructor(o,c){this.aabb=o,this.lastCascade=c}}class Id{add(o,c){let g=this.receivers[o.key];g!==void 0?(g.aabb.min[0]=Math.min(g.aabb.min[0],c.min[0]),g.aabb.min[1]=Math.min(g.aabb.min[1],c.min[1]),g.aabb.min[2]=Math.min(g.aabb.min[2],c.min[2]),g.aabb.max[0]=Math.max(g.aabb.max[0],c.max[0]),g.aabb.max[1]=Math.max(g.aabb.max[1],c.max[1]),g.aabb.max[2]=Math.max(g.aabb.max[2],c.max[2])):this.receivers[o.key]=new dv(c,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,c,g){let v=r.c3.fromPoints(o.points),b=0;for(let E in this.receivers){let I=this.receivers[E];if(!I||!v.intersectsAabb(I.aabb))continue;I.aabb.min=v.closestPoint(I.aabb.min),I.aabb.max=v.closestPoint(I.aabb.max);let C=I.aabb.getCorners();for(let R=0;R<g.length;R++){let O=!0;for(let F of C){let z=[F[0]*c,F[1]*c,F[2]];if(r.v.transformMat4(z,z,g[R].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){O=!1;break}}if(I.lastCascade=R,b=Math.max(b,R),O)break}}return b+1}}class Dd{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Id,this._depthMode=new r.b4(o.context.gl.LEQUAL,r.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,o.tp.registerParameter(hi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),o.tp.registerParameter(hi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(let o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,c){let g=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;let v=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||v<=0||(this._shadowLayerCount=g.style.order.reduce((U,G)=>{let $=g.style._mergedLayers[G];return U+($.hasShadowPass()&&!$.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let b=g.context,E=hi.shadowMapResolution,I=hi.shadowMapResolution;if(this._cascades.length===0||hi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let U=0;U<hi.cascadeCount;++U){let G=g._shadowMapDebug,$=b.gl,V=b.createFramebuffer(E,I,G,"texture"),Y=new r.a9(b,{width:E,height:I,data:null},$.DEPTH_COMPONENT);if(V.depthAttachment.set(Y.texture),G){let ne=new r.a9(b,{width:E,height:I,data:null},$.RGBA);V.colorAttachment.set(ne.texture)}this._cascades.push({framebuffer:V,texture:Y,matrix:[],far:0,boundingSphereRadius:0,frustum:new r.F,scale:0})}}this.shadowDirection=Md(c);let C=0;if(o.elevation){let U=o.elevation,G=[1e4,-1e4];U.visibleDemTiles.filter($=>$.dem).forEach($=>{let V=$.dem.tree;G[0]=Math.min(G[0],V.minimums[0]),G[1]=Math.max(G[1],V.maximums[0])}),G[0]!==1e4&&(C=(G[1]-G[0])*U.exaggeration())}let R=1.5*o.cameraToCenterDistance,O=3*R,F=new Float64Array(16);for(let U=0;U<this._cascades.length;++U){let G=this._cascades[U],$=o.height/50,V=1;hi.cascadeCount===1?V=O:U===0?V=R:($=R,V=O);let[Y,ne]=nm(o,this.shadowDirection,$,V,hi.shadowMapResolution,C);G.scale=o.scale,G.matrix=Y,G.boundingSphereRadius=ne,r.m.invert(F,G.matrix),G.frustum=r.F.fromInvProjectionMatrix(F,1,0,!0),G.far=V}let z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=v,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/hi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=hi.shadowMapResolution,this._uniformValues.u_shadowmap_0=Nr.ShadowMap0,this._uniformValues.u_shadowmap_1=Nr.ShadowMap0+1,this._groundShadowTiles=g.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let j=g.transform.elevation;for(let U of this._groundShadowTiles){let G={min:0,max:0};if(j){let $=j.getMinMaxForTile(U);$&&(G=$)}this.addShadowReceiver(U.toUnwrapped(),G.min,G.max)}}get enabled(){return this._enabled}set enabled(o){this._enabled=o}drawShadowPass(o,c){if(!this._enabled)return;let g=this.painter,v=g.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(g.transform.getFrustum(0),g.transform.worldSize,this._cascades),v.viewport.set([0,0,hi.shadowMapResolution,hi.shadowMapResolution]);for(let b=0;b<this._numCascadesToRender;++b){g.currentShadowCascade=b,v.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),v.clear({color:r.C.white,depth:1});for(let E of o.order){let I=o._mergedLayers[E];if(!I.hasShadowPass()||I.isHidden(g.transform.zoom))continue;let C=o.getLayerSourceCache(I),R=C?c[C.id]:void 0;(I.type==="model"||R&&R.length)&&g.renderLayer(g,C,I,R)}}g.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let o=this.painter,c=o.style,g=o.context,v=c.directionalLight,b=c.ambientLight;if(!v||!b)return;let E=[],I=ta(o,o.longestCutoffRange);I.shouldRenderCutoff&&E.push("RENDER_CUTOFF");let C=yu(v,b),R=new r.b4(g.gl.LEQUAL,r.b4.ReadOnly,o.depthRangeFor3D);for(let O of this._groundShadowTiles){let F=O.toUnwrapped(),z=o.isTileAffectedByFog(O),j=o.getOrCreateProgram("groundShadow",{defines:E,overrideFog:z});this.setupShadows(F,j),o.uploadCommonUniforms(g,j,F,null,I);let U={u_matrix:o.transform.calculateProjMatrix(F),u_ground_shadow_factor:C};j.draw(o,g.gl.TRIANGLES,R,r.b6.disabled,r.a.multiply,r.b5.disabled,U,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,{},o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?r.a.unblended:r.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){let c=this.painter.transform,g=c.calculatePosMatrix(o,c.worldSize);return r.m.multiply(g,this._cascades[this.painter.currentShadowCascade].matrix,g),Float32Array.from(g)}calculateShadowPassMatrixFromMatrix(o){return r.m.multiply(o,this._cascades[this.painter.currentShadowCascade].matrix,o),Float32Array.from(o)}setupShadows(o,c,g,v=0){if(!this._enabled)return;let b=this.painter.transform,E=this.painter.context,I=E.gl,C=this._uniformValues,R=new Float64Array(16),O=b.calculatePosMatrix(o,b.worldSize);for(let F=0;F<this._cascades.length;F++)r.m.multiply(R,this._cascades[F].matrix,O),C[F===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),E.activeTexture.set(I.TEXTURE0+Nr.ShadowMap0+F),this._cascades[F].texture.bind(I.NEAREST,I.CLAMP_TO_EDGE);if(this.useNormalOffset=!!g,this.useNormalOffset){let F=r.cg(o.canonical),z=2/b.tileSize*r.J/hi.shadowMapResolution,j=z*this._cascades[0].boundingSphereRadius,U=z*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(g==="vector-tile"?1:3)/Math.pow(2,v-o.canonical.z-(1-b.zoom+Math.floor(b.zoom)));C.u_shadow_normal_offset=[F,j*G,U*G],C.u_shadow_bias=[6e-5,.0012,.012]}else C.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(E,C)}setupShadowsFromMatrix(o,c,g=!1){if(!this._enabled)return;let v=this.painter.context,b=v.gl,E=this._uniformValues,I=new Float64Array(16);for(let C=0;C<hi.cascadeCount;C++)r.m.multiply(I,this._cascades[C].matrix,o),E[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),v.activeTexture.set(b.TEXTURE0+Nr.ShadowMap0+C),this._cascades[C].texture.bind(b.NEAREST,b.CLAMP_TO_EDGE);this.useNormalOffset=g,g?(E.u_shadow_normal_offset=[1,5,5],E.u_shadow_bias=[6e-5,.0012,.012]):E.u_shadow_bias=[36e-5,.0012,.012],c.setShadowUniformValues(v,E)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,c,g,v){if(v[2]>=0)return{};let b=function(C,R,O){let F=O/(1<<C.canonical.z);return new r.c3([C.canonical.x*F+C.wrap*O,C.canonical.y*F+C.wrap*O,0],[(C.canonical.x+1)*F+C.wrap*O,(C.canonical.y+1)*F+C.wrap*O,R])}(o,c,g).getCorners(),E=c/-v[2];v[0]<0?(r.v.add(b[0],b[0],[v[0]*E,0,0]),r.v.add(b[3],b[3],[v[0]*E,0,0])):v[0]>0&&(r.v.add(b[1],b[1],[v[0]*E,0,0]),r.v.add(b[2],b[2],[v[0]*E,0,0])),v[1]<0?(r.v.add(b[0],b[0],[0,v[1]*E,0]),r.v.add(b[1],b[1],[0,v[1]*E,0])):v[1]>0&&(r.v.add(b[2],b[2],[0,v[1]*E,0]),r.v.add(b[3],b[3],[0,v[1]*E,0]));let I={};return I.vertices=b,I.planes=[Ul(b[1],b[0],b[4]),Ul(b[2],b[1],b[5]),Ul(b[3],b[2],b[6]),Ul(b[0],b[3],b[7])],I}addShadowReceiver(o,c,g){this._receivers.add(o,r.c3.fromTileIdAndHeight(o,c,g))}getMaxCascadeForTile(o){let c=this._receivers.get(o);return c&&c.lastCascade?c.lastCascade:0}}function Ul(p,o,c){let g=r.v.sub([],c,o),v=r.v.sub([],p,o),b=r.v.cross([],g,v),E=r.v.length(b);return E===0?[0,0,1,0]:(r.v.scale(b,b,1/E),[b[0],b[1],b[2],-r.v.dot(b,o)])}function Md(p){let o=p.properties.get("direction"),c=r.b3(o.x,o.y,o.z);c[2]=r.c(c[2],0,75);let g=r.ch([c[0],c[1],c[2]]);return r.v.fromValues(g.x,g.y,g.z)}function yu(p,o){let c=p.properties.get("color"),g=p.properties.get("intensity"),v=p.properties.get("direction"),b=[v.x,v.y,v.z],E=o.properties.get("color"),I=o.properties.get("intensity"),C=Math.max(r.v.dot([0,0,1],b),0),R=[0,0,0];r.v.scale(R,E.toArray01Linear().slice(0,3),I);let O=[0,0,0];return r.v.scale(O,c.toArray01Linear().slice(0,3),C*g),r.bw([R[0]>0?R[0]/(R[0]+O[0]):0,R[1]>0?R[1]/(R[1]+O[1]):0,R[2]>0?R[2]/(R[2]+O[2]):0])}function nm(p,o,c,g,v,b){let E=p.zoom,I=p.scale,C=p.worldSize,R=1/C,O=p.aspect,F=Math.sqrt(1+O*O)*Math.tan(.5*p.fovX),z=F*F,j=g-c,U=g+c,G,$;z>j/U?(G=g,$=g*F):(G=.5*U*(1+z),$=.5*Math.sqrt(j*j+2*(g*g+c*c)*z+U*U*z*z));let V=p.projection.pixelsPerMeter(p.center.lat,C),Y=p._camera.getCameraToWorldMercator(),ne=[0,0,-G*R];r.v.transformMat4(ne,ne,Y);let re=$*R,W=p._edgeInsets;if(!(W.left===0&&W.top===0&&W.right===0&&W.bottom===0||W.left===W.right&&W.top===W.bottom)){let Re=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?V:1),ot=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,g);ot[8]=2*-p.centerOffset.x/p.width,ot[9]=2*p.centerOffset.y/p.height;let et=new Float64Array(16);r.m.mul(et,ot,Re);let mt=new Float64Array(16);r.m.invert(mt,et);let tt=r.F.fromInvProjectionMatrix(mt,C,E,!0);for(let xt of tt.points){let bt=((J=xt)[0]/=I,J[1]/=I,J[2]=r.b(J[2],p._center.lat),J);re=Math.max(re,r.v.len(r.v.subtract([],ne,bt)))}}var J;re*=v/(v-1);let oe=Math.acos(o[2]),ce=Math.atan2(-o[0],-o[1]),ae=new Ii;ae.position=ne,ae.setPitchBearing(oe,ce);let ue=ae.getWorldToCamera(C,V),De=re*C,ve=Math.min(p._mercatorZfromZoom(17)*C*-2,-2*De),we=ae.getCameraToClipOrthographic(-De,De,-De,De,ve,(De+b*V)/o[2]),de=new Float64Array(16);r.m.multiply(de,we,ue);let Ie=r.v.fromValues(Math.floor(1e6*ne[0])/1e6*C,Math.floor(1e6*ne[1])/1e6*C,0),be=.5*v,Ce=[0,0,0];r.v.transformMat4(Ce,Ie,de),r.v.scale(Ce,Ce,be);let Q=[Math.floor(Ce[0]),Math.floor(Ce[1]),Math.floor(Ce[2])],me=[0,0,0];r.v.sub(me,Ce,Q),r.v.scale(me,me,-1/be);let Le=new Float64Array(16);return r.m.identity(Le),r.m.translate(Le,Le,me),r.m.multiply(de,Le,de),[de,De]}class rm extends r.a6{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.numModelsLoading={}}loadModel(o,c){return r.aO(this.requestManager.transformRequest(c,r.a2.Model).url).then(g=>{if(!g)return;let v=r.aP(g),b=new r.aQ(o,void 0,void 0,v);return b.computeBoundsAndApplyParent(),b}).catch(g=>{this.fire(new r.a7(new Error(`Could not load model ${o} from ${c}: ${g.message}`)))})}load(o,c){this.models[c]||(this.models[c]={});let g=Object.keys(o);this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+g.length;let v=[];for(let b of g)v.push(this.loadModel(b,o[b]));Promise.allSettled(v).then(b=>{for(let E=0;E<b.length;E++){let{status:I,value:C}=b[E];I==="fulfilled"&&C&&(this.models[c][g[E]]=C)}this.numModelsLoading[c]-=g.length,this.fire(new r.a8("data",{dataType:"style"}))}).catch(b=>{this.fire(new r.a7(new Error(`Could not load models: ${b.message}`)))})}isLoaded(){for(let o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,c){return!!this.getModel(o,c)}getModel(o,c){return this.models[c]||(this.models[c]={}),this.models[c][o]}addModel(o,c,g){this.models[g]||(this.models[g]={}),this.hasModel(o,g)&&this.removeModel(o,g),this.load({[o]:this.requestManager.normalizeModelURL(c)},g)}addModels(o,c){let g={};for(let v in o)g[v]=this.requestManager.normalizeModelURL(o[v]);this.load(g,c)}removeModel(o,c){this.models[c]||(this.models[c]={});let g=this.models[c][o];delete this.models[c][o],g.destroy()}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,c){this.models[c]||(this.models[c]={});for(let g in this.models[c])this.models[c][g].upload(o.context)}}let aa=(p,o)=>r.ai(p,o&&o.filter(c=>c.identifier!=="source.canvas")),im=r.p(Pe,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),om=r.p(Pe,["setCenter","setZoom","setBearing","setPitch"]),Sd={version:8,layers:[],sources:{}},ps={duration:300,delay:0},$l=new Set(["fill","line","background","hillshade","raster"]);class Ai extends r.a6{constructor(o,c={}){super(),this.map=o,this.scope=c.scope||"",this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=r.ak({},ps),this._buildingIndex=new Hh(this),this.crossTileSymbolIndex=new Zy,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new Ue,this.dispatcher=c.dispatcher?c.dispatcher:new r.br(r.bs(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new nr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new r.cj(o._requestManager,c.localFontFamily?r.ck.all:c.localIdeographFontFamily?r.ck.ideographs:r.ck.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new rm(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this.dispatcher.broadcast("setReferrer",r.cl());let g=this;this._rtlTextPluginCallback=Ai.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,E)=>{if(r.cm(b),E&&E.every(I=>I))for(let I in g._sourceCaches){let C=g._sourceCaches[I],R=C.getSource().type;R!=="vector"&&R!=="geojson"||C.reload()}})}),this.on("data",v=>{if(v.dataType!=="source"||v.sourceDataType!=="metadata")return;let b=this.getOwnSource(v.sourceId);if(b&&b.vectorLayerIds)for(let E in this._layers){let I=this._layers[E];I.source===b.id&&this._validateLayer(I)}})}loadURL(o,c={}){this.fire(new r.a8("dataloading",{dataType:"style"}));let g=typeof c.validate=="boolean"?c.validate:!r.cn(o);o=this.map._requestManager.normalizeStyleURL(o,c.accessToken),this.resolvedImports.add(o);let v=this.importsCache.get(o);if(v)return this._load(v,g);let b=this.map._requestManager.transformRequest(o,r.a2.Style);this._request=r.a1(b,(E,I)=>{if(this._request=null,E)this.fire(new r.a7(E));else if(I)return this.importsCache.set(o,I),this._load(I,g)})}loadJSON(o,c={}){this.fire(new r.a8("dataloading",{dataType:"style"})),this._request=r.a4.frame(()=>{this._request=null,this._load(o,c.validate!==!1)})}loadEmpty(){this.fire(new r.a8("dataloading",{dataType:"style"})),this._load(Sd,!1)}_loadImports(o,c){if(this.importDepth>=4)return r.X("Style doesn't support nesting deeper than 5"),Promise.resolve();let g=[];for(let v of o){let b=this._createFragmentStyle(v),E=new Promise(C=>{b.once("style.import.load",C),b.once("error",C)}).then(()=>this.mergeAll());if(g.push(E),this.resolvedImports.has(v.url)){b.loadEmpty();continue}let I=v.data||this.importsCache.get(v.url);I?b.loadJSON(I,{validate:c}):v.url?b.loadURL(v.url,{validate:c}):b.loadEmpty(),this.fragments.push({style:b,id:v.id,config:v.config})}return Promise.allSettled(g)}_createFragmentStyle(o){let c=this.scope?r.aE(o.id,this.scope):o.id,g=new Ai(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:o.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return g.setEventedParent(this.map,{style:g}),g}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let o=this.isRootStyle();this._shouldPrecompile=o,this.fire(new r.a8(o?"style.load":"style.import.load"))}_load(o,c){let g=o.schema;if(this.isRootStyle()&&(o.fragment||g&&o.fragment!==!1)){let E=r.ak({},Sd,{imports:[{id:"basemap",data:o,url:""}]});return void this._load(E,c)}if(this.setConfig(this._config,g),c&&aa(this,r.aj(o)))return;this._loaded=!0,this.stylesheet=r.co(o);for(let E in o.sources)this.addSource(E,o.sources[E],{validate:!1,isInitialLoad:!0});o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(o.glyphs,this.scope);let v=Xs(this.stylesheet.layers);if(this._order=v.map(E=>E.id),this.stylesheet.light&&r.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let E=this.stylesheet.lights[0];this.light=new Br(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Br(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let E of v){let I=r.cp(E,this.scope,this.options);I.isConfigDependent&&this._configDependentLayers.add(I.fqid),I.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=I,this._serializedLayers[I.id]=I.serialize();let C=this.getOwnLayerSourceCache(I),R=!!this.directionalLight&&this.directionalLight.shadowsEnabled();C&&I.canCastShadows()&&R&&(C.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let b=this.stylesheet.terrain;b&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=r.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?r.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(b,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new r.a8("data",{dataType:"style"})),o.imports?this._loadImports(o.imports,c).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let o,c,g,v,b,E,I,C;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(R=>{if(R.stylesheet){if(R.light!=null&&(o=R.light),R.stylesheet.lights)for(let O of R.stylesheet.lights)O.type==="ambient"&&R.ambientLight!=null&&(c=R.ambientLight),O.type==="directional"&&R.directionalLight!=null&&(g=R.directionalLight);v=this._prioritizeTerrain(v,R.terrain,R.stylesheet.terrain),R.stylesheet.fog&&R.fog!=null&&(b=R.fog),R.stylesheet.camera!=null&&(C=R.stylesheet.camera),R.stylesheet.projection!=null&&(E=R.stylesheet.projection),R.stylesheet.transition!=null&&(I=R.stylesheet.transition)}}),this.light=o,this.ambientLight=c,this.directionalLight=g,this.fog=b,v===null?delete this.terrain:this.terrain=v,this.camera=C||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=r.ak({},ps,I),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(o){let c=g=>{for(let v of g.fragments)c(v.style);o(g)};c(this)}_prioritizeTerrain(o,c,g){let v=o&&o.drapeRenderMode===0;return g===null?c&&c.drapeRenderMode===0?c:v?o:null:c!=null&&(!o||v||c&&c.drapeRenderMode===1)?c:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{o=this._prioritizeTerrain(o,c.terrain,c.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(o=c.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){let o={},c={},g={};this.forEachFragmentStyle(v=>{for(let b in v._sourceCaches){let E=r.aE(b,v.scope);o[E]=v._sourceCaches[b]}for(let b in v._otherSourceCaches){let E=r.aE(b,v.scope);c[E]=v._otherSourceCaches[b]}for(let b in v._symbolSourceCaches){let E=r.aE(b,v.scope);g[E]=v._symbolSourceCaches[b]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=g}mergeLayers(){let o={},c=[],g={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(b=>{for(let E of b._order){let I=b._layers[E];if(I.type==="slot"){let C=r.cq(E);if(o[C])continue;o[C]=[]}I.slot&&o[I.slot]?o[I.slot].push(I):c.push(I)}}),this._mergedOrder=[];let v=(b=[])=>{for(let E of b)if(E.type==="slot"){let I=r.cq(E.id);o[I]&&v(o[I])}else{let I=r.aE(E.id,E.scope);this._mergedOrder.push(I),g[I]=E,E.is3D()&&(this._has3DLayers=!0),E.type==="circle"&&(this._hasCircleLayers=!0),E.type==="symbol"&&(this._hasSymbolLayers=!0)}};v(c),this._mergedLayers=g,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=r.ak({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(c,g,v){let b,E,I,C=r.a4.devicePixelRatio>1?"@2x":"",R=r.a1(g.transformRequest(g.normalizeSpriteURL(c,C,".json"),r.a2.SpriteJSON),(z,j)=>{R=null,I||(I=z,b=j,F())}),O=r.a3(g.transformRequest(g.normalizeSpriteURL(c,C,".png"),r.a2.SpriteImage),(z,j)=>{O=null,I||(I=z,E=j,F())});function F(){if(I)v(I);else if(b&&E){let z=r.a4.getImageData(E),j={};for(let U in b){let{width:G,height:$,x:V,y:Y,sdf:ne,pixelRatio:re,stretchX:W,stretchY:J,content:oe}=b[U],ce=new r.a5({width:G,height:$});r.a5.copy(z,ce,{x:V,y:Y},{x:0,y:0},{width:G,height:$}),j[U]={data:ce,pixelRatio:re,sdf:ne,stretchX:W,stretchY:J,content:oe}}v(null,j)}}return{cancel(){R&&(R.cancel(),R=null),O&&(O.cancel(),O=null)}}}(o,this.map._requestManager,(c,g)=>{if(this._spriteRequest=null,c)this.fire(new r.a7(c));else if(g)for(let v in g)this.imageManager.addImage(v,this.scope,g[v]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new r.a8("data",{dataType:"style"}))})}_validateLayer(o){let c=this.getOwnSource(o.source);if(!c)return;let g=o.sourceLayer;g&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(g)===-1)&&this.fire(new r.a7(new Error(`Source layer "${g}" does not exist on source "${c.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,c)=>{let g=this.fragments[c];return g&&g.style&&(o.data=g.style.serialize()),o})}_serializeSources(){let o={};for(let c in this._sourceCaches){let g=this._sourceCaches[c].getSource();o[g.id]||(o[g.id]=g.serialize())}return o}_serializeLayers(o){let c=[];for(let g of o){let v=this._layers[g];v&&v.type!=="custom"&&c.push(v.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(let o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&(typeof o.isLayerDraped=="function"?o.isLayerDraped(this.getLayerSourceCache(o)):$l.has(o.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){let c=this.getOwnLayer(o);if(c)return c;this.fire(new r.a7(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){let c=this.getOwnSource(o);if(c)return c;this.fire(new r.a7(new Error(`The source '${o}' does not exist in the map's style.`)))}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);let c=this.calculateLightsBrightness();o.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c));let g=this._changes.isDirty();if(this._changes.isDirty()){let b=this._changes.getLayerUpdatesByScope();for(let E in b){let{updatedIds:I,removedIds:C}=b[E];(I||C)&&this._updateWorkerLayers(E,I,C)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._changes.reset()}let v={};for(let b in this._mergedSourceCaches){let E=this._mergedSourceCaches[b];v[b]=E.used,E.used=!1}for(let b of this._mergedOrder){let E=this._mergedLayers[b];if(E.recalculate(o,this._availableImages),!E.isHidden(o.zoom)){let I=this.getLayerSourceCache(E);I&&(I.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let I=E.minzoom||0;I<(E.maxzoom||25.5);I++){let C=this.map.painter;if(C){let R=E.getProgramIds();if(!R)continue;for(let O of R){let F=E.getDefaultProgramParams(O,o.zoom);F&&(C.style=this,this.fog&&(C._fogVisible=!0,F.overrideFog=!0,C.getOrCreateProgram(O,F)),C._fogVisible=!1,F.overrideFog=!1,C.getOrCreateProgram(O,F),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(F.overrideRtt=!0,C.getOrCreateProgram(O,F)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let b in v){let E=this._mergedSourceCaches[b];v[b]!==E.used&&E.getSource().fire(new r.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new r.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){let o=this._changes.getUpdatedImages();if(o.length){for(let c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],o);this._changes.resetUpdatedImages()}}_updateWorkerLayers(o,c,g){let v=this.getFragmentStyle(o);v&&this.dispatcher.broadcast("updateLayers",{layers:c?v._serializeLayers(c):[],scope:o,removedIds:g||[],options:v.options})}setState(o){if(this._checkLoaded(),aa(this,r.aj(o)))return!1;(o=r.co(o)).layers=Xs(o.layers);let c=function(v,b){if(!v)return[{command:Pe.setStyle,args:[b]}];let E=[];try{if(!M(v.version,b.version))return[{command:Pe.setStyle,args:[b]}];M(v.center,b.center)||E.push({command:Pe.setCenter,args:[b.center]}),M(v.zoom,b.zoom)||E.push({command:Pe.setZoom,args:[b.zoom]}),M(v.bearing,b.bearing)||E.push({command:Pe.setBearing,args:[b.bearing]}),M(v.pitch,b.pitch)||E.push({command:Pe.setPitch,args:[b.pitch]}),M(v.sprite,b.sprite)||E.push({command:Pe.setSprite,args:[b.sprite]}),M(v.glyphs,b.glyphs)||E.push({command:Pe.setGlyphs,args:[b.glyphs]}),M(v.imports,b.imports)||function(F=[],z=[],j){z=z||[];let U=(F=F||[]).map(Ys),G=z.map(Ys),$=F.reduce(ss,{}),V=z.reduce(ss,{}),Y=U.slice(),ne,re,W,J;for(ne=0,re=0;ne<U.length;ne++)W=U[ne],V.hasOwnProperty(W)?re++:(j.push({command:Pe.removeImport,args:[W]}),Y.splice(Y.indexOf(W,re),1));for(ne=0,re=0;ne<G.length;ne++)W=G[G.length-1-ne],Y[Y.length-1-ne]!==W&&($.hasOwnProperty(W)?(j.push({command:Pe.removeImport,args:[W]}),Y.splice(Y.lastIndexOf(W,Y.length-re),1)):re++,J=Y[Y.length-ne],j.push({command:Pe.addImport,args:[V[W],J]}),Y.splice(Y.length-ne,0,W));for(let oe of z){let ce=$[oe.id];if(!ce||M(ce,oe))continue;M(ce.config,oe.config)||j.push({command:Pe.setImportConfig,args:[oe.id,oe.config]}),M(ce.url,oe.url)||j.push({command:Pe.setImportUrl,args:[oe.id,oe.url]});let ae=oe.data;M(ce&&ce.data,ae)||j.push({command:Pe.setImportData,args:[oe.id,ae]})}}(v.imports,b.imports,E),M(v.transition,b.transition)||E.push({command:Pe.setTransition,args:[b.transition]}),M(v.light,b.light)||E.push({command:Pe.setLight,args:[b.light]}),M(v.fog,b.fog)||E.push({command:Pe.setFog,args:[b.fog]}),M(v.projection,b.projection)||E.push({command:Pe.setProjection,args:[b.projection]}),M(v.lights,b.lights)||E.push({command:Pe.setLights,args:[b.lights]}),M(v.camera,b.camera)||E.push({command:Pe.setCamera,args:[b.camera]});let I={},C=[];(function(F,z,j,U){let G;for(G in z=z||{},F=F||{})F.hasOwnProperty(G)&&(z.hasOwnProperty(G)||sn(G,j,U));for(G in z){if(!z.hasOwnProperty(G))continue;let $=z[G];F.hasOwnProperty(G)?M(F[G],$)||(F[G].type==="geojson"&&$.type==="geojson"&&La(F,z,G)?j.push({command:Pe.setGeoJSONSourceData,args:[G,$.data]}):Mi(G,z,j,U)):tn(G,z,j)}})(v.sources,b.sources,C,I);let R=[];v.layers&&v.layers.forEach(F=>{F.source&&I[F.source]?E.push({command:Pe.removeLayer,args:[F.id]}):R.push(F)});let O=v.terrain;O&&I[O.source]&&(E.push({command:Pe.setTerrain,args:[void 0]}),O=void 0),E=E.concat(C),M(O,b.terrain)||E.push({command:Pe.setTerrain,args:[b.terrain]}),function(F,z,j){z=z||[];let U=(F=F||[]).map(Ys),G=z.map(Ys),$=F.reduce(ss,{}),V=z.reduce(ss,{}),Y=U.slice(),ne=Object.create(null),re,W,J,oe,ce,ae,ue;for(re=0,W=0;re<U.length;re++)J=U[re],V.hasOwnProperty(J)?W++:(j.push({command:Pe.removeLayer,args:[J]}),Y.splice(Y.indexOf(J,W),1));for(re=0,W=0;re<G.length;re++)J=G[G.length-1-re],Y[Y.length-1-re]!==J&&($.hasOwnProperty(J)?(j.push({command:Pe.removeLayer,args:[J]}),Y.splice(Y.lastIndexOf(J,Y.length-W),1)):W++,ae=Y[Y.length-re],j.push({command:Pe.addLayer,args:[V[J],ae]}),Y.splice(Y.length-re,0,J),ne[J]=!0);for(re=0;re<G.length;re++)if(J=G[re],oe=$[J],ce=V[J],!ne[J]&&!M(oe,ce))if(M(oe.source,ce.source)&&M(oe["source-layer"],ce["source-layer"])&&M(oe.type,ce.type)){for(ue in Kt(oe.layout,ce.layout,j,J,null,Pe.setLayoutProperty),Kt(oe.paint,ce.paint,j,J,null,Pe.setPaintProperty),M(oe.slot,ce.slot)||j.push({command:Pe.setSlot,args:[J,ce.slot]}),M(oe.filter,ce.filter)||j.push({command:Pe.setFilter,args:[J,ce.filter]}),M(oe.minzoom,ce.minzoom)&&M(oe.maxzoom,ce.maxzoom)||j.push({command:Pe.setLayerZoomRange,args:[J,ce.minzoom,ce.maxzoom]}),oe)oe.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Kt(oe[ue],ce[ue],j,J,ue.slice(6),Pe.setPaintProperty):M(oe[ue],ce[ue])||j.push({command:Pe.setLayerProperty,args:[J,ue,ce[ue]]}));for(ue in ce)ce.hasOwnProperty(ue)&&!oe.hasOwnProperty(ue)&&ue!=="layout"&&ue!=="paint"&&ue!=="filter"&&ue!=="metadata"&&ue!=="minzoom"&&ue!=="maxzoom"&&ue!=="slot"&&(ue.indexOf("paint.")===0?Kt(oe[ue],ce[ue],j,J,ue.slice(6),Pe.setPaintProperty):M(oe[ue],ce[ue])||j.push({command:Pe.setLayerProperty,args:[J,ue,ce[ue]]}))}else j.push({command:Pe.removeLayer,args:[J]}),ae=Y[Y.lastIndexOf(J)+1],j.push({command:Pe.addLayer,args:[ce,ae]})}(R,b.layers,E)}catch(I){console.warn("Unable to compute style diff:",I),E=[{command:Pe.setStyle,args:[b]}]}return E}(this.serialize(),o).filter(v=>!(v.command in om));if(c.length===0)return!1;let g=c.filter(v=>!(v.command in im));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return c.forEach(v=>{this[v.command].apply(this,v.args)}),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(o,c){return this.getImage(o)?this.fire(new r.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,this.scope,c),this._afterImageUpdated(o),this)}updateImage(o,c){this.imageManager.updateImage(o,this.scope,c)}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._afterImageUpdated(o),this):this.fire(new r.a7(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(o),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new r.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(o,c,g={}){return this._checkLoaded(),this._validate(r.cr,`models.${o}`,c,null,g)||(this.modelManager.addModel(o,c,this.scope),this._changes.setDirty()),this}hasModel(o){return this.modelManager.hasModel(o,this.scope)}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.scope),this):this.fire(new r.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(o,c,g={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(r.cs,`sources.${o}`,c,null,g))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);let v=Zi(o,c,this.dispatcher,this);v.scope=this.scope,v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(v.id),source:v.serialize(),sourceId:v.id}));let b=E=>{let I=(E?"symbol:":"other:")+v.id,C=r.aE(I,this.scope),R=this._sourceCaches[I]=new r.bq(C,v,E);(E?this._symbolSourceCaches:this._otherSourceCaches)[v.id]=R,R.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),v.onAdd&&v.onAdd(this.map),g.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();let c=this.getOwnSource(o);if(!c)throw new Error("There is no source with this ID");for(let v in this._layers)if(this._layers[v].source===o)return this.fire(new r.a7(new Error(`Source "${o}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new r.a7(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));let g=this.getOwnSourceCaches(o);for(let v of g){let b=r.cq(v.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(v.id),v.fire(new r.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,c){this._checkLoaded(),this.getOwnSource(o).setData(c),this._changes.setDirty()}getOwnSource(o){let c=this.getOwnSourceCache(o);return c&&c.getSource()}getOwnSources(){let o=[];for(let c in this._otherSourceCaches){let g=this.getOwnSourceCache(c);g&&o.push(g.getSource())}return o}areTilesLoaded(){let o=this._mergedSourceCaches;for(let c in o){let g=o[c]._tiles;for(let v in g){let b=g[v];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;let c=this._getTransitionParameters();for(let v of o){if(this._validate(r.ct,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){let b=this.ambientLight;b.set(v),b.updateTransitions(c)}else this.ambientLight=new Cl(v,qs,this.scope,this.options);break;case"directional":if(this.directionalLight){let b=this.directionalLight;b.set(v),b.updateTransitions(c)}else this.directionalLight=new Cl(v,Rp,this.scope,this.options)}}let g=new r.al(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let o=this.directionalLight,c=this.ambientLight;if(!o||!c)return;let g=F=>.2126*(F[0]<=.03928?F[0]/12.92:Math.pow((F[0]+.055)/1.055,2.4))+.7152*(F[1]<=.03928?F[1]/12.92:Math.pow((F[1]+.055)/1.055,2.4))+.0722*(F[2]<=.03928?F[2]/12.92:Math.pow((F[2]+.055)/1.055,2.4)),v=o.properties.get("color").toArray01(),b=o.properties.get("intensity"),E=o.properties.get("direction"),I=1-r.b3(E.x,E.y,E.z)[2]/90,C=g(v)*b*I,R=c.properties.get("color").toArray01(),O=c.properties.get("intensity");return(C+g(R)*O)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(!o)return this;if(r.cu(o)){let c=r.cv(o),g=this.fragments.find(({id:b})=>b===c);if(!g)throw new Error(`Style import not found: ${o}`);let v=r.cq(o);return g.style.getFragmentStyle(v)}{let c=this.fragments.find(({id:g})=>g===o);if(!c)throw new Error(`Style import not found: ${o}`);return c.style}}getConfigProperty(o,c){let g=this.getFragmentStyle(o);if(!g)return null;let v=r.aE(c,g.scope),b=g.options.get(v),E=b?b.value||b.default:null;return E?E.serialize():null}setConfigProperty(o,c,g){let v=r.cw(g);if(v.result!=="success")return void aa(this,v.value);let b=v.value.expression,E=this.getFragmentStyle(o);if(!E)return;let I=r.aE(c,E.scope),C=E.options.get(I);C&&(this.options.set(I,Wn(It({},C),{value:b})),this.updateConfigDependencies())}setConfig(o,c){if(this._config=o,o||c)if(c)for(let g in c){let v,b,E=r.cw(c[g].default);if(E.result==="success"&&(v=E.value.expression),o&&o[g]!==void 0){let z=r.cw(o[g]);z.result==="success"&&(b=z.value.expression)}let{minValue:I,maxValue:C,stepValue:R,type:O,values:F}=c[g];if(v){let z=r.aE(g,this.scope);this.options.set(z,{default:v,value:b,minValue:I,maxValue:C,stepValue:R,type:O,values:F})}else this.fire(new r.a7(new Error(`No schema defined for config option "${g}".`)))}else this.fire(new r.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let o of this._configDependentLayers){let c=this.getLayer(o);c&&(c.possiblyEvaluateVisibility(),this._updateLayer(c))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(o,c,g={}){this._checkLoaded();let v=o.id;if(this._layers[v])return void this.fire(new r.a7(new Error(`Layer with id "${v}" already exists on this map`)));let b;if(o.type==="custom"){if(aa(this,r.cx(o)))return;b=r.cp(o,this.scope,this.options)}else{if(typeof o.source=="object"&&(this.addSource(v,o.source),o=r.co(o),o=r.ak(o,{source:v})),this._validate(r.cy,`layers.${v}`,o,{arrayIndex:-1},g))return;b=r.cp(o,this.scope,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize()}b.isConfigDependent&&this._configDependentLayers.add(b.fqid);let E=this._order.length;if(c){let O=this._order.indexOf(c);if(O===-1)return void this.fire(new r.a7(new Error(`Layer with id "${c}" does not exist on this map.`)));b.slot===this._layers[c].slot?E=O:r.X(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(E,0,v),this._layerOrderChanged=!0,this._layers[v]=b;let I=this.getOwnLayerSourceCache(b),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&b.canCastShadows()&&C&&(I.castsShadows=!0);let R=this._changes.getRemovedLayer(b);if(R&&b.source&&I&&b.type!=="custom"){this._changes.discardLayerRemoval(b);let O=r.aE(b.source,b.scope);R.type!==b.type?this._changes.updateSourceCache(O,"clear"):(this._changes.updateSourceCache(O,"reload"),I.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(o,c){this._checkLoaded();let g=this._checkLayer(o);if(!g||o===c)return;let v=this._order.indexOf(o);this._order.splice(v,1);let b=this._order.length;if(c){let E=this._order.indexOf(c);if(E===-1)return void this.fire(new r.a7(new Error(`Layer with id "${c}" does not exist on this map.`)));g.slot===this._layers[c].slot?b=E:r.X(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();let c=this._checkLayer(o);if(!c)return;c.setEventedParent(null);let g=this._order.indexOf(o);this._order.splice(g,1),delete this._layers[o],delete this._serializedLayers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);let v=this.getOwnLayerSourceCache(c);if(v&&v.castsShadows){let b=!1;for(let E in this._layers)if(this._layers[E].source===c.source&&this._layers[E].canCastShadows()){b=!0;break}v.castsShadows=b}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(let c in this._layers)if(this._layers[c].type===o)return!0;return!1}setLayerZoomRange(o,c,g){this._checkLoaded();let v=this._checkLayer(o);v&&(v.minzoom===c&&v.maxzoom===g||(c!=null&&(v.minzoom=c),g!=null&&(v.maxzoom=g),this._updateLayer(v)))}setSlot(o,c){this._checkLoaded();let g=this._checkLayer(o);g&&g.slot!==c&&(g.slot=c,this._updateLayer(g))}setFilter(o,c,g={}){this._checkLoaded();let v=this._checkLayer(o);if(v&&!M(v.filter,c))return c==null?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(r.cz,`layers.${v.id}.filter`,c,{layerType:v.type},g)||(v.filter=r.co(c),this._updateLayer(v)))}getFilter(o){let c=this._checkLayer(o);if(c)return r.co(c.filter)}setLayoutProperty(o,c,g,v={}){this._checkLoaded();let b=this._checkLayer(o);b&&(M(b.getLayoutProperty(c),g)||(b.setLayoutProperty(c,g,v),b.isConfigDependent&&this._configDependentLayers.add(b.fqid),this._updateLayer(b)))}getLayoutProperty(o,c){let g=this._checkLayer(o);if(g)return g.getLayoutProperty(c)}setPaintProperty(o,c,g,v={}){this._checkLoaded();let b=this._checkLayer(o);if(!b||M(b.getPaintProperty(c),g))return;let E=b.setPaintProperty(c,g,v);b.isConfigDependent&&this._configDependentLayers.add(b.fqid),E&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(o,c){let g=this._checkLayer(o);if(g)return g.getPaintProperty(c)}setFeatureState(o,c){this._checkLoaded();let g=o.source,v=o.sourceLayer,b=this._checkSource(g);if(!b)return;let E=b.type;if(E==="geojson"&&v)return void this.fire(new r.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(E==="vector"&&!v)return void this.fire(new r.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.a7(new Error("The feature id parameter must be provided.")));let I=this.getOwnSourceCaches(g);for(let C of I)C.setFeatureState(v,o.id,c)}removeFeatureState(o,c){this._checkLoaded();let g=o.source,v=this._checkSource(g);if(!v)return;let b=v.type,E=b==="vector"?o.sourceLayer:void 0;if(b==="vector"&&!E)return void this.fire(new r.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.a7(new Error("A feature id is required to remove its specific state property.")));let I=this.getOwnSourceCaches(g);for(let C of I)C.removeFeatureState(E,o.id,c)}getFeatureState(o){this._checkLoaded();let c=o.source,g=o.sourceLayer,v=this._checkSource(c);if(v){if(v.type!=="vector"||g)return o.id===void 0&&this.fire(new r.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(g,o.id);this.fire(new r.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=r.ak({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return r.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();let o=this.getTerrain(),c=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return r.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},g=>g!==void 0)}_updateLayer(o){this._changes.updateLayer(o);let c=this.getLayerSourceCache(o),g=r.aE(o.source,o.scope),v=this._changes.getUpdatedSourceCaches();o.source&&!v[g]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(g,"reload"),c.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){let c=I=>this._mergedLayers[I].type==="fill-extrusion",g=this.order,v={},b=[];for(let I=g.length-1;I>=0;I--){let C=g[I];if(c(C)){v[C]=I;for(let R of o){let O=R[C];if(O)for(let F of O)b.push(F)}}}b.sort((I,C)=>C.intersectionZ-I.intersectionZ);let E=[];for(let I=g.length-1;I>=0;I--){let C=g[I];if(c(C))for(let R=b.length-1;R>=0;R--){let O=b[R].feature;if(v[O.layer.id]<I)break;E.push(O),b.pop()}else for(let R of o){let O=R[C];if(O)for(let F of O)E.push(F.feature)}}return E}queryRenderedFeatures(o,c,g){c&&c.filter&&this._validate(r.cz,"queryRenderedFeatures.filter",c.filter,null,c),c.scope=this.scope,c.availableImages=this._availableImages,c.serializedLayers=this._serializedLayers;let v={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.a7(new Error("parameters.layers must be an Array."))),[];for(let R of c.layers){let O=this._mergedLayers[R];if(!O)return this.fire(new r.a7(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];v[O.source]=!0}}let b=[],E=c.serializedLayers||{},I=c&&c.layers?c.layers.some(R=>{let O=this.getLayer(R);return O&&O.is3D()}):this.has3DLayers(),C=Xr.createFromScreenPoints(o,g);for(let R in this._mergedSourceCaches){let O=this._mergedSourceCaches[R].getSource();if(!O||O.scope!==c.scope)continue;let F=this._mergedSourceCaches[R].getSource().id;c.layers&&!v[F]||b.push(Oo(this._mergedSourceCaches[R],this._mergedLayers,E,C,c,g,I,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(R,O,F,z,j,U,G){let $={},V=U.queryRenderedSymbols(z),Y=[];for(let ne of Object.keys(V).map(Number))Y.push(G[ne]);Y.sort(Xi);for(let ne of Y){let re=ne.featureIndex.lookupSymbolFeatures(V[ne.bucketInstanceId],O,ne.bucketIndex,ne.sourceLayerIndex,j.filter,j.layers,j.availableImages,R);for(let W in re){let J=$[W]=$[W]||[],oe=re[W];oe.sort((ce,ae)=>{let ue=ne.featureSortOrder;if(ue){let De=ue.indexOf(ce.featureIndex);return ue.indexOf(ae.featureIndex)-De}return ae.featureIndex-ce.featureIndex});for(let ce of oe)J.push(ce)}}for(let ne in $)$[ne].forEach(re=>{let W=re.feature,J=F(R[ne]);if(!J)return;let oe=J.getFeatureState(W.layer["source-layer"],W.id);W.source=W.layer.source,W.layer["source-layer"]&&(W.sourceLayer=W.layer["source-layer"]),W.state=oe});return $}(this._mergedLayers,E,this.getLayerSourceCache.bind(this),C.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(o,c){c&&c.filter&&this._validate(r.cz,"querySourceFeatures.filter",c.filter,null,c);let g=this.getOwnSourceCaches(o),v=[];for(let b of g)v=v.concat(Hy(b,c));return v}addSourceType(o,c,g){return Ai.getSourceType(o)?g(new Error(`A source type called "${o}" already exists.`)):(Ai.setSourceType(o,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:c.workerSourceURL},g):g(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,c,g={}){this._checkLoaded();let v=this.light.getLight(),b=!1;for(let I in o)if(!M(o[I],v[I])){b=!0;break}if(!b)return;let E=this._getTransitionParameters();this.light.setLight(o,c,g),this.light.updateTransitions(E)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,c=1){if(this._checkLoaded(),!o)return delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let g=o,v=o.source==null;if(c===1){if(typeof g.source=="object"){let I="terrain-dem-src";this.addSource(I,g.source),g=r.co(g),g=r.ak(g,{source:I})}let b=r.ak({},g),E={};if(this.terrain&&v){b.source=this.terrain.get().source;let I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(E.style=I.serialize())}if(this._validate(r.cB,"terrain",b,E))return}if(!this.terrain||this.terrain.scope!==this.scope&&!v||this.terrain&&c!==this.terrain.drapeRenderMode){if(!g)return;this._createTerrain(g,c),this.fire(new r.a8("data",{dataType:"style"}))}else{let b=this.terrain,E=b.get();for(let I of Object.keys(r.ae.terrain))!g.hasOwnProperty(I)&&r.ae.terrain[I].default&&(g[I]=r.ae.terrain[I].default);for(let I in o)if(!M(o[I],E[I])){b.set(o,this.options),this.stylesheet.terrain=o;let C=this._getTransitionParameters({duration:0});b.updateTransitions(C),this.fire(new r.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){let c=this.fog=new Gh(o,this.map.transform);this.stylesheet.fog=c.get();let g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let c=this.fog;if(!M(c.get(),o)){c.set(o),this.stylesheet.fog=c.get();let g=this._getTransitionParameters({duration:0});c.updateTransitions(g)}}else this._createFog(o);this._markersNeedUpdate=!0}_getTransitionParameters(o){return{now:r.a4.now(),transition:r.ak(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;let o=[],c=[];for(let g in this._mergedLayers)this.isLayerDraped(this._mergedLayers[g])?o.push(g):c.push(g);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...c)}_createTerrain(o,c){let g=this.terrain=new Di(o,c,this.scope,this.options);c===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let v=this._getTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(let o in this._layers){let c=this._layers[o];c.type==="symbol"&&this._updateLayer(c)}}_validate(o,c,g,v,b={}){if(b&&b.validate===!1)return!1;let E=r.ak({},this.serialize());return aa(this,o.call(r.aj,r.ak({key:c,style:E,value:g,styleSpec:r.ae},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(let o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(o){let c=this.getSourceCaches(o);for(let g of c)g.clearTiles()}clearSources(){for(let o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}reloadSource(o){let c=this.getSourceCaches(o);for(let g of c)g.resume(),g.reload()}reloadSources(){for(let o of this.getSources())o.reload&&o.reload()}updateSources(o){let c;this.directionalLight&&(c=Md(this.directionalLight));for(let g in this._mergedSourceCaches)this._mergedSourceCaches[g].update(o,void 0,void 0,c)}_generateCollisionBoxes(){for(let o in this._sourceCaches){let c=this._sourceCaches[o];c.resume(),c.reload()}}_updatePlacement(o,c,g,v,b=!1){let E=!1,I=!1,C={},R={};for(let O of this._mergedOrder){let F=this._mergedLayers[O];if(F.type!=="symbol")continue;let z=r.aE(F.source,F.scope),j=C[z];if(!j){let G=this.getLayerSourceCache(F);if(!G)continue;let $=G.getRenderableIds(!0).map(V=>G.getTileByID(V));R[z]=$.slice(),j=C[z]=$.sort((V,Y)=>Y.tileID.overscaledZ-V.tileID.overscaledZ||(V.tileID.isLessThan(Y.tileID)?-1:1))}let U=this.crossTileSymbolIndex.addLayer(F,j,o.center.lng,o.projection);E=E||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),b=b||this._layerOrderChanged||g===0,this._layerOrderChanged&&this.fire(new r.a8("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.a4.now(),o.zoom))&&(this.pauseablePlacement=new Kh(o,this._mergedOrder,b,c,g,v,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,C,R),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.a4.now()),I=!0),E&&this.pauseablePlacement.placement.setStale()),I||E)for(let O of this._mergedOrder){let F=this._mergedLayers[O];F.type==="symbol"&&this.placement.updateLayerOpacities(F,C[r.aE(F.source,F.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.a4.now())}_releaseSymbolFadeTiles(){for(let o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o){this._checkLoaded();let c=this.stylesheet.imports=this.stylesheet.imports||[];return c.findIndex(({id:g})=>g===o.id)!==-1?this.fire(new r.a7(new Error(`Import with id '${o.id}' already exists in the map's style.`))):(c.push(o),this._loadImports([o],!0),this)}setImportUrl(o,c){this._checkLoaded();let g=this.stylesheet.imports||[],v=this.getImportIndex(o);if(v===-1)return this;g[v].url=c;let b=this.fragments[v];return b.style=this._createFragmentStyle(g[v]),b.style.on("style.import.load",()=>this.mergeAll()),b.style.loadURL(c),this}setImportData(o,c){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];return g===-1?this:c?(this.fragments[g].style.setState(c),this._reloadImports(),this):(delete v[g].data,this.setImportUrl(o,v[g].url))}setImportConfig(o,c){this._checkLoaded();let g=this.getImportIndex(o),v=this.stylesheet.imports||[];if(g===-1)return this;c?v[g].config=c:delete v[g].config;let b=this.fragments[g],E=b.style.stylesheet&&b.style.stylesheet.schema;return b.config=c,b.style.setConfig(c,E),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();let c=this.stylesheet.imports||[],g=this.getImportIndex(o);return g===-1||(c.splice(g,1),this.fragments[g].style._remove(),this.fragments.splice(g,1),this._reloadImports()),this}getImportIndex(o){let c=(this.stylesheet.imports||[]).findIndex(g=>g.id===o);return c===-1&&this.fire(new r.a7(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),c}getLayer(o){return this._mergedLayers[o]}getSources(){let o=[];for(let c in this._mergedOtherSourceCaches){let g=this._mergedOtherSourceCaches[c];g&&o.push(g.getSource())}return o}getSource(o,c){let g=this.getSourceCache(o,c);return g&&g.getSource()}getLayerSource(o){let c=this.getLayerSourceCache(o);return c&&c.getSource()}getSourceCache(o,c){let g=r.aE(o,c);return this._mergedOtherSourceCaches[g]}getLayerSourceCache(o){let c=r.aE(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(o){let c=[];return this._mergedOtherSourceCaches[o]&&c.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&c.push(this._mergedSymbolSourceCaches[o]),c}updateSourceCaches(){let o=this._changes.getUpdatedSourceCaches();for(let c in o){let g=o[c];g==="reload"?this.reloadSource(c):g==="clear"&&this.clearSource(c)}}updateLayers(o){let c=this._changes.getUpdatedPaintProperties();for(let g of c){let v=this.getLayer(g);v&&v.updateTransitions(o)}}getImages(o,c,g){this.imageManager.getImages(c.icons,c.scope,g),this._updateTilesForChangedImages();let v=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};v(this._otherSourceCaches[c.source]),v(this._symbolSourceCaches[c.source])}getGlyphs(o,c,g){this.glyphManager.getGlyphs(c.stacks,c.scope,g)}getResource(o,c,g){return r.cD(c,g)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){let c=[];return this._otherSourceCaches[o]&&c.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&c.push(this._symbolSourceCaches[o]),c}_isSourceCacheLoaded(o){let c=this.getOwnSourceCaches(o);return c.length===0?(this.fire(new r.a7(new Error(`There is no source with ID '${o}'`))),!1):c.every(g=>g.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function ms(p,o){let c=!1,g=null,v=()=>{g=null,c&&(p(),g=setTimeout(v,o),c=!1)};return()=>(c=!0,g||v(),g)}Ai.getSourceType=function(p){return ho[p]},Ai.setSourceType=function(p,o){ho[p]=o},Ai.registerForPluginStateChange=r.ci;class sm{constructor(o){this._hashName=o&&encodeURIComponent(o),r.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ms(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let o=this._map;if(!o)return"";let c=gs(o);if(this._hashName){let g=this._hashName,v=!1,b=location.hash.slice(1).split("&").map(E=>{let I=E.split("=")[0];return I===g?(v=!0,`${I}=${c}`):E}).filter(E=>E);return v||b.push(`${g}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){let o=location.hash.replace("#","");if(this._hashName){let c;return o.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(c=g)}),(c&&c[1]||"").split("/")}return o.split("/")}_onHashChange(){let o=this._map;if(!o)return!1;let c=this._getCurrentHash();if(c.length>=3&&!c.some(g=>isNaN(g))){let g=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(c[3]||0):o.getBearing();return o.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:g,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function gs(p,o){let c=p.getCenter(),g=Math.round(100*p.getZoom())/100,v=Math.ceil((g*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,v),E=Math.round(c.lng*b)/b,I=Math.round(c.lat*b)/b,C=p.getBearing(),R=p.getPitch(),O=o?`/${E}/${I}/${g}`:`${g}/${I}/${E}`;return(C||R)&&(O+="/"+Math.round(10*C)/10),R&&(O+=`/${Math.round(R)}`),O}let Gl={linearity:.3,easing:r.cE(0,0,.3,1)},Cd=r.ak({deceleration:2500,maxSpeed:1400},Gl),Ad=r.ak({deceleration:20,maxSpeed:1400},Gl),vu=r.ak({deceleration:1e3,maxSpeed:360},Gl),fv=r.ak({deceleration:1e3,maxSpeed:90},Gl);class am{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.a4.now(),settings:o})}_drainInertiaBuffer(){let o=this._inertiaBuffer,c=r.a4.now();for(;o.length>0&&c-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let c={zoom:0,bearing:0,pitch:0,pan:new r.P(0,0),pinchAround:void 0,around:void 0};for(let{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);let g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(c.pan.mag()){let b=xu(c.pan.mag(),g,r.ak({},Cd,o||{}));v.offset=c.pan.mult(b.amount/c.pan.mag()),v.center=this._map.transform.center,_s(v,b)}if(c.zoom){let b=xu(c.zoom,g,Ad);v.zoom=this._map.transform.zoom+b.amount,_s(v,b)}if(c.bearing){let b=xu(c.bearing,g,vu);v.bearing=this._map.transform.bearing+r.c(b.amount,-179,179),_s(v,b)}if(c.pitch){let b=xu(c.pitch,g,fv);v.pitch=this._map.transform.pitch+b.amount,_s(v,b)}if(v.zoom||v.bearing){let b=c.pinchAround===void 0?c.around:c.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function _s(p,o){(!p.duration||p.duration<o.duration)&&(p.duration=o.duration,p.easing=o.easing)}function xu(p,o,c){let{maxSpeed:g,linearity:v,deceleration:b}=c,E=r.c(p*v/(o/1e3),-g,g),I=Math.abs(E)/(b*v);return{easing:c.easing,duration:1e3*I,amount:E*(I/2)}}class wi extends r.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g,v={}){let b=zn(c.getCanvasContainer(),g),E=c.unproject(b);super(o,r.ak({point:b,lngLat:E,originalEvent:g},v)),this._defaultPrevented=!1,this.target=c}}class Hl extends r.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g){let v=o==="touchend"?g.changedTouches:g.touches,b=An(c.getCanvasContainer(),v),E=b.map(C=>c.unproject(C)),I=b.reduce((C,R,O,F)=>C.add(R.div(F.length)),new r.P(0,0));super(o,{points:b,point:I,lngLats:E,lngLat:c.unproject(I),originalEvent:g}),this._defaultPrevented=!1}}class pv extends r.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,c,g){super(o,{originalEvent:g}),this._defaultPrevented=!1}}class Rd{constructor(o,c){this._map=o,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new pv(o.type,this._map,o))}mousedown(o,c){return this._mousedownPos=c,this._firePreventable(new wi(o.type,this._map,o))}mouseup(o){this._map.fire(new wi(o.type,this._map,o))}preclick(o){let c=r.ak({},o);c.type="preclick",this._map.fire(new wi(c.type,this._map,c))}click(o,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(o),this._map.fire(new wi(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new wi(o.type,this._map,o))}mouseover(o){this._map.fire(new wi(o.type,this._map,o))}mouseout(o){this._map.fire(new wi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Hl(o.type,this._map,o))}touchmove(o){this._map.fire(new Hl(o.type,this._map,o))}touchend(o){this._map.fire(new Hl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Hl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bu{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new wi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new wi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ql{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,c){this.isEnabled()&&o.shiftKey&&o.button===0&&(Vt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(o,c){if(!this._active)return;let g=c,v=this._startPos,b=this._lastPos;if(!v||!b||b.equals(g)||!this._box&&g.dist(v)<this._clickTolerance)return;this._lastPos=g,this._box||(this._box=se("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));let E=Math.min(v.x,g.x),I=Math.max(v.x,g.x),C=Math.min(v.y,g.y),R=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${E}px,${C}px)`,this._box.style.width=I-E+"px",this._box.style.height=R-C+"px")})}mouseupWindow(o,c){if(!this._active)return;let g=this._startPos,v=c;if(g&&o.button===0){if(this.reset(),Fn(),g.x!==v.x||g.y!==v.y)return this._map.fire(new r.a8("boxzoomend",{originalEvent:o})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),kt(),delete this._startPos,delete this._lastPos}_fireEvent(o,c){return this._map.fire(new r.a8(o,{originalEvent:c}))}}function Wl(p,o){let c={};for(let g=0;g<p.length;g++)c[p[g].identifier]=o[g];return c}class Zl{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,c,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){let b=new r.P(0,0);for(let E of v)b._add(E);return b.div(v.length)}(c),this.touches=Wl(g,c)))}touchmove(o,c,g){if(this.aborted||!this.centroid)return;let v=Wl(g,c);for(let b in this.touches){let E=v[b];(!E||E.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(o,c,g){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),g.length===0){let v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Xl{constructor(o){this.singleTap=new Zl(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,c,g){this.singleTap.touchstart(o,c,g)}touchmove(o,c,g){this.singleTap.touchmove(o,c,g)}touchend(o,c,g){let v=this.singleTap.touchend(o,c,g);if(v){let b=o.timeStamp-this.lastTime<500,E=!this.lastTap||this.lastTap.dist(v)<30;if(b&&E||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class wu{constructor(){this._zoomIn=new Xl({numTouches:1,numTaps:2}),this._zoomOut=new Xl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,c,g){this._zoomIn.touchstart(o,c,g),this._zoomOut.touchstart(o,c,g)}touchmove(o,c,g){this._zoomIn.touchmove(o,c,g),this._zoomOut.touchmove(o,c,g)}touchend(o,c,g){let v=this._zoomIn.touchend(o,c,g),b=this._zoomOut.touchend(o,c,g);return v?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(v)},{originalEvent:o})}):b?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:E=>E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(b)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let Eu={0:1,2:2};class di{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,c){return!1}_move(o,c){return{}}mousedown(o,c){if(this._lastPoint)return;let g=Pr(o);this._correctButton(o,g)&&(this._lastPoint=c,this._eventButton=g)}mousemoveWindow(o,c){let g=this._lastPoint;if(g){if(o.preventDefault(),this._eventButton!=null&&function(v,b){let E=Eu[b];return v.buttons===void 0||(v.buttons&E)!==E}(o,this._eventButton))this.reset();else if(this._moved||!(c.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(g,c)}}mouseupWindow(o){this._lastPoint&&Pr(o)===this._eventButton&&(this._moved&&Fn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class lm extends di{mousedown(o,c){super.mousedown(o,c),this._lastPoint&&(this._active=!0)}_correctButton(o,c){return c===0&&!o.ctrlKey}_move(o,c){return{around:c,panDelta:c.sub(o)}}}class Pd extends di{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){let g=.8*(c.x-o.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(o){o.preventDefault()}}class Od extends di{_correctButton(o,c){return c===0&&o.ctrlKey||c===2}_move(o,c){let g=-.5*(c.y-o.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(o){o.preventDefault()}}class la{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.P(0,0)}touchstart(o,c,g){return this._calculateTransform(o,c,g)}touchmove(o,c,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(g.length===1&&!r.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,c,g)}}touchend(o,c,g){this._calculateTransform(o,c,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,c,g){g.length>0&&(this._active=!0);let v=Wl(g,c),b=new r.P(0,0),E=new r.P(0,0),I=0;for(let R in v){let O=v[R],F=this._touches[R];F&&(b._add(O),E._add(O.sub(F)),I++,v[R]=O)}if(this._touches=v,I<this._minTouches||!E.mag())return;let C=E.div(I);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Tu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,c,g){return{}}touchstart(o,c,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([c[0],c[1]]))}touchmove(o,c,g){let v=this._firstTwoTouches;if(!v)return;o.preventDefault();let[b,E]=v,I=ca(g,c,b),C=ca(g,c,E);if(!I||!C)return;let R=this._aroundCenter?null:I.add(C).div(2);return this._move([I,C],R,o)}touchend(o,c,g){if(!this._firstTwoTouches)return;let[v,b]=this._firstTwoTouches,E=ca(g,c,v),I=ca(g,c,b);E&&I||(this._active&&Fn(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ca(p,o,c){for(let g=0;g<p.length;g++)if(p[g].identifier===c)return o[g]}function Iu(p,o){return Math.log(p/o)/Math.LN2}class Du extends Tu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,c){let g=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Iu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Iu(this._distance,g),pinchAround:c}}}function kd(p,o){return 180*p.angleWith(o)/Math.PI}class cm extends Tu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,c){let g=this._vector;if(this._vector=o[0].sub(o[1]),g&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:kd(this._vector,g),pinchAround:c}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());let c=25/(Math.PI*this._minDiameter)*360,g=this._startVector;if(!g)return!1;let v=kd(o,g);return Math.abs(v)<c}}function ys(p){return Math.abs(p.y)>Math.abs(p.x)}class mv extends Tu{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,ys(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,c,g){let v=this._lastPoints;if(!v)return;let b=o[0].sub(v[0]),E=o[1].sub(v[1]);return this._map._cooperativeGestures&&!r.cF()&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,E,g.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+E.y)/2*-.5})}gestureBeginsVertically(o,c,g){if(this._valid!==void 0)return this._valid;let v=o.mag()>=2,b=c.mag()>=2;if(!v&&!b)return;if(!v||!b)return this._firstMove==null&&(this._firstMove=g),g-this._firstMove<100&&void 0;let E=o.y>0==c.y>0;return ys(o)&&ys(c)&&E}}let gv={panStep:100,bearingStep:15,pitchStep:10};class um{constructor(){let o=gv;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let c=0,g=0,v=0,b=0,E=0;switch(o.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:o.shiftKey?g=-1:(o.preventDefault(),b=-1);break;case 39:o.shiftKey?g=1:(o.preventDefault(),b=1);break;case 38:o.shiftKey?v=1:(o.preventDefault(),E=-1);break;case 40:o.shiftKey?v=-1:(o.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:I=>{let C=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Mu,zoom:c?Math.round(C)+c*(o.shiftKey?2:1):C,bearing:I.getBearing()+g*this._bearingStep,pitch:I.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-E*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Mu(p){return p*(2-p)}let Su=4.000244140625;class hm{constructor(o,c){this._map=o,this._el=o.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||r.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY,g=r.a4.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,c!==0&&c%Su==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(v*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),o.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=o,this._delta-=c,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let c=zn(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let c=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){let R=this._type==="wheel"&&Math.abs(this._delta)>Su?this._wheelZoomRate:this._defaultZoomRate,O=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&O!==0&&(O=1/O);let F=c(),z=Math.pow(2,F),j=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(j*O))),this._type==="wheel"&&(this._startZoom=F,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let g=typeof this._targetZoom=="number"?this._targetZoom:c(),v=this._startZoom,b=this._easing,E,I=!1;if(this._type==="wheel"&&v&&b){let R=Math.min((r.a4.now()-this._lastWheelEventTime)/200,1),O=b(R);E=r.n(v,g,O),R<1?this._frameId||(this._frameId=!0):I=!0}else E=g,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=E-c();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let c=r.cG;if(this._prevEase){let g=this._prevEase,v=(r.a4.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),E=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-E*E);c=r.cE(E,I,.25,1)}return this._prevEase={start:r.a4.now(),duration:o,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=se("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class dm{constructor(o,c){this._clickZoom=o,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Cu{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,c){return o.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(o.shiftKey?-1:1),around:g.unproject(c)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ld{constructor(){this._tap=new Xl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,c,g){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=c[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(o,c,g))}touchmove(o,c,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;let v=c[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,o.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(o,c,g)}touchend(o,c,g){this._tapTime?this._swipePoint&&g.length===0&&this.reset():this._tap.touchend(o,c,g)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fm{constructor(o,c,g){this._el=o,this._mousePan=c,this._touchPan=g}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pm{constructor(o,c,g){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=c,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mm{constructor(o,c,g,v){this._el=o,this._touchZoom=c,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let Yl=p=>p.zoom||p.drag||p.pitch||p.rotate;class gm extends r.a8{}class Ha{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,c){let g=r.v.sub([],c,o);this.radius=r.v.length(g[2]<0?r.v.div([],g,this.constants):[g[0],g[1],0])}projectRay(o){r.v.div(o,o,this.constants),r.v.normalize(o,o),r.v.mul(o,o,this.constants);let c=r.v.scale([],o,this.radius);if(c[2]>0){let g=r.v.scale([],[0,0,1],r.v.dot(c,[0,0,1])),v=r.v.scale([],r.v.normalize([],[c[0],c[1],0]),this.radius),b=r.v.add([],c,r.v.scale([],r.v.sub([],r.v.add([],v,g),c),2));c[0]=b[0],c[1]=b[1]}return c}}function Jl(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class _m{constructor(o,c){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new am(o),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ha,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.aR(["handleEvent","handleWindowEvent"],this);let g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[window,"blur",void 0]];for(let[v,b,E]of this._listeners){let I=v===document?this.handleWindowEvent:this.handleEvent;v.addEventListener(b,I,E)}}destroy(){for(let[o,c,g]of this._listeners){let v=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(c,v,g)}}_addDefaultHandlers(o){let c=this._map,g=c.getCanvasContainer();this._add("mapEvent",new Rd(c,o));let v=c.boxZoom=new ql(c,o);this._add("boxZoom",v);let b=new wu,E=new Cu;c.doubleClickZoom=new dm(E,b),this._add("tapZoom",b),this._add("clickZoom",E);let I=new Ld;this._add("tapDragZoom",I);let C=c.touchPitch=new mv(c);this._add("touchPitch",C);let R=new Pd(o),O=new Od(o);c.dragRotate=new pm(o,R,O),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);let F=new lm(o),z=new la(c,o);c.dragPan=new fm(g,F,z),this._add("mousePan",F),this._add("touchPan",z,["touchZoom","touchRotate"]);let j=new cm,U=new Du;c.touchZoomRotate=new mm(g,U,j,I),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",U,["touchPan","touchRotate"]),this._add("blockableMapEvent",new bu(c));let G=c.scrollZoom=new hm(c,this);this._add("scrollZoom",G,["mousePan"]);let $=c.keyboard=new um;this._add("keyboard",$);for(let V of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[V]&&c[V].enable(o[V])}_add(o,c,g){this._handlers.push({handlerName:o,handler:c,allowed:g}),this._handlersById[o]=c}stop(o){if(!this._updatingCamera){for(let{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Yl(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,c,g){for(let v in o)if(v!==g&&(!c||c.indexOf(v)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){let c=[];for(let g of o)this._el.contains(g.target)&&c.push(g);return c}handleEvent(o,c){this._updatingCamera=!0;let g=o.type==="renderFrame",v=g?void 0:o,b={needsRenderFrame:!1},E={},I={},C=o.touches?this._getMapTouches(o.touches):void 0,R=C?An(this._el,C):g?void 0:zn(this._el,o);for(let{handlerName:z,handler:j,allowed:U}of this._handlers){if(!j.isEnabled())continue;let G;this._blockedByActive(I,U,z)?j.reset():j[c||o.type]&&(G=j[c||o.type](o,R,C),this.mergeHandlerResult(b,E,G,z,v),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||j.isActive())&&(I[z]=j)}let O={};for(let z in this._previousActiveHandlers)I[z]||(O[z]=v);this._previousActiveHandlers=I,(Object.keys(O).length||Jl(b))&&(this._changes.push([b,E,O]),this._triggerRenderFrame()),(Object.keys(I).length||Jl(b))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:F}=b;F&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],F(this._map))}mergeHandlerResult(o,c,g,v,b){if(!g)return;r.ak(o,g);let E={handlerName:v,originalEvent:g.originalEvent||b};g.zoomDelta!==void 0&&(c.zoom=E),g.panDelta!==void 0&&(c.drag=E),g.pitchDelta!==void 0&&(c.pitch=E),g.bearingDelta!==void 0&&(c.rotate=E)}_applyChanges(){let o={},c={},g={};for(let[v,b,E]of this._changes)v.panDelta&&(o.panDelta=(o.panDelta||new r.P(0,0))._add(v.panDelta)),v.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+v.pitchDelta),v.around!==void 0&&(o.around=v.around),v.aroundCoord!==void 0&&(o.aroundCoord=v.aroundCoord),v.pinchAround!==void 0&&(o.pinchAround=v.pinchAround),v.noInertia&&(o.noInertia=v.noInertia),r.ak(c,b),r.ak(g,E);this._updateMapTransform(o,c,g),this._changes=[]}_updateMapTransform(o,c,g){let v=this._map,b=v.transform,E=Y=>[Y.x,Y.y,Y.z];if((Y=>{let ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!Jl(o)){let Y=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Y!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&v._stop(!0),!Jl(o))return void this._fireEvents(c,g,!0);let{panDelta:I,zoomDelta:C,bearingDelta:R,pitchDelta:O,around:F,aroundCoord:z,pinchAround:j}=o;b._isCameraConstrained&&(C>0&&(C=0),b._isCameraConstrained=!1),j!==void 0&&(F=j),(C||(Y=>c[Y]&&!this._eventsInProgress[Y])("drag"))&&F&&(this._dragOrigin=E(b.pointCoordinate3D(F)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),F=F||v.transform.centerPoint,R&&(b.bearing+=R),O&&(b.pitch+=O),b._updateCameraState();let U=[0,0,0];if(I)if(b.projection.name==="mercator"){let Y=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(F).dir),ne=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(F.sub(I)).dir);U[0]=ne[0]-Y[0],U[1]=ne[1]-Y[1]}else{let Y=b.pointCoordinate(F);if(b.projection.name==="globe"){I=I.rotate(-b.angle);let ne=b._pixelsPerMercatorPixel/b.worldSize;U[0]=-I.x*r.cH(r.l(Y.y))*ne,U[1]=-I.y*r.cH(b.center.lat)*ne}else{let ne=b.pointCoordinate(F.sub(I));Y&&ne&&(U[0]=ne.x-Y.x,U[1]=ne.y-Y.y)}}let G=b.zoom,$=[0,0,0];if(C){let Y=E(z||b.pointCoordinate3D(F)),ne={dir:r.v.normalize([],r.v.sub([],Y,b._camera.position))};if(ne.dir[2]<0){let re=b.zoomDeltaToMovement(Y,C);r.v.scale($,ne.dir,re)}}let V=r.v.add(U,U,$);b._translateCameraConstrained(V),C&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(c,g,!0)}_fireEvents(o,c,g){let v=Yl(this._eventsInProgress),b=Yl(o),E={};for(let O in o){let{originalEvent:F}=o[O];this._eventsInProgress[O]||(E[`${O}start`]=F),this._eventsInProgress[O]=o[O]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(let O in E)this._fireEvent(O,E[O]);b&&this._fireEvent("move",b.originalEvent);for(let O in o){let{originalEvent:F}=o[O];this._fireEvent(O,F)}let I={},C;for(let O in this._eventsInProgress){let{handlerName:F,originalEvent:z}=this._eventsInProgress[O];this._handlersById[F].isActive()||(delete this._eventsInProgress[O],C=c[F]||z,I[`${O}end`]=C)}for(let O in I)this._fireEvent(O,I[O]);let R=Yl(this._eventsInProgress);if(g&&(v||b)&&!R){this._updatingCamera=!0;let O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),F=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;O?(F(O.bearing||this._map.getBearing())&&(O.bearing=0),this._map.easeTo(O,{originalEvent:C})):(this._map.fire(new r.a8("moveend",{originalEvent:C})),F(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,c){this._map.fire(new r.a8(o,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new gm("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let ym="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vm extends r.a6{constructor(o,c){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.aR(["_renderFrameCallback"],this)}getCenter(){return new r.L(this.transform.center.lng,this.transform.center.lat)}setCenter(o,c){return this.jumpTo({center:o},c)}panBy(o,c,g){return o=r.P.convert(o).mult(-1),this.panTo(this.transform.center,r.ak({offset:o},c),g)}panTo(o,c,g){return this.easeTo(r.ak({center:o},c),g)}getZoom(){return this.transform.zoom}setZoom(o,c){return this.jumpTo({zoom:o},c),this}zoomTo(o,c,g){return this.easeTo(r.ak({zoom:o},c),g)}zoomIn(o,c){return this.zoomTo(this.getZoom()+1,o,c),this}zoomOut(o,c){return this.zoomTo(this.getZoom()-1,o,c),this}getBearing(){return this.transform.bearing}setBearing(o,c){return this.jumpTo({bearing:o},c),this}getPadding(){return this.transform.padding}setPadding(o,c){return this.jumpTo({padding:o},c),this}rotateTo(o,c,g){return this.easeTo(r.ak({bearing:o},c),g)}resetNorth(o,c){return this.rotateTo(0,r.ak({duration:1e3},o),c),this}resetNorthPitch(o,c){return this.easeTo(r.ak({bearing:0,pitch:0,duration:1e3},o),c),this}snapToNorth(o,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,c):this}getPitch(){return this.transform.pitch}setPitch(o,c){return this.jumpTo({pitch:o},c),this}cameraForBounds(o,c){o=r.D.convert(o);let g=c&&c.bearing||0,v=c&&c.pitch||0,b=o.getNorthWest(),E=o.getSouthEast();return this._cameraForBounds(this.transform,b,E,g,v,c)}_extendCameraOptions(o){let c={top:0,bottom:0,right:0,left:0};if(typeof(o=r.ak({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){let g=o.padding;o.padding={top:g,bottom:g,right:g,left:g}}return o.padding=r.ak(c,o.padding),o}_minimumAABBFrustumDistance(o,c){let g=c.max[0]-c.min[0],v=c.max[1]-c.min[1];return g/v>o.aspect?g/(2*Math.tan(.5*o.fovX)*o.aspect):v/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,c,g,v,b,E){let I=o.clone(),C=this._extendCameraOptions(E);I.bearing=v,I.pitch=b;let R=r.L.convert(c),O=r.L.convert(g),F=.5*(R.lat+O.lat),z=.5*(R.lng+O.lng),j=r.cI(F,z),U=r.v.normalize([],j),G=r.v.normalize([],r.v.cross([],U,[0,1,0])),$=r.v.cross([],G,U),V=[G[0],G[1],G[2],0,$[0],$[1],$[2],0,U[0],U[1],U[2],0,0,0,0,1],Y=[j,r.cI(R.lat,R.lng),r.cI(O.lat,R.lng),r.cI(O.lat,O.lng),r.cI(R.lat,O.lng),r.cI(F,R.lng),r.cI(F,O.lng),r.cI(R.lat,z),r.cI(O.lat,z)],ne=r.c3.fromPoints(Y.map(me=>[r.v.dot(G,me),r.v.dot($,me),r.v.dot(U,me)])),re=r.v.transformMat4([],ne.center,V);r.v.squaredLength(re)===0&&r.v.set(re,0,0,1),r.v.normalize(re,re),r.v.scale(re,re,r.aC),I.center=r.cJ(re);let W=I.getWorldToCameraMatrix(),J=r.m.invert(new Float64Array(16),W);ne=r.c3.applyTransform(ne,r.m.multiply([],W,V)),r.v.transformMat4(re,re,W);let oe=.5*(ne.max[2]-ne.min[2]),ce=this._minimumAABBFrustumDistance(I,ne),ae=r.v.scale([],[0,0,1],oe),ue=r.v.add(ae,re,ae),De=ce+(I.pitch===0?0:r.v.distance(re,ue)),ve=I.globeCenterInViewSpace,we=r.v.sub([],re,[ve[0],ve[1],ve[2]]);r.v.normalize(we,we),r.v.scale(we,we,De);let de=r.v.add([],re,we);r.v.transformMat4(de,de,J);let Ie=r.cL/r.aC,be=r.v.length(de),Ce=r.b(Math.max(be*Ie-r.cL,Number.EPSILON),0),Q=Math.min(I.zoomFromMercatorZAdjusted(Ce),C.maxZoom);return Q>.5*(r.Z+r.G)?(I.setProjection({name:"mercator"}),I.zoom=Q,this._cameraForBounds(I,c,g,v,b,E)):{center:I.center,zoom:Q,bearing:v,pitch:b}}queryTerrainElevation(o,c){let g=this.transform.elevation;return g?(c=r.ak({},{exaggerated:!0},c),g.getAtPoint(r.M.fromLngLat(o),null,c.exaggerated)):null}_cameraForBounds(o,c,g,v,b,E){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,c,g,v,b,E);let I=o.clone(),C=this._extendCameraOptions(E),R=I.padding;I.bearing=v,I.pitch=b;let O=r.L.convert(c),F=r.L.convert(g),z=new r.L(O.lng,F.lat),j=new r.L(F.lng,O.lat),U=I.project(O),G=I.project(F),$=this.queryTerrainElevation(O),V=this.queryTerrainElevation(F),Y=this.queryTerrainElevation(z),ne=this.queryTerrainElevation(j),re=[[U.x,U.y,Math.min($||0,V||0,Y||0,ne||0)],[G.x,G.y,Math.max($||0,V||0,Y||0,ne||0)]],W=r.c3.fromPoints(re),J=I.getWorldToCameraMatrix(),oe=r.m.invert(new Float64Array(16),J);W=r.c3.applyTransform(W,J);let ce=r.v.sub([],W.max,W.min),ae=R.left||0,ue=R.right||0,De=R.bottom||0,ve=R.top||0,{left:we,right:de,top:Ie,bottom:be}=C.padding,Ce=.5*(ae+ue),Q=.5*(ve+De),me=Math.min(I.scaleZoom(I.scale*Math.min((I.width-(ae+ue+we+de))/ce[0],(I.height-(De+ve+be+Ie))/ce[1])),C.maxZoom),Le=I.scale/I.zoomScale(me);W=new r.c3([W.min[0]-(we+Ce)*Le,W.min[1]-(be+Q)*Le,W.min[2]],[W.max[0]+(de+Ce)*Le,W.max[1]+(Ie+Q)*Le,W.max[2]]);let Re=.5*ce[2],ot=this._minimumAABBFrustumDistance(I,W),et=[0,0,1,0];r.e.transformMat4(et,et,J),r.e.normalize(et,et);let mt=r.v.scale([],et,ot+Re),tt=r.v.add([],W.center,mt),xt=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new r.P(C.offset.x,C.offset.y):r.P.convert(C.offset)).rotate(-r.d(v));W.center[0]-=xt.x*Le,W.center[1]+=xt.y*Le,r.v.transformMat4(W.center,W.center,oe),r.v.transformMat4(tt,tt,oe);let bt=[W.center[0],W.center[1],tt[2]*I.pixelsPerMeter];r.v.scale(bt,bt,1/I.worldSize);let ht=r.cK(bt[0]),dt=r.l(bt[1]),nn=Math.min(I._zoomFromMercatorZ(bt[2]),C.maxZoom),Lt=new r.L(ht,dt);return I.mercatorFromTransition&&nn<.5*(r.Z+r.G)?(I.setProjection({name:"globe"}),I.zoom=nn,this._cameraForBounds(I,c,g,v,b,E)):{center:Lt,zoom:nn,bearing:v,pitch:b}}fitBounds(o,c,g){let v=this.cameraForBounds(o,c);return this._fitInternal(v,c,g)}fitScreenCoordinates(o,c,g,v,b){let E=r.P.convert(o),I=r.P.convert(c),C=new r.P(Math.min(E.x,I.x),Math.min(E.y,I.y)),R=new r.P(Math.max(E.x,I.x),Math.max(E.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(E,I))return this;let O=this.transform.pointLocation3D(C),F=this.transform.pointLocation3D(R),z=this.transform.pointLocation3D(new r.P(C.x,R.y)),j=this.transform.pointLocation3D(new r.P(R.x,C.y)),U=[Math.min(O.lng,F.lng,z.lng,j.lng),Math.min(O.lat,F.lat,z.lat,j.lat)],G=[Math.max(O.lng,F.lng,z.lng,j.lng),Math.max(O.lat,F.lat,z.lat,j.lat)],$=v&&v.pitch?v.pitch:this.getPitch(),V=this._cameraForBounds(this.transform,U,G,g,$,v);return this._fitInternal(V,v,b)}_fitInternal(o,c,g){return o?(delete(c=r.ak(o,c)).padding,c.linear?this.easeTo(c,g):this.flyTo(c,g)):this}jumpTo(o,c){this.stop();let g=o.preloadOnly?this.transform.clone():this.transform,v=!1,b=!1,E=!1;return"zoom"in o&&g.zoom!==+o.zoom&&(v=!0,g.zoom=+o.zoom),o.center!==void 0&&(g.center=r.L.convert(o.center)),"bearing"in o&&g.bearing!==+o.bearing&&(b=!0,g.bearing=+o.bearing),"pitch"in o&&g.pitch!==+o.pitch&&(E=!0,g.pitch=+o.pitch),o.padding==null||g.isPaddingEqual(o.padding)||(g.padding=o.padding),o.preloadOnly?(this._preloadTiles(g),this):(this.fire(new r.a8("movestart",c)).fire(new r.a8("move",c)),v&&this.fire(new r.a8("zoomstart",c)).fire(new r.a8("zoom",c)).fire(new r.a8("zoomend",c)),b&&this.fire(new r.a8("rotatestart",c)).fire(new r.a8("rotate",c)).fire(new r.a8("rotateend",c)),E&&this.fire(new r.a8("pitchstart",c)).fire(new r.a8("pitch",c)).fire(new r.a8("pitchend",c)),this.fire(new r.a8("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.X(ym),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,c){let g=this.transform;if(!g.projection.supportsFreeCamera)return r.X(ym),this;this.stop();let v=g.zoom,b=g.pitch,E=g.bearing;g.setFreeCameraOptions(o);let I=v!==g.zoom,C=b!==g.pitch,R=E!==g.bearing;return this.fire(new r.a8("movestart",c)).fire(new r.a8("move",c)),I&&this.fire(new r.a8("zoomstart",c)).fire(new r.a8("zoom",c)).fire(new r.a8("zoomend",c)),R&&this.fire(new r.a8("rotatestart",c)).fire(new r.a8("rotate",c)).fire(new r.a8("rotateend",c)),C&&this.fire(new r.a8("pitchstart",c)).fire(new r.a8("pitch",c)).fire(new r.a8("pitchend",c)),this.fire(new r.a8("moveend",c)),this}easeTo(o,c){this._stop(!1,o.easeId),((o=r.ak({offset:[0,0],duration:500,easing:r.cG},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);let g=this.transform,v=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I=this.getPadding(),C="zoom"in o?+o.zoom:v,R="bearing"in o?this._normalizeBearing(o.bearing,b):b,O="pitch"in o?+o.pitch:E,F="padding"in o?o.padding:g.padding,z=r.P.convert(o.offset),j,U,G;if(g.projection.name==="globe"){let ae=r.M.fromLngLat(g.center),ue=z.rotate(-g.angle);ae.x+=ue.x/g.worldSize,ae.y+=ue.y/g.worldSize;let De=ae.toLngLat(),ve=r.L.convert(o.center||De);this._normalizeCenter(ve),j=g.centerPoint.add(ue),U=new r.P(ae.x,ae.y).mult(g.worldSize),G=new r.P(r.E(ve.lng),r.H(ve.lat)).mult(g.worldSize).sub(U)}else{j=g.centerPoint.add(z);let ae=g.pointLocation(j),ue=r.L.convert(o.center||ae);this._normalizeCenter(ue),U=g.project(ae),G=g.project(ue).sub(U)}let $=g.zoomScale(C-v),V,Y;o.around&&(V=r.L.convert(o.around),Y=g.locationPoint(V));let ne=this._zooming||C!==v,re=this._rotating||b!==R,W=this._pitching||O!==E,J=!g.isPaddingEqual(F),oe=ae=>ue=>{if(ne&&(ae.zoom=r.n(v,C,ue)),re&&(ae.bearing=r.n(b,R,ue)),W&&(ae.pitch=r.n(E,O,ue)),J&&(ae.interpolatePadding(I,F,ue),j=ae.centerPoint.add(z)),V)ae.setLocationAtPoint(V,Y);else{let De=ae.zoomScale(ae.zoom-v),ve=C>v?Math.min(2,$):Math.max(.5,$),we=Math.pow(ve,1-ue),de=ae.unproject(U.add(G.mult(ue*we)).mult(De));ae.setLocationAtPoint(ae.renderWorldCopies?de.wrap():de,j)}return o.preloadOnly||this._fireMoveEvents(c),ae};if(o.preloadOnly){let ae=this._emulate(oe,o.duration,g);return this._preloadTiles(ae),this}let ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=re,this._pitching=W,this._easeId=o.easeId,this._prepareEase(c,o.noMoveStart,ce),this._ease(oe(g),ae=>{g.cameraElevationReference==="sea"&&g.recenterOnTerrain(),this._afterEase(c,ae)},o),this}_prepareEase(o,c,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||g.moving||this.fire(new r.a8("movestart",o)),this._zooming&&!g.zooming&&this.fire(new r.a8("zoomstart",o)),this._rotating&&!g.rotating&&this.fire(new r.a8("rotatestart",o)),this._pitching&&!g.pitching&&this.fire(new r.a8("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.a8("move",o)),this._zooming&&this.fire(new r.a8("zoom",o)),this._rotating&&this.fire(new r.a8("rotate",o)),this._pitching&&this.fire(new r.a8("pitch",o))}_afterEase(o,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,g&&this.fire(new r.a8("zoomend",o)),v&&this.fire(new r.a8("rotateend",o)),b&&this.fire(new r.a8("pitchend",o)),this.fire(new r.a8("moveend",o))}flyTo(o,c){if(this._prefersReducedMotion(o)){let be=r.p(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(be,c)}this.stop(),o=r.ak({offset:[0,0],speed:1.2,curve:1.42,easing:r.cG},o);let g=this.transform,v=this.getZoom(),b=this.getBearing(),E=this.getPitch(),I="zoom"in o?r.c(+o.zoom,g.minZoom,g.maxZoom):v,C="bearing"in o?this._normalizeBearing(o.bearing,b):b,R="pitch"in o?+o.pitch:E,O=g.zoomScale(I-v),F=r.P.convert(o.offset),z=g.centerPoint.add(F),j=g.pointLocation(z),U=o.center;if(U&&o.padding){let be=this._cameraForBounds(this.transform,U,U,C,R,o);be&&(U=be.center)}U=r.L.convert(U||j),this._normalizeCenter(U);let G=g.project(j),$=g.project(U).sub(G),V=o.curve,Y=Math.max(g.width,g.height),ne=Y/O,re=$.mag();if("minZoom"in o){let be=r.c(Math.min(o.minZoom,v,I),g.minZoom,g.maxZoom),Ce=Y/g.zoomScale(be-v);V=Math.sqrt(Ce/re*2)}let W=V*V;function J(be){let Ce=(ne*ne-Y*Y+(be?-1:1)*W*W*re*re)/(2*(be?ne:Y)*W*re);return Math.log(Math.sqrt(Ce*Ce+1)-Ce)}function oe(be){return(Math.exp(be)-Math.exp(-be))/2}function ce(be){return(Math.exp(be)+Math.exp(-be))/2}let ae=J(0),ue=function(be){return ce(ae)/ce(ae+V*be)},De=function(be){return Y*((ce(ae)*(oe(Ce=ae+V*be)/ce(Ce))-oe(ae))/W)/re;var Ce},ve=(J(1)-ae)/V;if(Math.abs(re)<1e-6||!isFinite(ve)){if(Math.abs(Y-ne)<1e-6)return this.easeTo(o,c);let be=ne<Y?-1:1;ve=Math.abs(Math.log(ne/Y))/V,De=function(){return 0},ue=function(Ce){return Math.exp(be*V*Ce)}}o.duration="duration"in o?+o.duration:1e3*ve/("screenSpeed"in o?+o.screenSpeed/V:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);let we=b!==C,de=R!==E,Ie=be=>Ce=>{let Q=Ce*ve,me=1/ue(Q);be.zoom=Ce===1?I:v+be.scaleZoom(me),we&&(be.bearing=r.n(b,C,Ce)),de&&(be.pitch=r.n(E,R,Ce));let Le=Ce===1?U:be.unproject(G.add($.mult(De(Q))).mult(me));return be.setLocationAtPoint(be.renderWorldCopies?Le.wrap():Le,z),be._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(c),be};if(o.preloadOnly){let be=this._emulate(Ie,o.duration,g);return this._preloadTiles(be),this}return this._zooming=!0,this._rotating=we,this._pitching=de,this._prepareEase(c,!1),this._ease(Ie(g),()=>this._afterEase(c),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,c)}if(!o){let g=this.handlers;g&&g.stop(!1)}return this}_ease(o,c,g){g.animate===!1||g.duration===0?(o(1),c()):(this._easeStart=r.a4.now(),this._easeOptions=g,this._onEaseFrame=o,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let o=Math.min((r.a4.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,c){o=r.w(o,-180,180);let g=Math.abs(o-c);return Math.abs(o-360-c)<g&&(o-=360),Math.abs(o+360-c)<g&&(o+=360),o}_normalizeCenter(o){let c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;let g=o.lng-c.center.lng;o.lng+=g>180?-360:g<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&r.a4.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,c,g){let v=Math.ceil(15*c/1e3),b=[],E=o(g.clone());for(let I=0;I<=v;I++){let C=E(I/v);b.push(C.clone())}return b}}class Fd{constructor(o={}){this.options=o,r.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){let c=this.options&&this.options.compact;return this._map=o,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=se("button","mapboxgl-ctrl-attrib-button",this._container),se("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=se("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,c){let g=this._map._getUIString(`AttributionControl.${c}`);o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));let c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.cM.ACCESS_TOKEN}];if(o){let g=c.reduce((v,b,E)=>(b.value&&(v+=`${b.key}=${b.value}${E<c.length-1?"&":""}`),v),"?");o.href=`${r.cM.FEEDBACK_URL}/${g}#${gs(this._map,!0)}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){let v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}let c=this._map.style._mergedSourceCaches;for(let v in c){let b=c[v];if(b.used){let E=b.getSource();E.attribution&&o.indexOf(E.attribution)<0&&o.push(E.attribution)}}o.sort((v,b)=>v.length-b.length),o=o.filter((v,b)=>{for(let E=b+1;E<o.length;E++)if(o[E].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));let g=o.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,o.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Nd{constructor(){r.aR(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=se("div","mapboxgl-ctrl");let c=se("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(let c in o){let g=o[c].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){let o=this._container.children;if(o.length){let c=o[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class zd{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){let c=++this._id;return this._queue.push({callback:o,id:c,cancelled:!1}),c}remove(o){let c=this._currentlyRunning,g=c?this._queue.concat(c):this._queue;for(let v of g)if(v.id===o)return void(v.cancelled=!0)}run(o=0){let c=this._currentlyRunning=this._queue;this._queue=[];for(let g of c)if(!g.cancelled&&(g.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bd(p,o,c){if(p=new r.L(p.lng,p.lat),o){let g=new r.L(p.lng-360,p.lat),v=new r.L(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),E=c.locationPoint(p).distSqr(o),I=o.x<0||o.y<0||o.x>c.width||o.y>c.height;c.locationPoint(g).distSqr(o)<E&&(I||Math.abs(g.lng-c.center.lng)<b)?p=g:c.locationPoint(v).distSqr(o)<E&&(I||Math.abs(v.lng-c.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-c.center.lng)>180;){let g=c.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=c.width&&g.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}let Au={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class _r extends r.a6{constructor(o,c){if(super(),(o instanceof HTMLElement||c)&&(o=r.ak({element:o},c)),r.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=o&&o.occludedOpacity||.2,o&&o.element)this._element=o.element,this._offset=r.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=se("div");let b=41,E=27,I=ge("svg",{display:"block",height:b*this._scale+"px",width:E*this._scale+"px",viewBox:`0 0 ${E} ${b}`},this._element),C=ge("radialGradient",{id:"shadowGradient"},ge("defs",{},I));ge("stop",{offset:"10%","stop-opacity":.4},C),ge("stop",{offset:"100%","stop-opacity":.05},C),ge("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},I),ge("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},I),ge("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},I),ge("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},I),this._offset=r.P.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",b=>{b.preventDefault()}),this._element.addEventListener("mousedown",b=>{b.preventDefault()});let g=this._element.classList;for(let b in Au)g.remove(`mapboxgl-marker-anchor-${b}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`);let v=o&&o.className?o.className.trim().split(/\s+/):[];g.add(...v),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){let o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.L.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){let v=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(38.1-13.5+v)],"bottom-right":[-v,-1*(38.1-13.5+v)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){let c=o.code,g=o.charCode||o.keyCode;c!=="Space"&&c!=="Enter"&&g!==32&&g!==13||this.togglePopup()}_onMapClick(o){let c=o.originalEvent.target,g=this._element;this._popup&&(c===g||g.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let o=this._map,c=this._pos;if(!o||!c)return!1;let g=o.unproject(c),v=o.getFreeCameraOptions();if(!v.position)return!1;let b=v.position.toLngLat();return b.distanceTo(g)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){let o=this._map;if(!o)return;let c=this._pos;if(!c||c.x<0||c.x>o.transform.width||c.y<0||c.y>o.transform.height)return void this._clearFadeTimer();let g=o.unproject(c),v;o._showingGlobe()&&r.cN(o.transform,this._lngLat)?v=0:(v=1-o._queryFogOpacity(g),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(v*=this._occludedOpacity)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let o=this._pos;if(!o||!this._map)return;let c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Au[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){let o=this._pos,c=this._map,g=this.getPitchAlignment();if(!c||!o||g!=="map")return"";if(!c._showingGlobe()){let C=c.getPitch();return C?`rotateX(${C}deg)`:""}let v=r.Y(r.cO(c.transform,this._lngLat)),b=o.sub(r.cP(c.transform)),E=Math.abs(b.x)+Math.abs(b.y);if(E===0)return"";let I=v/E;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){let o=this._pos,c=this._map;if(!c||!o)return"";let g=0,v=this.getRotationAlignment();if(v==="map")if(c._showingGlobe()){let b=c.project(new r.L(this._lngLat.lng,this._lngLat.lat+.001)),E=c.project(new r.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);g=r.Y(Math.atan2(E.y,E.x))-90}else g=-c.getBearing();else if(v==="horizon"){let b=r.an(4,6,c.getZoom()),E=r.cP(c.transform);E.y+=b*c.transform.height;let I=o.sub(E),C=r.Y(Math.atan2(I.y,I.x));g=(C>90?C-270:C+90)*(1-b)}return g+=this._rotation,g?`rotateZ(${g}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);let c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Bd(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){let c=this._map;if(!c)return;let g=this._pointerdownPos,v=this._positionDelta;if(g&&v){if(!this._isDragging){let b=this._clickTolerance||c._clickTolerance;if(o.point.dist(g)<b)return;this._isDragging=!0}this._pos=o.point.sub(v),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.a8("dragstart"))),this.fire(new r.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.a8("dragend")),this._state="inactive"}_addDragHandler(o){let c=this._map,g=this._pos;c&&g&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(g),this._pointerdownPos=o.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;let c=this._map;return c&&(o?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let _v={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},xm=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jd(p=new r.P(0,0),o="bottom"){if(typeof p=="number"){let c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(o){case"top":return new r.P(0,p);case"top-left":return new r.P(c,c);case"top-right":return new r.P(-c,c);case"bottom":return new r.P(0,-p);case"bottom-left":return new r.P(c,-c);case"bottom-right":return new r.P(-c,-c);case"left":return new r.P(p,0);case"right":return new r.P(-p,0)}return new r.P(0,0)}return p instanceof r.P||Array.isArray(p)?r.P.convert(p):r.P.convert(p[o]||[0,0])}class yv{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;let c=r.ba((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,c,g){this._start=this.getValue(c),this._end=o,this._startTime=c,this._endTime=c+g}}let vv={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Qi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class bm{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}let xv={showCompass:!0,showZoom:!0,visualizePitch:!1};class vs{constructor(o,c,g=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Pd({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,g&&(this.mousePitch=new Od({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(o,c){this.mouseRotate.mousedown(o,c),this.mousePitch&&this.mousePitch.mousedown(o,c),Vt()}move(o,c){let g=this.map,v=this.mouseRotate.mousemoveWindow(o,c),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){let E=this.mousePitch.mousemoveWindow(o,c),I=E&&E.pitchDelta;I&&g.setPitch(g.getPitch()+I)}}off(){let o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){kt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(r.ak({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),zn(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,zn(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=An(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=An(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let mo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},qa={maxWidth:100,unit:"metric"},Ru={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:r.c$,supported:L,setRTLTextPlugin:r.d1,getRTLTextPluginStatus:r.d2,Map:class extends vm{constructor(p){let o=p;if((p=r.ak({},Qi,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.cQ(window)&&(p.antialias=!1,r.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new vn(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._repaint=!1,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new zd,this._domRenderTaskQueue=new zd,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.cR(),this._locale=r.ak({},vv,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new yv(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.cS(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?It({},p.contextCreateOptions):{},typeof p.container=="string"){let c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new bm,this._tp=p.devtools?new em(this):new em,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,c=>{this.repaint=c}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new _m(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||r.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),p.hash&&(this._hash=new sm(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});let c=p.bounds;c&&(this.resize(),this.fitBounds(c,r.ak({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Fd({customAttribution:p.customAttribution})),this._logoControl=new Nd,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new r.a8(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new r.a8(`${c.dataType}dataloading`,c))})}_getMapId(){return this._mapId}addControl(p,o){if(o===void 0&&(o=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let c=p.onAdd(this);this._controls.push(p);let g=this._controlPositions[o];return o.indexOf("bottom")!==-1?g.insertBefore(c,g.firstChild):g.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let o=this._controls.indexOf(p);return o>-1&&this._controls.splice(o,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let o=!this._moving;return o&&this.fire(new r.a8("movestart",p)).fire(new r.a8("move",p)),this.fire(new r.a8("resize",p)),o&&this.fire(new r.a8("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.D.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.a8("zoomstart")).fire(new r.a8("zoom")).fire(new r.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.a8("zoomstart")).fire(new r.a8("zoom")).fire(new r.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.a8("pitchstart")).fire(new r.a8("pitch")).fire(new r.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.a8("pitchstart")).fire(new r.a8("pitch")).fire(new r.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(o=>o==="auto"?navigator.language:o):p}setLanguage(p){let o=this._parseLanguage(p);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(let c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let p=this.transform,o=p.projection.name,c;o==="globe"&&p.zoom>=r.G?(p.setMercatorFromTransition(),c=!0):o==="mercator"&&p.zoom<r.G&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,o){return this._updateProjection(p||o||{name:"mercator"})}_updateProjection(p){let o;return o=p.name==="globe"&&this.transform.zoom>=r.G?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),o&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p){return this.transform.locationPoint3D(r.L.convert(p))}unproject(p){return this.transform.pointLocation3D(r.P.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,o,c){if(p==="mouseenter"||p==="mouseover"){let g=!1,v=E=>{let I=o.filter(R=>this.getLayer(R)),C=I.length?this.queryRenderedFeatures(E.point,{layers:I}):[];C.length?g||(g=!0,c.call(this,new wi(p,this,E.originalEvent,{features:C}))):g=!1},b=()=>{g=!1};return{layers:new Set(o),listener:c,delegates:{mousemove:v,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let g=!1,v=E=>{let I=o.filter(C=>this.getLayer(C));(I.length?this.queryRenderedFeatures(E.point,{layers:I}):[]).length?g=!0:g&&(g=!1,c.call(this,new wi(p,this,E.originalEvent)))},b=E=>{g&&(g=!1,c.call(this,new wi(p,this,E.originalEvent)))};return{layers:new Set(o),listener:c,delegates:{mousemove:v,mouseout:b}}}{let g=v=>{let b=o.filter(I=>this.getLayer(I)),E=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];E.length&&(v.features=E,c.call(this,v),delete v.features)};return{layers:new Set(o),listener:c,delegates:{[p]:g}}}}on(p,o,c){if(c===void 0)return super.on(p,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,o,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(let v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,o,c){if(c===void 0)return super.once(p,o);if(Array.isArray(o)||(o=[o]),o){for(let v of o)if(!this._isValidId(v))return this}let g=this._createDelegatedListener(p,o,c);for(let v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,o,c){if(c===void 0)return super.off(p,o);o=new Set(Array.isArray(o)?o:[o]);for(let b of o)if(!this._isValidId(b))return this;let g=(b,E)=>{if(b.size!==E.size)return!1;for(let I of b)if(!E.has(I))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let E=0;E<b.length;E++){let I=b[E];if(I.listener===c&&g(I.layers,o)){for(let C in I.delegates)this.off(C,I.delegates[C]);return b.splice(E,1),this}}})(v),this}queryRenderedFeatures(p,o){if(!this.style)return[];if(o!==void 0||p===void 0||p instanceof r.P||Array.isArray(p)||(o=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],(o=o||{}).layers&&Array.isArray(o.layers)){for(let c of o.layers)if(!this._isValidId(c))return[]}return this.style.queryRenderedFeatures(p,o,this.transform)}querySourceFeatures(p,o){return this._isValidId(p)?this.style.querySourceFeatures(p,o):[]}isPointOnSurface(p){let{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&r.X(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.P.convert(p))}setStyle(p,o){return(o=r.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(p,o))}_getUIString(p){let o=this._locale[p];if(o==null)throw new Error(`Missing UI string '${p}'`);return o}_updateStyle(p,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Ai(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ai(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,o){if(typeof p=="string"){let c=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(c,r.a2.Style);r.a1(g,(v,b)=>{v?this.fire(new r.a7(v)):b&&this._updateDiff(b,o)})}else typeof p=="object"&&this._updateDiff(p,o)}_updateDiff(p,o){try{this.style.setState(p)&&this._update(!0)}catch(c){r.X(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.X("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new r.a7(new Error("IDs can't be empty."))),!1):!r.cu(p)||(this.fire(new r.a7(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}addSource(p,o){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,o),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,o,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,o,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,o,{pixelRatio:c=1,sdf:g=!1,stretchX:v,stretchY:b,content:E}={}){if(this._lazyInitEmptyStyle(),o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){let{width:I,height:C,data:R}=r.a4.getImageData(o);this.style.addImage(p,{data:new r.a5({width:I,height:C},R),pixelRatio:c,stretchX:v,stretchY:b,content:E,sdf:g,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new r.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:I,height:C}=o,R=o;this.style.addImage(p,{data:new r.a5({width:I,height:C},new Uint8Array(R.data)),pixelRatio:c,stretchX:v,stretchY:b,content:E,sdf:g,version:0,userImage:R}),R.onAdd&&R.onAdd(this,p)}}updateImage(p,o){this._lazyInitEmptyStyle();let c=this.style.getImage(p);if(!c)return void this.fire(new r.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let g=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?r.a4.getImageData(o):o,{width:v,height:b}=g,E=g.data;if(v===void 0||b===void 0)return void this.fire(new r.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==c.data.width||b!==c.data.height)return void this.fire(new r.a7(new Error(`The width and height of the updated image (${v}, ${b})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));let I=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);c.data.replace(E,I),this.style.updateImage(p,c)}hasImage(p){return p?!!this.style&&!!this.style.getImage(p):(this.fire(new r.a7(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,o){r.a3(this._requestManager.transformRequest(p,r.a2.Image),(c,g)=>{o(c,g instanceof HTMLImageElement?r.a4.getImageData(g):g)})}listImages(){return this.style.listImages()}addModel(p,o){this._lazyInitEmptyStyle(),this.style.addModel(p,o)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new r.a7(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,o){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,o),this._update(!0)):this}moveLayer(p,o){return this._isValidId(p)?(this.style.moveLayer(p,o),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){return this._isValidId(p)?this.style.getOwnLayer(p):null}setLayerZoomRange(p,o,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,o,c),this._update(!0)):this}setFilter(p,o,c={}){return this._isValidId(p)?(this.style.setFilter(p,o,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,o,c,g={}){return this._isValidId(p)?(this.style.setPaintProperty(p,o,c,g),this._update(!0)):this}getPaintProperty(p,o){return this._isValidId(p)?this.style.getPaintProperty(p,o):null}setLayoutProperty(p,o,c,g={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,o,c,g),this._update(!0)):this}getLayoutProperty(p,o){return this._isValidId(p)?this.style.getLayoutProperty(p,o):null}getConfigProperty(p,o){return this.style.getConfigProperty(p,o)}setConfigProperty(p,o,c){return this.style.setConfigProperty(p,o,c),this._update(!0)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){let o=p[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.L.convert(p),this.transform):0}setFeatureState(p,o){return this._isValidId(p.source)?(this.style.setFeatureState(p,o),this._update()):this}removeFeatureState(p,o){return this._isValidId(p.source)?(this.style.removeFeatureState(p,o),this._update()):this}getFeatureState(p){return this._isValidId(p.source)?this.style.getFeatureState(p):null}_updateContainerDimensions(){if(!this._container)return;let p=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300,c,g,v,b=this._container;for(;b&&(!g||!v);){let E=window.getComputedStyle(b).transform;E&&E!=="none"&&(c=E.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(g=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(v=c[3])),b=b.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(o/v):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=se("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();let o=this._canvasContainer=se("div","mapboxgl-canvas-container",p);this._canvas=se("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let c=this._controlContainer=se("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=se("div",`mapboxgl-ctrl-${v}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,o){let c=r.a4.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(o),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${o}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){let o=this._markers.indexOf(p);o!==-1&&this._markers.splice(o,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){let o=this._popups.indexOf(p);o!==-1&&this._popups.splice(o,1)}_setupPainter(){let p=r.ak({},L.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",p);o?(r.cT(o,!0),this.painter=new hv(o,this._contextCreateOptions,this.transform,this._tp),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.cU.testSupport(o)):this.fire(new r.a7(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.a8("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.a8("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let o;this.fire(new r.a8("renderstart"));let c=this.painter.context.extTimerQuery,g=r.a4.now(),v=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=v.createQuery(),v.beginQuery(c.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();let b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let C=this.transform.zoom,R=this.transform.pitch,O=r.a4.now(),F=new r.al(C,{now:O,fadeDuration:b,pitch:R,transition:this.style.transition});this.style.update(F)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let E=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),E=this._updateAverageElevation(g),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):E=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){let C=r.a4.now()-g;v.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{let R=v.getQueryParameter(o,v.QUERY_RESULT)/1e6;v.deleteQuery(o),this.fire(new r.a8("gpu-timing-frame",{cpuTime:C,gpuTime:R}))},50)}if(this.listens("gpu-timing-layer")){let C=this.painter.collectGpuTimers();setTimeout(()=>{let R=this.painter.queryGpuTimers(C);this.fire(new r.a8("gpu-timing-layer",{layerTimes:R}))},50)}if(this.listens("gpu-timing-deferred-render")){let C=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let R=this.painter.queryGpuTimeDeferredRender(C);this.fire(new r.a8("gpu-timing-deferred-render",{gpuTime:R}))},50)}let I=this._sourcesDirty||this._styleDirty||this._placementDirty||E;if(I||this._repaint)this.triggerRepaint();else{let C=!this.isMoving()&&this.loaded();if(C&&(E=this._updateAverageElevation(g,!0)),E)this.triggerRepaint();else if(this._triggerFrame(!1),C&&(this.fire(new r.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let R=this._calculateSpeedIndex();this.fire(new r.a8("speedindexcompleted",{speedIndex:R})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,this._performanceMetricsCollection&&r.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(let o of this._markers)p&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(let o of this._popups)!p||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(p,o=!1){let c=v=>(this.transform.averageElevation=v,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);let g=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(g||(o||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){let v=this.transform.averageElevation,b=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=p;let E=Math.abs(v-b);if(E>1){if(this._isInitialLoad||g)return this._averageElevation.jumpTo(b),c(b);this._averageElevation.easeTo(b,p,300)}else if(E>1e-4)return this._averageElevation.jumpTo(b),c(b)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){r.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.cX||p.status===401)){let o=this.painter.context.gl;r.cT(o,!1),this._logoControl instanceof Nd&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){let p=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());let c=this.painter.context.gl,g=c.createFramebuffer();function v(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);let E=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,E),E}return c.bindFramebuffer(c.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),o.canvasCopies.map(v),o.timeStamps)}_canvasPixelComparison(p,o,c){let g=c[1]-c[0],v=p.length/4;for(let b=0;b<o.length;b++){let E=o[b],I=0;for(let C=0;C<E.length;C+=4)E[C]===p[C]&&E[C+1]===p[C+1]&&E[C+2]===p[C+2]&&E[C+3]===p[C+3]&&(I+=1);g+=(c[b+2]-c[b+1])*(1-I/v)}return g}remove(){this._hash&&this._hash.remove();for(let o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);let p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.cZ(this.painter.context.gl),this._removed=!0,this.fire(new r.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.a4.frame(o=>{let c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(o)}))}_preloadTiles(p){let o=this.style?Object.values(this.style._sourceCaches):[];return r.c_(o,(c,g)=>c._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,o){r.d0(p,o)}get version(){return r.c$}},NavigationControl:class{constructor(p){this.options=r.ak({},xv,p),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),se("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),se("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{let c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:o}):c.resetNorth({},{originalEvent:o}))}),this._compassIcon=se("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let p=this._map;if(!p)return;let o=p.getZoom(),c=o===p.getMaxZoom(),g=o===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){let p=this._map;if(!p)return;let o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new vs(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){let p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,o){let c=se("button",p,this._container);return c.type="button",c.addEventListener("click",o),c}_setButtonTitle(p,o){if(!this._map)return;let c=this._map._getUIString(`NavigationControl.${o}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.a6{constructor(p){super();let o=navigator.geolocation;this.options=r.ak({geolocation:o},mo,p),r.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ms(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){let o=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>o(c.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(p){let o=this._map.getMaxBounds(),c=p.coords;return!!o&&(c.longitude<o.getWest()||c.longitude>o.getEast()||c.latitude<o.getSouth()||c.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.a8("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.a8("geolocate",p)),this._finish()}}_updateCamera(p){let o=new r.L(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,g=this._map.getBearing(),v=r.ak({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(c),v,{geolocateSource:!0})}_updateMarker(p){if(p){let o=new r.L(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let p=this._map.transform,o=r.b(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new r.a8("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=se("button","mapboxgl-ctrl-geolocate",this._container),se("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.X("Geolocation support is not available so the GeolocateControl will be disabled.");let o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{let o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=se("div","mapboxgl-user-location"),this._dotElement.appendChild(se("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(se("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new _r({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=se("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _r({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.a8("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fd,ScaleControl:class{constructor(p){this.options=r.ak({},qa,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let p=this.options.maxWidth||100,o=this._map,c=o._containerHeight/2,g=o._containerWidth/2-p/2,v=o.unproject([g,c]),b=o.unproject([g+p,c]),E=v.distanceTo(b);if(this.options.unit==="imperial"){let I=3.2808*E;I>5280?this._setScale(p,I/5280,"mile"):this._setScale(p,I,"foot")}else this.options.unit==="nautical"?this._setScale(p,E/1852,"nautical-mile"):E>=1e3?this._setScale(p,E/1e3,"kilometer"):this._setScale(p,E,"meter")}_setScale(p,o,c){this._map._requestDomTask(()=>{let g=function(b){let E=Math.pow(10,`${Math.floor(b)}`.length-1),I=b/E;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(C){let R=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*R)/R}(I),E*I}(o),v=g/o;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(g):`${g}&nbsp;${Ru[c]}`,this._container.style.width=p*v+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=se("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:r.X("Full screen control 'container' must be a DOM element.")),r.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=se("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){let p=this._fullscreenButton=se("button","mapboxgl-ctrl-fullscreen",this._controlContainer);se("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.a6{constructor(p){super(),this.options=r.ak(Object.create(_v),p),r.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.L.convert(p),this._pos=null,this._trackPointer=!1,this._update();let o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){let o=document.createDocumentFragment(),c=document.createElement("body"),g;for(c.innerHTML=p;g=c.firstChild,g;)o.appendChild(g);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=se("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(p),this.options.closeButton){let c=this._closeButton=se("button","mapboxgl-popup-close-button",o);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let o;return this._classList.delete(p)?o=!1:(this._classList.add(p),o=!0),this._updateClassList(),o}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;let o=this._map,c=this._container,g=this._pos;if(!o||!c||!g)return"bottom";let v=c.offsetWidth,b=c.offsetHeight,E=g.x<v/2,I=g.x>o.transform.width-v/2;if(g.y+p<b)return E?"top-left":I?"top-right":"top";if(g.y>o.transform.height-b){if(E)return"bottom-left";if(I)return"bottom-right"}return E?"left":I?"right":"bottom"}_updateClassList(){let p=this._container;if(!p)return;let o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),p.className=o.join(" ")}_update(p){let o=this._map,c=this._content;if(!o||!this._lngLat&&!this._trackPointer||!c)return;let g=this._container;if(g||(g=this._container=se("div","mapboxgl-popup",o.getContainer()),this._tip=se("div","mapboxgl-popup-tip",g),g.appendChild(c)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bd(this._lngLat,this._pos,o.transform)),!this._trackPointer||p){let v=this._pos=this._trackPointer&&p?p:o.project(this._lngLat),b=jd(this.options.offset),E=this._anchor=this._getAnchor(b.y),I=jd(this.options.offset,E),C=v.add(I).round();o._requestDomTask(()=>{this._container&&E&&(this._container.style.transform=`${Au[E]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&o._showingGlobe()){let v=r.cN(o.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let p=this._container.querySelector(xm);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:_r,Style:Ai,LngLat:r.L,LngLatBounds:r.D,Point:r.P,MercatorCoordinate:r.M,FreeCameraOptions:kr,Evented:r.a6,config:r.cM,prewarm:r.d3,clearPrewarmedResources:r.d4,get accessToken(){return r.cM.ACCESS_TOKEN},set accessToken(p){r.cM.ACCESS_TOKEN=p},get baseApiUrl(){return r.cM.API_URL},set baseApiUrl(p){r.cM.API_URL=p},get workerCount(){return r.d5.workerCount},set workerCount(p){r.d5.workerCount=p},get maxParallelImageRequests(){return r.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.cM.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.d6(p)},get workerUrl(){return r.d7.workerUrl},set workerUrl(p){r.d7.workerUrl=p},get workerClass(){return r.d7.workerClass},set workerClass(p){r.d7.workerClass=p},get workerParams(){return r.d7.workerParams},set workerParams(p){r.d7.workerParams=p},get dracoUrl(){return r.d8()},set dracoUrl(p){r.d9(p)},setNow:r.a4.setNow,restoreNow:r.a4.restoreNow}});var _=f;return _})});function jM(s,a){return Object.is(s,a)}var qr=null,Sg=!1,Cg=1,ul=Symbol("SIGNAL");function Ln(s){let a=qr;return qr=s,a}var Rg={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function px(s){if(Sg)throw new Error("");if(qr===null)return;qr.consumerOnSignalRead(s);let a=qr.nextProducerIndex++;if(Ku(qr),a<qr.producerNode.length&&qr.producerNode[a]!==s&&Tf(qr)){let f=qr.producerNode[a];Pg(f,qr.producerIndexOfThis[a])}qr.producerNode[a]!==s&&(qr.producerNode[a]=s,qr.producerIndexOfThis[a]=Tf(qr)?HM(s,qr,a):0),qr.producerLastReadVersion[a]=s.version}function yF(){Cg++}function VM(s){if(!(Tf(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===Cg)){if(!s.producerMustRecompute(s)&&!_x(s)){s.dirty=!1,s.lastCleanEpoch=Cg;return}s.producerRecomputeValue(s),s.dirty=!1,s.lastCleanEpoch=Cg}}function UM(s){if(s.liveConsumerNode===void 0)return;let a=Sg;Sg=!0;try{for(let f of s.liveConsumerNode)f.dirty||vF(f)}finally{Sg=a}}function $M(){return qr?.consumerAllowSignalWrites!==!1}function vF(s){s.dirty=!0,UM(s),s.consumerMarkedDirty?.(s)}function mx(s){return s&&(s.nextProducerIndex=0),Ln(s)}function gx(s,a){if(Ln(a),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(Tf(s))for(let f=s.nextProducerIndex;f<s.producerNode.length;f++)Pg(s.producerNode[f],s.producerIndexOfThis[f]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function _x(s){Ku(s);for(let a=0;a<s.producerNode.length;a++){let f=s.producerNode[a],d=s.producerLastReadVersion[a];if(d!==f.version||(VM(f),d!==f.version))return!0}return!1}function GM(s){if(Ku(s),Tf(s))for(let a=0;a<s.producerNode.length;a++)Pg(s.producerNode[a],s.producerIndexOfThis[a]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function HM(s,a,f){if(qM(s),Ku(s),s.liveConsumerNode.length===0)for(let d=0;d<s.producerNode.length;d++)s.producerIndexOfThis[d]=HM(s.producerNode[d],s,d);return s.liveConsumerIndexOfThis.push(f),s.liveConsumerNode.push(a)-1}function Pg(s,a){if(qM(s),Ku(s),s.liveConsumerNode.length===1)for(let d=0;d<s.producerNode.length;d++)Pg(s.producerNode[d],s.producerIndexOfThis[d]);let f=s.liveConsumerNode.length-1;if(s.liveConsumerNode[a]=s.liveConsumerNode[f],s.liveConsumerIndexOfThis[a]=s.liveConsumerIndexOfThis[f],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,a<s.liveConsumerNode.length){let d=s.liveConsumerIndexOfThis[a],_=s.liveConsumerNode[a];Ku(_),_.producerIndexOfThis[d]=a}}function Tf(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function Ku(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function qM(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function WM(s){let a=Object.create(xF);a.computation=s;let f=()=>{if(VM(a),px(a),a.value===Ag)throw a.error;return a.value};return f[ul]=a,f}var dx=Symbol("UNSET"),fx=Symbol("COMPUTING"),Ag=Symbol("ERRORED"),xF=Wn(It({},Rg),{value:dx,dirty:!0,error:null,equal:jM,producerMustRecompute(s){return s.value===dx||s.value===fx},producerRecomputeValue(s){if(s.value===fx)throw new Error("Detected cycle in computations.");let a=s.value;s.value=fx;let f=mx(s),d;try{d=s.computation()}catch(_){d=Ag,s.error=_}finally{gx(s,f)}if(a!==dx&&a!==Ag&&d!==Ag&&s.equal(a,d)){s.value=a;return}s.value=d,s.version++}});function bF(){throw new Error}var ZM=bF;function XM(){ZM()}function YM(s){ZM=s}var wF=null;function JM(s){let a=Object.create(QM);a.value=s;let f=()=>(px(a),a.value);return f[ul]=a,f}function yx(s,a){$M()||XM(),s.equal(s.value,a)||(s.value=a,EF(s))}function KM(s,a){$M()||XM(),yx(s,a(s.value))}var QM=Wn(It({},Rg),{equal:jM,value:void 0});function EF(s){s.version++,yF(),UM(s),wF?.()}function ln(s){return typeof s=="function"}function Qu(s){let f=s(d=>{Error.call(d),d.stack=new Error().stack});return f.prototype=Object.create(Error.prototype),f.prototype.constructor=f,f}var Og=Qu(s=>function(f){s(this),this.message=f?`${f.length} errors occurred during unsubscription:
${f.map((d,_)=>`${_+1}) ${d.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=f});function mc(s,a){if(s){let f=s.indexOf(a);0<=f&&s.splice(f,1)}}var Ar=class s{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;let{_parentage:f}=this;if(f)if(this._parentage=null,Array.isArray(f))for(let r of f)r.remove(this);else f.remove(this);let{initialTeardown:d}=this;if(ln(d))try{d()}catch(r){a=r instanceof Og?r.errors:[r]}let{_finalizers:_}=this;if(_){this._finalizers=null;for(let r of _)try{eS(r)}catch(M){a=a??[],M instanceof Og?a=[...a,...M.errors]:a.push(M)}}if(a)throw new Og(a)}}add(a){var f;if(a&&a!==this)if(this.closed)eS(a);else{if(a instanceof s){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=(f=this._finalizers)!==null&&f!==void 0?f:[]).push(a)}}_hasParent(a){let{_parentage:f}=this;return f===a||Array.isArray(f)&&f.includes(a)}_addParent(a){let{_parentage:f}=this;this._parentage=Array.isArray(f)?(f.push(a),f):f?[f,a]:a}_removeParent(a){let{_parentage:f}=this;f===a?this._parentage=null:Array.isArray(f)&&mc(f,a)}remove(a){let{_finalizers:f}=this;f&&mc(f,a),a instanceof s&&a._removeParent(this)}};Ar.EMPTY=(()=>{let s=new Ar;return s.closed=!0,s})();var vx=Ar.EMPTY;function kg(s){return s instanceof Ar||s&&"closed"in s&&ln(s.remove)&&ln(s.add)&&ln(s.unsubscribe)}function eS(s){ln(s)?s():s.unsubscribe()}var qo={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var eh={setTimeout(s,a,...f){let{delegate:d}=eh;return d?.setTimeout?d.setTimeout(s,a,...f):setTimeout(s,a,...f)},clearTimeout(s){let{delegate:a}=eh;return(a?.clearTimeout||clearTimeout)(s)},delegate:void 0};function Lg(s){eh.setTimeout(()=>{let{onUnhandledError:a}=qo;if(a)a(s);else throw s})}function Ta(){}var tS=xx("C",void 0,void 0);function nS(s){return xx("E",void 0,s)}function rS(s){return xx("N",s,void 0)}function xx(s,a,f){return{kind:s,value:a,error:f}}var gc=null;function th(s){if(qo.useDeprecatedSynchronousErrorHandling){let a=!gc;if(a&&(gc={errorThrown:!1,error:null}),s(),a){let{errorThrown:f,error:d}=gc;if(gc=null,f)throw d}}else s()}function iS(s){qo.useDeprecatedSynchronousErrorHandling&&gc&&(gc.errorThrown=!0,gc.error=s)}var _c=class extends Ar{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,kg(a)&&a.add(this)):this.destination=DF}static create(a,f,d){return new nh(a,f,d)}next(a){this.isStopped?wx(rS(a),this):this._next(a)}error(a){this.isStopped?wx(nS(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?wx(tS,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},TF=Function.prototype.bind;function bx(s,a){return TF.call(s,a)}var Ex=class{constructor(a){this.partialObserver=a}next(a){let{partialObserver:f}=this;if(f.next)try{f.next(a)}catch(d){Fg(d)}}error(a){let{partialObserver:f}=this;if(f.error)try{f.error(a)}catch(d){Fg(d)}else Fg(a)}complete(){let{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(f){Fg(f)}}},nh=class extends _c{constructor(a,f,d){super();let _;if(ln(a)||!a)_={next:a??void 0,error:f??void 0,complete:d??void 0};else{let r;this&&qo.useDeprecatedNextContext?(r=Object.create(a),r.unsubscribe=()=>this.unsubscribe(),_={next:a.next&&bx(a.next,r),error:a.error&&bx(a.error,r),complete:a.complete&&bx(a.complete,r)}):_=a}this.destination=new Ex(_)}};function Fg(s){qo.useDeprecatedSynchronousErrorHandling?iS(s):Lg(s)}function IF(s){throw s}function wx(s,a){let{onStoppedNotification:f}=qo;f&&eh.setTimeout(()=>f(s,a))}var DF={closed:!0,next:Ta,error:IF,complete:Ta};var rh=typeof Symbol=="function"&&Symbol.observable||"@@observable";function ri(s){return s}function Tx(...s){return Ix(s)}function Ix(s){return s.length===0?ri:s.length===1?s[0]:function(f){return s.reduce((d,_)=>_(d),f)}}var yn=(()=>{class s{constructor(f){f&&(this._subscribe=f)}lift(f){let d=new s;return d.source=this,d.operator=f,d}subscribe(f,d,_){let r=SF(f)?f:new nh(f,d,_);return th(()=>{let{operator:M,source:L}=this;r.add(M?M.call(r,L):L?this._subscribe(r):this._trySubscribe(r))}),r}_trySubscribe(f){try{return this._subscribe(f)}catch(d){f.error(d)}}forEach(f,d){return d=oS(d),new d((_,r)=>{let M=new nh({next:L=>{try{f(L)}catch(B){r(B),M.unsubscribe()}},error:r,complete:_});this.subscribe(M)})}_subscribe(f){var d;return(d=this.source)===null||d===void 0?void 0:d.subscribe(f)}[rh](){return this}pipe(...f){return Ix(f)(this)}toPromise(f){return f=oS(f),new f((d,_)=>{let r;this.subscribe(M=>r=M,M=>_(M),()=>d(r))})}}return s.create=a=>new s(a),s})();function oS(s){var a;return(a=s??qo.Promise)!==null&&a!==void 0?a:Promise}function MF(s){return s&&ln(s.next)&&ln(s.error)&&ln(s.complete)}function SF(s){return s&&s instanceof _c||MF(s)&&kg(s)}function Dx(s){return ln(s?.lift)}function rn(s){return a=>{if(Dx(a))return a.lift(function(f){try{return s(f,this)}catch(d){this.error(d)}});throw new TypeError("Unable to lift unknown Observable type")}}function Jt(s,a,f,d,_){return new If(s,a,f,d,_)}var If=class extends _c{constructor(a,f,d,_,r,M){super(a),this.onFinalize=r,this.shouldUnsubscribe=M,this._next=f?function(L){try{f(L)}catch(B){a.error(B)}}:super._next,this._error=_?function(L){try{_(L)}catch(B){a.error(B)}finally{this.unsubscribe()}}:super._error,this._complete=d?function(){try{d()}catch(L){a.error(L)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:f}=this;super.unsubscribe(),!f&&((a=this.onFinalize)===null||a===void 0||a.call(this))}}};function ih(){return rn((s,a)=>{let f=null;s._refCount++;let d=Jt(a,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){f=null;return}let _=s._connection,r=f;f=null,_&&(!r||_===r)&&_.unsubscribe(),a.unsubscribe()});s.subscribe(d),d.closed||(f=s.connect())})}var oh=class extends yn{constructor(a,f){super(),this.source=a,this.subjectFactory=f,this._subject=null,this._refCount=0,this._connection=null,Dx(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){let a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:a}=this;this._subject=this._connection=null,a?.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new Ar;let f=this.getSubject();a.add(this.source.subscribe(Jt(f,void 0,()=>{this._teardown(),f.complete()},d=>{this._teardown(),f.error(d)},()=>this._teardown()))),a.closed&&(this._connection=null,a=Ar.EMPTY)}return a}refCount(){return ih()(this)}};var sS=Qu(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var wr=(()=>{class s extends yn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(f){let d=new Ng(this,this);return d.operator=f,d}_throwIfClosed(){if(this.closed)throw new sS}next(f){th(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let d of this.currentObservers)d.next(f)}})}error(f){th(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=f;let{observers:d}=this;for(;d.length;)d.shift().error(f)}})}complete(){th(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:f}=this;for(;f.length;)f.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var f;return((f=this.observers)===null||f===void 0?void 0:f.length)>0}_trySubscribe(f){return this._throwIfClosed(),super._trySubscribe(f)}_subscribe(f){return this._throwIfClosed(),this._checkFinalizedStatuses(f),this._innerSubscribe(f)}_innerSubscribe(f){let{hasError:d,isStopped:_,observers:r}=this;return d||_?vx:(this.currentObservers=null,r.push(f),new Ar(()=>{this.currentObservers=null,mc(r,f)}))}_checkFinalizedStatuses(f){let{hasError:d,thrownError:_,isStopped:r}=this;d?f.error(_):r&&f.complete()}asObservable(){let f=new yn;return f.source=this,f}}return s.create=(a,f)=>new Ng(a,f),s})(),Ng=class extends wr{constructor(a,f){super(),this.destination=a,this.source=f}next(a){var f,d;(d=(f=this.destination)===null||f===void 0?void 0:f.next)===null||d===void 0||d.call(f,a)}error(a){var f,d;(d=(f=this.destination)===null||f===void 0?void 0:f.error)===null||d===void 0||d.call(f,a)}complete(){var a,f;(f=(a=this.destination)===null||a===void 0?void 0:a.complete)===null||f===void 0||f.call(a)}_subscribe(a){var f,d;return(d=(f=this.source)===null||f===void 0?void 0:f.subscribe(a))!==null&&d!==void 0?d:vx}};var Rr=class extends wr{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){let f=super._subscribe(a);return!f.closed&&a.next(this._value),f}getValue(){let{hasError:a,thrownError:f,_value:d}=this;if(a)throw f;return this._throwIfClosed(),d}next(a){super.next(this._value=a)}};var Mx={now(){return(Mx.delegate||Date).now()},delegate:void 0};var zg=class extends Ar{constructor(a,f){super()}schedule(a,f=0){return this}};var Df={setInterval(s,a,...f){let{delegate:d}=Df;return d?.setInterval?d.setInterval(s,a,...f):setInterval(s,a,...f)},clearInterval(s){let{delegate:a}=Df;return(a?.clearInterval||clearInterval)(s)},delegate:void 0};var Bg=class extends zg{constructor(a,f){super(a,f),this.scheduler=a,this.work=f,this.pending=!1}schedule(a,f=0){var d;if(this.closed)return this;this.state=a;let _=this.id,r=this.scheduler;return _!=null&&(this.id=this.recycleAsyncId(r,_,f)),this.pending=!0,this.delay=f,this.id=(d=this.id)!==null&&d!==void 0?d:this.requestAsyncId(r,this.id,f),this}requestAsyncId(a,f,d=0){return Df.setInterval(a.flush.bind(a,this),d)}recycleAsyncId(a,f,d=0){if(d!=null&&this.delay===d&&this.pending===!1)return f;f!=null&&Df.clearInterval(f)}execute(a,f){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let d=this._execute(a,f);if(d)return d;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(a,f){let d=!1,_;try{this.work(a)}catch(r){d=!0,_=r||new Error("Scheduled action threw falsy error")}if(d)return this.unsubscribe(),_}unsubscribe(){if(!this.closed){let{id:a,scheduler:f}=this,{actions:d}=f;this.work=this.state=this.scheduler=null,this.pending=!1,mc(d,this),a!=null&&(this.id=this.recycleAsyncId(f,a,null)),this.delay=null,super.unsubscribe()}}};var sh=class s{constructor(a,f=s.now){this.schedulerActionCtor=a,this.now=f}schedule(a,f=0,d){return new this.schedulerActionCtor(this,a).schedule(d,f)}};sh.now=Mx.now;var jg=class extends sh{constructor(a,f=sh.now){super(a,f),this.actions=[],this._active=!1}flush(a){let{actions:f}=this;if(this._active){f.push(a);return}let d;this._active=!0;do if(d=a.execute(a.state,a.delay))break;while(a=f.shift());if(this._active=!1,d){for(;a=f.shift();)a.unsubscribe();throw d}}};var Vg=class extends Bg{constructor(a,f){super(a,f),this.scheduler=a,this.work=f}schedule(a,f=0){return f>0?super.schedule(a,f):(this.delay=f,this.state=a,this.scheduler.flush(this),this)}execute(a,f){return f>0||this.closed?super.execute(a,f):this._execute(a,f)}requestAsyncId(a,f,d=0){return d!=null&&d>0||d==null&&this.delay>0?super.requestAsyncId(a,f,d):(a.flush(this),0)}};var Ug=class extends jg{};var Sx=new Ug(Vg);var ii=new yn(s=>s.complete());function aS(s){return s&&ln(s.schedule)}function Cx(s){return s[s.length-1]}function $g(s){return ln(Cx(s))?s.pop():void 0}function Cs(s){return aS(Cx(s))?s.pop():void 0}function lS(s,a){return typeof Cx(s)=="number"?s.pop():a}function uS(s,a,f,d){function _(r){return r instanceof f?r:new f(function(M){M(r)})}return new(f||(f=Promise))(function(r,M){function L(se){try{X(d.next(se))}catch(ge){M(ge)}}function B(se){try{X(d.throw(se))}catch(ge){M(ge)}}function X(se){se.done?r(se.value):_(se.value).then(L,B)}X((d=d.apply(s,a||[])).next())})}function cS(s){var a=typeof Symbol=="function"&&Symbol.iterator,f=a&&s[a],d=0;if(f)return f.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&d>=s.length&&(s=void 0),{value:s&&s[d++],done:!s}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function yc(s){return this instanceof yc?(this.v=s,this):new yc(s)}function hS(s,a,f){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=f.apply(s,a||[]),_,r=[];return _={},M("next"),M("throw"),M("return"),_[Symbol.asyncIterator]=function(){return this},_;function M(Oe){d[Oe]&&(_[Oe]=function(at){return new Promise(function(Dt,Vt){r.push([Oe,at,Dt,Vt])>1||L(Oe,at)})})}function L(Oe,at){try{B(d[Oe](at))}catch(Dt){ge(r[0][3],Dt)}}function B(Oe){Oe.value instanceof yc?Promise.resolve(Oe.value.v).then(X,se):ge(r[0][2],Oe)}function X(Oe){L("next",Oe)}function se(Oe){L("throw",Oe)}function ge(Oe,at){Oe(at),r.shift(),r.length&&L(r[0][0],r[0][1])}}function dS(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s[Symbol.asyncIterator],f;return a?a.call(s):(s=typeof cS=="function"?cS(s):s[Symbol.iterator](),f={},d("next"),d("throw"),d("return"),f[Symbol.asyncIterator]=function(){return this},f);function d(r){f[r]=s[r]&&function(M){return new Promise(function(L,B){M=s[r](M),_(L,B,M.done,M.value)})}}function _(r,M,L,B){Promise.resolve(B).then(function(X){r({value:X,done:L})},M)}}var Gg=s=>s&&typeof s.length=="number"&&typeof s!="function";function Hg(s){return ln(s?.then)}function qg(s){return ln(s[rh])}function Wg(s){return Symbol.asyncIterator&&ln(s?.[Symbol.asyncIterator])}function Zg(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function CF(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var Xg=CF();function Yg(s){return ln(s?.[Xg])}function Jg(s){return hS(this,arguments,function*(){let f=s.getReader();try{for(;;){let{value:d,done:_}=yield yc(f.read());if(_)return yield yc(void 0);yield yield yc(d)}}finally{f.releaseLock()}})}function Kg(s){return ln(s?.getReader)}function or(s){if(s instanceof yn)return s;if(s!=null){if(qg(s))return AF(s);if(Gg(s))return RF(s);if(Hg(s))return PF(s);if(Wg(s))return fS(s);if(Yg(s))return OF(s);if(Kg(s))return kF(s)}throw Zg(s)}function AF(s){return new yn(a=>{let f=s[rh]();if(ln(f.subscribe))return f.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function RF(s){return new yn(a=>{for(let f=0;f<s.length&&!a.closed;f++)a.next(s[f]);a.complete()})}function PF(s){return new yn(a=>{s.then(f=>{a.closed||(a.next(f),a.complete())},f=>a.error(f)).then(null,Lg)})}function OF(s){return new yn(a=>{for(let f of s)if(a.next(f),a.closed)return;a.complete()})}function fS(s){return new yn(a=>{LF(s,a).catch(f=>a.error(f))})}function kF(s){return fS(Jg(s))}function LF(s,a){var f,d,_,r;return uS(this,void 0,void 0,function*(){try{for(f=dS(s);d=yield f.next(),!d.done;){let M=d.value;if(a.next(M),a.closed)return}}catch(M){_={error:M}}finally{try{d&&!d.done&&(r=f.return)&&(yield r.call(f))}finally{if(_)throw _.error}}a.complete()})}function Ni(s,a,f,d=0,_=!1){let r=a.schedule(function(){f(),_?s.add(this.schedule(null,d)):this.unsubscribe()},d);if(s.add(r),!_)return r}function vc(s,a=0){return rn((f,d)=>{f.subscribe(Jt(d,_=>Ni(d,s,()=>d.next(_),a),()=>Ni(d,s,()=>d.complete(),a),_=>Ni(d,s,()=>d.error(_),a)))})}function Qg(s,a=0){return rn((f,d)=>{d.add(s.schedule(()=>f.subscribe(d),a))})}function pS(s,a){return or(s).pipe(Qg(a),vc(a))}function mS(s,a){return or(s).pipe(Qg(a),vc(a))}function gS(s,a){return new yn(f=>{let d=0;return a.schedule(function(){d===s.length?f.complete():(f.next(s[d++]),f.closed||this.schedule())})})}function _S(s,a){return new yn(f=>{let d;return Ni(f,a,()=>{d=s[Xg](),Ni(f,a,()=>{let _,r;try{({value:_,done:r}=d.next())}catch(M){f.error(M);return}r?f.complete():f.next(_)},0,!0)}),()=>ln(d?.return)&&d.return()})}function e_(s,a){if(!s)throw new Error("Iterable cannot be null");return new yn(f=>{Ni(f,a,()=>{let d=s[Symbol.asyncIterator]();Ni(f,a,()=>{d.next().then(_=>{_.done?f.complete():f.next(_.value)})},0,!0)})})}function yS(s,a){return e_(Jg(s),a)}function vS(s,a){if(s!=null){if(qg(s))return pS(s,a);if(Gg(s))return gS(s,a);if(Hg(s))return mS(s,a);if(Wg(s))return e_(s,a);if(Yg(s))return _S(s,a);if(Kg(s))return yS(s,a)}throw Zg(s)}function vr(s,a){return a?vS(s,a):or(s)}function Gt(...s){let a=Cs(s);return vr(s,a)}function hl(s,a){let f=ln(s)?s:()=>s,d=_=>_.error(f());return new yn(a?_=>a.schedule(d,0,_):d)}var dl=class s{constructor(a,f,d){this.kind=a,this.value=f,this.error=d,this.hasValue=a==="N"}observe(a){return Ax(this,a)}do(a,f,d){let{kind:_,value:r,error:M}=this;return _==="N"?a?.(r):_==="E"?f?.(M):d?.()}accept(a,f,d){var _;return ln((_=a)===null||_===void 0?void 0:_.next)?this.observe(a):this.do(a,f,d)}toObservable(){let{kind:a,value:f,error:d}=this,_=a==="N"?Gt(f):a==="E"?hl(()=>d):a==="C"?ii:0;if(!_)throw new TypeError(`Unexpected notification kind ${a}`);return _}static createNext(a){return new s("N",a)}static createError(a){return new s("E",void 0,a)}static createComplete(){return s.completeNotification}};dl.completeNotification=new dl("C");function Ax(s,a){var f,d,_;let{kind:r,value:M,error:L}=s;if(typeof r!="string")throw new TypeError('Invalid notification, missing "kind"');r==="N"?(f=a.next)===null||f===void 0||f.call(a,M):r==="E"?(d=a.error)===null||d===void 0||d.call(a,L):(_=a.complete)===null||_===void 0||_.call(a)}function Rx(s){return!!s&&(s instanceof yn||ln(s.lift)&&ln(s.subscribe))}var Ia=Qu(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function Ht(s,a){return rn((f,d)=>{let _=0;f.subscribe(Jt(d,r=>{d.next(s.call(a,r,_++))}))})}var{isArray:FF}=Array;function NF(s,a){return FF(a)?s(...a):s(a)}function xS(s){return Ht(a=>NF(s,a))}var{isArray:zF}=Array,{getPrototypeOf:BF,prototype:jF,keys:VF}=Object;function bS(s){if(s.length===1){let a=s[0];if(zF(a))return{args:a,keys:null};if(UF(a)){let f=VF(a);return{args:f.map(d=>a[d]),keys:f}}}return{args:s,keys:null}}function UF(s){return s&&typeof s=="object"&&BF(s)===jF}function wS(s,a){return s.reduce((f,d,_)=>(f[d]=a[_],f),{})}function t_(...s){let a=Cs(s),f=$g(s),{args:d,keys:_}=bS(s);if(d.length===0)return vr([],a);let r=new yn($F(d,a,_?M=>wS(_,M):ri));return f?r.pipe(xS(f)):r}function $F(s,a,f=ri){return d=>{ES(a,()=>{let{length:_}=s,r=new Array(_),M=_,L=_;for(let B=0;B<_;B++)ES(a,()=>{let X=vr(s[B],a),se=!1;X.subscribe(Jt(d,ge=>{r[B]=ge,se||(se=!0,L--),L||d.next(f(r.slice()))},()=>{--M||d.complete()}))},d)},d)}}function ES(s,a,f){s?Ni(f,s,a):a()}function TS(s,a,f,d,_,r,M,L){let B=[],X=0,se=0,ge=!1,Oe=()=>{ge&&!B.length&&!X&&a.complete()},at=Vt=>X<d?Dt(Vt):B.push(Vt),Dt=Vt=>{r&&a.next(Vt),X++;let kt=!1;or(f(Vt,se++)).subscribe(Jt(a,St=>{_?.(St),r?at(St):a.next(St)},()=>{kt=!0},void 0,()=>{if(kt)try{for(X--;B.length&&X<d;){let St=B.shift();M?Ni(a,M,()=>Dt(St)):Dt(St)}Oe()}catch(St){a.error(St)}}))};return s.subscribe(Jt(a,at,()=>{ge=!0,Oe()})),()=>{L?.()}}function Er(s,a,f=1/0){return ln(a)?Er((d,_)=>Ht((r,M)=>a(d,r,_,M))(or(s(d,_))),f):(typeof a=="number"&&(f=a),rn((d,_)=>TS(d,_,s,f)))}function Mf(s=1/0){return Er(ri,s)}function IS(){return Mf(1)}function ah(...s){return IS()(vr(s,Cs(s)))}function Sf(s){return new yn(a=>{or(s()).subscribe(a)})}function n_(...s){let a=Cs(s),f=lS(s,1/0),d=s;return d.length?d.length===1?or(d[0]):Mf(f)(vr(d,a)):ii}function oi(s,a){return rn((f,d)=>{let _=0;f.subscribe(Jt(d,r=>s.call(a,r,_++)&&d.next(r)))})}function zi(s){return rn((a,f)=>{let d=null,_=!1,r;d=a.subscribe(Jt(f,void 0,void 0,M=>{r=or(s(M,zi(s)(a))),d?(d.unsubscribe(),d=null,r.subscribe(f)):_=!0})),_&&(d.unsubscribe(),d=null,r.subscribe(f))})}function DS(s,a,f,d,_){return(r,M)=>{let L=f,B=a,X=0;r.subscribe(Jt(M,se=>{let ge=X++;B=L?s(B,se,ge):(L=!0,se),d&&M.next(B)},_&&(()=>{L&&M.next(B),M.complete()})))}}function Da(s,a){return ln(a)?Er(s,a,1):Er(s,1)}function fl(s){return rn((a,f)=>{let d=!1;a.subscribe(Jt(f,_=>{d=!0,f.next(_)},()=>{d||f.next(s),f.complete()}))})}function Wo(s){return s<=0?()=>ii:rn((a,f)=>{let d=0;a.subscribe(Jt(f,_=>{++d<=s&&(f.next(_),s<=d&&f.complete())}))})}function Px(){return rn((s,a)=>{s.subscribe(Jt(a,Ta))})}function Ox(s){return Ht(()=>s)}function kx(){return rn((s,a)=>{s.subscribe(Jt(a,f=>Ax(f,a)))})}function Lx(s,a=ri){return s=s??GF,rn((f,d)=>{let _,r=!0;f.subscribe(Jt(d,M=>{let L=a(M);(r||!s(_,L))&&(r=!1,_=L,d.next(M))}))})}function GF(s,a){return s===a}function r_(s=HF){return rn((a,f)=>{let d=!1;a.subscribe(Jt(f,_=>{d=!0,f.next(_)},()=>d?f.complete():f.error(s())))})}function HF(){return new Ia}function pl(s,a){return a?f=>f.pipe(pl((d,_)=>or(s(d,_)).pipe(Ht((r,M)=>a(d,r,_,M))))):rn((f,d)=>{let _=0,r=null,M=!1;f.subscribe(Jt(d,L=>{r||(r=Jt(d,void 0,()=>{r=null,M&&d.complete()}),or(s(L,_++)).subscribe(r))},()=>{M=!0,!r&&d.complete()}))})}function ml(s){return rn((a,f)=>{try{a.subscribe(f)}finally{f.add(s)}})}function As(s,a){let f=arguments.length>=2;return d=>d.pipe(s?oi((_,r)=>s(_,r,d)):ri,Wo(1),f?fl(a):r_(()=>new Ia))}function i_(s,a,f,d){return rn((_,r)=>{let M;!a||typeof a=="function"?M=a:{duration:f,element:M,connector:d}=a;let L=new Map,B=Dt=>{L.forEach(Dt),Dt(r)},X=Dt=>B(Vt=>Vt.error(Dt)),se=0,ge=!1,Oe=new If(r,Dt=>{try{let Vt=s(Dt),kt=L.get(Vt);if(!kt){L.set(Vt,kt=d?d():new wr);let St=at(Vt,kt);if(r.next(St),f){let Fn=Jt(kt,()=>{kt.complete(),Fn?.unsubscribe()},void 0,void 0,()=>L.delete(Vt));Oe.add(or(f(St)).subscribe(Fn))}}kt.next(M?M(Dt):Dt)}catch(Vt){X(Vt)}},()=>B(Dt=>Dt.complete()),X,()=>L.clear(),()=>(ge=!0,se===0));_.subscribe(Oe);function at(Dt,Vt){let kt=new yn(St=>{se++;let Fn=Vt.subscribe(St);return()=>{Fn.unsubscribe(),--se===0&&ge&&Oe.unsubscribe()}});return kt.key=Dt,kt}})}function lh(s){return s<=0?()=>ii:rn((a,f)=>{let d=[];a.subscribe(Jt(f,_=>{d.push(_),s<d.length&&d.shift()},()=>{for(let _ of d)f.next(_);f.complete()},void 0,()=>{d=null}))})}function Fx(s,a){let f=arguments.length>=2;return d=>d.pipe(s?oi((_,r)=>s(_,r,d)):ri,lh(1),f?fl(a):r_(()=>new Ia))}function Nx(){return rn((s,a)=>{s.subscribe(Jt(a,f=>{a.next(dl.createNext(f))},()=>{a.next(dl.createComplete()),a.complete()},f=>{a.next(dl.createError(f)),a.complete()}))})}function zx(...s){let a=s.length;if(a===0)throw new Error("list of properties cannot be empty.");return Ht(f=>{let d=f;for(let _=0;_<a;_++){let r=d?.[s[_]];if(typeof r<"u")d=r;else return}return d})}function Cf(s,a){return rn(DS(s,a,arguments.length>=2,!0))}function Bx(...s){let a=Cs(s);return rn((f,d)=>{(a?ah(s,f,a):ah(s,f)).subscribe(d)})}function ao(s,a){return rn((f,d)=>{let _=null,r=0,M=!1,L=()=>M&&!_&&d.complete();f.subscribe(Jt(d,B=>{_?.unsubscribe();let X=0,se=r++;or(s(B,se)).subscribe(_=Jt(d,ge=>d.next(a?a(B,ge,se,X++):ge),()=>{_=null,L()}))},()=>{M=!0,L()}))})}function jx(s){return rn((a,f)=>{or(s).subscribe(Jt(f,()=>f.complete(),Ta)),!f.closed&&a.subscribe(f)})}function Wr(s,a,f){let d=ln(s)||a||f?{next:s,error:a,complete:f}:s;return d?rn((_,r)=>{var M;(M=d.subscribe)===null||M===void 0||M.call(d);let L=!0;_.subscribe(Jt(r,B=>{var X;(X=d.next)===null||X===void 0||X.call(d,B),r.next(B)},()=>{var B;L=!1,(B=d.complete)===null||B===void 0||B.call(d),r.complete()},B=>{var X;L=!1,(X=d.error)===null||X===void 0||X.call(d,B),r.error(B)},()=>{var B,X;L&&((B=d.unsubscribe)===null||B===void 0||B.call(d)),(X=d.finalize)===null||X===void 0||X.call(d)}))}):ri}function Vx(...s){let a=$g(s);return rn((f,d)=>{let _=s.length,r=new Array(_),M=s.map(()=>!1),L=!1;for(let B=0;B<_;B++)or(s[B]).subscribe(Jt(d,X=>{r[B]=X,!L&&!M[B]&&(M[B]=!0,(L=M.every(ri))&&(M=null))},Ta));f.subscribe(Jt(d,B=>{if(L){let X=[B,...r];d.next(a?a(...X):X)}}))})}var lC="https://g.co/ng/security#xss",qt=class extends Error{constructor(a,f){super(R_(a,f)),this.code=a}};function R_(s,a){return`${`NG0${Math.abs(s)}`}${a?": "+a:""}`}function P_(s){return{toString:s}.toString()}var o_="__parameters__";function WF(s){return function(...f){if(s){let d=s(...f);for(let _ in d)this[_]=d[_]}}}function k1(s,a,f){return P_(()=>{let d=WF(a);function _(...r){if(this instanceof _)return d.apply(this,r),this;let M=new _(...r);return L.annotation=M,L;function L(B,X,se){let ge=B.hasOwnProperty(o_)?B[o_]:Object.defineProperty(B,o_,{value:[]})[o_];for(;ge.length<=se;)ge.push(null);return(ge[se]=ge[se]||[]).push(M),B}}return f&&(_.prototype=Object.create(f.prototype)),_.prototype.ngMetadataName=s,_.annotationCls=_,_})}var xc=globalThis;function sr(s){for(let a in s)if(s[a]===sr)return a;throw Error("Could not find renamed property on target object.")}function ji(s){if(typeof s=="string")return s;if(Array.isArray(s))return"["+s.map(ji).join(", ")+"]";if(s==null)return""+s;if(s.overriddenName)return`${s.overriddenName}`;if(s.name)return`${s.name}`;let a=s.toString();if(a==null)return""+a;let f=a.indexOf(`
`);return f===-1?a:a.substring(0,f)}function MS(s,a){return s==null||s===""?a===null?"":a:a==null||a===""?s:s+" "+a}var ZF=sr({__forward_ref__:sr});function cC(s){return s.__forward_ref__=cC,s.toString=function(){return ji(this())},s}function wo(s){return uC(s)?s():s}function uC(s){return typeof s=="function"&&s.hasOwnProperty(ZF)&&s.__forward_ref__===cC}function Ot(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function O_(s){return SS(s,dC)||SS(s,fC)}function hC(s){return O_(s)!==null}function SS(s,a){return s.hasOwnProperty(a)?s[a]:null}function XF(s){let a=s&&(s[dC]||s[fC]);return a||null}function CS(s){return s&&(s.hasOwnProperty(AS)||s.hasOwnProperty(YF))?s[AS]:null}var dC=sr({\u0275prov:sr}),AS=sr({\u0275inj:sr}),fC=sr({ngInjectableDef:sr}),YF=sr({ngInjectorDef:sr}),_t=class{constructor(a,f){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof f=="number"?this.__NG_ELEMENT_ID__=f:f!==void 0&&(this.\u0275prov=Ot({token:this,providedIn:f.providedIn||"root",factory:f.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function pC(s){return s&&!!s.\u0275providers}var JF=sr({\u0275cmp:sr}),KF=sr({\u0275dir:sr}),QF=sr({\u0275pipe:sr}),eN=sr({\u0275mod:sr}),d_=sr({\u0275fac:sr}),Af=sr({__NG_ELEMENT_ID__:sr}),RS=sr({__NG_ENV_ID__:sr});function k_(s){return typeof s=="string"?s:s==null?"":String(s)}function tN(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():k_(s)}function nN(s,a){let f=a?`. Dependency path: ${a.join(" > ")} > ${s}`:"";throw new qt(-200,s)}function L1(s,a){throw new qt(-201,!1)}var wn=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(wn||{}),Kx;function mC(){return Kx}function Bi(s){let a=Kx;return Kx=s,a}function gC(s,a,f){let d=O_(s);if(d&&d.providedIn=="root")return d.value===void 0?d.value=d.factory():d.value;if(f&wn.Optional)return null;if(a!==void 0)return a;L1(s,"Injector")}var rN={},Rf=rN,Qx="__NG_DI_FLAG__",f_="ngTempTokenPath",iN="ngTokenPath",oN=/\n/gm,sN="\u0275",PS="__source",dh;function aN(){return dh}function gl(s){let a=dh;return dh=s,a}function lN(s,a=wn.Default){if(dh===void 0)throw new qt(-203,!1);return dh===null?gC(s,void 0,a):dh.get(s,a&wn.Optional?null:void 0,a)}function Rt(s,a=wn.Default){return(mC()||lN)(wo(s),a)}function nt(s,a=wn.Default){return Rt(s,L_(a))}function L_(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function e1(s){let a=[];for(let f=0;f<s.length;f++){let d=wo(s[f]);if(Array.isArray(d)){if(d.length===0)throw new qt(900,!1);let _,r=wn.Default;for(let M=0;M<d.length;M++){let L=d[M],B=cN(L);typeof B=="number"?B===-1?_=L.token:r|=B:_=L}a.push(Rt(_,r))}else a.push(Rt(d))}return a}function F1(s,a){return s[Qx]=a,s.prototype[Qx]=a,s}function cN(s){return s[Qx]}function uN(s,a,f,d){let _=s[f_];throw a[PS]&&_.unshift(a[PS]),s.message=hN(`
`+s.message,_,f,d),s[iN]=_,s[f_]=null,s}function hN(s,a,f,d=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==sN?s.slice(2):s;let _=ji(a);if(Array.isArray(a))_=a.map(ji).join(" -> ");else if(typeof a=="object"){let r=[];for(let M in a)if(a.hasOwnProperty(M)){let L=a[M];r.push(M+":"+(typeof L=="string"?JSON.stringify(L):ji(L)))}_=`{${r.join(", ")}}`}return`${f}${d?"("+d+")":""}[${_}]: ${s.replace(oN,`
  `)}`}var N1=F1(k1("Inject",s=>({token:s})),-1),z1=F1(k1("Optional"),8);var _C=F1(k1("SkipSelf"),4);function Ec(s,a){let f=s.hasOwnProperty(d_);return f?s[d_]:null}function B1(s,a){s.forEach(f=>Array.isArray(f)?B1(f,a):a(f))}function yC(s,a,f){a>=s.length?s.push(f):s.splice(a,0,f)}function p_(s,a){return a>=s.length-1?s.pop():s.splice(a,1)[0]}var Pf={},ph=[],Jo=new _t(""),vC=new _t("",-1),xC=new _t(""),m_=class{get(a,f=Rf){if(f===Rf){let d=new Error(`NullInjectorError: No provider for ${ji(a)}!`);throw d.name="NullInjectorError",d}return f}},bC=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(bC||{}),Os=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(Os||{}),To=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(To||{});function dN(s,a,f){let d=s.length;for(;;){let _=s.indexOf(a,f);if(_===-1)return _;if(_===0||s.charCodeAt(_-1)<=32){let r=a.length;if(_+r===d||s.charCodeAt(_+r)<=32)return _}f=_+1}}function t1(s,a,f){let d=0;for(;d<f.length;){let _=f[d];if(typeof _=="number"){if(_!==0)break;d++;let r=f[d++],M=f[d++],L=f[d++];s.setAttribute(a,M,L,r)}else{let r=_,M=f[++d];fN(r)?s.setProperty(a,r,M):s.setAttribute(a,r,M),d++}}return d}function wC(s){return s===3||s===4||s===6}function fN(s){return s.charCodeAt(0)===64}function j1(s,a){if(!(a===null||a.length===0))if(s===null||s.length===0)s=a.slice();else{let f=-1;for(let d=0;d<a.length;d++){let _=a[d];typeof _=="number"?f=_:f===0||(f===-1||f===2?OS(s,f,_,null,a[++d]):OS(s,f,_,null,null))}}return s}function OS(s,a,f,d,_){let r=0,M=s.length;if(a===-1)M=-1;else for(;r<s.length;){let L=s[r++];if(typeof L=="number"){if(L===a){M=-1;break}else if(L>a){M=r-1;break}}}for(;r<s.length;){let L=s[r];if(typeof L=="number")break;if(L===f){if(d===null){_!==null&&(s[r+1]=_);return}else if(d===s[r+1]){s[r+2]=_;return}}r++,d!==null&&r++,_!==null&&r++}M!==-1&&(s.splice(M,0,a),r=M+1),s.splice(r++,0,f),d!==null&&s.splice(r++,0,d),_!==null&&s.splice(r++,0,_)}var EC="ng-template";function pN(s,a,f,d){let _=0;if(d){for(;_<a.length&&typeof a[_]=="string";_+=2)if(a[_]==="class"&&dN(a[_+1].toLowerCase(),f,0)!==-1)return!0}else if(V1(s))return!1;if(_=a.indexOf(1,_),_>-1){let r;for(;++_<a.length&&typeof(r=a[_])=="string";)if(r.toLowerCase()===f)return!0}return!1}function V1(s){return s.type===4&&s.value!==EC}function mN(s,a,f){let d=s.type===4&&!f?EC:s.value;return a===d}function gN(s,a,f){let d=4,_=s.attrs,r=_!==null?vN(_):0,M=!1;for(let L=0;L<a.length;L++){let B=a[L];if(typeof B=="number"){if(!M&&!Zo(d)&&!Zo(B))return!1;if(M&&Zo(B))continue;M=!1,d=B|d&1;continue}if(!M)if(d&4){if(d=2|d&1,B!==""&&!mN(s,B,f)||B===""&&a.length===1){if(Zo(d))return!1;M=!0}}else if(d&8){if(_===null||!pN(s,_,B,f)){if(Zo(d))return!1;M=!0}}else{let X=a[++L],se=_N(B,_,V1(s),f);if(se===-1){if(Zo(d))return!1;M=!0;continue}if(X!==""){let ge;if(se>r?ge="":ge=_[se+1].toLowerCase(),d&2&&X!==ge){if(Zo(d))return!1;M=!0}}}}return Zo(d)||M}function Zo(s){return(s&1)===0}function _N(s,a,f,d){if(a===null)return-1;let _=0;if(d||!f){let r=!1;for(;_<a.length;){let M=a[_];if(M===s)return _;if(M===3||M===6)r=!0;else if(M===1||M===2){let L=a[++_];for(;typeof L=="string";)L=a[++_];continue}else{if(M===4)break;if(M===0){_+=4;continue}}_+=r?1:2}return-1}else return xN(a,s)}function yN(s,a,f=!1){for(let d=0;d<a.length;d++)if(gN(s,a[d],f))return!0;return!1}function vN(s){for(let a=0;a<s.length;a++){let f=s[a];if(wC(f))return a}return s.length}function xN(s,a){let f=s.indexOf(4);if(f>-1)for(f++;f<s.length;){let d=s[f];if(typeof d=="number")return-1;if(d===a)return f;f++}return-1}function kS(s,a){return s?":not("+a.trim()+")":a}function bN(s){let a=s[0],f=1,d=2,_="",r=!1;for(;f<s.length;){let M=s[f];if(typeof M=="string")if(d&2){let L=s[++f];_+="["+M+(L.length>0?'="'+L+'"':"")+"]"}else d&8?_+="."+M:d&4&&(_+=" "+M);else _!==""&&!Zo(M)&&(a+=kS(r,_),_=""),d=M,r=r||!Zo(d);f++}return _!==""&&(a+=kS(r,_)),a}function wN(s){return s.map(bN).join(",")}function EN(s){let a=[],f=[],d=1,_=2;for(;d<s.length;){let r=s[d];if(typeof r=="string")_===2?r!==""&&a.push(r,s[++d]):_===8&&f.push(r);else{if(!Zo(_))break;_=r}d++}return{attrs:a,classes:f}}function Ui(s){return P_(()=>{let a=SC(s),f=Wn(It({},a),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===bC.OnPush,directiveDefs:null,pipeDefs:null,dependencies:a.standalone&&s.dependencies||null,getStandaloneInjector:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||Os.Emulated,styles:s.styles||ph,_:null,schemas:s.schemas||null,tView:null,id:""});CC(f);let d=s.dependencies;return f.directiveDefs=FS(d,!1),f.pipeDefs=FS(d,!0),f.id=DN(f),f})}function TN(s){return Tc(s)||TC(s)}function IN(s){return s!==null}function LS(s,a){if(s==null)return Pf;let f={};for(let d in s)if(s.hasOwnProperty(d)){let _=s[d],r,M,L=To.None;Array.isArray(_)?(L=_[0],r=_[1],M=_[2]??r):(r=_,M=_),a?(f[r]=L!==To.None?[d,L]:d,a[r]=M):f[r]=d}return f}function Ac(s){return P_(()=>{let a=SC(s);return CC(a),a})}function U1(s){return{type:s.type,name:s.name,factory:null,pure:s.pure!==!1,standalone:s.standalone===!0,onDestroy:s.type.prototype.ngOnDestroy||null}}function Tc(s){return s[JF]||null}function TC(s){return s[KF]||null}function IC(s){return s[QF]||null}function DC(s){let a=Tc(s)||TC(s)||IC(s);return a!==null?a.standalone:!1}function MC(s,a){let f=s[eN]||null;if(!f&&a===!0)throw new Error(`Type ${ji(s)} does not have '\u0275mod' property.`);return f}function SC(s){let a={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:a,inputTransforms:null,inputConfig:s.inputs||Pf,exportAs:s.exportAs||null,standalone:s.standalone===!0,signals:s.signals===!0,selectors:s.selectors||ph,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:LS(s.inputs,a),outputs:LS(s.outputs),debugInfo:null}}function CC(s){s.features?.forEach(a=>a(s))}function FS(s,a){if(!s)return null;let f=a?IC:TN;return()=>(typeof s=="function"?s():s).map(d=>f(d)).filter(IN)}function DN(s){let a=0,f=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery].join("|");for(let _ of f)a=Math.imul(31,a)+_.charCodeAt(0)<<0;return a+=2147483648,"c"+a}function ts(s){return{\u0275providers:s}}function MN(...s){return{\u0275providers:AC(!0,s),\u0275fromNgModule:!0}}function AC(s,...a){let f=[],d=new Set,_,r=M=>{f.push(M)};return B1(a,M=>{let L=M;n1(L,r,[],d)&&(_||=[],_.push(L))}),_!==void 0&&RC(_,r),f}function RC(s,a){for(let f=0;f<s.length;f++){let{ngModule:d,providers:_}=s[f];$1(_,r=>{a(r,d)})}}function n1(s,a,f,d){if(s=wo(s),!s)return!1;let _=null,r=CS(s),M=!r&&Tc(s);if(!r&&!M){let B=s.ngModule;if(r=CS(B),r)_=B;else return!1}else{if(M&&!M.standalone)return!1;_=s}let L=d.has(_);if(M){if(L)return!1;if(d.add(_),M.dependencies){let B=typeof M.dependencies=="function"?M.dependencies():M.dependencies;for(let X of B)n1(X,a,f,d)}}else if(r){if(r.imports!=null&&!L){d.add(_);let X;try{B1(r.imports,se=>{n1(se,a,f,d)&&(X||=[],X.push(se))})}finally{}X!==void 0&&RC(X,a)}if(!L){let X=Ec(_)||(()=>new _);a({provide:_,useFactory:X,deps:ph},_),a({provide:xC,useValue:_,multi:!0},_),a({provide:Jo,useValue:()=>Rt(_),multi:!0},_)}let B=r.providers;if(B!=null&&!L){let X=s;$1(B,se=>{a(se,X)})}}else return!1;return _!==s&&s.providers!==void 0}function $1(s,a){for(let f of s)pC(f)&&(f=f.\u0275providers),Array.isArray(f)?$1(f,a):a(f)}var SN=sr({provide:String,useValue:sr});function PC(s){return s!==null&&typeof s=="object"&&SN in s}function CN(s){return!!(s&&s.useExisting)}function AN(s){return!!(s&&s.useFactory)}function r1(s){return typeof s=="function"}var F_=new _t(""),a_={},RN={},Ux;function G1(){return Ux===void 0&&(Ux=new m_),Ux}var Vi=class{},Of=class extends Vi{get destroyed(){return this._destroyed}constructor(a,f,d,_){super(),this.parent=f,this.source=d,this.scopes=_,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,o1(a,M=>this.processProvider(M)),this.records.set(vC,ch(void 0,this)),_.has("environment")&&this.records.set(Vi,ch(void 0,this));let r=this.records.get(F_);r!=null&&typeof r.value=="string"&&this.scopes.add(r.value),this.injectorDefTypes=new Set(this.get(xC,ph,wn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;let a=Ln(null);try{for(let d of this._ngOnDestroyHooks)d.ngOnDestroy();let f=this._onDestroyHooks;this._onDestroyHooks=[];for(let d of f)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Ln(a)}}onDestroy(a){return this.assertNotDestroyed(),this._onDestroyHooks.push(a),()=>this.removeOnDestroy(a)}runInContext(a){this.assertNotDestroyed();let f=gl(this),d=Bi(void 0),_;try{return a()}finally{gl(f),Bi(d)}}get(a,f=Rf,d=wn.Default){if(this.assertNotDestroyed(),a.hasOwnProperty(RS))return a[RS](this);d=L_(d);let _,r=gl(this),M=Bi(void 0);try{if(!(d&wn.SkipSelf)){let B=this.records.get(a);if(B===void 0){let X=NN(a)&&O_(a);X&&this.injectableDefInScope(X)?B=ch(i1(a),a_):B=null,this.records.set(a,B)}if(B!=null)return this.hydrate(a,B)}let L=d&wn.Self?G1():this.parent;return f=d&wn.Optional&&f===Rf?null:f,L.get(a,f)}catch(L){if(L.name==="NullInjectorError"){if((L[f_]=L[f_]||[]).unshift(ji(a)),r)throw L;return uN(L,a,"R3InjectorError",this.source)}else throw L}finally{Bi(M),gl(r)}}resolveInjectorInitializers(){let a=Ln(null),f=gl(this),d=Bi(void 0),_;try{let r=this.get(Jo,ph,wn.Self);for(let M of r)M()}finally{gl(f),Bi(d),Ln(a)}}toString(){let a=[],f=this.records;for(let d of f.keys())a.push(ji(d));return`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new qt(205,!1)}processProvider(a){a=wo(a);let f=r1(a)?a:wo(a&&a.provide),d=ON(a);if(!r1(a)&&a.multi===!0){let _=this.records.get(f);_||(_=ch(void 0,a_,!0),_.factory=()=>e1(_.multi),this.records.set(f,_)),f=a,_.multi.push(a)}this.records.set(f,d)}hydrate(a,f){let d=Ln(null);try{return f.value===a_&&(f.value=RN,f.value=f.factory()),typeof f.value=="object"&&f.value&&FN(f.value)&&this._ngOnDestroyHooks.add(f.value),f.value}finally{Ln(d)}}injectableDefInScope(a){if(!a.providedIn)return!1;let f=wo(a.providedIn);return typeof f=="string"?f==="any"||this.scopes.has(f):this.injectorDefTypes.has(f)}removeOnDestroy(a){let f=this._onDestroyHooks.indexOf(a);f!==-1&&this._onDestroyHooks.splice(f,1)}};function i1(s){let a=O_(s),f=a!==null?a.factory:Ec(s);if(f!==null)return f;if(s instanceof _t)throw new qt(204,!1);if(s instanceof Function)return PN(s);throw new qt(204,!1)}function PN(s){if(s.length>0)throw new qt(204,!1);let f=XF(s);return f!==null?()=>f.factory(s):()=>new s}function ON(s){if(PC(s))return ch(void 0,s.useValue);{let a=kN(s);return ch(a,a_)}}function kN(s,a,f){let d;if(r1(s)){let _=wo(s);return Ec(_)||i1(_)}else if(PC(s))d=()=>wo(s.useValue);else if(AN(s))d=()=>s.useFactory(...e1(s.deps||[]));else if(CN(s))d=()=>Rt(wo(s.useExisting));else{let _=wo(s&&(s.useClass||s.provide));if(LN(s))d=()=>new _(...e1(s.deps));else return Ec(_)||i1(_)}return d}function ch(s,a,f=!1){return{factory:s,value:a,multi:f?[]:void 0}}function LN(s){return!!s.deps}function FN(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function NN(s){return typeof s=="function"||typeof s=="object"&&s instanceof _t}function o1(s,a){for(let f of s)Array.isArray(f)?o1(f,a):f&&pC(f)?o1(f.\u0275providers,a):a(f)}function Ma(s,a){s instanceof Of&&s.assertNotDestroyed();let f,d=gl(s),_=Bi(void 0);try{return a()}finally{gl(d),Bi(_)}}function OC(){return mC()!==void 0||aN()!=null}function kC(s){if(!OC())throw new qt(-203,!1)}function zN(s){return typeof s=="function"}var Sa=0,Sn=1,on=2,_i=3,Yo=4,ns=5,g_=6,kf=7,Ko=8,mh=9,Qo=10,yi=11,Lf=12,NS=13,_h=14,ks=15,N_=16,uh=17,gh=18,z_=19,LC=20,_l=21,$x=22,Ic=23,Ls=25,FC=1;var Dc=7,__=8,y_=9,Eo=10,H1=function(s){return s[s.None=0]="None",s[s.HasTransplantedViews=2]="HasTransplantedViews",s}(H1||{});function bc(s){return Array.isArray(s)&&typeof s[FC]=="object"}function Ca(s){return Array.isArray(s)&&s[FC]===!0}function NC(s){return(s.flags&4)!==0}function B_(s){return s.componentOffset>-1}function q1(s){return(s.flags&1)===1}function $f(s){return!!s.template}function BN(s){return(s[on]&512)!==0}var s1=class{constructor(a,f,d){this.previousValue=a,this.currentValue=f,this.firstChange=d}isFirstChange(){return this.firstChange}};function zC(s,a,f,d){a!==null?a.applyValueToInputSignal(a,d):s[f]=d}function Gf(){return BC}function BC(s){return s.type.prototype.ngOnChanges&&(s.setInput=VN),jN}Gf.ngInherit=!0;function jN(){let s=VC(this),a=s?.current;if(a){let f=s.previous;if(f===Pf)s.previous=a;else for(let d in a)f[d]=a[d];s.current=null,this.ngOnChanges(a)}}function VN(s,a,f,d,_){let r=this.declaredInputs[d],M=VC(s)||UN(s,{previous:Pf,current:null}),L=M.current||(M.current={}),B=M.previous,X=B[r];L[r]=new s1(X&&X.currentValue,f,B===Pf),zC(s,a,_,f)}var jC="__ngSimpleChanges__";function VC(s){return s[jC]||null}function UN(s,a){return s[jC]=a}var zS=null;var Rs=function(s,a,f){zS?.(s,a,f)},$N="svg",GN="math",HN=!1;function qN(){return HN}function Fs(s){for(;Array.isArray(s);)s=s[Sa];return s}function WN(s,a){return Fs(a[s])}function Io(s,a){return Fs(a[s.index])}function UC(s,a){return s.data[a]}function ZN(s,a){return s[a]}function vl(s,a){let f=a[s];return bc(f)?f:f[Sa]}function W1(s){return(s[on]&128)===128}function XN(s){return Ca(s[_i])}function v_(s,a){return a==null?null:s[a]}function $C(s){s[uh]=0}function YN(s){s[on]&1024||(s[on]|=1024,W1(s)&&Ff(s))}function JN(s,a){for(;s>0;)a=a[_h],s--;return a}function Z1(s){return!!(s[on]&9216||s[Ic]?.dirty)}function a1(s){s[Qo].changeDetectionScheduler?.notify(1),Z1(s)?Ff(s):s[on]&64&&(qN()?(s[on]|=1024,Ff(s)):s[Qo].changeDetectionScheduler?.notify())}function Ff(s){s[Qo].changeDetectionScheduler?.notify();let a=Nf(s);for(;a!==null&&!(a[on]&8192||(a[on]|=8192,!W1(a)));)a=Nf(a)}function GC(s,a){if((s[on]&256)===256)throw new qt(911,!1);s[_l]===null&&(s[_l]=[]),s[_l].push(a)}function KN(s,a){if(s[_l]===null)return;let f=s[_l].indexOf(a);f!==-1&&s[_l].splice(f,1)}function Nf(s){let a=s[_i];return Ca(a)?a[_i]:a}var Cn={lFrame:KC(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function QN(){return Cn.lFrame.elementDepthCount}function e3(){Cn.lFrame.elementDepthCount++}function t3(){Cn.lFrame.elementDepthCount--}function HC(){return Cn.bindingsEnabled}function n3(){return Cn.skipHydrationRootTNode!==null}function r3(s){return Cn.skipHydrationRootTNode===s}function i3(){Cn.skipHydrationRootTNode=null}function mr(){return Cn.lFrame.lView}function Aa(){return Cn.lFrame.tView}function j_(s){return Cn.lFrame.contextLView=s,s[Ko]}function V_(s){return Cn.lFrame.contextLView=null,s}function Do(){let s=qC();for(;s!==null&&s.type===64;)s=s.parent;return s}function qC(){return Cn.lFrame.currentTNode}function o3(){let s=Cn.lFrame,a=s.currentTNode;return s.isParent?a:a.parent}function Hf(s,a){let f=Cn.lFrame;f.currentTNode=s,f.isParent=a}function WC(){return Cn.lFrame.isParent}function s3(){Cn.lFrame.isParent=!1}function ZC(){let s=Cn.lFrame,a=s.bindingRootIndex;return a===-1&&(a=s.bindingRootIndex=s.tView.bindingStartIndex),a}function a3(s){return Cn.lFrame.bindingIndex=s}function X1(){return Cn.lFrame.bindingIndex++}function l3(){return Cn.lFrame.inI18n}function c3(s,a){let f=Cn.lFrame;f.bindingIndex=f.bindingRootIndex=s,l1(a)}function u3(){return Cn.lFrame.currentDirectiveIndex}function l1(s){Cn.lFrame.currentDirectiveIndex=s}function XC(s){Cn.lFrame.currentQueryIndex=s}function h3(s){let a=s[Sn];return a.type===2?a.declTNode:a.type===1?s[ns]:null}function YC(s,a,f){if(f&wn.SkipSelf){let _=a,r=s;for(;_=_.parent,_===null&&!(f&wn.Host);)if(_=h3(r),_===null||(r=r[_h],_.type&10))break;if(_===null)return!1;a=_,s=r}let d=Cn.lFrame=JC();return d.currentTNode=a,d.lView=s,!0}function Y1(s){let a=JC(),f=s[Sn];Cn.lFrame=a,a.currentTNode=f.firstChild,a.lView=s,a.tView=f,a.contextLView=s,a.bindingIndex=f.bindingStartIndex,a.inI18n=!1}function JC(){let s=Cn.lFrame,a=s===null?null:s.child;return a===null?KC(s):a}function KC(s){let a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=a),a}function QC(){let s=Cn.lFrame;return Cn.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var eA=QC;function J1(){let s=QC();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function d3(s){return(Cn.lFrame.contextLView=JN(s,Cn.lFrame.contextLView))[Ko]}function K1(){return Cn.lFrame.selectedIndex}function Mc(s){Cn.lFrame.selectedIndex=s}function tA(){let s=Cn.lFrame;return UC(s.tView,s.selectedIndex)}function f3(){return Cn.lFrame.currentNamespace}var nA=!0;function Q1(){return nA}function eb(s){nA=s}function p3(s,a,f){let{ngOnChanges:d,ngOnInit:_,ngDoCheck:r}=a.type.prototype;if(d){let M=BC(a);(f.preOrderHooks??=[]).push(s,M),(f.preOrderCheckHooks??=[]).push(s,M)}_&&(f.preOrderHooks??=[]).push(0-s,_),r&&((f.preOrderHooks??=[]).push(s,r),(f.preOrderCheckHooks??=[]).push(s,r))}function tb(s,a){for(let f=a.directiveStart,d=a.directiveEnd;f<d;f++){let r=s.data[f].type.prototype,{ngAfterContentInit:M,ngAfterContentChecked:L,ngAfterViewInit:B,ngAfterViewChecked:X,ngOnDestroy:se}=r;M&&(s.contentHooks??=[]).push(-f,M),L&&((s.contentHooks??=[]).push(f,L),(s.contentCheckHooks??=[]).push(f,L)),B&&(s.viewHooks??=[]).push(-f,B),X&&((s.viewHooks??=[]).push(f,X),(s.viewCheckHooks??=[]).push(f,X)),se!=null&&(s.destroyHooks??=[]).push(f,se)}}function l_(s,a,f){rA(s,a,3,f)}function c_(s,a,f,d){(s[on]&3)===f&&rA(s,a,f,d)}function Gx(s,a){let f=s[on];(f&3)===a&&(f&=16383,f+=1,s[on]=f)}function rA(s,a,f,d){let _=d!==void 0?s[uh]&65535:0,r=d??-1,M=a.length-1,L=0;for(let B=_;B<M;B++)if(typeof a[B+1]=="number"){if(L=a[B],d!=null&&L>=d)break}else a[B]<0&&(s[uh]+=65536),(L<r||r==-1)&&(m3(s,f,a,B),s[uh]=(s[uh]&4294901760)+B+2),B++}function BS(s,a){Rs(4,s,a);let f=Ln(null);try{a.call(s)}finally{Ln(f),Rs(5,s,a)}}function m3(s,a,f,d){let _=f[d]<0,r=f[d+1],M=_?-f[d]:f[d],L=s[M];_?s[on]>>14<s[uh]>>16&&(s[on]&3)===a&&(s[on]+=16384,BS(L,r)):BS(L,r)}var fh=-1,zf=class{constructor(a,f,d){this.factory=a,this.resolving=!1,this.canSeeViewProviders=f,this.injectImpl=d}};function g3(s){return s instanceof zf}function _3(s){return(s.flags&8)!==0}function y3(s){return(s.flags&16)!==0}function iA(s){return s!==fh}function x_(s){return s&32767}function v3(s){return s>>16}function b_(s,a){let f=v3(s),d=a;for(;f>0;)d=d[_h],f--;return d}var c1=!0;function w_(s){let a=c1;return c1=s,a}var x3=256,oA=x3-1,sA=5,b3=0,Ps={};function w3(s,a,f){let d;typeof f=="string"?d=f.charCodeAt(0)||0:f.hasOwnProperty(Af)&&(d=f[Af]),d==null&&(d=f[Af]=b3++);let _=d&oA,r=1<<_;a.data[s+(_>>sA)]|=r}function aA(s,a){let f=lA(s,a);if(f!==-1)return f;let d=a[Sn];d.firstCreatePass&&(s.injectorIndex=a.length,Hx(d.data,s),Hx(a,null),Hx(d.blueprint,null));let _=nb(s,a),r=s.injectorIndex;if(iA(_)){let M=x_(_),L=b_(_,a),B=L[Sn].data;for(let X=0;X<8;X++)a[r+X]=L[M+X]|B[M+X]}return a[r+8]=_,r}function Hx(s,a){s.push(0,0,0,0,0,0,0,0,a)}function lA(s,a){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||a[s.injectorIndex+8]===null?-1:s.injectorIndex}function nb(s,a){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let f=0,d=null,_=a;for(;_!==null;){if(d=fA(_),d===null)return fh;if(f++,_=_[_h],d.injectorIndex!==-1)return d.injectorIndex|f<<16}return fh}function E3(s,a,f){w3(s,a,f)}function T3(s,a){if(a==="class")return s.classes;if(a==="style")return s.styles;let f=s.attrs;if(f){let d=f.length,_=0;for(;_<d;){let r=f[_];if(wC(r))break;if(r===0)_=_+2;else if(typeof r=="number")for(_++;_<d&&typeof f[_]=="string";)_++;else{if(r===a)return f[_+1];_=_+2}}}return null}function cA(s,a,f){if(f&wn.Optional||s!==void 0)return s;L1(a,"NodeInjector")}function uA(s,a,f,d){if(f&wn.Optional&&d===void 0&&(d=null),!(f&(wn.Self|wn.Host))){let _=s[mh],r=Bi(void 0);try{return _?_.get(a,d,f&wn.Optional):gC(a,d,f&wn.Optional)}finally{Bi(r)}}return cA(d,a,f)}function hA(s,a,f,d=wn.Default,_){if(s!==null){if(a[on]&2048&&!(d&wn.Self)){let M=C3(s,a,f,d,Ps);if(M!==Ps)return M}let r=dA(s,a,f,d,Ps);if(r!==Ps)return r}return uA(a,f,d,_)}function dA(s,a,f,d,_){let r=M3(f);if(typeof r=="function"){if(!YC(a,s,d))return d&wn.Host?cA(_,f,d):uA(a,f,d,_);try{let M;if(M=r(d),M==null&&!(d&wn.Optional))L1(f);else return M}finally{eA()}}else if(typeof r=="number"){let M=null,L=lA(s,a),B=fh,X=d&wn.Host?a[ks][ns]:null;for((L===-1||d&wn.SkipSelf)&&(B=L===-1?nb(s,a):a[L+8],B===fh||!VS(d,!1)?L=-1:(M=a[Sn],L=x_(B),a=b_(B,a)));L!==-1;){let se=a[Sn];if(jS(r,L,se.data)){let ge=I3(L,a,f,M,d,X);if(ge!==Ps)return ge}B=a[L+8],B!==fh&&VS(d,a[Sn].data[L+8]===X)&&jS(r,L,a)?(M=se,L=x_(B),a=b_(B,a)):L=-1}}return _}function I3(s,a,f,d,_,r){let M=a[Sn],L=M.data[s+8],B=d==null?B_(L)&&c1:d!=M&&(L.type&3)!==0,X=_&wn.Host&&r===L,se=D3(L,M,f,B,X);return se!==null?Bf(a,M,se,L):Ps}function D3(s,a,f,d,_){let r=s.providerIndexes,M=a.data,L=r&1048575,B=s.directiveStart,X=s.directiveEnd,se=r>>20,ge=d?L:L+se,Oe=_?L+se:X;for(let at=ge;at<Oe;at++){let Dt=M[at];if(at<B&&f===Dt||at>=B&&Dt.type===f)return at}if(_){let at=M[B];if(at&&$f(at)&&at.type===f)return B}return null}function Bf(s,a,f,d){let _=s[f],r=a.data;if(g3(_)){let M=_;M.resolving&&nN(tN(r[f]));let L=w_(M.canSeeViewProviders);M.resolving=!0;let B,X=M.injectImpl?Bi(M.injectImpl):null,se=YC(s,d,wn.Default);try{_=s[f]=M.factory(void 0,r,s,d),a.firstCreatePass&&f>=d.directiveStart&&p3(f,r[f],a)}finally{X!==null&&Bi(X),w_(L),M.resolving=!1,eA()}}return _}function M3(s){if(typeof s=="string")return s.charCodeAt(0)||0;let a=s.hasOwnProperty(Af)?s[Af]:void 0;return typeof a=="number"?a>=0?a&oA:S3:a}function jS(s,a,f){let d=1<<s;return!!(f[a+(s>>sA)]&d)}function VS(s,a){return!(s&wn.Self)&&!(s&wn.Host&&a)}var wc=class{constructor(a,f){this._tNode=a,this._lView=f}get(a,f,d){return hA(this._tNode,this._lView,a,L_(d),f)}};function S3(){return new wc(Do(),mr())}function qf(s){return P_(()=>{let a=s.prototype.constructor,f=a[d_]||u1(a),d=Object.prototype,_=Object.getPrototypeOf(s.prototype).constructor;for(;_&&_!==d;){let r=_[d_]||u1(_);if(r&&r!==f)return r;_=Object.getPrototypeOf(_)}return r=>new r})}function u1(s){return uC(s)?()=>{let a=u1(wo(s));return a&&a()}:Ec(s)}function C3(s,a,f,d,_){let r=s,M=a;for(;r!==null&&M!==null&&M[on]&2048&&!(M[on]&512);){let L=dA(r,M,f,d|wn.Self,Ps);if(L!==Ps)return L;let B=r.parent;if(!B){let X=M[LC];if(X){let se=X.get(f,Ps,d);if(se!==Ps)return se}B=fA(M),M=M[_h]}r=B}return _}function fA(s){let a=s[Sn],f=a.type;return f===2?a.declTNode:f===1?s[ns]:null}function rb(s){return T3(Do(),s)}function US(s,a=null,f=null,d){let _=pA(s,a,f,d);return _.resolveInjectorInitializers(),_}function pA(s,a=null,f=null,d,_=new Set){let r=[f||ph,MN(s)];return d=d||(typeof s=="object"?void 0:ji(s)),new Of(r,a||G1(),d||null,_)}var yh=(()=>{let a=class a{static create(d,_){if(Array.isArray(d))return US({name:""},_,d,"");{let r=d.name??"";return US({name:r},d.parent,d.providers,r)}}};a.THROW_IF_NOT_FOUND=Rf,a.NULL=new m_,a.\u0275prov=Ot({token:a,providedIn:"any",factory:()=>Rt(vC)}),a.__NG_ELEMENT_ID__=-1;let s=a;return s})();var A3="ngOriginalError";function qx(s){return s[A3]}var es=class{constructor(){this._console=console}handleError(a){let f=this._findOriginalError(a);this._console.error("ERROR",a),f&&this._console.error("ORIGINAL ERROR",f)}_findOriginalError(a){let f=a&&qx(a);for(;f&&qx(f);)f=qx(f);return f||null}},mA=new _t("",{providedIn:"root",factory:()=>nt(es).handleError.bind(void 0)}),Wf=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=R3,a.__NG_ENV_ID__=d=>d;let s=a;return s})(),h1=class extends Wf{constructor(a){super(),this._lView=a}onDestroy(a){return GC(this._lView,a),()=>KN(this._lView,a)}};function R3(){return new h1(mr())}function P3(){return U_(Do(),mr())}function U_(s,a){return new vh(Io(s,a))}var vh=(()=>{let a=class a{constructor(d){this.nativeElement=d}};a.__NG_ELEMENT_ID__=P3;let s=a;return s})();var d1=class extends wr{constructor(a=!1){super(),this.destroyRef=void 0,this.__isAsync=a,OC()&&(this.destroyRef=nt(Wf,{optional:!0})??void 0)}emit(a){let f=Ln(null);try{super.next(a)}finally{Ln(f)}}subscribe(a,f,d){let _=a,r=f||(()=>null),M=d;if(a&&typeof a=="object"){let B=a;_=B.next?.bind(B),r=B.error?.bind(B),M=B.complete?.bind(B)}this.__isAsync&&(r=Wx(r),_&&(_=Wx(_)),M&&(M=Wx(M)));let L=super.subscribe({next:_,error:r,complete:M});return a instanceof Ar&&a.add(L),L}};function Wx(s){return a=>{setTimeout(s,void 0,a)}}var Xo=d1;function gA(s){return(s.flags&128)===128}var f1;function _A(s){f1=s}function O3(){if(f1!==void 0)return f1;if(typeof document<"u")return document;throw new qt(210,!1)}var ib=new _t("",{providedIn:"root",factory:()=>k3}),k3="ng",ob=new _t(""),xl=new _t("",{providedIn:"platform",factory:()=>"unknown"});var sb=new _t("",{providedIn:"root",factory:()=>O3().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var L3="h",F3="b";var N3=()=>null;function ab(s,a,f=!1){return N3(s,a,f)}var yA=!1,z3=new _t("",{providedIn:"root",factory:()=>yA});var s_;function B3(){if(s_===void 0&&(s_=null,xc.trustedTypes))try{s_=xc.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:s=>s,createScript:s=>s,createScriptURL:s=>s})}catch{}return s_}function $S(s){return B3()?.createScriptURL(s)||s}var E_=class{constructor(a){this.changingThisBreaksApplicationSecurity=a}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${lC})`}};function $_(s){return s instanceof E_?s.changingThisBreaksApplicationSecurity:s}function lb(s,a){let f=j3(s);if(f!=null&&f!==a){if(f==="ResourceURL"&&a==="URL")return!0;throw new Error(`Required a safe ${a}, got a ${f} (see ${lC})`)}return f===a}function j3(s){return s instanceof E_&&s.getTypeName()||null}var V3=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function vA(s){return s=String(s),s.match(V3)?s:"unsafe:"+s}var G_=function(s){return s[s.NONE=0]="NONE",s[s.HTML=1]="HTML",s[s.STYLE=2]="STYLE",s[s.SCRIPT=3]="SCRIPT",s[s.URL=4]="URL",s[s.RESOURCE_URL=5]="RESOURCE_URL",s}(G_||{});function U3(s){let a=bA();return a?a.sanitize(G_.URL,s)||"":lb(s,"URL")?$_(s):vA(k_(s))}function $3(s){let a=bA();if(a)return $S(a.sanitize(G_.RESOURCE_URL,s)||"");if(lb(s,"ResourceURL"))return $S($_(s));throw new qt(904,!1)}function G3(s,a){return a==="src"&&(s==="embed"||s==="frame"||s==="iframe"||s==="media"||s==="script")||a==="href"&&(s==="base"||s==="link")?$3:U3}function xA(s,a,f){return G3(a,f)(s)}function bA(){let s=mr();return s&&s[Qo].sanitizer}var wA=new Map,H3=0;function q3(){return H3++}function W3(s){wA.set(s[z_],s)}function Z3(s){wA.delete(s[z_])}var GS="__ngContext__";function Sc(s,a){bc(a)?(s[GS]=a[z_],W3(a)):s[GS]=a}function EA(s){return s instanceof Function?s():s}var Rc=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(Rc||{}),X3;function cb(s,a){return X3(s,a)}function hh(s,a,f,d,_){if(d!=null){let r,M=!1;Ca(d)?r=d:bc(d)&&(M=!0,d=d[Sa]);let L=Fs(d);s===0&&f!==null?_==null?SA(a,f,L):T_(a,f,L,_||null,!0):s===1&&f!==null?T_(a,f,L,_||null,!0):s===2?dz(a,L,M):s===3&&a.destroyNode(L),r!=null&&pz(a,s,r,f,_)}}function Y3(s,a){return s.createText(a)}function J3(s,a,f){s.setValue(a,f)}function TA(s,a,f){return s.createElement(a,f)}function K3(s,a){IA(s,a),a[Sa]=null,a[ns]=null}function Q3(s,a,f,d,_,r){d[Sa]=_,d[ns]=a,H_(s,d,f,1,_,r)}function IA(s,a){a[Qo].changeDetectionScheduler?.notify(1),H_(s,a,a[yi],2,null,null)}function ez(s){let a=s[Lf];if(!a)return Zx(s[Sn],s);for(;a;){let f=null;if(bc(a))f=a[Lf];else{let d=a[Eo];d&&(f=d)}if(!f){for(;a&&!a[Yo]&&a!==s;)bc(a)&&Zx(a[Sn],a),a=a[_i];a===null&&(a=s),bc(a)&&Zx(a[Sn],a),f=a&&a[Yo]}a=f}}function tz(s,a,f,d){let _=Eo+d,r=f.length;d>0&&(f[_-1][Yo]=a),d<r-Eo?(a[Yo]=f[_],yC(f,Eo+d,a)):(f.push(a),a[Yo]=null),a[_i]=f;let M=a[N_];M!==null&&f!==M&&nz(M,a);let L=a[gh];L!==null&&L.insertView(s),a1(a),a[on]|=128}function nz(s,a){let f=s[y_],_=a[_i][_i][ks];a[ks]!==_&&(s[on]|=H1.HasTransplantedViews),f===null?s[y_]=[a]:f.push(a)}function DA(s,a){let f=s[y_],d=f.indexOf(a);f.splice(d,1)}function p1(s,a){if(s.length<=Eo)return;let f=Eo+a,d=s[f];if(d){let _=d[N_];_!==null&&_!==s&&DA(_,d),a>0&&(s[f-1][Yo]=d[Yo]);let r=p_(s,Eo+a);K3(d[Sn],d);let M=r[gh];M!==null&&M.detachView(r[Sn]),d[_i]=null,d[Yo]=null,d[on]&=-129}return d}function MA(s,a){if(!(a[on]&256)){let f=a[yi];f.destroyNode&&H_(s,a,f,3,null,null),ez(a)}}function Zx(s,a){if(a[on]&256)return;let f=Ln(null);try{a[on]&=-129,a[on]|=256,a[Ic]&&GM(a[Ic]),iz(s,a),rz(s,a),a[Sn].type===1&&a[yi].destroy();let d=a[N_];if(d!==null&&Ca(a[_i])){d!==a[_i]&&DA(d,a);let _=a[gh];_!==null&&_.detachView(s)}Z3(a)}finally{Ln(f)}}function rz(s,a){let f=s.cleanup,d=a[kf];if(f!==null)for(let r=0;r<f.length-1;r+=2)if(typeof f[r]=="string"){let M=f[r+3];M>=0?d[M]():d[-M].unsubscribe(),r+=2}else{let M=d[f[r+1]];f[r].call(M)}d!==null&&(a[kf]=null);let _=a[_l];if(_!==null){a[_l]=null;for(let r=0;r<_.length;r++){let M=_[r];M()}}}function iz(s,a){let f;if(s!=null&&(f=s.destroyHooks)!=null)for(let d=0;d<f.length;d+=2){let _=a[f[d]];if(!(_ instanceof zf)){let r=f[d+1];if(Array.isArray(r))for(let M=0;M<r.length;M+=2){let L=_[r[M]],B=r[M+1];Rs(4,L,B);try{B.call(L)}finally{Rs(5,L,B)}}else{Rs(4,_,r);try{r.call(_)}finally{Rs(5,_,r)}}}}}function oz(s,a,f){return sz(s,a.parent,f)}function sz(s,a,f){let d=a;for(;d!==null&&d.type&40;)a=d,d=a.parent;if(d===null)return f[Sa];{let{componentOffset:_}=d;if(_>-1){let{encapsulation:r}=s.data[d.directiveStart+_];if(r===Os.None||r===Os.Emulated)return null}return Io(d,f)}}function T_(s,a,f,d,_){s.insertBefore(a,f,d,_)}function SA(s,a,f){s.appendChild(a,f)}function HS(s,a,f,d,_){d!==null?T_(s,a,f,d,_):SA(s,a,f)}function az(s,a,f,d){s.removeChild(a,f,d)}function ub(s,a){return s.parentNode(a)}function lz(s,a){return s.nextSibling(a)}function cz(s,a,f){return hz(s,a,f)}function uz(s,a,f){return s.type&40?Io(s,f):null}var hz=uz,qS;function hb(s,a,f,d){let _=oz(s,d,a),r=a[yi],M=d.parent||a[ns],L=cz(M,d,a);if(_!=null)if(Array.isArray(f))for(let B=0;B<f.length;B++)HS(r,_,f[B],L,!1);else HS(r,_,f,L,!1);qS!==void 0&&qS(r,d,a,f,_)}function u_(s,a){if(a!==null){let f=a.type;if(f&3)return Io(a,s);if(f&4)return m1(-1,s[a.index]);if(f&8){let d=a.child;if(d!==null)return u_(s,d);{let _=s[a.index];return Ca(_)?m1(-1,_):Fs(_)}}else{if(f&32)return cb(a,s)()||Fs(s[a.index]);{let d=CA(s,a);if(d!==null){if(Array.isArray(d))return d[0];let _=Nf(s[ks]);return u_(_,d)}else return u_(s,a.next)}}}return null}function CA(s,a){if(a!==null){let d=s[ks][ns],_=a.projection;return d.projection[_]}return null}function m1(s,a){let f=Eo+s+1;if(f<a.length){let d=a[f],_=d[Sn].firstChild;if(_!==null)return u_(d,_)}return a[Dc]}function dz(s,a,f){let d=ub(s,a);d&&az(s,d,a,f)}function db(s,a,f,d,_,r,M){for(;f!=null;){let L=d[f.index],B=f.type;if(M&&a===0&&(L&&Sc(Fs(L),d),f.flags|=2),(f.flags&32)!==32)if(B&8)db(s,a,f.child,d,_,r,!1),hh(a,s,_,L,r);else if(B&32){let X=cb(f,d),se;for(;se=X();)hh(a,s,_,se,r);hh(a,s,_,L,r)}else B&16?fz(s,a,d,f,_,r):hh(a,s,_,L,r);f=M?f.projectionNext:f.next}}function H_(s,a,f,d,_,r){db(f,d,s.firstChild,a,_,r,!1)}function fz(s,a,f,d,_,r){let M=f[ks],B=M[ns].projection[d.projection];if(Array.isArray(B))for(let X=0;X<B.length;X++){let se=B[X];hh(a,s,_,se,r)}else{let X=B,se=M[_i];gA(d)&&(X.flags|=128),db(s,a,X,se,_,r,!0)}}function pz(s,a,f,d,_){let r=f[Dc],M=Fs(f);r!==M&&hh(a,s,d,r,_);for(let L=Eo;L<f.length;L++){let B=f[L];H_(B[Sn],B,s,a,d,r)}}function mz(s,a,f){s.setAttribute(a,"style",f)}function AA(s,a,f){f===""?s.removeAttribute(a,"class"):s.setAttribute(a,"class",f)}function RA(s,a,f){let{mergedAttrs:d,classes:_,styles:r}=f;d!==null&&t1(s,a,d),_!==null&&AA(s,a,_),r!==null&&mz(s,a,r)}var Zf={};function rs(s=1){PA(Aa(),mr(),K1()+s,!1)}function PA(s,a,f,d){if(!d)if((a[on]&3)===3){let r=s.preOrderCheckHooks;r!==null&&l_(a,r,f)}else{let r=s.preOrderHooks;r!==null&&c_(a,r,0,f)}Mc(f)}function br(s,a=wn.Default){let f=mr();if(f===null)return Rt(s,a);let d=Do();return hA(d,f,wo(s),a)}function OA(s,a,f,d,_,r){let M=Ln(null);try{let L=null;_&To.SignalBased&&(L=a[d][ul]),L!==null&&L.transformFn!==void 0&&(r=L.transformFn(r)),_&To.HasDecoratorInputTransform&&(r=s.inputTransforms[d].call(a,r)),s.setInput!==null?s.setInput(a,L,r,f,d):zC(a,L,d,r)}finally{Ln(M)}}function gz(s,a){let f=s.hostBindingOpCodes;if(f!==null)try{for(let d=0;d<f.length;d++){let _=f[d];if(_<0)Mc(~_);else{let r=_,M=f[++d],L=f[++d];c3(M,r);let B=a[r];L(2,B)}}}finally{Mc(-1)}}function q_(s,a,f,d,_,r,M,L,B,X,se){let ge=a.blueprint.slice();return ge[Sa]=_,ge[on]=d|4|128|8|64,(X!==null||s&&s[on]&2048)&&(ge[on]|=2048),$C(ge),ge[_i]=ge[_h]=s,ge[Ko]=f,ge[Qo]=M||s&&s[Qo],ge[yi]=L||s&&s[yi],ge[mh]=B||s&&s[mh]||null,ge[ns]=r,ge[z_]=q3(),ge[g_]=se,ge[LC]=X,ge[ks]=a.type==2?s[ks]:ge,ge}function W_(s,a,f,d,_){let r=s.data[a];if(r===null)r=_z(s,a,f,d,_),l3()&&(r.flags|=32);else if(r.type&64){r.type=f,r.value=d,r.attrs=_;let M=o3();r.injectorIndex=M===null?-1:M.injectorIndex}return Hf(r,!0),r}function _z(s,a,f,d,_){let r=qC(),M=WC(),L=M?r:r&&r.parent,B=s.data[a]=wz(s,L,f,a,d,_);return s.firstChild===null&&(s.firstChild=B),r!==null&&(M?r.child==null&&B.parent!==null&&(r.child=B):r.next===null&&(r.next=B,B.prev=r)),B}function kA(s,a,f,d){if(f===0)return-1;let _=a.length;for(let r=0;r<f;r++)a.push(d),s.blueprint.push(d),s.data.push(null);return _}function LA(s,a,f,d,_){let r=K1(),M=d&2;try{Mc(-1),M&&a.length>Ls&&PA(s,a,Ls,!1),Rs(M?2:0,_),f(d,_)}finally{Mc(r),Rs(M?3:1,_)}}function FA(s,a,f){if(NC(a)){let d=Ln(null);try{let _=a.directiveStart,r=a.directiveEnd;for(let M=_;M<r;M++){let L=s.data[M];if(L.contentQueries){let B=f[M];L.contentQueries(1,B,M)}}}finally{Ln(d)}}}function NA(s,a,f){HC()&&(Cz(s,a,f,Io(f,a)),(f.flags&64)===64&&UA(s,a,f))}function zA(s,a,f=Io){let d=a.localNames;if(d!==null){let _=a.index+1;for(let r=0;r<d.length;r+=2){let M=d[r+1],L=M===-1?f(a,s):s[M];s[_++]=L}}}function BA(s){let a=s.tView;return a===null||a.incompleteFirstPass?s.tView=fb(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):a}function fb(s,a,f,d,_,r,M,L,B,X,se){let ge=Ls+d,Oe=ge+_,at=yz(ge,Oe),Dt=typeof X=="function"?X():X;return at[Sn]={type:s,blueprint:at,template:f,queries:null,viewQuery:L,declTNode:a,data:at.slice().fill(null,ge),bindingStartIndex:ge,expandoStartIndex:Oe,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof r=="function"?r():r,pipeRegistry:typeof M=="function"?M():M,firstChild:null,schemas:B,consts:Dt,incompleteFirstPass:!1,ssrId:se}}function yz(s,a){let f=[];for(let d=0;d<a;d++)f.push(d<s?null:Zf);return f}function vz(s,a,f,d){let r=d.get(z3,yA)||f===Os.ShadowDom,M=s.selectRootElement(a,r);return xz(M),M}function xz(s){bz(s)}var bz=()=>null;function wz(s,a,f,d,_,r){let M=a?a.injectorIndex:-1,L=0;return n3()&&(L|=128),{type:f,index:d,insertBeforeIndex:null,injectorIndex:M,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:L,providerIndexes:0,value:_,attrs:r,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function WS(s,a,f,d,_){for(let r in a){if(!a.hasOwnProperty(r))continue;let M=a[r];if(M===void 0)continue;d??={};let L,B=To.None;Array.isArray(M)?(L=M[0],B=M[1]):L=M;let X=r;if(_!==null){if(!_.hasOwnProperty(r))continue;X=_[r]}s===0?ZS(d,f,X,L,B):ZS(d,f,X,L)}return d}function ZS(s,a,f,d,_){let r;s.hasOwnProperty(f)?(r=s[f]).push(a,d):r=s[f]=[a,d],_!==void 0&&r.push(_)}function Ez(s,a,f){let d=a.directiveStart,_=a.directiveEnd,r=s.data,M=a.attrs,L=[],B=null,X=null;for(let se=d;se<_;se++){let ge=r[se],Oe=f?f.get(ge):null,at=Oe?Oe.inputs:null,Dt=Oe?Oe.outputs:null;B=WS(0,ge.inputs,se,B,at),X=WS(1,ge.outputs,se,X,Dt);let Vt=B!==null&&M!==null&&!V1(a)?jz(B,se,M):null;L.push(Vt)}B!==null&&(B.hasOwnProperty("class")&&(a.flags|=8),B.hasOwnProperty("style")&&(a.flags|=16)),a.initialInputs=L,a.inputs=B,a.outputs=X}function Tz(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function Iz(s,a,f,d,_,r,M,L){let B=Io(a,f),X=a.inputs,se;!L&&X!=null&&(se=X[d])?(pb(s,f,se,d,_),B_(a)&&Dz(f,a.index)):a.type&3?(d=Tz(d),_=M!=null?M(_,a.value||"",d):_,r.setProperty(B,d,_)):a.type&12}function Dz(s,a){let f=vl(a,s);f[on]&16||(f[on]|=64)}function jA(s,a,f,d){if(HC()){let _=d===null?null:{"":-1},r=Rz(s,f),M,L;r===null?M=L=null:[M,L]=r,M!==null&&VA(s,a,f,M,_,L),_&&Pz(f,d,_)}f.mergedAttrs=j1(f.mergedAttrs,f.attrs)}function VA(s,a,f,d,_,r){for(let X=0;X<d.length;X++)E3(aA(f,a),s,d[X].type);kz(f,s.data.length,d.length);for(let X=0;X<d.length;X++){let se=d[X];se.providersResolver&&se.providersResolver(se)}let M=!1,L=!1,B=kA(s,a,d.length,null);for(let X=0;X<d.length;X++){let se=d[X];f.mergedAttrs=j1(f.mergedAttrs,se.hostAttrs),Lz(s,f,a,B,se),Oz(B,se,_),se.contentQueries!==null&&(f.flags|=4),(se.hostBindings!==null||se.hostAttrs!==null||se.hostVars!==0)&&(f.flags|=64);let ge=se.type.prototype;!M&&(ge.ngOnChanges||ge.ngOnInit||ge.ngDoCheck)&&((s.preOrderHooks??=[]).push(f.index),M=!0),!L&&(ge.ngOnChanges||ge.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(f.index),L=!0),B++}Ez(s,f,r)}function Mz(s,a,f,d,_){let r=_.hostBindings;if(r){let M=s.hostBindingOpCodes;M===null&&(M=s.hostBindingOpCodes=[]);let L=~a.index;Sz(M)!=L&&M.push(L),M.push(f,d,r)}}function Sz(s){let a=s.length;for(;a>0;){let f=s[--a];if(typeof f=="number"&&f<0)return f}return 0}function Cz(s,a,f,d){let _=f.directiveStart,r=f.directiveEnd;B_(f)&&Fz(a,f,s.data[_+f.componentOffset]),s.firstCreatePass||aA(f,a),Sc(d,a);let M=f.initialInputs;for(let L=_;L<r;L++){let B=s.data[L],X=Bf(a,s,L,f);if(Sc(X,a),M!==null&&Bz(a,L-_,X,B,f,M),$f(B)){let se=vl(f.index,a);se[Ko]=Bf(a,s,L,f)}}}function UA(s,a,f){let d=f.directiveStart,_=f.directiveEnd,r=f.index,M=u3();try{Mc(r);for(let L=d;L<_;L++){let B=s.data[L],X=a[L];l1(L),(B.hostBindings!==null||B.hostVars!==0||B.hostAttrs!==null)&&Az(B,X)}}finally{Mc(-1),l1(M)}}function Az(s,a){s.hostBindings!==null&&s.hostBindings(1,a)}function Rz(s,a){let f=s.directiveRegistry,d=null,_=null;if(f)for(let r=0;r<f.length;r++){let M=f[r];if(yN(a,M.selectors,!1))if(d||(d=[]),$f(M))if(M.findHostDirectiveDefs!==null){let L=[];_=_||new Map,M.findHostDirectiveDefs(M,L,_),d.unshift(...L,M);let B=L.length;g1(s,a,B)}else d.unshift(M),g1(s,a,0);else _=_||new Map,M.findHostDirectiveDefs?.(M,d,_),d.push(M)}return d===null?null:[d,_]}function g1(s,a,f){a.componentOffset=f,(s.components??=[]).push(a.index)}function Pz(s,a,f){if(a){let d=s.localNames=[];for(let _=0;_<a.length;_+=2){let r=f[a[_+1]];if(r==null)throw new qt(-301,!1);d.push(a[_],r)}}}function Oz(s,a,f){if(f){if(a.exportAs)for(let d=0;d<a.exportAs.length;d++)f[a.exportAs[d]]=s;$f(a)&&(f[""]=s)}}function kz(s,a,f){s.flags|=1,s.directiveStart=a,s.directiveEnd=a+f,s.providerIndexes=a}function Lz(s,a,f,d,_){s.data[d]=_;let r=_.factory||(_.factory=Ec(_.type,!0)),M=new zf(r,$f(_),br);s.blueprint[d]=M,f[d]=M,Mz(s,a,d,kA(s,f,_.hostVars,Zf),_)}function Fz(s,a,f){let d=Io(a,s),_=BA(f),r=s[Qo].rendererFactory,M=16;f.signals?M=4096:f.onPush&&(M=64);let L=Z_(s,q_(s,_,null,M,d,a,null,r.createRenderer(d,f),null,null,null));s[a.index]=L}function Nz(s,a,f,d,_,r){let M=Io(s,a);zz(a[yi],M,r,s.value,f,d,_)}function zz(s,a,f,d,_,r,M){if(r==null)s.removeAttribute(a,_,f);else{let L=M==null?k_(r):M(r,d||"",_);s.setAttribute(a,_,L,f)}}function Bz(s,a,f,d,_,r){let M=r[a];if(M!==null)for(let L=0;L<M.length;){let B=M[L++],X=M[L++],se=M[L++],ge=M[L++];OA(d,f,B,X,se,ge)}}function jz(s,a,f){let d=null,_=0;for(;_<f.length;){let r=f[_];if(r===0){_+=4;continue}else if(r===5){_+=2;continue}if(typeof r=="number")break;if(s.hasOwnProperty(r)){d===null&&(d=[]);let M=s[r];for(let L=0;L<M.length;L+=3)if(M[L]===a){d.push(r,M[L+1],M[L+2],f[_+1]);break}}_+=2}return d}function $A(s,a,f,d){return[s,!0,0,a,null,d,null,f,null,null]}function GA(s,a){let f=s.contentQueries;if(f!==null){let d=Ln(null);try{for(let _=0;_<f.length;_+=2){let r=f[_],M=f[_+1];if(M!==-1){let L=s.data[M];XC(r),L.contentQueries(2,a[M],M)}}}finally{Ln(d)}}}function Z_(s,a){return s[Lf]?s[NS][Yo]=a:s[Lf]=a,s[NS]=a,a}function _1(s,a,f){XC(0);let d=Ln(null);try{a(s,f)}finally{Ln(d)}}function Vz(s){return s[kf]||(s[kf]=[])}function Uz(s){return s.cleanup||(s.cleanup=[])}function HA(s,a){let f=s[mh],d=f?f.get(es,null):null;d&&d.handleError(a)}function pb(s,a,f,d,_){for(let r=0;r<f.length;){let M=f[r++],L=f[r++],B=f[r++],X=a[M],se=s.data[M];OA(se,X,d,L,B,_)}}function $z(s,a,f){let d=WN(a,s);J3(s[yi],d,f)}function Gz(s,a){let f=vl(a,s),d=f[Sn];Hz(d,f);let _=f[Sa];_!==null&&f[g_]===null&&(f[g_]=ab(_,f[mh])),mb(d,f,f[Ko])}function Hz(s,a){for(let f=a.length;f<s.blueprint.length;f++)a.push(s.blueprint[f])}function mb(s,a,f){Y1(a);try{let d=s.viewQuery;d!==null&&_1(1,d,f);let _=s.template;_!==null&&LA(s,a,_,1,f),s.firstCreatePass&&(s.firstCreatePass=!1),a[gh]?.finishViewCreation(s),s.staticContentQueries&&GA(s,a),s.staticViewQueries&&_1(2,s.viewQuery,f);let r=s.components;r!==null&&qz(a,r)}catch(d){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),d}finally{a[on]&=-5,J1()}}function qz(s,a){for(let f=0;f<a.length;f++)Gz(s,a[f])}function Wz(s,a,f,d){let _=Ln(null);try{let r=a.tView,L=s[on]&4096?4096:16,B=q_(s,r,f,L,null,a,null,null,null,d?.injector??null,d?.dehydratedView??null),X=s[a.index];B[N_]=X;let se=s[gh];return se!==null&&(B[gh]=se.createEmbeddedView(r)),mb(r,B,f),B}finally{Ln(_)}}function XS(s,a){return!a||a.firstChild===null||gA(s)}function Zz(s,a,f,d=!0){let _=a[Sn];if(tz(_,a,s,f),d){let M=m1(f,s),L=a[yi],B=ub(L,s[Dc]);B!==null&&Q3(_,s[ns],L,a,B,M)}let r=a[g_];r!==null&&r.firstChild!==null&&(r.firstChild=null)}function I_(s,a,f,d,_=!1){for(;f!==null;){let r=a[f.index];r!==null&&d.push(Fs(r)),Ca(r)&&Xz(r,d);let M=f.type;if(M&8)I_(s,a,f.child,d);else if(M&32){let L=cb(f,a),B;for(;B=L();)d.push(B)}else if(M&16){let L=CA(a,f);if(Array.isArray(L))d.push(...L);else{let B=Nf(a[ks]);I_(B[Sn],B,L,d,!0)}}f=_?f.projectionNext:f.next}return d}function Xz(s,a){for(let f=Eo;f<s.length;f++){let d=s[f],_=d[Sn].firstChild;_!==null&&I_(d[Sn],d,_,a)}s[Dc]!==s[Sa]&&a.push(s[Dc])}var qA=[];function Yz(s){return s[Ic]??Jz(s)}function Jz(s){let a=qA.pop()??Object.create(Qz);return a.lView=s,a}function Kz(s){s.lView[Ic]!==s&&(s.lView=null,qA.push(s))}var Qz=Wn(It({},Rg),{consumerIsAlwaysLive:!0,consumerMarkedDirty:s=>{Ff(s.lView)},consumerOnSignalRead(){this.lView[Ic]=this}});function WA(s){return XA(s[Lf])}function ZA(s){return XA(s[Yo])}function XA(s){for(;s!==null&&!Ca(s);)s=s[Yo];return s}var YA=100;function JA(s,a=!0,f=0){let d=s[Qo],_=d.rendererFactory,r=!1;r||_.begin?.();try{eB(s,f)}catch(M){throw a&&HA(s,M),M}finally{r||(_.end?.(),d.inlineEffectRunner?.flush())}}function eB(s,a){y1(s,a);let f=0;for(;Z1(s);){if(f===YA)throw new qt(103,!1);f++,y1(s,1)}}function tB(s,a,f,d){let _=a[on];if((_&256)===256)return;let r=!1;!r&&a[Qo].inlineEffectRunner?.flush(),Y1(a);let M=null,L=null;!r&&nB(s)&&(L=Yz(a),M=mx(L));try{$C(a),a3(s.bindingStartIndex),f!==null&&LA(s,a,f,2,d);let B=(_&3)===3;if(!r)if(B){let ge=s.preOrderCheckHooks;ge!==null&&l_(a,ge,null)}else{let ge=s.preOrderHooks;ge!==null&&c_(a,ge,0,null),Gx(a,0)}if(rB(a),KA(a,0),s.contentQueries!==null&&GA(s,a),!r)if(B){let ge=s.contentCheckHooks;ge!==null&&l_(a,ge)}else{let ge=s.contentHooks;ge!==null&&c_(a,ge,1),Gx(a,1)}gz(s,a);let X=s.components;X!==null&&e2(a,X,0);let se=s.viewQuery;if(se!==null&&_1(2,se,d),!r)if(B){let ge=s.viewCheckHooks;ge!==null&&l_(a,ge)}else{let ge=s.viewHooks;ge!==null&&c_(a,ge,2),Gx(a,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),a[$x]){for(let ge of a[$x])ge();a[$x]=null}r||(a[on]&=-73)}catch(B){throw Ff(a),B}finally{L!==null&&(gx(L,M),Kz(L)),J1()}}function nB(s){return s.type!==2}function KA(s,a){for(let f=WA(s);f!==null;f=ZA(f))for(let d=Eo;d<f.length;d++){let _=f[d];QA(_,a)}}function rB(s){for(let a=WA(s);a!==null;a=ZA(a)){if(!(a[on]&H1.HasTransplantedViews))continue;let f=a[y_];for(let d=0;d<f.length;d++){let _=f[d],r=_[_i];YN(_)}}}function iB(s,a,f){let d=vl(a,s);QA(d,f)}function QA(s,a){W1(s)&&y1(s,a)}function y1(s,a){let d=s[Sn],_=s[on],r=s[Ic],M=!!(a===0&&_&16);if(M||=!!(_&64&&a===0),M||=!!(_&1024),M||=!!(r?.dirty&&_x(r)),r&&(r.dirty=!1),s[on]&=-9217,M)tB(d,s,d.template,s[Ko]);else if(_&8192){KA(s,1);let L=d.components;L!==null&&e2(s,L,1)}}function e2(s,a,f){for(let d=0;d<a.length;d++)iB(s,a[d],f)}function gb(s){for(s[Qo].changeDetectionScheduler?.notify();s;){s[on]|=64;let a=Nf(s);if(BN(s)&&!a)return s;s=a}return null}var Cc=class{get rootNodes(){let a=this._lView,f=a[Sn];return I_(f,a,f.firstChild,[])}constructor(a,f,d=!0){this._lView=a,this._cdRefInjectingView=f,this.notifyErrorHandler=d,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[Ko]}set context(a){this._lView[Ko]=a}get destroyed(){return(this._lView[on]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let a=this._lView[_i];if(Ca(a)){let f=a[__],d=f?f.indexOf(this):-1;d>-1&&(p1(a,d),p_(f,d))}this._attachedToViewContainer=!1}MA(this._lView[Sn],this._lView)}onDestroy(a){GC(this._lView,a)}markForCheck(){gb(this._cdRefInjectingView||this._lView)}detach(){this._lView[on]&=-129}reattach(){a1(this._lView),this._lView[on]|=128}detectChanges(){this._lView[on]|=1024,JA(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new qt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,IA(this._lView[Sn],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new qt(902,!1);this._appRef=a,a1(this._lView)}},X_=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=aB;let s=a;return s})(),oB=X_,sB=class extends oB{constructor(a,f,d){super(),this._declarationLView=a,this._declarationTContainer=f,this.elementRef=d}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(a,f){return this.createEmbeddedViewImpl(a,f)}createEmbeddedViewImpl(a,f,d){let _=Wz(this._declarationLView,this._declarationTContainer,a,{injector:f,dehydratedView:d});return new Cc(_)}};function aB(){return lB(Do(),mr())}function lB(s,a){return s.type&4?new sB(a,s,U_(s,a)):null}var K7=new RegExp(`^(\\d+)*(${F3}|${L3})*(.*)`);var cB=()=>null;function YS(s,a){return cB(s,a)}var v1=class{},x1=class{},D_=class{};function uB(s){let a=Error(`No component factory found for ${ji(s)}.`);return a[hB]=s,a}var hB="ngComponent";var b1=class{resolveComponentFactory(a){throw uB(a)}},Y_=(()=>{let a=class a{};a.NULL=new b1;let s=a;return s})(),jf=class{},Xf=(()=>{let a=class a{constructor(){this.destroyNode=null}};a.__NG_ELEMENT_ID__=()=>dB();let s=a;return s})();function dB(){let s=mr(),a=Do(),f=vl(a.index,s);return(bc(f)?f:s)[yi]}var fB=(()=>{let a=class a{};a.\u0275prov=Ot({token:a,providedIn:"root",factory:()=>null});let s=a;return s})(),Xx={};var JS=new Set;function Yf(s){JS.has(s)||(JS.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}function KS(...s){}function pB(){let s=typeof xc.requestAnimationFrame=="function",a=xc[s?"requestAnimationFrame":"setTimeout"],f=xc[s?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&a&&f){let d=a[Zone.__symbol__("OriginalDelegate")];d&&(a=d);let _=f[Zone.__symbol__("OriginalDelegate")];_&&(f=_)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:f}}var xr=class s{constructor({enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:f=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Xo(!1),this.onMicrotaskEmpty=new Xo(!1),this.onStable=new Xo(!1),this.onError=new Xo(!1),typeof Zone>"u")throw new qt(908,!1);Zone.assertZonePatched();let _=this;_._nesting=0,_._outer=_._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(_._inner=_._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(_._inner=_._inner.fork(Zone.longStackTraceZoneSpec)),_.shouldCoalesceEventChangeDetection=!d&&f,_.shouldCoalesceRunChangeDetection=d,_.lastRequestAnimationFrameId=-1,_.nativeRequestAnimationFrame=pB().nativeRequestAnimationFrame,_B(_)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new qt(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new qt(909,!1)}run(a,f,d){return this._inner.run(a,f,d)}runTask(a,f,d,_){let r=this._inner,M=r.scheduleEventTask("NgZoneEvent: "+_,a,mB,KS,KS);try{return r.runTask(M,f,d)}finally{r.cancelTask(M)}}runGuarded(a,f,d){return this._inner.runGuarded(a,f,d)}runOutsideAngular(a){return this._outer.run(a)}},mB={};function _b(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function gB(s){s.isCheckStableRunning||s.lastRequestAnimationFrameId!==-1||(s.lastRequestAnimationFrameId=s.nativeRequestAnimationFrame.call(xc,()=>{s.fakeTopEventTask||(s.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{s.lastRequestAnimationFrameId=-1,w1(s),s.isCheckStableRunning=!0,_b(s),s.isCheckStableRunning=!1},void 0,()=>{},()=>{})),s.fakeTopEventTask.invoke()}),w1(s))}function _B(s){let a=()=>{gB(s)};s._inner=s._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(f,d,_,r,M,L)=>{if(yB(L))return f.invokeTask(_,r,M,L);try{return QS(s),f.invokeTask(_,r,M,L)}finally{(s.shouldCoalesceEventChangeDetection&&r.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&a(),eC(s)}},onInvoke:(f,d,_,r,M,L,B)=>{try{return QS(s),f.invoke(_,r,M,L,B)}finally{s.shouldCoalesceRunChangeDetection&&a(),eC(s)}},onHasTask:(f,d,_,r)=>{f.hasTask(_,r),d===_&&(r.change=="microTask"?(s._hasPendingMicrotasks=r.microTask,w1(s),_b(s)):r.change=="macroTask"&&(s.hasPendingMacrotasks=r.macroTask))},onHandleError:(f,d,_,r)=>(f.handleError(_,r),s.runOutsideAngular(()=>s.onError.emit(r)),!1)})}function w1(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.lastRequestAnimationFrameId!==-1?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function QS(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function eC(s){s._nesting--,_b(s)}function yB(s){return!Array.isArray(s)||s.length!==1?!1:s[0].data?.__ignore_ng_zone__===!0}var t2=(()=>{let a=class a{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){this.executeInternalCallbacks(),this.handler?.execute()}executeInternalCallbacks(){let d=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let _ of d)_()}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};a.\u0275prov=Ot({token:a,providedIn:"root",factory:()=>new a});let s=a;return s})();function E1(s,a,f){let d=f?s.styles:null,_=f?s.classes:null,r=0;if(a!==null)for(let M=0;M<a.length;M++){let L=a[M];if(typeof L=="number")r=L;else if(r==1)_=MS(_,L);else if(r==2){let B=L,X=a[++M];d=MS(d,B+": "+X+";")}}f?s.styles=d:s.stylesWithoutHost=d,f?s.classes=_:s.classesWithoutHost=_}var M_=class extends Y_{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){let f=Tc(a);return new Vf(f,this.ngModule)}};function tC(s){let a=[];for(let f in s){if(!s.hasOwnProperty(f))continue;let d=s[f];d!==void 0&&a.push({propName:Array.isArray(d)?d[0]:d,templateName:f})}return a}function vB(s){let a=s.toLowerCase();return a==="svg"?$N:a==="math"?GN:null}var T1=class{constructor(a,f){this.injector=a,this.parentInjector=f}get(a,f,d){d=L_(d);let _=this.injector.get(a,Xx,d);return _!==Xx||f===Xx?_:this.parentInjector.get(a,f,d)}},Vf=class extends D_{get inputs(){let a=this.componentDef,f=a.inputTransforms,d=tC(a.inputs);if(f!==null)for(let _ of d)f.hasOwnProperty(_.propName)&&(_.transform=f[_.propName]);return d}get outputs(){return tC(this.componentDef.outputs)}constructor(a,f){super(),this.componentDef=a,this.ngModule=f,this.componentType=a.type,this.selector=wN(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!f}create(a,f,d,_){let r=Ln(null);try{_=_||this.ngModule;let M=_ instanceof Vi?_:_?.injector;M&&this.componentDef.getStandaloneInjector!==null&&(M=this.componentDef.getStandaloneInjector(M)||M);let L=M?new T1(a,M):a,B=L.get(jf,null);if(B===null)throw new qt(407,!1);let X=L.get(fB,null),se=L.get(t2,null),ge=L.get(v1,null),Oe={rendererFactory:B,sanitizer:X,inlineEffectRunner:null,afterRenderEventManager:se,changeDetectionScheduler:ge},at=B.createRenderer(null,this.componentDef),Dt=this.componentDef.selectors[0][0]||"div",Vt=d?vz(at,d,this.componentDef.encapsulation,L):TA(at,Dt,vB(Dt)),kt=512;this.componentDef.signals?kt|=4096:this.componentDef.onPush||(kt|=16);let St=null;Vt!==null&&(St=ab(Vt,L,!0));let Fn=fb(0,null,null,1,0,null,null,null,null,null,null),zn=q_(null,Fn,null,kt,null,null,Oe,at,L,null,St);Y1(zn);let An,Pr;try{let tr=this.componentDef,Ue,js=null;tr.findHostDirectiveDefs?(Ue=[],js=new Map,tr.findHostDirectiveDefs(tr,Ue,js),Ue.push(tr)):Ue=[tr];let Vs=xB(zn,Vt),gt=bB(Vs,Vt,tr,Ue,zn,Oe,at);Pr=UC(Fn,Ls),Vt&&TB(at,tr,Vt,d),f!==void 0&&IB(Pr,this.ngContentSelectors,f),An=EB(gt,tr,Ue,js,zn,[DB]),mb(Fn,zn,null)}finally{J1()}return new I1(this.componentType,An,U_(Pr,zn),zn,Pr)}finally{Ln(r)}}},I1=class extends x1{constructor(a,f,d,_,r){super(),this.location=d,this._rootLView=_,this._tNode=r,this.previousInputValues=null,this.instance=f,this.hostView=this.changeDetectorRef=new Cc(_,void 0,!1),this.componentType=a}setInput(a,f){let d=this._tNode.inputs,_;if(d!==null&&(_=d[a])){if(this.previousInputValues??=new Map,this.previousInputValues.has(a)&&Object.is(this.previousInputValues.get(a),f))return;let r=this._rootLView;pb(r[Sn],r,_,a,f),this.previousInputValues.set(a,f);let M=vl(this._tNode.index,r);gb(M)}}get injector(){return new wc(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}};function xB(s,a){let f=s[Sn],d=Ls;return s[d]=a,W_(f,d,2,"#host",null)}function bB(s,a,f,d,_,r,M){let L=_[Sn];wB(d,s,a,M);let B=null;a!==null&&(B=ab(a,_[mh]));let X=r.rendererFactory.createRenderer(a,f),se=16;f.signals?se=4096:f.onPush&&(se=64);let ge=q_(_,BA(f),null,se,_[s.index],s,r,X,null,null,B);return L.firstCreatePass&&g1(L,s,d.length-1),Z_(_,ge),_[s.index]=ge}function wB(s,a,f,d){for(let _ of s)a.mergedAttrs=j1(a.mergedAttrs,_.hostAttrs);a.mergedAttrs!==null&&(E1(a,a.mergedAttrs,!0),f!==null&&RA(d,f,a))}function EB(s,a,f,d,_,r){let M=Do(),L=_[Sn],B=Io(M,_);VA(L,_,M,f,null,d);for(let se=0;se<f.length;se++){let ge=M.directiveStart+se,Oe=Bf(_,L,ge,M);Sc(Oe,_)}UA(L,_,M),B&&Sc(B,_);let X=Bf(_,L,M.directiveStart+M.componentOffset,M);if(s[Ko]=_[Ko]=X,r!==null)for(let se of r)se(X,a);return FA(L,M,_),X}function TB(s,a,f,d){if(d)t1(s,f,["ng-version","17.3.0"]);else{let{attrs:_,classes:r}=EN(a.selectors[0]);_&&t1(s,f,_),r&&r.length>0&&AA(s,f,r.join(" "))}}function IB(s,a,f){let d=s.projection=[];for(let _=0;_<a.length;_++){let r=f[_];d.push(r!=null?Array.from(r):null)}}function DB(){let s=Do();tb(mr()[Sn],s)}var xh=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=MB;let s=a;return s})();function MB(){let s=Do();return CB(s,mr())}var SB=xh,n2=class extends SB{constructor(a,f,d){super(),this._lContainer=a,this._hostTNode=f,this._hostLView=d}get element(){return U_(this._hostTNode,this._hostLView)}get injector(){return new wc(this._hostTNode,this._hostLView)}get parentInjector(){let a=nb(this._hostTNode,this._hostLView);if(iA(a)){let f=b_(a,this._hostLView),d=x_(a),_=f[Sn].data[d+8];return new wc(_,f)}else return new wc(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){let f=nC(this._lContainer);return f!==null&&f[a]||null}get length(){return this._lContainer.length-Eo}createEmbeddedView(a,f,d){let _,r;typeof d=="number"?_=d:d!=null&&(_=d.index,r=d.injector);let M=YS(this._lContainer,a.ssrId),L=a.createEmbeddedViewImpl(f||{},r,M);return this.insertImpl(L,_,XS(this._hostTNode,M)),L}createComponent(a,f,d,_,r){let M=a&&!zN(a),L;if(M)L=f;else{let Dt=f||{};L=Dt.index,d=Dt.injector,_=Dt.projectableNodes,r=Dt.environmentInjector||Dt.ngModuleRef}let B=M?a:new Vf(Tc(a)),X=d||this.parentInjector;if(!r&&B.ngModule==null){let Vt=(M?X:this.parentInjector).get(Vi,null);Vt&&(r=Vt)}let se=Tc(B.componentType??{}),ge=YS(this._lContainer,se?.id??null),Oe=ge?.firstChild??null,at=B.create(X,_,Oe,r);return this.insertImpl(at.hostView,L,XS(this._hostTNode,ge)),at}insert(a,f){return this.insertImpl(a,f,!0)}insertImpl(a,f,d){let _=a._lView;if(XN(_)){let L=this.indexOf(a);if(L!==-1)this.detach(L);else{let B=_[_i],X=new n2(B,B[ns],B[_i]);X.detach(X.indexOf(a))}}let r=this._adjustIndex(f),M=this._lContainer;return Zz(M,_,r,d),a.attachToViewContainerRef(),yC(Yx(M),r,a),a}move(a,f){return this.insert(a,f)}indexOf(a){let f=nC(this._lContainer);return f!==null?f.indexOf(a):-1}remove(a){let f=this._adjustIndex(a,-1),d=p1(this._lContainer,f);d&&(p_(Yx(this._lContainer),f),MA(d[Sn],d))}detach(a){let f=this._adjustIndex(a,-1),d=p1(this._lContainer,f);return d&&p_(Yx(this._lContainer),f)!=null?new Cc(d):null}_adjustIndex(a,f=0){return a??this.length+f}};function nC(s){return s[__]}function Yx(s){return s[__]||(s[__]=[])}function CB(s,a){let f,d=a[s.index];return Ca(d)?f=d:(f=$A(d,a,null,s),a[s.index]=f,Z_(a,f)),RB(f,a,s,d),new n2(f,s,a)}function AB(s,a){let f=s[yi],d=f.createComment(""),_=Io(a,s),r=ub(f,_);return T_(f,r,d,lz(f,_),!1),d}var RB=kB,PB=()=>!1;function OB(s,a,f){return PB(s,a,f)}function kB(s,a,f,d){if(s[Dc])return;let _;f.type&8?_=Fs(d):_=AB(a,f),s[Dc]=_}function yb(s,a){Yf("NgSignals");let f=JM(s),d=f[ul];return a?.equal&&(d.equal=a.equal),f.set=_=>yx(d,_),f.update=_=>KM(d,_),f.asReadonly=LB.bind(f),f}function LB(){let s=this[ul];if(s.readonlyFn===void 0){let a=()=>this();a[ul]=s,s.readonlyFn=a}return s.readonlyFn}function vb(s){let a=s.inputConfig,f={};for(let d in a)if(a.hasOwnProperty(d)){let _=a[d];Array.isArray(_)&&_[3]&&(f[d]=_[3])}s.inputTransforms=f}var yl=class{},Uf=class{};var D1=class extends yl{constructor(a,f,d){super(),this._parent=f,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new M_(this);let _=MC(a);this._bootstrapComponents=EA(_.bootstrap),this._r3Injector=pA(a,f,[{provide:yl,useValue:this},{provide:Y_,useValue:this.componentFactoryResolver},...d],ji(a),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(a)}get injector(){return this._r3Injector}destroy(){let a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(f=>f()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}},M1=class extends Uf{constructor(a){super(),this.moduleType=a}create(a){return new D1(this.moduleType,a,[])}};var S_=class extends yl{constructor(a){super(),this.componentFactoryResolver=new M_(this),this.instance=null;let f=new Of([...a.providers,{provide:yl,useValue:this},{provide:Y_,useValue:this.componentFactoryResolver}],a.parent||G1(),a.debugName,new Set(["environment"]));this.injector=f,a.runEnvironmentInitializers&&f.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(a){this.injector.onDestroy(a)}};function xb(s,a,f=null){return new S_({providers:s,parent:a,debugName:f,runEnvironmentInitializers:!0}).injector}var bh=(()=>{let a=class a{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new Rr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let d=this.taskId++;return this.pendingTasks.add(d),d}remove(d){this.pendingTasks.delete(d),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function r2(s){return NB(s)?Array.isArray(s)||!(s instanceof Map)&&Symbol.iterator in s:!1}function FB(s,a){if(Array.isArray(s))for(let f=0;f<s.length;f++)a(s[f]);else{let f=s[Symbol.iterator](),d;for(;!(d=f.next()).done;)a(d.value)}}function NB(s){return s!==null&&(typeof s=="function"||typeof s=="object")}function zB(s,a,f){return s[a]=f}function J_(s,a,f){let d=s[a];return Object.is(d,f)?!1:(s[a]=f,!0)}function BB(s){return(s.flags&32)===32}function jB(s,a,f,d,_,r,M,L,B){let X=a.consts,se=W_(a,s,4,M||null,v_(X,L));jA(a,f,se,v_(X,B)),tb(a,se);let ge=se.tView=fb(2,se,d,_,r,a.directiveRegistry,a.pipeRegistry,null,a.schemas,X,null);return a.queries!==null&&(a.queries.template(a,se),ge.queries=a.queries.embeddedTView(se)),se}function wh(s,a,f,d,_,r,M,L){let B=mr(),X=Aa(),se=s+Ls,ge=X.firstCreatePass?jB(se,X,B,a,f,d,_,r,M):X.data[se];Hf(ge,!1);let Oe=VB(X,B,ge,s);Q1()&&hb(X,B,Oe,ge),Sc(Oe,B);let at=$A(Oe,B,Oe,ge);return B[se]=at,Z_(B,at),OB(at,ge,B),q1(ge)&&NA(X,B,ge),M!=null&&zA(B,ge,L),wh}var VB=UB;function UB(s,a,f,d){return eb(!0),a[yi].createComment("")}function bb(s,a,f,d){let _=mr(),r=X1();if(J_(_,r,a)){let M=Aa(),L=tA();Nz(L,_,s,a,f,d)}return bb}function $B(s,a,f,d){return J_(s,X1(),f)?a+k_(f)+d:Zf}function Mo(s,a,f){let d=mr(),_=X1();if(J_(d,_,a)){let r=Aa(),M=tA();Iz(r,M,d,s,a,d[yi],f,!1)}return Mo}function rC(s,a,f,d,_){let r=a.inputs,M=_?"class":"style";pb(s,f,r[M],M,d)}function GB(s,a,f,d,_,r){let M=a.consts,L=v_(M,_),B=W_(a,s,2,d,L);return jA(a,f,B,v_(M,r)),B.attrs!==null&&E1(B,B.attrs,!1),B.mergedAttrs!==null&&E1(B,B.mergedAttrs,!0),a.queries!==null&&a.queries.elementStart(a,B),B}function si(s,a,f,d){let _=mr(),r=Aa(),M=Ls+s,L=_[yi],B=r.firstCreatePass?GB(M,r,_,a,f,d):r.data[M],X=HB(r,_,B,L,a,s);_[M]=X;let se=q1(B);return Hf(B,!0),RA(L,X,B),!BB(B)&&Q1()&&hb(r,_,X,B),QN()===0&&Sc(X,_),e3(),se&&(NA(r,_,B),FA(r,B,_)),d!==null&&zA(_,B),si}function ai(){let s=Do();WC()?s3():(s=s.parent,Hf(s,!1));let a=s;r3(a)&&i3(),t3();let f=Aa();return f.firstCreatePass&&(tb(f,s),NC(s)&&f.queries.elementEnd(s)),a.classesWithoutHost!=null&&_3(a)&&rC(f,a,mr(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&y3(a)&&rC(f,a,mr(),a.stylesWithoutHost,!1),ai}function Pc(s,a,f,d){return si(s,a,f,d),ai(),Pc}var HB=(s,a,f,d,_,r)=>(eb(!0),TA(d,_,f3()));function K_(){return mr()}var C_="en-US";var qB=C_;function WB(s){typeof s=="string"&&(qB=s.toLowerCase().replace(/_/g,"-"))}function Oc(s,a,f,d){let _=mr(),r=Aa(),M=Do();return XB(r,_,_[yi],M,s,a,d),Oc}function ZB(s,a,f,d){let _=s.cleanup;if(_!=null)for(let r=0;r<_.length-1;r+=2){let M=_[r];if(M===f&&_[r+1]===d){let L=a[kf],B=_[r+2];return L.length>B?L[B]:null}typeof M=="string"&&(r+=2)}return null}function XB(s,a,f,d,_,r,M){let L=q1(d),X=s.firstCreatePass&&Uz(s),se=a[Ko],ge=Vz(a),Oe=!0;if(d.type&3||M){let Vt=Io(d,a),kt=M?M(Vt):Vt,St=ge.length,Fn=M?An=>M(Fs(An[d.index])):d.index,zn=null;if(!M&&L&&(zn=ZB(s,a,_,d.index)),zn!==null){let An=zn.__ngLastListenerFn__||zn;An.__ngNextListenerFn__=r,zn.__ngLastListenerFn__=r,Oe=!1}else{r=oC(d,a,se,r,!1);let An=f.listen(kt,_,r);ge.push(r,An),X&&X.push(_,Fn,St,St+1)}}else r=oC(d,a,se,r,!1);let at=d.outputs,Dt;if(Oe&&at!==null&&(Dt=at[_])){let Vt=Dt.length;if(Vt)for(let kt=0;kt<Vt;kt+=2){let St=Dt[kt],Fn=Dt[kt+1],Pr=a[St][Fn].subscribe(r),tr=ge.length;ge.push(r,Pr),X&&X.push(_,d.index,tr,-(tr+1))}}}function iC(s,a,f,d){let _=Ln(null);try{return Rs(6,a,f),f(d)!==!1}catch(r){return HA(s,r),!1}finally{Rs(7,a,f),Ln(_)}}function oC(s,a,f,d,_){return function r(M){if(M===Function)return d;let L=s.componentOffset>-1?vl(s.index,a):a;gb(L);let B=iC(a,f,d,M),X=r.__ngNextListenerFn__;for(;X;)B=iC(a,f,X,M)&&B,X=X.__ngNextListenerFn__;return _&&B===!1&&M.preventDefault(),B}}function Eh(s=1){return d3(s)}function YB(s,a,f,d){f>=s.data.length&&(s.data[f]=null,s.blueprint[f]=null),a[f]=d}function Ns(s,a=""){let f=mr(),d=Aa(),_=s+Ls,r=d.firstCreatePass?W_(d,_,1,a,null):d.data[_],M=JB(d,f,r,a,s);f[_]=M,Q1()&&hb(d,f,M,r),Hf(r,!1)}var JB=(s,a,f,d,_)=>(eb(!0),Y3(a[yi],d));function wb(s){return Q_("",s,""),wb}function Q_(s,a,f){let d=mr(),_=$B(d,s,a,f);return _!==Zf&&$z(d,K1(),_),Q_}var KB=(()=>{let a=class a{constructor(d){this._injector=d,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(d){if(!d.standalone)return null;if(!this.cachedInjectors.has(d)){let _=AC(!1,d.type),r=_.length>0?xb([_],this._injector,`Standalone[${d.type.name}]`):null;this.cachedInjectors.set(d,r)}return this.cachedInjectors.get(d)}ngOnDestroy(){try{for(let d of this.cachedInjectors.values())d!==null&&d.destroy()}finally{this.cachedInjectors.clear()}}};a.\u0275prov=Ot({token:a,providedIn:"environment",factory:()=>new a(Rt(Vi))});let s=a;return s})();function $i(s){Yf("NgStandalone"),s.getStandaloneInjector=a=>a.get(KB).getOrCreateStandaloneInjector(s)}function ey(s,a,f,d){return i2(mr(),ZC(),s,a,f,d)}function QB(s,a){let f=s[a];return f===Zf?void 0:f}function i2(s,a,f,d,_,r){let M=a+f;return J_(s,M,_)?zB(s,M+1,r?d.call(r,_):d(_)):QB(s,M+1)}function kc(s,a){let f=Aa(),d,_=s+Ls;f.firstCreatePass?(d=e4(a,f.pipeRegistry),f.data[_]=d,d.onDestroy&&(f.destroyHooks??=[]).push(_,d.onDestroy)):d=f.data[_];let r=d.factory||(d.factory=Ec(d.type,!0)),M,L=Bi(br);try{let B=w_(!1),X=r();return w_(B),YB(f,mr(),_,X),X}finally{Bi(L)}}function e4(s,a){if(a)for(let f=a.length-1;f>=0;f--){let d=a[f];if(s===d.name)return d}}function Lc(s,a,f){let d=s+Ls,_=mr(),r=ZN(_,d);return t4(_,d)?i2(_,ZC(),a,r.transform,f,r):r.transform(f)}function t4(s,a){return s[Sn].data[a].pure}var ty=(()=>{let a=class a{log(d){console.log(d)}warn(d){console.warn(d)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})();var o2=new _t("");function Th(s){return!!s&&typeof s.then=="function"}function Eb(s){return!!s&&typeof s.subscribe=="function"}var s2=new _t(""),a2=(()=>{let a=class a{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,_)=>{this.resolve=d,this.reject=_}),this.appInits=nt(s2,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let d=[];for(let r of this.appInits){let M=r();if(Th(M))d.push(M);else if(Eb(M)){let L=new Promise((B,X)=>{M.subscribe({complete:B,error:X})});d.push(L)}}let _=()=>{this.done=!0,this.resolve()};Promise.all(d).then(()=>{_()}).catch(r=>{this.reject(r)}),d.length===0&&_(),this.initialized=!0}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),ny=new _t("");function n4(){YM(()=>{throw new qt(600,!1)})}function r4(s){return s.isBoundToModule}function i4(s,a,f){try{let d=f();return Th(d)?d.catch(_=>{throw a.runOutsideAngular(()=>s.handleError(_)),_}):d}catch(d){throw a.runOutsideAngular(()=>s.handleError(d)),d}}var Ih=(()=>{let a=class a{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=nt(mA),this.afterRenderEffectManager=nt(t2),this.externalTestViews=new Set,this.beforeRender=new wr,this.afterTick=new wr,this.componentTypes=[],this.components=[],this.isStable=nt(bh).hasPendingTasks.pipe(Ht(d=>!d)),this._injector=nt(Vi)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(d,_){let r=d instanceof D_;if(!this._injector.get(a2).done){let at=!r&&DC(d),Dt=!1;throw new qt(405,Dt)}let L;r?L=d:L=this._injector.get(Y_).resolveComponentFactory(d),this.componentTypes.push(L.componentType);let B=r4(L)?void 0:this._injector.get(yl),X=_||L.selector,se=L.create(yh.NULL,[],X,B),ge=se.location.nativeElement,Oe=se.injector.get(o2,null);return Oe?.registerApplication(ge),se.onDestroy(()=>{this.detachView(se.hostView),Jx(this.components,se),Oe?.unregisterApplication(ge)}),this._loadComponent(se),se}tick(){this._tick(!0)}_tick(d){if(this._runningTick)throw new qt(101,!1);let _=Ln(null);try{this._runningTick=!0,this.detectChangesInAttachedViews(d)}catch(r){this.internalErrorHandler(r)}finally{this.afterTick.next(),this._runningTick=!1,Ln(_)}}detectChangesInAttachedViews(d){let _=0,r=this.afterRenderEffectManager;for(;;){if(_===YA)throw new qt(103,!1);if(d){let M=_===0;this.beforeRender.next(M);for(let{_lView:L,notifyErrorHandler:B}of this._views)o4(L,M,B)}if(_++,r.executeInternalCallbacks(),![...this.externalTestViews.keys(),...this._views].some(({_lView:M})=>S1(M))&&(r.execute(),![...this.externalTestViews.keys(),...this._views].some(({_lView:M})=>S1(M))))break}}attachView(d){let _=d;this._views.push(_),_.attachToAppRef(this)}detachView(d){let _=d;Jx(this._views,_),_.detachFromAppRef()}_loadComponent(d){this.attachView(d.hostView),this.tick(),this.components.push(d);let _=this._injector.get(ny,[]);[...this._bootstrapListeners,..._].forEach(r=>r(d))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(d=>d()),this._views.slice().forEach(d=>d.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(d){return this._destroyListeners.push(d),()=>Jx(this._destroyListeners,d)}destroy(){if(this._destroyed)throw new qt(406,!1);let d=this._injector;d.destroy&&!d.destroyed&&d.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Jx(s,a){let f=s.indexOf(a);f>-1&&s.splice(f,1)}function o4(s,a,f){!a&&!S1(s)||s4(s,f,a)}function S1(s){return Z1(s)}function s4(s,a,f){let d;f?(d=0,s[on]|=1024):s[on]&64?d=0:d=1,JA(s,a,d)}var C1=class{constructor(a,f){this.ngModuleFactory=a,this.componentFactories=f}},Tb=(()=>{let a=class a{compileModuleSync(d){return new M1(d)}compileModuleAsync(d){return Promise.resolve(this.compileModuleSync(d))}compileModuleAndAllComponentsSync(d){let _=this.compileModuleSync(d),r=MC(d),M=EA(r.declarations).reduce((L,B)=>{let X=Tc(B);return X&&L.push(new Vf(X)),L},[]);return new C1(_,M)}compileModuleAndAllComponentsAsync(d){return Promise.resolve(this.compileModuleAndAllComponentsSync(d))}clearCache(){}clearCacheFor(d){}getModuleId(d){}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var a4=(()=>{let a=class a{constructor(){this.zone=nt(xr),this.applicationRef=nt(Ih)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function l4(s){return[{provide:xr,useFactory:s},{provide:Jo,multi:!0,useFactory:()=>{let a=nt(a4,{optional:!0});return()=>a.initialize()}},{provide:Jo,multi:!0,useFactory:()=>{let a=nt(d4);return()=>{a.initialize()}}},{provide:mA,useFactory:c4}]}function c4(){let s=nt(xr),a=nt(es);return f=>s.runOutsideAngular(()=>a.handleError(f))}function u4(s){let a=l4(()=>new xr(h4(s)));return ts([[],a])}function h4(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var d4=(()=>{let a=class a{constructor(){this.subscription=new Ar,this.initialized=!1,this.zone=nt(xr),this.pendingTasks=nt(bh)}initialize(){if(this.initialized)return;this.initialized=!0;let d=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(d=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{xr.assertNotInAngularZone(),queueMicrotask(()=>{d!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(d),d=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{xr.assertInAngularZone(),d??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function f4(){return typeof $localize<"u"&&$localize.locale||C_}var Ib=new _t("",{providedIn:"root",factory:()=>nt(Ib,wn.Optional|wn.SkipSelf)||f4()});var l2=new _t("");var h_=null;function p4(s=[],a){return yh.create({name:a,providers:[{provide:F_,useValue:"platform"},{provide:l2,useValue:new Set([()=>h_=null])},...s]})}function m4(s=[]){if(h_)return h_;let a=p4(s);return h_=a,n4(),g4(a),a}function g4(s){s.get(ob,null)?.forEach(f=>f())}function c2(){return!1}var Dh=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=_4;let s=a;return s})();function _4(s){return y4(Do(),mr(),(s&16)===16)}function y4(s,a,f){if(B_(s)&&!f){let d=vl(s.index,a);return new Cc(d,d)}else if(s.type&47){let d=a[ks];return new Cc(d,a)}return null}var A1=class{constructor(){}supports(a){return r2(a)}create(a){return new R1(a)}},v4=(s,a)=>a,R1=class{constructor(a){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=a||v4}forEachItem(a){let f;for(f=this._itHead;f!==null;f=f._next)a(f)}forEachOperation(a){let f=this._itHead,d=this._removalsHead,_=0,r=null;for(;f||d;){let M=!d||f&&f.currentIndex<sC(d,_,r)?f:d,L=sC(M,_,r),B=M.currentIndex;if(M===d)_--,d=d._nextRemoved;else if(f=f._next,M.previousIndex==null)_++;else{r||(r=[]);let X=L-_,se=B-_;if(X!=se){for(let Oe=0;Oe<X;Oe++){let at=Oe<r.length?r[Oe]:r[Oe]=0,Dt=at+Oe;se<=Dt&&Dt<X&&(r[Oe]=at+1)}let ge=M.previousIndex;r[ge]=se-X}}L!==B&&a(M,L,B)}}forEachPreviousItem(a){let f;for(f=this._previousItHead;f!==null;f=f._nextPrevious)a(f)}forEachAddedItem(a){let f;for(f=this._additionsHead;f!==null;f=f._nextAdded)a(f)}forEachMovedItem(a){let f;for(f=this._movesHead;f!==null;f=f._nextMoved)a(f)}forEachRemovedItem(a){let f;for(f=this._removalsHead;f!==null;f=f._nextRemoved)a(f)}forEachIdentityChange(a){let f;for(f=this._identityChangesHead;f!==null;f=f._nextIdentityChange)a(f)}diff(a){if(a==null&&(a=[]),!r2(a))throw new qt(900,!1);return this.check(a)?this:null}onDestroy(){}check(a){this._reset();let f=this._itHead,d=!1,_,r,M;if(Array.isArray(a)){this.length=a.length;for(let L=0;L<this.length;L++)r=a[L],M=this._trackByFn(L,r),f===null||!Object.is(f.trackById,M)?(f=this._mismatch(f,r,M,L),d=!0):(d&&(f=this._verifyReinsertion(f,r,M,L)),Object.is(f.item,r)||this._addIdentityChange(f,r)),f=f._next}else _=0,FB(a,L=>{M=this._trackByFn(_,L),f===null||!Object.is(f.trackById,M)?(f=this._mismatch(f,L,M,_),d=!0):(d&&(f=this._verifyReinsertion(f,L,M,_)),Object.is(f.item,L)||this._addIdentityChange(f,L)),f=f._next,_++}),this.length=_;return this._truncate(f),this.collection=a,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let a;for(a=this._previousItHead=this._itHead;a!==null;a=a._next)a._nextPrevious=a._next;for(a=this._additionsHead;a!==null;a=a._nextAdded)a.previousIndex=a.currentIndex;for(this._additionsHead=this._additionsTail=null,a=this._movesHead;a!==null;a=a._nextMoved)a.previousIndex=a.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(a,f,d,_){let r;return a===null?r=this._itTail:(r=a._prev,this._remove(a)),a=this._unlinkedRecords===null?null:this._unlinkedRecords.get(d,null),a!==null?(Object.is(a.item,f)||this._addIdentityChange(a,f),this._reinsertAfter(a,r,_)):(a=this._linkedRecords===null?null:this._linkedRecords.get(d,_),a!==null?(Object.is(a.item,f)||this._addIdentityChange(a,f),this._moveAfter(a,r,_)):a=this._addAfter(new P1(f,d),r,_)),a}_verifyReinsertion(a,f,d,_){let r=this._unlinkedRecords===null?null:this._unlinkedRecords.get(d,null);return r!==null?a=this._reinsertAfter(r,a._prev,_):a.currentIndex!=_&&(a.currentIndex=_,this._addToMoves(a,_)),a}_truncate(a){for(;a!==null;){let f=a._next;this._addToRemovals(this._unlink(a)),a=f}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(a,f,d){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(a);let _=a._prevRemoved,r=a._nextRemoved;return _===null?this._removalsHead=r:_._nextRemoved=r,r===null?this._removalsTail=_:r._prevRemoved=_,this._insertAfter(a,f,d),this._addToMoves(a,d),a}_moveAfter(a,f,d){return this._unlink(a),this._insertAfter(a,f,d),this._addToMoves(a,d),a}_addAfter(a,f,d){return this._insertAfter(a,f,d),this._additionsTail===null?this._additionsTail=this._additionsHead=a:this._additionsTail=this._additionsTail._nextAdded=a,a}_insertAfter(a,f,d){let _=f===null?this._itHead:f._next;return a._next=_,a._prev=f,_===null?this._itTail=a:_._prev=a,f===null?this._itHead=a:f._next=a,this._linkedRecords===null&&(this._linkedRecords=new A_),this._linkedRecords.put(a),a.currentIndex=d,a}_remove(a){return this._addToRemovals(this._unlink(a))}_unlink(a){this._linkedRecords!==null&&this._linkedRecords.remove(a);let f=a._prev,d=a._next;return f===null?this._itHead=d:f._next=d,d===null?this._itTail=f:d._prev=f,a}_addToMoves(a,f){return a.previousIndex===f||(this._movesTail===null?this._movesTail=this._movesHead=a:this._movesTail=this._movesTail._nextMoved=a),a}_addToRemovals(a){return this._unlinkedRecords===null&&(this._unlinkedRecords=new A_),this._unlinkedRecords.put(a),a.currentIndex=null,a._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=a,a._prevRemoved=null):(a._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=a),a}_addIdentityChange(a,f){return a.item=f,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=a:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=a,a}},P1=class{constructor(a,f){this.item=a,this.trackById=f,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}},O1=class{constructor(){this._head=null,this._tail=null}add(a){this._head===null?(this._head=this._tail=a,a._nextDup=null,a._prevDup=null):(this._tail._nextDup=a,a._prevDup=this._tail,a._nextDup=null,this._tail=a)}get(a,f){let d;for(d=this._head;d!==null;d=d._nextDup)if((f===null||f<=d.currentIndex)&&Object.is(d.trackById,a))return d;return null}remove(a){let f=a._prevDup,d=a._nextDup;return f===null?this._head=d:f._nextDup=d,d===null?this._tail=f:d._prevDup=f,this._head===null}},A_=class{constructor(){this.map=new Map}put(a){let f=a.trackById,d=this.map.get(f);d||(d=new O1,this.map.set(f,d)),d.add(a)}get(a,f){let d=a,_=this.map.get(d);return _?_.get(a,f):null}remove(a){let f=a.trackById;return this.map.get(f).remove(a)&&this.map.delete(f),a}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function sC(s,a,f){let d=s.previousIndex;if(d===null)return d;let _=0;return f&&d<f.length&&(_=f[d]),d+a+_}function aC(){return new Db([new A1])}var Db=(()=>{let a=class a{constructor(d){this.factories=d}static create(d,_){if(_!=null){let r=_.factories.slice();d=d.concat(r)}return new a(d)}static extend(d){return{provide:a,useFactory:_=>a.create(d,_||aC()),deps:[[a,new _C,new z1]]}}find(d){let _=this.factories.find(r=>r.supports(d));if(_!=null)return _;throw new qt(901,!1)}};a.\u0275prov=Ot({token:a,providedIn:"root",factory:aC});let s=a;return s})();function u2(s){try{let{rootComponent:a,appProviders:f,platformProviders:d}=s,_=m4(d),r=[u4(),...f||[]],L=new S_({providers:r,parent:_,debugName:"",runEnvironmentInitializers:!1}).injector,B=L.get(xr);return B.run(()=>{L.resolveInjectorInitializers();let X=L.get(es,null),se;B.runOutsideAngular(()=>{se=B.onError.subscribe({next:at=>{X.handleError(at)}})});let ge=()=>L.destroy(),Oe=_.get(l2);return Oe.add(ge),L.onDestroy(()=>{se.unsubscribe(),Oe.delete(ge)}),i4(X,B,()=>{let at=L.get(a2);return at.runInitializers(),at.donePromise.then(()=>{let Dt=L.get(Ib,C_);WB(Dt||C_);let Vt=L.get(Ih);return a!==void 0&&Vt.bootstrap(a),Vt})})})}catch(a){return Promise.reject(a)}}function Jf(s){return typeof s=="boolean"?s:s!=null&&s!=="false"}function ry(s,a){Yf("NgSignals");let f=WM(s);return a?.equal&&(f[ul].equal=a.equal),f}function iy(s){let a=Ln(null);try{return s()}finally{Ln(a)}}var _2=null;function Mh(){return _2}function y2(s){_2??=s}var oy=class{};var Hi=new _t(""),v2=(()=>{let a=class a{historyGo(d){throw new Error("")}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(x4),providedIn:"platform"});let s=a;return s})();var x4=(()=>{let a=class a extends v2{constructor(){super(),this._doc=nt(Hi),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Mh().getBaseHref(this._doc)}onPopState(d){let _=Mh().getGlobalEventTarget(this._doc,"window");return _.addEventListener("popstate",d,!1),()=>_.removeEventListener("popstate",d)}onHashChange(d){let _=Mh().getGlobalEventTarget(this._doc,"window");return _.addEventListener("hashchange",d,!1),()=>_.removeEventListener("hashchange",d)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(d){this._location.pathname=d}pushState(d,_,r){this._history.pushState(d,_,r)}replaceState(d,_,r){this._history.replaceState(d,_,r)}forward(){this._history.forward()}back(){this._history.back()}historyGo(d=0){this._history.go(d)}getState(){return this._history.state}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>new a,providedIn:"platform"});let s=a;return s})();function x2(s,a){if(s.length==0)return a;if(a.length==0)return s;let f=0;return s.endsWith("/")&&f++,a.startsWith("/")&&f++,f==2?s+a.substring(1):f==1?s+a:s+"/"+a}function h2(s){let a=s.match(/#|\?|$/),f=a&&a.index||s.length,d=f-(s[f-1]==="/"?1:0);return s.slice(0,d)+s.slice(f)}function Fc(s){return s&&s[0]!=="?"?"?"+s:s}var Ch=(()=>{let a=class a{historyGo(d){throw new Error("")}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(b2),providedIn:"root"});let s=a;return s})(),b4=new _t(""),b2=(()=>{let a=class a extends Ch{constructor(d,_){super(),this._platformLocation=d,this._removeListenerFns=[],this._baseHref=_??this._platformLocation.getBaseHrefFromDOM()??nt(Hi).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(d){this._removeListenerFns.push(this._platformLocation.onPopState(d),this._platformLocation.onHashChange(d))}getBaseHref(){return this._baseHref}prepareExternalUrl(d){return x2(this._baseHref,d)}path(d=!1){let _=this._platformLocation.pathname+Fc(this._platformLocation.search),r=this._platformLocation.hash;return r&&d?`${_}${r}`:_}pushState(d,_,r,M){let L=this.prepareExternalUrl(r+Fc(M));this._platformLocation.pushState(d,_,L)}replaceState(d,_,r,M){let L=this.prepareExternalUrl(r+Fc(M));this._platformLocation.replaceState(d,_,L)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(d=0){this._platformLocation.historyGo?.(d)}};a.\u0275fac=function(_){return new(_||a)(Rt(v2),Rt(b4,8))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var ep=(()=>{let a=class a{constructor(d){this._subject=new Xo,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=d;let _=this._locationStrategy.getBaseHref();this._basePath=T4(h2(d2(_))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(d=!1){return this.normalize(this._locationStrategy.path(d))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(d,_=""){return this.path()==this.normalize(d+Fc(_))}normalize(d){return a.stripTrailingSlash(E4(this._basePath,d2(d)))}prepareExternalUrl(d){return d&&d[0]!=="/"&&(d="/"+d),this._locationStrategy.prepareExternalUrl(d)}go(d,_="",r=null){this._locationStrategy.pushState(r,"",d,_),this._notifyUrlChangeListeners(this.prepareExternalUrl(d+Fc(_)),r)}replaceState(d,_="",r=null){this._locationStrategy.replaceState(r,"",d,_),this._notifyUrlChangeListeners(this.prepareExternalUrl(d+Fc(_)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(d=0){this._locationStrategy.historyGo?.(d)}onUrlChange(d){return this._urlChangeListeners.push(d),this._urlChangeSubscription??=this.subscribe(_=>{this._notifyUrlChangeListeners(_.url,_.state)}),()=>{let _=this._urlChangeListeners.indexOf(d);this._urlChangeListeners.splice(_,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(d="",_){this._urlChangeListeners.forEach(r=>r(d,_))}subscribe(d,_,r){return this._subject.subscribe({next:d,error:_,complete:r})}};a.normalizeQueryParams=Fc,a.joinWithSlash=x2,a.stripTrailingSlash=h2,a.\u0275fac=function(_){return new(_||a)(Rt(Ch))},a.\u0275prov=Ot({token:a,factory:()=>w4(),providedIn:"root"});let s=a;return s})();function w4(){return new ep(Rt(Ch))}function E4(s,a){if(!s||!a.startsWith(s))return a;let f=a.substring(s.length);return f===""||["/",";","?","#"].includes(f[0])?f:a}function d2(s){return s.replace(/\/index.html$/,"")}function T4(s){if(new RegExp("^(https?:)?//").test(s)){let[,f]=s.split(/\/\/[^\/]+/);return f}return s}function sy(s,a){a=encodeURIComponent(a);for(let f of s.split(";")){let d=f.indexOf("="),[_,r]=d==-1?[f,""]:[f.slice(0,d),f.slice(d+1)];if(_.trim()===a)return decodeURIComponent(r)}return null}var Mb=/\s+/,f2=[],ay=(()=>{let a=class a{constructor(d,_){this._ngEl=d,this._renderer=_,this.initialClasses=f2,this.stateMap=new Map}set klass(d){this.initialClasses=d!=null?d.trim().split(Mb):f2}set ngClass(d){this.rawClass=typeof d=="string"?d.trim().split(Mb):d}ngDoCheck(){for(let _ of this.initialClasses)this._updateState(_,!0);let d=this.rawClass;if(Array.isArray(d)||d instanceof Set)for(let _ of d)this._updateState(_,!0);else if(d!=null)for(let _ of Object.keys(d))this._updateState(_,!!d[_]);this._applyStateDiff()}_updateState(d,_){let r=this.stateMap.get(d);r!==void 0?(r.enabled!==_&&(r.changed=!0,r.enabled=_),r.touched=!0):this.stateMap.set(d,{enabled:_,changed:!0,touched:!0})}_applyStateDiff(){for(let d of this.stateMap){let _=d[0],r=d[1];r.changed?(this._toggleClass(_,r.enabled),r.changed=!1):r.touched||(r.enabled&&this._toggleClass(_,!1),this.stateMap.delete(_)),r.touched=!1}}_toggleClass(d,_){d=d.trim(),d.length>0&&d.split(Mb).forEach(r=>{_?this._renderer.addClass(this._ngEl.nativeElement,r):this._renderer.removeClass(this._ngEl.nativeElement,r)})}};a.\u0275fac=function(_){return new(_||a)(br(vh),br(Xf))},a.\u0275dir=Ac({type:a,selectors:[["","ngClass",""]],inputs:{klass:[To.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let s=a;return s})();var Sb=class{constructor(a,f,d,_){this.$implicit=a,this.ngForOf=f,this.index=d,this.count=_}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},ly=(()=>{let a=class a{set ngForOf(d){this._ngForOf=d,this._ngForOfDirty=!0}set ngForTrackBy(d){this._trackByFn=d}get ngForTrackBy(){return this._trackByFn}constructor(d,_,r){this._viewContainer=d,this._template=_,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(d){d&&(this._template=d)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let d=this._ngForOf;if(!this._differ&&d)if(0)try{}catch{}else this._differ=this._differs.find(d).create(this.ngForTrackBy)}if(this._differ){let d=this._differ.diff(this._ngForOf);d&&this._applyChanges(d)}}_applyChanges(d){let _=this._viewContainer;d.forEachOperation((r,M,L)=>{if(r.previousIndex==null)_.createEmbeddedView(this._template,new Sb(r.item,this._ngForOf,-1,-1),L===null?void 0:L);else if(L==null)_.remove(M===null?void 0:M);else if(M!==null){let B=_.get(M);_.move(B,L),p2(B,r)}});for(let r=0,M=_.length;r<M;r++){let B=_.get(r).context;B.index=r,B.count=M,B.ngForOf=this._ngForOf}d.forEachIdentityChange(r=>{let M=_.get(r.currentIndex);p2(M,r)})}static ngTemplateContextGuard(d,_){return!0}};a.\u0275fac=function(_){return new(_||a)(br(xh),br(X_),br(Db))},a.\u0275dir=Ac({type:a,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0});let s=a;return s})();function p2(s,a){s.context.$implicit=a.item}var w2=(()=>{let a=class a{constructor(d,_){this._viewContainer=d,this._context=new Cb,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=_}set ngIf(d){this._context.$implicit=this._context.ngIf=d,this._updateView()}set ngIfThen(d){m2("ngIfThen",d),this._thenTemplateRef=d,this._thenViewRef=null,this._updateView()}set ngIfElse(d){m2("ngIfElse",d),this._elseTemplateRef=d,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(d,_){return!0}};a.\u0275fac=function(_){return new(_||a)(br(xh),br(X_))},a.\u0275dir=Ac({type:a,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let s=a;return s})(),Cb=class{constructor(){this.$implicit=null,this.ngIf=null}};function m2(s,a){if(!!!(!a||a.createEmbeddedView))throw new Error(`${s} must be a TemplateRef, but received '${ji(a)}'.`)}function E2(s,a){return new qt(2100,!1)}var Ab=class{createSubscription(a,f){return iy(()=>a.subscribe({next:f,error:d=>{throw d}}))}dispose(a){iy(()=>a.unsubscribe())}},Rb=class{createSubscription(a,f){return a.then(f,d=>{throw d})}dispose(a){}},I4=new Rb,D4=new Ab,cy=(()=>{let a=class a{constructor(d){this._latestValue=null,this.markForCheckOnValueUpdate=!0,this._subscription=null,this._obj=null,this._strategy=null,this._ref=d}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(d){if(!this._obj){if(d)try{this.markForCheckOnValueUpdate=!1,this._subscribe(d)}finally{this.markForCheckOnValueUpdate=!0}return this._latestValue}return d!==this._obj?(this._dispose(),this.transform(d)):this._latestValue}_subscribe(d){this._obj=d,this._strategy=this._selectStrategy(d),this._subscription=this._strategy.createSubscription(d,_=>this._updateLatestValue(d,_))}_selectStrategy(d){if(Th(d))return I4;if(Eb(d))return D4;throw E2(a,d)}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(d,_){d===this._obj&&(this._latestValue=_,this.markForCheckOnValueUpdate&&this._ref?.markForCheck())}};a.\u0275fac=function(_){return new(_||a)(br(Dh,16))},a.\u0275pipe=U1({name:"async",type:a,pure:!1,standalone:!0});let s=a;return s})();var M4=/(?:[0-9A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u0870-\u0887\u0889-\u088E\u08A0-\u08C9\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C5D\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u1711\u171F-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4C\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7CA\uA7D0\uA7D1\uA7D3\uA7D5-\uA7D9\uA7F2-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDD70-\uDD7A\uDD7C-\uDD8A\uDD8C-\uDD92\uDD94\uDD95\uDD97-\uDDA1\uDDA3-\uDDB1\uDDB3-\uDDB9\uDDBB\uDDBC\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67\uDF80-\uDF85\uDF87-\uDFB0\uDFB2-\uDFBA]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDE80-\uDEA9\uDEB0\uDEB1\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDF70-\uDF81\uDFB0-\uDFC4\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC71\uDC72\uDC75\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD47\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F-\uDC61\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A\uDF40-\uDF46]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF-\uDD06\uDD09\uDD0C-\uDD13\uDD15\uDD16\uDD18-\uDD2F\uDD3F\uDD41\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEB0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2\uDFB0]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|\uD80B[\uDF90-\uDFF0]|[\uD80C\uD81C-\uD820\uD822\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879\uD880-\uD883][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE70-\uDEBE\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD823[\uDC00-\uDCD5\uDD00-\uDD08]|\uD82B[\uDFF0-\uDFF3\uDFF5-\uDFFB\uDFFD\uDFFE]|\uD82C[\uDC00-\uDD22\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD837[\uDF00-\uDF1E]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDE90-\uDEAD\uDEC0-\uDEEB]|\uD839[\uDFE0-\uDFE6\uDFE8-\uDFEB\uDFED\uDFEE\uDFF0-\uDFFE]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDEDF\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF38\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uD884[\uDC00-\uDF4A])\S*/g,T2=(()=>{let a=class a{transform(d){if(d==null)return null;if(typeof d!="string")throw E2(a,d);return d.replace(M4,_=>_[0].toUpperCase()+_.slice(1).toLowerCase())}};a.\u0275fac=function(_){return new(_||a)},a.\u0275pipe=U1({name:"titlecase",type:a,pure:!0,standalone:!0});let s=a;return s})();var I2="browser",S4="server";function Pb(s){return s===S4}var Sh=class{};var np=class{},hy=class{},Nc=class s{constructor(a){this.normalizedNames=new Map,this.lazyUpdate=null,a?typeof a=="string"?this.lazyInit=()=>{this.headers=new Map,a.split(`
`).forEach(f=>{let d=f.indexOf(":");if(d>0){let _=f.slice(0,d),r=_.toLowerCase(),M=f.slice(d+1).trim();this.maybeSetNormalizedName(_,r),this.headers.has(r)?this.headers.get(r).push(M):this.headers.set(r,[M])}})}:typeof Headers<"u"&&a instanceof Headers?(this.headers=new Map,a.forEach((f,d)=>{this.setHeaderEntries(d,f)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(a).forEach(([f,d])=>{this.setHeaderEntries(f,d)})}:this.headers=new Map}has(a){return this.init(),this.headers.has(a.toLowerCase())}get(a){this.init();let f=this.headers.get(a.toLowerCase());return f&&f.length>0?f[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(a){return this.init(),this.headers.get(a.toLowerCase())||null}append(a,f){return this.clone({name:a,value:f,op:"a"})}set(a,f){return this.clone({name:a,value:f,op:"s"})}delete(a,f){return this.clone({name:a,value:f,op:"d"})}maybeSetNormalizedName(a,f){this.normalizedNames.has(f)||this.normalizedNames.set(f,a)}init(){this.lazyInit&&(this.lazyInit instanceof s?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(a=>this.applyUpdate(a)),this.lazyUpdate=null))}copyFrom(a){a.init(),Array.from(a.headers.keys()).forEach(f=>{this.headers.set(f,a.headers.get(f)),this.normalizedNames.set(f,a.normalizedNames.get(f))})}clone(a){let f=new s;return f.lazyInit=this.lazyInit&&this.lazyInit instanceof s?this.lazyInit:this,f.lazyUpdate=(this.lazyUpdate||[]).concat([a]),f}applyUpdate(a){let f=a.name.toLowerCase();switch(a.op){case"a":case"s":let d=a.value;if(typeof d=="string"&&(d=[d]),d.length===0)return;this.maybeSetNormalizedName(a.name,f);let _=(a.op==="a"?this.headers.get(f):void 0)||[];_.push(...d),this.headers.set(f,_);break;case"d":let r=a.value;if(!r)this.headers.delete(f),this.normalizedNames.delete(f);else{let M=this.headers.get(f);if(!M)return;M=M.filter(L=>r.indexOf(L)===-1),M.length===0?(this.headers.delete(f),this.normalizedNames.delete(f)):this.headers.set(f,M)}break}}setHeaderEntries(a,f){let d=(Array.isArray(f)?f:[f]).map(r=>r.toString()),_=a.toLowerCase();this.headers.set(_,d),this.maybeSetNormalizedName(a,_)}forEach(a){this.init(),Array.from(this.normalizedNames.keys()).forEach(f=>a(this.normalizedNames.get(f),this.headers.get(f)))}};var kb=class{encodeKey(a){return M2(a)}encodeValue(a){return M2(a)}decodeKey(a){return decodeURIComponent(a)}decodeValue(a){return decodeURIComponent(a)}};function R4(s,a){let f=new Map;return s.length>0&&s.replace(/^\?/,"").split("&").forEach(_=>{let r=_.indexOf("="),[M,L]=r==-1?[a.decodeKey(_),""]:[a.decodeKey(_.slice(0,r)),a.decodeValue(_.slice(r+1))],B=f.get(M)||[];B.push(L),f.set(M,B)}),f}var P4=/%(\d[a-f0-9])/gi,O4={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function M2(s){return encodeURIComponent(s).replace(P4,(a,f)=>O4[f]??a)}function uy(s){return`${s}`}var bl=class s{constructor(a={}){if(this.updates=null,this.cloneFrom=null,this.encoder=a.encoder||new kb,a.fromString){if(a.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=R4(a.fromString,this.encoder)}else a.fromObject?(this.map=new Map,Object.keys(a.fromObject).forEach(f=>{let d=a.fromObject[f],_=Array.isArray(d)?d.map(uy):[uy(d)];this.map.set(f,_)})):this.map=null}has(a){return this.init(),this.map.has(a)}get(a){this.init();let f=this.map.get(a);return f?f[0]:null}getAll(a){return this.init(),this.map.get(a)||null}keys(){return this.init(),Array.from(this.map.keys())}append(a,f){return this.clone({param:a,value:f,op:"a"})}appendAll(a){let f=[];return Object.keys(a).forEach(d=>{let _=a[d];Array.isArray(_)?_.forEach(r=>{f.push({param:d,value:r,op:"a"})}):f.push({param:d,value:_,op:"a"})}),this.clone(f)}set(a,f){return this.clone({param:a,value:f,op:"s"})}delete(a,f){return this.clone({param:a,value:f,op:"d"})}toString(){return this.init(),this.keys().map(a=>{let f=this.encoder.encodeKey(a);return this.map.get(a).map(d=>f+"="+this.encoder.encodeValue(d)).join("&")}).filter(a=>a!=="").join("&")}clone(a){let f=new s({encoder:this.encoder});return f.cloneFrom=this.cloneFrom||this,f.updates=(this.updates||[]).concat(a),f}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(a=>this.map.set(a,this.cloneFrom.map.get(a))),this.updates.forEach(a=>{switch(a.op){case"a":case"s":let f=(a.op==="a"?this.map.get(a.param):void 0)||[];f.push(uy(a.value)),this.map.set(a.param,f);break;case"d":if(a.value!==void 0){let d=this.map.get(a.param)||[],_=d.indexOf(uy(a.value));_!==-1&&d.splice(_,1),d.length>0?this.map.set(a.param,d):this.map.delete(a.param)}else{this.map.delete(a.param);break}}}),this.cloneFrom=this.updates=null)}};var Lb=class{constructor(){this.map=new Map}set(a,f){return this.map.set(a,f),this}get(a){return this.map.has(a)||this.map.set(a,a.defaultValue()),this.map.get(a)}delete(a){return this.map.delete(a),this}has(a){return this.map.has(a)}keys(){return this.map.keys()}};function k4(s){switch(s){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function S2(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer}function C2(s){return typeof Blob<"u"&&s instanceof Blob}function A2(s){return typeof FormData<"u"&&s instanceof FormData}function L4(s){return typeof URLSearchParams<"u"&&s instanceof URLSearchParams}var tp=class s{constructor(a,f,d,_){this.url=f,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=a.toUpperCase();let r;if(k4(this.method)||_?(this.body=d!==void 0?d:null,r=_):r=d,r&&(this.reportProgress=!!r.reportProgress,this.withCredentials=!!r.withCredentials,r.responseType&&(this.responseType=r.responseType),r.headers&&(this.headers=r.headers),r.context&&(this.context=r.context),r.params&&(this.params=r.params),this.transferCache=r.transferCache),this.headers??=new Nc,this.context??=new Lb,!this.params)this.params=new bl,this.urlWithParams=f;else{let M=this.params.toString();if(M.length===0)this.urlWithParams=f;else{let L=f.indexOf("?"),B=L===-1?"?":L<f.length-1?"&":"";this.urlWithParams=f+B+M}}}serializeBody(){return this.body===null?null:S2(this.body)||C2(this.body)||A2(this.body)||L4(this.body)||typeof this.body=="string"?this.body:this.body instanceof bl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||A2(this.body)?null:C2(this.body)?this.body.type||null:S2(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof bl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(a={}){let f=a.method||this.method,d=a.url||this.url,_=a.responseType||this.responseType,r=a.body!==void 0?a.body:this.body,M=a.withCredentials!==void 0?a.withCredentials:this.withCredentials,L=a.reportProgress!==void 0?a.reportProgress:this.reportProgress,B=a.headers||this.headers,X=a.params||this.params,se=a.context??this.context;return a.setHeaders!==void 0&&(B=Object.keys(a.setHeaders).reduce((ge,Oe)=>ge.set(Oe,a.setHeaders[Oe]),B)),a.setParams&&(X=Object.keys(a.setParams).reduce((ge,Oe)=>ge.set(Oe,a.setParams[Oe]),X)),new s(f,d,r,{params:X,headers:B,context:se,reportProgress:L,responseType:_,withCredentials:M})}},Ah=function(s){return s[s.Sent=0]="Sent",s[s.UploadProgress=1]="UploadProgress",s[s.ResponseHeader=2]="ResponseHeader",s[s.DownloadProgress=3]="DownloadProgress",s[s.Response=4]="Response",s[s.User=5]="User",s}(Ah||{}),rp=class{constructor(a,f=py.Ok,d="OK"){this.headers=a.headers||new Nc,this.status=a.status!==void 0?a.status:f,this.statusText=a.statusText||d,this.url=a.url||null,this.ok=this.status>=200&&this.status<300}},Fb=class s extends rp{constructor(a={}){super(a),this.type=Ah.ResponseHeader}clone(a={}){return new s({headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},dy=class s extends rp{constructor(a={}){super(a),this.type=Ah.Response,this.body=a.body!==void 0?a.body:null}clone(a={}){return new s({body:a.body!==void 0?a.body:this.body,headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},fy=class extends rp{constructor(a){super(a,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${a.url||"(unknown url)"}`:this.message=`Http failure response for ${a.url||"(unknown url)"}: ${a.status} ${a.statusText}`,this.error=a.error||null}},py=function(s){return s[s.Continue=100]="Continue",s[s.SwitchingProtocols=101]="SwitchingProtocols",s[s.Processing=102]="Processing",s[s.EarlyHints=103]="EarlyHints",s[s.Ok=200]="Ok",s[s.Created=201]="Created",s[s.Accepted=202]="Accepted",s[s.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",s[s.NoContent=204]="NoContent",s[s.ResetContent=205]="ResetContent",s[s.PartialContent=206]="PartialContent",s[s.MultiStatus=207]="MultiStatus",s[s.AlreadyReported=208]="AlreadyReported",s[s.ImUsed=226]="ImUsed",s[s.MultipleChoices=300]="MultipleChoices",s[s.MovedPermanently=301]="MovedPermanently",s[s.Found=302]="Found",s[s.SeeOther=303]="SeeOther",s[s.NotModified=304]="NotModified",s[s.UseProxy=305]="UseProxy",s[s.Unused=306]="Unused",s[s.TemporaryRedirect=307]="TemporaryRedirect",s[s.PermanentRedirect=308]="PermanentRedirect",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.PaymentRequired=402]="PaymentRequired",s[s.Forbidden=403]="Forbidden",s[s.NotFound=404]="NotFound",s[s.MethodNotAllowed=405]="MethodNotAllowed",s[s.NotAcceptable=406]="NotAcceptable",s[s.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",s[s.RequestTimeout=408]="RequestTimeout",s[s.Conflict=409]="Conflict",s[s.Gone=410]="Gone",s[s.LengthRequired=411]="LengthRequired",s[s.PreconditionFailed=412]="PreconditionFailed",s[s.PayloadTooLarge=413]="PayloadTooLarge",s[s.UriTooLong=414]="UriTooLong",s[s.UnsupportedMediaType=415]="UnsupportedMediaType",s[s.RangeNotSatisfiable=416]="RangeNotSatisfiable",s[s.ExpectationFailed=417]="ExpectationFailed",s[s.ImATeapot=418]="ImATeapot",s[s.MisdirectedRequest=421]="MisdirectedRequest",s[s.UnprocessableEntity=422]="UnprocessableEntity",s[s.Locked=423]="Locked",s[s.FailedDependency=424]="FailedDependency",s[s.TooEarly=425]="TooEarly",s[s.UpgradeRequired=426]="UpgradeRequired",s[s.PreconditionRequired=428]="PreconditionRequired",s[s.TooManyRequests=429]="TooManyRequests",s[s.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",s[s.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",s[s.InternalServerError=500]="InternalServerError",s[s.NotImplemented=501]="NotImplemented",s[s.BadGateway=502]="BadGateway",s[s.ServiceUnavailable=503]="ServiceUnavailable",s[s.GatewayTimeout=504]="GatewayTimeout",s[s.HttpVersionNotSupported=505]="HttpVersionNotSupported",s[s.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",s[s.InsufficientStorage=507]="InsufficientStorage",s[s.LoopDetected=508]="LoopDetected",s[s.NotExtended=510]="NotExtended",s[s.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",s}(py||{});function Ob(s,a){return{body:a,headers:s.headers,context:s.context,observe:s.observe,params:s.params,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials,transferCache:s.transferCache}}var Nb=(()=>{let a=class a{constructor(d){this.handler=d}request(d,_,r={}){let M;if(d instanceof tp)M=d;else{let X;r.headers instanceof Nc?X=r.headers:X=new Nc(r.headers);let se;r.params&&(r.params instanceof bl?se=r.params:se=new bl({fromObject:r.params})),M=new tp(d,_,r.body!==void 0?r.body:null,{headers:X,context:r.context,params:se,reportProgress:r.reportProgress,responseType:r.responseType||"json",withCredentials:r.withCredentials,transferCache:r.transferCache})}let L=Gt(M).pipe(Da(X=>this.handler.handle(X)));if(d instanceof tp||r.observe==="events")return L;let B=L.pipe(oi(X=>X instanceof dy));switch(r.observe||"body"){case"body":switch(M.responseType){case"arraybuffer":return B.pipe(Ht(X=>{if(X.body!==null&&!(X.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return X.body}));case"blob":return B.pipe(Ht(X=>{if(X.body!==null&&!(X.body instanceof Blob))throw new Error("Response is not a Blob.");return X.body}));case"text":return B.pipe(Ht(X=>{if(X.body!==null&&typeof X.body!="string")throw new Error("Response is not a string.");return X.body}));case"json":default:return B.pipe(Ht(X=>X.body))}case"response":return B;default:throw new Error(`Unreachable: unhandled observe type ${r.observe}}`)}}delete(d,_={}){return this.request("DELETE",d,_)}get(d,_={}){return this.request("GET",d,_)}head(d,_={}){return this.request("HEAD",d,_)}jsonp(d,_){return this.request("JSONP",d,{params:new bl().append(_,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(d,_={}){return this.request("OPTIONS",d,_)}patch(d,_,r={}){return this.request("PATCH",d,Ob(r,_))}post(d,_,r={}){return this.request("POST",d,Ob(r,_))}put(d,_,r={}){return this.request("PUT",d,Ob(r,_))}};a.\u0275fac=function(_){return new(_||a)(Rt(np))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})();function F4(s,a){return a(s)}function N4(s,a,f){return(d,_)=>Ma(f,()=>a(d,r=>s(r,_)))}var zb=new _t(""),z4=new _t(""),B4=new _t("");var R2=(()=>{let a=class a extends np{constructor(d,_){super(),this.backend=d,this.injector=_,this.chain=null,this.pendingTasks=nt(bh);let r=nt(B4,{optional:!0});this.backend=r??d}handle(d){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(zb),...this.injector.get(z4,[])]));this.chain=r.reduceRight((M,L)=>N4(M,L,this.injector),F4)}let _=this.pendingTasks.add();return this.chain(d,r=>this.backend.handle(r)).pipe(ml(()=>this.pendingTasks.remove(_)))}};a.\u0275fac=function(_){return new(_||a)(Rt(hy),Rt(Vi))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})();var j4=/^\)\]\}',?\n/;function V4(s){return"responseURL"in s&&s.responseURL?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):null}var P2=(()=>{let a=class a{constructor(d){this.xhrFactory=d}handle(d){if(d.method==="JSONP")throw new qt(-2800,!1);let _=this.xhrFactory;return(_.\u0275loadImpl?vr(_.\u0275loadImpl()):Gt(null)).pipe(ao(()=>new yn(M=>{let L=_.build();if(L.open(d.method,d.urlWithParams),d.withCredentials&&(L.withCredentials=!0),d.headers.forEach((kt,St)=>L.setRequestHeader(kt,St.join(","))),d.headers.has("Accept")||L.setRequestHeader("Accept","application/json, text/plain, */*"),!d.headers.has("Content-Type")){let kt=d.detectContentTypeHeader();kt!==null&&L.setRequestHeader("Content-Type",kt)}if(d.responseType){let kt=d.responseType.toLowerCase();L.responseType=kt!=="json"?kt:"text"}let B=d.serializeBody(),X=null,se=()=>{if(X!==null)return X;let kt=L.statusText||"OK",St=new Nc(L.getAllResponseHeaders()),Fn=V4(L)||d.url;return X=new Fb({headers:St,status:L.status,statusText:kt,url:Fn}),X},ge=()=>{let{headers:kt,status:St,statusText:Fn,url:zn}=se(),An=null;St!==py.NoContent&&(An=typeof L.response>"u"?L.responseText:L.response),St===0&&(St=An?py.Ok:0);let Pr=St>=200&&St<300;if(d.responseType==="json"&&typeof An=="string"){let tr=An;An=An.replace(j4,"");try{An=An!==""?JSON.parse(An):null}catch(Ue){An=tr,Pr&&(Pr=!1,An={error:Ue,text:An})}}Pr?(M.next(new dy({body:An,headers:kt,status:St,statusText:Fn,url:zn||void 0})),M.complete()):M.error(new fy({error:An,headers:kt,status:St,statusText:Fn,url:zn||void 0}))},Oe=kt=>{let{url:St}=se(),Fn=new fy({error:kt,status:L.status||0,statusText:L.statusText||"Unknown Error",url:St||void 0});M.error(Fn)},at=!1,Dt=kt=>{at||(M.next(se()),at=!0);let St={type:Ah.DownloadProgress,loaded:kt.loaded};kt.lengthComputable&&(St.total=kt.total),d.responseType==="text"&&L.responseText&&(St.partialText=L.responseText),M.next(St)},Vt=kt=>{let St={type:Ah.UploadProgress,loaded:kt.loaded};kt.lengthComputable&&(St.total=kt.total),M.next(St)};return L.addEventListener("load",ge),L.addEventListener("error",Oe),L.addEventListener("timeout",Oe),L.addEventListener("abort",Oe),d.reportProgress&&(L.addEventListener("progress",Dt),B!==null&&L.upload&&L.upload.addEventListener("progress",Vt)),L.send(B),M.next({type:Ah.Sent}),()=>{L.removeEventListener("error",Oe),L.removeEventListener("abort",Oe),L.removeEventListener("load",ge),L.removeEventListener("timeout",Oe),d.reportProgress&&(L.removeEventListener("progress",Dt),B!==null&&L.upload&&L.upload.removeEventListener("progress",Vt)),L.readyState!==L.DONE&&L.abort()}})))}};a.\u0275fac=function(_){return new(_||a)(Rt(Sh))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),O2=new _t(""),U4="XSRF-TOKEN",$4=new _t("",{providedIn:"root",factory:()=>U4}),G4="X-XSRF-TOKEN",H4=new _t("",{providedIn:"root",factory:()=>G4}),my=class{},q4=(()=>{let a=class a{constructor(d,_,r){this.doc=d,this.platform=_,this.cookieName=r,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let d=this.doc.cookie||"";return d!==this.lastCookieString&&(this.parseCount++,this.lastToken=sy(d,this.cookieName),this.lastCookieString=d),this.lastToken}};a.\u0275fac=function(_){return new(_||a)(Rt(Hi),Rt(xl),Rt($4))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})();function W4(s,a){let f=s.url.toLowerCase();if(!nt(O2)||s.method==="GET"||s.method==="HEAD"||f.startsWith("http://")||f.startsWith("https://"))return a(s);let d=nt(my).getToken(),_=nt(H4);return d!=null&&!s.headers.has(_)&&(s=s.clone({headers:s.headers.set(_,d)})),a(s)}var k2=function(s){return s[s.Interceptors=0]="Interceptors",s[s.LegacyInterceptors=1]="LegacyInterceptors",s[s.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",s[s.NoXsrfProtection=3]="NoXsrfProtection",s[s.JsonpSupport=4]="JsonpSupport",s[s.RequestsMadeViaParent=5]="RequestsMadeViaParent",s[s.Fetch=6]="Fetch",s}(k2||{});function Z4(s,a){return{\u0275kind:s,\u0275providers:a}}function L2(...s){let a=[Nb,P2,R2,{provide:np,useExisting:R2},{provide:hy,useExisting:P2},{provide:zb,useValue:W4,multi:!0},{provide:O2,useValue:!0},{provide:my,useClass:q4}];for(let f of s)a.push(...f.\u0275providers);return ts(a)}function F2(s){return Z4(k2.Interceptors,s.map(a=>({provide:zb,useValue:a,multi:!0})))}var Vb=class extends oy{constructor(){super(...arguments),this.supportsDOMEvents=!0}},Ub=class s extends Vb{static makeCurrent(){y2(new s)}onAndCancel(a,f,d){return a.addEventListener(f,d),()=>{a.removeEventListener(f,d)}}dispatchEvent(a,f){a.dispatchEvent(f)}remove(a){a.parentNode&&a.parentNode.removeChild(a)}createElement(a,f){return f=f||this.getDefaultDocument(),f.createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,f){return f==="window"?window:f==="document"?a:f==="body"?a.body:null}getBaseHref(a){let f=Y4();return f==null?null:J4(f)}resetBaseElement(){ip=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return sy(document.cookie,a)}},ip=null;function Y4(){return ip=ip||document.querySelector("base"),ip?ip.getAttribute("href"):null}function J4(s){return new URL(s,document.baseURI).pathname}var K4=(()=>{let a=class a{build(){return new XMLHttpRequest}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),$b=new _t(""),j2=(()=>{let a=class a{constructor(d,_){this._zone=_,this._eventNameToPlugin=new Map,d.forEach(r=>{r.manager=this}),this._plugins=d.slice().reverse()}addEventListener(d,_,r){return this._findPluginFor(_).addEventListener(d,_,r)}getZone(){return this._zone}_findPluginFor(d){let _=this._eventNameToPlugin.get(d);if(_)return _;if(_=this._plugins.find(M=>M.supports(d)),!_)throw new qt(5101,!1);return this._eventNameToPlugin.set(d,_),_}};a.\u0275fac=function(_){return new(_||a)(Rt($b),Rt(xr))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),gy=class{constructor(a){this._doc=a}},Bb="ng-app-id",V2=(()=>{let a=class a{constructor(d,_,r,M={}){this.doc=d,this.appId=_,this.nonce=r,this.platformId=M,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=Pb(M),this.resetHostNodes()}addStyles(d){for(let _ of d)this.changeUsageCount(_,1)===1&&this.onStyleAdded(_)}removeStyles(d){for(let _ of d)this.changeUsageCount(_,-1)<=0&&this.onStyleRemoved(_)}ngOnDestroy(){let d=this.styleNodesInDOM;d&&(d.forEach(_=>_.remove()),d.clear());for(let _ of this.getAllStyles())this.onStyleRemoved(_);this.resetHostNodes()}addHost(d){this.hostNodes.add(d);for(let _ of this.getAllStyles())this.addStyleToHost(d,_)}removeHost(d){this.hostNodes.delete(d)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(d){for(let _ of this.hostNodes)this.addStyleToHost(_,d)}onStyleRemoved(d){let _=this.styleRef;_.get(d)?.elements?.forEach(r=>r.remove()),_.delete(d)}collectServerRenderedStyles(){let d=this.doc.head?.querySelectorAll(`style[${Bb}="${this.appId}"]`);if(d?.length){let _=new Map;return d.forEach(r=>{r.textContent!=null&&_.set(r.textContent,r)}),_}return null}changeUsageCount(d,_){let r=this.styleRef;if(r.has(d)){let M=r.get(d);return M.usage+=_,M.usage}return r.set(d,{usage:_,elements:[]}),_}getStyleElement(d,_){let r=this.styleNodesInDOM,M=r?.get(_);if(M?.parentNode===d)return r.delete(_),M.removeAttribute(Bb),M;{let L=this.doc.createElement("style");return this.nonce&&L.setAttribute("nonce",this.nonce),L.textContent=_,this.platformIsServer&&L.setAttribute(Bb,this.appId),d.appendChild(L),L}}addStyleToHost(d,_){let r=this.getStyleElement(d,_),M=this.styleRef,L=M.get(_)?.elements;L?L.push(r):M.set(_,{elements:[r],usage:1})}resetHostNodes(){let d=this.hostNodes;d.clear(),d.add(this.doc.head)}};a.\u0275fac=function(_){return new(_||a)(Rt(Hi),Rt(ib),Rt(sb,8),Rt(xl))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),jb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Hb=/%COMP%/g,U2="%COMP%",Q4=`_nghost-${U2}`,ej=`_ngcontent-${U2}`,tj=!0,nj=new _t("",{providedIn:"root",factory:()=>tj});function rj(s){return ej.replace(Hb,s)}function ij(s){return Q4.replace(Hb,s)}function $2(s,a){return a.map(f=>f.replace(Hb,s))}var N2=(()=>{let a=class a{constructor(d,_,r,M,L,B,X,se=null){this.eventManager=d,this.sharedStylesHost=_,this.appId=r,this.removeStylesOnCompDestroy=M,this.doc=L,this.platformId=B,this.ngZone=X,this.nonce=se,this.rendererByCompId=new Map,this.platformIsServer=Pb(B),this.defaultRenderer=new op(d,L,X,this.platformIsServer)}createRenderer(d,_){if(!d||!_)return this.defaultRenderer;this.platformIsServer&&_.encapsulation===Os.ShadowDom&&(_=Wn(It({},_),{encapsulation:Os.Emulated}));let r=this.getOrCreateRenderer(d,_);return r instanceof _y?r.applyToHost(d):r instanceof sp&&r.applyStyles(),r}getOrCreateRenderer(d,_){let r=this.rendererByCompId,M=r.get(_.id);if(!M){let L=this.doc,B=this.ngZone,X=this.eventManager,se=this.sharedStylesHost,ge=this.removeStylesOnCompDestroy,Oe=this.platformIsServer;switch(_.encapsulation){case Os.Emulated:M=new _y(X,se,_,this.appId,ge,L,B,Oe);break;case Os.ShadowDom:return new Gb(X,se,d,_,L,B,this.nonce,Oe);default:M=new sp(X,se,_,ge,L,B,Oe);break}r.set(_.id,M)}return M}ngOnDestroy(){this.rendererByCompId.clear()}};a.\u0275fac=function(_){return new(_||a)(Rt(j2),Rt(V2),Rt(ib),Rt(nj),Rt(Hi),Rt(xl),Rt(xr),Rt(sb))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),op=class{constructor(a,f,d,_){this.eventManager=a,this.doc=f,this.ngZone=d,this.platformIsServer=_,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(a,f){return f?this.doc.createElementNS(jb[f]||f,a):this.doc.createElement(a)}createComment(a){return this.doc.createComment(a)}createText(a){return this.doc.createTextNode(a)}appendChild(a,f){(z2(a)?a.content:a).appendChild(f)}insertBefore(a,f,d){a&&(z2(a)?a.content:a).insertBefore(f,d)}removeChild(a,f){a&&a.removeChild(f)}selectRootElement(a,f){let d=typeof a=="string"?this.doc.querySelector(a):a;if(!d)throw new qt(-5104,!1);return f||(d.textContent=""),d}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,f,d,_){if(_){f=_+":"+f;let r=jb[_];r?a.setAttributeNS(r,f,d):a.setAttribute(f,d)}else a.setAttribute(f,d)}removeAttribute(a,f,d){if(d){let _=jb[d];_?a.removeAttributeNS(_,f):a.removeAttribute(`${d}:${f}`)}else a.removeAttribute(f)}addClass(a,f){a.classList.add(f)}removeClass(a,f){a.classList.remove(f)}setStyle(a,f,d,_){_&(Rc.DashCase|Rc.Important)?a.style.setProperty(f,d,_&Rc.Important?"important":""):a.style[f]=d}removeStyle(a,f,d){d&Rc.DashCase?a.style.removeProperty(f):a.style[f]=""}setProperty(a,f,d){a!=null&&(a[f]=d)}setValue(a,f){a.nodeValue=f}listen(a,f,d){if(typeof a=="string"&&(a=Mh().getGlobalEventTarget(this.doc,a),!a))throw new Error(`Unsupported event target ${a} for event ${f}`);return this.eventManager.addEventListener(a,f,this.decoratePreventDefault(d))}decoratePreventDefault(a){return f=>{if(f==="__ngUnwrap__")return a;(this.platformIsServer?this.ngZone.runGuarded(()=>a(f)):a(f))===!1&&f.preventDefault()}}};function z2(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var Gb=class extends op{constructor(a,f,d,_,r,M,L,B){super(a,r,M,B),this.sharedStylesHost=f,this.hostEl=d,this.shadowRoot=d.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let X=$2(_.id,_.styles);for(let se of X){let ge=document.createElement("style");L&&ge.setAttribute("nonce",L),ge.textContent=se,this.shadowRoot.appendChild(ge)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}appendChild(a,f){return super.appendChild(this.nodeOrShadowRoot(a),f)}insertBefore(a,f,d){return super.insertBefore(this.nodeOrShadowRoot(a),f,d)}removeChild(a,f){return super.removeChild(this.nodeOrShadowRoot(a),f)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},sp=class extends op{constructor(a,f,d,_,r,M,L,B){super(a,r,M,L),this.sharedStylesHost=f,this.removeStylesOnCompDestroy=_,this.styles=B?$2(B,d.styles):d.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},_y=class extends sp{constructor(a,f,d,_,r,M,L,B){let X=_+"-"+d.id;super(a,f,d,r,M,L,B,X),this.contentAttr=rj(X),this.hostAttr=ij(X)}applyToHost(a){this.applyStyles(),this.setAttribute(a,this.hostAttr,"")}createElement(a,f){let d=super.createElement(a,f);return super.setAttribute(d,this.contentAttr,""),d}},oj=(()=>{let a=class a extends gy{constructor(d){super(d)}supports(d){return!0}addEventListener(d,_,r){return d.addEventListener(_,r,!1),()=>this.removeEventListener(d,_,r)}removeEventListener(d,_,r){return d.removeEventListener(_,r)}};a.\u0275fac=function(_){return new(_||a)(Rt(Hi))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),B2=["alt","control","meta","shift"],sj={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aj={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},lj=(()=>{let a=class a extends gy{constructor(d){super(d)}supports(d){return a.parseEventName(d)!=null}addEventListener(d,_,r){let M=a.parseEventName(_),L=a.eventCallback(M.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Mh().onAndCancel(d,M.domEventName,L))}static parseEventName(d){let _=d.toLowerCase().split("."),r=_.shift();if(_.length===0||!(r==="keydown"||r==="keyup"))return null;let M=a._normalizeKey(_.pop()),L="",B=_.indexOf("code");if(B>-1&&(_.splice(B,1),L="code."),B2.forEach(se=>{let ge=_.indexOf(se);ge>-1&&(_.splice(ge,1),L+=se+".")}),L+=M,_.length!=0||M.length===0)return null;let X={};return X.domEventName=r,X.fullKey=L,X}static matchEventFullKeyCode(d,_){let r=sj[d.key]||d.key,M="";return _.indexOf("code.")>-1&&(r=d.code,M="code."),r==null||!r?!1:(r=r.toLowerCase(),r===" "?r="space":r==="."&&(r="dot"),B2.forEach(L=>{if(L!==r){let B=aj[L];B(d)&&(M+=L+".")}}),M+=r,M===_)}static eventCallback(d,_,r){return M=>{a.matchEventFullKeyCode(M,d)&&r.runGuarded(()=>_(M))}}static _normalizeKey(d){return d==="esc"?"escape":d}};a.\u0275fac=function(_){return new(_||a)(Rt(Hi))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})();function G2(s,a){return u2(It({rootComponent:s},cj(a)))}function cj(s){return{appProviders:[...pj,...s?.providers??[]],platformProviders:fj}}function uj(){Ub.makeCurrent()}function hj(){return new es}function dj(){return _A(document),document}var fj=[{provide:xl,useValue:I2},{provide:ob,useValue:uj,multi:!0},{provide:Hi,useFactory:dj,deps:[]}];var pj=[{provide:F_,useValue:"root"},{provide:es,useFactory:hj,deps:[]},{provide:$b,useClass:oj,multi:!0,deps:[Hi,xr,xl]},{provide:$b,useClass:lj,multi:!0,deps:[Hi]},N2,V2,j2,{provide:jf,useExisting:N2},{provide:Sh,useClass:K4,deps:[]},[]];var H2=(()=>{let a=class a{constructor(d){this._doc=d}getTitle(){return this._doc.title}setTitle(d){this._doc.title=d||""}};a.\u0275fac=function(_){return new(_||a)(Rt(Hi))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var fn="primary",bp=Symbol("RouteTitle"),Yb=class{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){let f=this.params[a];return Array.isArray(f)?f[0]:f}return null}getAll(a){if(this.has(a)){let f=this.params[a];return Array.isArray(f)?f:[f]}return[]}get keys(){return Object.keys(this.params)}};function Lh(s){return new Yb(s)}function gj(s,a,f){let d=f.path.split("/");if(d.length>s.length||f.pathMatch==="full"&&(a.hasChildren()||d.length<s.length))return null;let _={};for(let r=0;r<d.length;r++){let M=d[r],L=s[r];if(M.startsWith(":"))_[M.substring(1)]=L;else if(M!==L.path)return null}return{consumed:s.slice(0,d.length),posParams:_}}function _j(s,a){if(s.length!==a.length)return!1;for(let f=0;f<s.length;++f)if(!zs(s[f],a[f]))return!1;return!0}function zs(s,a){let f=s?Jb(s):void 0,d=a?Jb(a):void 0;if(!f||!d||f.length!=d.length)return!1;let _;for(let r=0;r<f.length;r++)if(_=f[r],!J2(s[_],a[_]))return!1;return!0}function Jb(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function J2(s,a){if(Array.isArray(s)&&Array.isArray(a)){if(s.length!==a.length)return!1;let f=[...s].sort(),d=[...a].sort();return f.every((_,r)=>d[r]===_)}else return s===a}function K2(s){return s.length>0?s[s.length-1]:null}function Il(s){return Rx(s)?s:Th(s)?vr(Promise.resolve(s)):Gt(s)}var yj={exact:eR,subset:tR},Q2={exact:vj,subset:xj,ignored:()=>!0};function q2(s,a,f){return yj[f.paths](s.root,a.root,f.matrixParams)&&Q2[f.queryParams](s.queryParams,a.queryParams)&&!(f.fragment==="exact"&&s.fragment!==a.fragment)}function vj(s,a){return zs(s,a)}function eR(s,a,f){if(!Bc(s.segments,a.segments)||!xy(s.segments,a.segments,f)||s.numberOfChildren!==a.numberOfChildren)return!1;for(let d in a.children)if(!s.children[d]||!eR(s.children[d],a.children[d],f))return!1;return!0}function xj(s,a){return Object.keys(a).length<=Object.keys(s).length&&Object.keys(a).every(f=>J2(s[f],a[f]))}function tR(s,a,f){return nR(s,a,a.segments,f)}function nR(s,a,f,d){if(s.segments.length>f.length){let _=s.segments.slice(0,f.length);return!(!Bc(_,f)||a.hasChildren()||!xy(_,f,d))}else if(s.segments.length===f.length){if(!Bc(s.segments,f)||!xy(s.segments,f,d))return!1;for(let _ in a.children)if(!s.children[_]||!tR(s.children[_],a.children[_],d))return!1;return!0}else{let _=f.slice(0,s.segments.length),r=f.slice(s.segments.length);return!Bc(s.segments,_)||!xy(s.segments,_,d)||!s.children[fn]?!1:nR(s.children[fn],a,r,d)}}function xy(s,a,f){return a.every((d,_)=>Q2[f](s[_].parameters,d.parameters))}var wl=class{constructor(a=new Jn([],{}),f={},d=null){this.root=a,this.queryParams=f,this.fragment=d}get queryParamMap(){return this._queryParamMap??=Lh(this.queryParams),this._queryParamMap}toString(){return Ej.serialize(this)}},Jn=class{constructor(a,f){this.segments=a,this.children=f,this.parent=null,Object.values(f).forEach(d=>d.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return by(this)}},zc=class{constructor(a,f){this.path=a,this.parameters=f}get parameterMap(){return this._parameterMap??=Lh(this.parameters),this._parameterMap}toString(){return iR(this)}};function bj(s,a){return Bc(s,a)&&s.every((f,d)=>zs(f.parameters,a[d].parameters))}function Bc(s,a){return s.length!==a.length?!1:s.every((f,d)=>f.path===a[d].path)}function wj(s,a){let f=[];return Object.entries(s.children).forEach(([d,_])=>{d===fn&&(f=f.concat(a(_,d)))}),Object.entries(s.children).forEach(([d,_])=>{d!==fn&&(f=f.concat(a(_,d)))}),f}var Ew=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>new Ey,providedIn:"root"});let s=a;return s})(),Ey=class{parse(a){let f=new Qb(a);return new wl(f.parseRootSegment(),f.parseQueryParams(),f.parseFragment())}serialize(a){let f=`/${ap(a.root,!0)}`,d=Dj(a.queryParams),_=typeof a.fragment=="string"?`#${Tj(a.fragment)}`:"";return`${f}${d}${_}`}},Ej=new Ey;function by(s){return s.segments.map(a=>iR(a)).join("/")}function ap(s,a){if(!s.hasChildren())return by(s);if(a){let f=s.children[fn]?ap(s.children[fn],!1):"",d=[];return Object.entries(s.children).forEach(([_,r])=>{_!==fn&&d.push(`${_}:${ap(r,!1)}`)}),d.length>0?`${f}(${d.join("//")})`:f}else{let f=wj(s,(d,_)=>_===fn?[ap(s.children[fn],!1)]:[`${_}:${ap(d,!1)}`]);return Object.keys(s.children).length===1&&s.children[fn]!=null?`${by(s)}/${f[0]}`:`${by(s)}/(${f.join("//")})`}}function rR(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function yy(s){return rR(s).replace(/%3B/gi,";")}function Tj(s){return encodeURI(s)}function Kb(s){return rR(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function wy(s){return decodeURIComponent(s)}function W2(s){return wy(s.replace(/\+/g,"%20"))}function iR(s){return`${Kb(s.path)}${Ij(s.parameters)}`}function Ij(s){return Object.entries(s).map(([a,f])=>`;${Kb(a)}=${Kb(f)}`).join("")}function Dj(s){let a=Object.entries(s).map(([f,d])=>Array.isArray(d)?d.map(_=>`${yy(f)}=${yy(_)}`).join("&"):`${yy(f)}=${yy(d)}`).filter(f=>f);return a.length?`?${a.join("&")}`:""}var Mj=/^[^\/()?;#]+/;function qb(s){let a=s.match(Mj);return a?a[0]:""}var Sj=/^[^\/()?;=#]+/;function Cj(s){let a=s.match(Sj);return a?a[0]:""}var Aj=/^[^=?&#]+/;function Rj(s){let a=s.match(Aj);return a?a[0]:""}var Pj=/^[^&#]+/;function Oj(s){let a=s.match(Pj);return a?a[0]:""}var Qb=class{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Jn([],{}):new Jn([],this.parseChildren())}parseQueryParams(){let a={};if(this.consumeOptional("?"))do this.parseQueryParam(a);while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let f={};this.peekStartsWith("/(")&&(this.capture("/"),f=this.parseParens(!0));let d={};return this.peekStartsWith("(")&&(d=this.parseParens(!1)),(a.length>0||Object.keys(f).length>0)&&(d[fn]=new Jn(a,f)),d}parseSegment(){let a=qb(this.remaining);if(a===""&&this.peekStartsWith(";"))throw new qt(4009,!1);return this.capture(a),new zc(wy(a),this.parseMatrixParams())}parseMatrixParams(){let a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){let f=Cj(this.remaining);if(!f)return;this.capture(f);let d="";if(this.consumeOptional("=")){let _=qb(this.remaining);_&&(d=_,this.capture(d))}a[wy(f)]=wy(d)}parseQueryParam(a){let f=Rj(this.remaining);if(!f)return;this.capture(f);let d="";if(this.consumeOptional("=")){let M=Oj(this.remaining);M&&(d=M,this.capture(d))}let _=W2(f),r=W2(d);if(a.hasOwnProperty(_)){let M=a[_];Array.isArray(M)||(M=[M],a[_]=M),M.push(r)}else a[_]=r}parseParens(a){let f={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let d=qb(this.remaining),_=this.remaining[d.length];if(_!=="/"&&_!==")"&&_!==";")throw new qt(4010,!1);let r;d.indexOf(":")>-1?(r=d.slice(0,d.indexOf(":")),this.capture(r),this.capture(":")):a&&(r=fn);let M=this.parseChildren();f[r]=Object.keys(M).length===1?M[fn]:new Jn([],M),this.consumeOptional("//")}return f}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return this.peekStartsWith(a)?(this.remaining=this.remaining.substring(a.length),!0):!1}capture(a){if(!this.consumeOptional(a))throw new qt(4011,!1)}};function oR(s){return s.segments.length>0?new Jn([],{[fn]:s}):s}function sR(s){let a={};for(let[d,_]of Object.entries(s.children)){let r=sR(_);if(d===fn&&r.segments.length===0&&r.hasChildren())for(let[M,L]of Object.entries(r.children))a[M]=L;else(r.segments.length>0||r.hasChildren())&&(a[d]=r)}let f=new Jn(s.segments,a);return kj(f)}function kj(s){if(s.numberOfChildren===1&&s.children[fn]){let a=s.children[fn];return new Jn(s.segments.concat(a.segments),a.children)}return s}function Fh(s){return s instanceof wl}function Lj(s,a,f=null,d=null){let _=aR(s);return lR(_,a,f,d)}function aR(s){let a;function f(r){let M={};for(let B of r.children){let X=f(B);M[B.outlet]=X}let L=new Jn(r.url,M);return r===s&&(a=L),L}let d=f(s.root),_=oR(d);return a??_}function lR(s,a,f,d){let _=s;for(;_.parent;)_=_.parent;if(a.length===0)return Wb(_,_,_,f,d);let r=Fj(a);if(r.toRoot())return Wb(_,_,new Jn([],{}),f,d);let M=Nj(r,_,s),L=M.processChildren?up(M.segmentGroup,M.index,r.commands):uR(M.segmentGroup,M.index,r.commands);return Wb(_,M.segmentGroup,L,f,d)}function Ty(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function fp(s){return typeof s=="object"&&s!=null&&s.outlets}function Wb(s,a,f,d,_){let r={};d&&Object.entries(d).forEach(([B,X])=>{r[B]=Array.isArray(X)?X.map(se=>`${se}`):`${X}`});let M;s===a?M=f:M=cR(s,a,f);let L=oR(sR(M));return new wl(L,r,_)}function cR(s,a,f){let d={};return Object.entries(s.children).forEach(([_,r])=>{r===a?d[_]=f:d[_]=cR(r,a,f)}),new Jn(s.segments,d)}var Iy=class{constructor(a,f,d){if(this.isAbsolute=a,this.numberOfDoubleDots=f,this.commands=d,a&&d.length>0&&Ty(d[0]))throw new qt(4003,!1);let _=d.find(fp);if(_&&_!==K2(d))throw new qt(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Fj(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new Iy(!0,0,s);let a=0,f=!1,d=s.reduce((_,r,M)=>{if(typeof r=="object"&&r!=null){if(r.outlets){let L={};return Object.entries(r.outlets).forEach(([B,X])=>{L[B]=typeof X=="string"?X.split("/"):X}),[..._,{outlets:L}]}if(r.segmentPath)return[..._,r.segmentPath]}return typeof r!="string"?[..._,r]:M===0?(r.split("/").forEach((L,B)=>{B==0&&L==="."||(B==0&&L===""?f=!0:L===".."?a++:L!=""&&_.push(L))}),_):[..._,r]},[]);return new Iy(f,a,d)}var Oh=class{constructor(a,f,d){this.segmentGroup=a,this.processChildren=f,this.index=d}};function Nj(s,a,f){if(s.isAbsolute)return new Oh(a,!0,0);if(!f)return new Oh(a,!1,NaN);if(f.parent===null)return new Oh(f,!0,0);let d=Ty(s.commands[0])?0:1,_=f.segments.length-1+d;return zj(f,_,s.numberOfDoubleDots)}function zj(s,a,f){let d=s,_=a,r=f;for(;r>_;){if(r-=_,d=d.parent,!d)throw new qt(4005,!1);_=d.segments.length}return new Oh(d,!1,_-r)}function Bj(s){return fp(s[0])?s[0].outlets:{[fn]:s}}function uR(s,a,f){if(s??=new Jn([],{}),s.segments.length===0&&s.hasChildren())return up(s,a,f);let d=jj(s,a,f),_=f.slice(d.commandIndex);if(d.match&&d.pathIndex<s.segments.length){let r=new Jn(s.segments.slice(0,d.pathIndex),{});return r.children[fn]=new Jn(s.segments.slice(d.pathIndex),s.children),up(r,0,_)}else return d.match&&_.length===0?new Jn(s.segments,{}):d.match&&!s.hasChildren()?ew(s,a,f):d.match?up(s,0,_):ew(s,a,f)}function up(s,a,f){if(f.length===0)return new Jn(s.segments,{});{let d=Bj(f),_={};if(Object.keys(d).some(r=>r!==fn)&&s.children[fn]&&s.numberOfChildren===1&&s.children[fn].segments.length===0){let r=up(s.children[fn],a,f);return new Jn(s.segments,r.children)}return Object.entries(d).forEach(([r,M])=>{typeof M=="string"&&(M=[M]),M!==null&&(_[r]=uR(s.children[r],a,M))}),Object.entries(s.children).forEach(([r,M])=>{d[r]===void 0&&(_[r]=M)}),new Jn(s.segments,_)}}function jj(s,a,f){let d=0,_=a,r={match:!1,pathIndex:0,commandIndex:0};for(;_<s.segments.length;){if(d>=f.length)return r;let M=s.segments[_],L=f[d];if(fp(L))break;let B=`${L}`,X=d<f.length-1?f[d+1]:null;if(_>0&&B===void 0)break;if(B&&X&&typeof X=="object"&&X.outlets===void 0){if(!X2(B,X,M))return r;d+=2}else{if(!X2(B,{},M))return r;d++}_++}return{match:!0,pathIndex:_,commandIndex:d}}function ew(s,a,f){let d=s.segments.slice(0,a),_=0;for(;_<f.length;){let r=f[_];if(fp(r)){let B=Vj(r.outlets);return new Jn(d,B)}if(_===0&&Ty(f[0])){let B=s.segments[a];d.push(new zc(B.path,Z2(f[0]))),_++;continue}let M=fp(r)?r.outlets[fn]:`${r}`,L=_<f.length-1?f[_+1]:null;M&&L&&Ty(L)?(d.push(new zc(M,Z2(L))),_+=2):(d.push(new zc(M,{})),_++)}return new Jn(d,{})}function Vj(s){let a={};return Object.entries(s).forEach(([f,d])=>{typeof d=="string"&&(d=[d]),d!==null&&(a[f]=ew(new Jn([],{}),0,d))}),a}function Z2(s){let a={};return Object.entries(s).forEach(([f,d])=>a[f]=`${d}`),a}function X2(s,a,f){return s==f.path&&zs(a,f.parameters)}var hp="imperative",li=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(li||{}),So=class{constructor(a,f){this.id=a,this.url=f}},pp=class extends So{constructor(a,f,d="imperative",_=null){super(a,f),this.type=li.NavigationStart,this.navigationTrigger=d,this.restoredState=_}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},El=class extends So{constructor(a,f,d){super(a,f),this.urlAfterRedirects=d,this.type=li.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},co=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(co||{}),tw=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(tw||{}),Tl=class extends So{constructor(a,f,d,_){super(a,f),this.reason=d,this.code=_,this.type=li.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},jc=class extends So{constructor(a,f,d,_){super(a,f),this.reason=d,this.code=_,this.type=li.NavigationSkipped}},mp=class extends So{constructor(a,f,d,_){super(a,f),this.error=d,this.target=_,this.type=li.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Dy=class extends So{constructor(a,f,d,_){super(a,f),this.urlAfterRedirects=d,this.state=_,this.type=li.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},nw=class extends So{constructor(a,f,d,_){super(a,f),this.urlAfterRedirects=d,this.state=_,this.type=li.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},rw=class extends So{constructor(a,f,d,_,r){super(a,f),this.urlAfterRedirects=d,this.state=_,this.shouldActivate=r,this.type=li.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},iw=class extends So{constructor(a,f,d,_){super(a,f),this.urlAfterRedirects=d,this.state=_,this.type=li.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},ow=class extends So{constructor(a,f,d,_){super(a,f),this.urlAfterRedirects=d,this.state=_,this.type=li.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},sw=class{constructor(a){this.route=a,this.type=li.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},aw=class{constructor(a){this.route=a,this.type=li.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},lw=class{constructor(a){this.snapshot=a,this.type=li.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},cw=class{constructor(a){this.snapshot=a,this.type=li.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},uw=class{constructor(a){this.snapshot=a,this.type=li.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},hw=class{constructor(a){this.snapshot=a,this.type=li.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var gp=class{},_p=class{constructor(a){this.url=a}};var dw=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Py,this.attachRef=null}},Py=(()=>{let a=class a{constructor(){this.contexts=new Map}onChildOutletCreated(d,_){let r=this.getOrCreateContext(d);r.outlet=_,this.contexts.set(d,r)}onChildOutletDestroyed(d){let _=this.getContext(d);_&&(_.outlet=null,_.attachRef=null)}onOutletDeactivated(){let d=this.contexts;return this.contexts=new Map,d}onOutletReAttached(d){this.contexts=d}getOrCreateContext(d){let _=this.getContext(d);return _||(_=new dw,this.contexts.set(d,_)),_}getContext(d){return this.contexts.get(d)||null}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),My=class{constructor(a){this._root=a}get root(){return this._root.value}parent(a){let f=this.pathFromRoot(a);return f.length>1?f[f.length-2]:null}children(a){let f=fw(a,this._root);return f?f.children.map(d=>d.value):[]}firstChild(a){let f=fw(a,this._root);return f&&f.children.length>0?f.children[0].value:null}siblings(a){let f=pw(a,this._root);return f.length<2?[]:f[f.length-2].children.map(_=>_.value).filter(_=>_!==a)}pathFromRoot(a){return pw(a,this._root).map(f=>f.value)}};function fw(s,a){if(s===a.value)return a;for(let f of a.children){let d=fw(s,f);if(d)return d}return null}function pw(s,a){if(s===a.value)return[a];for(let f of a.children){let d=pw(s,f);if(d.length)return d.unshift(a),d}return[]}var lo=class{constructor(a,f){this.value=a,this.children=f}toString(){return`TreeNode(${this.value})`}};function Ph(s){let a={};return s&&s.children.forEach(f=>a[f.value.outlet]=f),a}var Sy=class extends My{constructor(a,f){super(a),this.snapshot=f,Iw(this,a)}toString(){return this.snapshot.toString()}};function hR(s){let a=Uj(s),f=new Rr([new zc("",{})]),d=new Rr({}),_=new Rr({}),r=new Rr({}),M=new Rr(""),L=new Vc(f,d,r,M,_,fn,s,a.root);return L.snapshot=a.root,new Sy(new lo(L,[]),a)}function Uj(s){let a={},f={},d={},_="",r=new yp([],a,d,_,f,fn,s,null,{});return new Cy("",new lo(r,[]))}var Vc=class{constructor(a,f,d,_,r,M,L,B){this.urlSubject=a,this.paramsSubject=f,this.queryParamsSubject=d,this.fragmentSubject=_,this.dataSubject=r,this.outlet=M,this.component=L,this._futureSnapshot=B,this.title=this.dataSubject?.pipe(Ht(X=>X[bp]))??Gt(void 0),this.url=a,this.params=f,this.queryParams=d,this.fragment=_,this.data=r}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ht(a=>Lh(a))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ht(a=>Lh(a))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Tw(s,a,f="emptyOnly"){let d,{routeConfig:_}=s;return a!==null&&(f==="always"||_?.path===""||!a.component&&!a.routeConfig?.loadComponent)?d={params:It(It({},a.params),s.params),data:It(It({},a.data),s.data),resolve:It(It(It(It({},s.data),a.data),_?.data),s._resolvedData)}:d={params:It({},s.params),data:It({},s.data),resolve:It(It({},s.data),s._resolvedData??{})},_&&fR(_)&&(d.resolve[bp]=_.title),d}var yp=class{get title(){return this.data?.[bp]}constructor(a,f,d,_,r,M,L,B,X){this.url=a,this.params=f,this.queryParams=d,this.fragment=_,this.data=r,this.outlet=M,this.component=L,this.routeConfig=B,this._resolve=X}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Lh(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Lh(this.queryParams),this._queryParamMap}toString(){let a=this.url.map(d=>d.toString()).join("/"),f=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${a}', path:'${f}')`}},Cy=class extends My{constructor(a,f){super(f),this.url=a,Iw(this,f)}toString(){return dR(this._root)}};function Iw(s,a){a.value._routerState=s,a.children.forEach(f=>Iw(s,f))}function dR(s){let a=s.children.length>0?` { ${s.children.map(dR).join(", ")} } `:"";return`${s.value}${a}`}function Zb(s){if(s.snapshot){let a=s.snapshot,f=s._futureSnapshot;s.snapshot=f,zs(a.queryParams,f.queryParams)||s.queryParamsSubject.next(f.queryParams),a.fragment!==f.fragment&&s.fragmentSubject.next(f.fragment),zs(a.params,f.params)||s.paramsSubject.next(f.params),_j(a.url,f.url)||s.urlSubject.next(f.url),zs(a.data,f.data)||s.dataSubject.next(f.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function mw(s,a){let f=zs(s.params,a.params)&&bj(s.url,a.url),d=!s.parent!=!a.parent;return f&&!d&&(!s.parent||mw(s.parent,a.parent))}function fR(s){return typeof s.title=="string"||s.title===null}var Dw=(()=>{let a=class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=fn,this.activateEvents=new Xo,this.deactivateEvents=new Xo,this.attachEvents=new Xo,this.detachEvents=new Xo,this.parentContexts=nt(Py),this.location=nt(xh),this.changeDetector=nt(Dh),this.environmentInjector=nt(Vi),this.inputBinder=nt(Mw,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(d){if(d.name){let{firstChange:_,previousValue:r}=d.name;if(_)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(d){return this.parentContexts.getContext(d)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let d=this.parentContexts.getContext(this.name);d?.route&&(d.attachRef?this.attach(d.attachRef,d.route):this.activateWith(d.route,d.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new qt(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new qt(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new qt(4012,!1);this.location.detach();let d=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(d.instance),d}attach(d,_){this.activated=d,this._activatedRoute=_,this.location.insert(d.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(d.instance)}deactivate(){if(this.activated){let d=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(d)}}activateWith(d,_){if(this.isActivated)throw new qt(4013,!1);this._activatedRoute=d;let r=this.location,L=d.snapshot.component,B=this.parentContexts.getOrCreateContext(this.name).children,X=new gw(d,B,r.injector);this.activated=r.createComponent(L,{index:r.length,injector:X,environmentInjector:_??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275dir=Ac({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Gf]});let s=a;return s})(),gw=class{constructor(a,f,d){this.route=a,this.childContexts=f,this.parent=d}get(a,f){return a===Vc?this.route:a===Py?this.childContexts:this.parent.get(a,f)}},Mw=new _t("");function $j(s,a,f){let d=vp(s,a._root,f?f._root:void 0);return new Sy(d,a)}function vp(s,a,f){if(f&&s.shouldReuseRoute(a.value,f.value.snapshot)){let d=f.value;d._futureSnapshot=a.value;let _=Gj(s,a,f);return new lo(d,_)}else{if(s.shouldAttach(a.value)){let r=s.retrieve(a.value);if(r!==null){let M=r.route;return M.value._futureSnapshot=a.value,M.children=a.children.map(L=>vp(s,L)),M}}let d=Hj(a.value),_=a.children.map(r=>vp(s,r));return new lo(d,_)}}function Gj(s,a,f){return a.children.map(d=>{for(let _ of f.children)if(s.shouldReuseRoute(d.value,_.value.snapshot))return vp(s,d,_);return vp(s,d)})}function Hj(s){return new Vc(new Rr(s.url),new Rr(s.params),new Rr(s.queryParams),new Rr(s.fragment),new Rr(s.data),s.outlet,s.component,s)}var pR="ngNavigationCancelingError";function mR(s,a){let{redirectTo:f,navigationBehaviorOptions:d}=Fh(a)?{redirectTo:a,navigationBehaviorOptions:void 0}:a,_=gR(!1,co.Redirect);return _.url=f,_.navigationBehaviorOptions=d,_}function gR(s,a){let f=new Error(`NavigationCancelingError: ${s||""}`);return f[pR]=!0,f.cancellationCode=a,f}function qj(s){return _R(s)&&Fh(s.url)}function _R(s){return!!s&&s[pR]}var Wj=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ui({type:a,selectors:[["ng-component"]],standalone:!0,features:[$i],decls:1,vars:0,template:function(_,r){_&1&&Pc(0,"router-outlet")},dependencies:[Dw],encapsulation:2});let s=a;return s})();function Zj(s,a){return s.providers&&!s._injector&&(s._injector=xb(s.providers,a,`Route: ${s.path}`)),s._injector??a}function Sw(s){let a=s.children&&s.children.map(Sw),f=a?Wn(It({},s),{children:a}):It({},s);return!f.component&&!f.loadComponent&&(a||f.loadChildren)&&f.outlet&&f.outlet!==fn&&(f.component=Wj),f}function Bs(s){return s.outlet||fn}function Xj(s,a){let f=s.filter(d=>Bs(d)===a);return f.push(...s.filter(d=>Bs(d)!==a)),f}function wp(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let a=s.parent;a;a=a.parent){let f=a.routeConfig;if(f?._loadedInjector)return f._loadedInjector;if(f?._injector)return f._injector}return null}var Yj=(s,a,f,d)=>Ht(_=>(new _w(a,_.targetRouterState,_.currentRouterState,f,d).activate(s),_)),_w=class{constructor(a,f,d,_,r){this.routeReuseStrategy=a,this.futureState=f,this.currState=d,this.forwardEvent=_,this.inputBindingEnabled=r}activate(a){let f=this.futureState._root,d=this.currState?this.currState._root:null;this.deactivateChildRoutes(f,d,a),Zb(this.futureState.root),this.activateChildRoutes(f,d,a)}deactivateChildRoutes(a,f,d){let _=Ph(f);a.children.forEach(r=>{let M=r.value.outlet;this.deactivateRoutes(r,_[M],d),delete _[M]}),Object.values(_).forEach(r=>{this.deactivateRouteAndItsChildren(r,d)})}deactivateRoutes(a,f,d){let _=a.value,r=f?f.value:null;if(_===r)if(_.component){let M=d.getContext(_.outlet);M&&this.deactivateChildRoutes(a,f,M.children)}else this.deactivateChildRoutes(a,f,d);else r&&this.deactivateRouteAndItsChildren(f,d)}deactivateRouteAndItsChildren(a,f){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,f):this.deactivateRouteAndOutlet(a,f)}detachAndStoreRouteSubtree(a,f){let d=f.getContext(a.value.outlet),_=d&&a.value.component?d.children:f,r=Ph(a);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,_);if(d&&d.outlet){let M=d.outlet.detach(),L=d.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:M,route:a,contexts:L})}}deactivateRouteAndOutlet(a,f){let d=f.getContext(a.value.outlet),_=d&&a.value.component?d.children:f,r=Ph(a);for(let M of Object.values(r))this.deactivateRouteAndItsChildren(M,_);d&&(d.outlet&&(d.outlet.deactivate(),d.children.onOutletDeactivated()),d.attachRef=null,d.route=null)}activateChildRoutes(a,f,d){let _=Ph(f);a.children.forEach(r=>{this.activateRoutes(r,_[r.value.outlet],d),this.forwardEvent(new hw(r.value.snapshot))}),a.children.length&&this.forwardEvent(new cw(a.value.snapshot))}activateRoutes(a,f,d){let _=a.value,r=f?f.value:null;if(Zb(_),_===r)if(_.component){let M=d.getOrCreateContext(_.outlet);this.activateChildRoutes(a,f,M.children)}else this.activateChildRoutes(a,f,d);else if(_.component){let M=d.getOrCreateContext(_.outlet);if(this.routeReuseStrategy.shouldAttach(_.snapshot)){let L=this.routeReuseStrategy.retrieve(_.snapshot);this.routeReuseStrategy.store(_.snapshot,null),M.children.onOutletReAttached(L.contexts),M.attachRef=L.componentRef,M.route=L.route.value,M.outlet&&M.outlet.attach(L.componentRef,L.route.value),Zb(L.route.value),this.activateChildRoutes(a,null,M.children)}else{let L=wp(_.snapshot);M.attachRef=null,M.route=_,M.injector=L,M.outlet&&M.outlet.activateWith(_,M.injector),this.activateChildRoutes(a,null,M.children)}}else this.activateChildRoutes(a,null,d)}},Ay=class{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}},kh=class{constructor(a,f){this.component=a,this.route=f}};function Jj(s,a,f){let d=s._root,_=a?a._root:null;return lp(d,_,f,[d.value])}function Kj(s){let a=s.routeConfig?s.routeConfig.canActivateChild:null;return!a||a.length===0?null:{node:s,guards:a}}function zh(s,a){let f=Symbol(),d=a.get(s,f);return d===f?typeof s=="function"&&!hC(s)?s:a.get(s):d}function lp(s,a,f,d,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=Ph(a);return s.children.forEach(M=>{Qj(M,r[M.value.outlet],f,d.concat([M.value]),_),delete r[M.value.outlet]}),Object.entries(r).forEach(([M,L])=>dp(L,f.getContext(M),_)),_}function Qj(s,a,f,d,_={canDeactivateChecks:[],canActivateChecks:[]}){let r=s.value,M=a?a.value:null,L=f?f.getContext(s.value.outlet):null;if(M&&r.routeConfig===M.routeConfig){let B=e5(M,r,r.routeConfig.runGuardsAndResolvers);B?_.canActivateChecks.push(new Ay(d)):(r.data=M.data,r._resolvedData=M._resolvedData),r.component?lp(s,a,L?L.children:null,d,_):lp(s,a,f,d,_),B&&L&&L.outlet&&L.outlet.isActivated&&_.canDeactivateChecks.push(new kh(L.outlet.component,M))}else M&&dp(a,L,_),_.canActivateChecks.push(new Ay(d)),r.component?lp(s,null,L?L.children:null,d,_):lp(s,null,f,d,_);return _}function e5(s,a,f){if(typeof f=="function")return f(s,a);switch(f){case"pathParamsChange":return!Bc(s.url,a.url);case"pathParamsOrQueryParamsChange":return!Bc(s.url,a.url)||!zs(s.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!mw(s,a)||!zs(s.queryParams,a.queryParams);case"paramsChange":default:return!mw(s,a)}}function dp(s,a,f){let d=Ph(s),_=s.value;Object.entries(d).forEach(([r,M])=>{_.component?a?dp(M,a.children.getContext(r),f):dp(M,null,f):dp(M,a,f)}),_.component?a&&a.outlet&&a.outlet.isActivated?f.canDeactivateChecks.push(new kh(a.outlet.component,_)):f.canDeactivateChecks.push(new kh(null,_)):f.canDeactivateChecks.push(new kh(null,_))}function Ep(s){return typeof s=="function"}function t5(s){return typeof s=="boolean"}function n5(s){return s&&Ep(s.canLoad)}function r5(s){return s&&Ep(s.canActivate)}function i5(s){return s&&Ep(s.canActivateChild)}function o5(s){return s&&Ep(s.canDeactivate)}function s5(s){return s&&Ep(s.canMatch)}function yR(s){return s instanceof Ia||s?.name==="EmptyError"}var vy=Symbol("INITIAL_VALUE");function Nh(){return ao(s=>t_(s.map(a=>a.pipe(Wo(1),Bx(vy)))).pipe(Ht(a=>{for(let f of a)if(f!==!0){if(f===vy)return vy;if(f===!1||f instanceof wl)return f}return!0}),oi(a=>a!==vy),Wo(1)))}function a5(s,a){return Er(f=>{let{targetSnapshot:d,currentSnapshot:_,guards:{canActivateChecks:r,canDeactivateChecks:M}}=f;return M.length===0&&r.length===0?Gt(Wn(It({},f),{guardsResult:!0})):l5(M,d,_,s).pipe(Er(L=>L&&t5(L)?c5(d,r,s,a):Gt(L)),Ht(L=>Wn(It({},f),{guardsResult:L})))})}function l5(s,a,f,d){return vr(s).pipe(Er(_=>p5(_.component,_.route,f,a,d)),As(_=>_!==!0,!0))}function c5(s,a,f,d){return vr(a).pipe(Da(_=>ah(h5(_.route.parent,d),u5(_.route,d),f5(s,_.path,f),d5(s,_.route,f))),As(_=>_!==!0,!0))}function u5(s,a){return s!==null&&a&&a(new uw(s)),Gt(!0)}function h5(s,a){return s!==null&&a&&a(new lw(s)),Gt(!0)}function d5(s,a,f){let d=a.routeConfig?a.routeConfig.canActivate:null;if(!d||d.length===0)return Gt(!0);let _=d.map(r=>Sf(()=>{let M=wp(a)??f,L=zh(r,M),B=r5(L)?L.canActivate(a,s):Ma(M,()=>L(a,s));return Il(B).pipe(As())}));return Gt(_).pipe(Nh())}function f5(s,a,f){let d=a[a.length-1],r=a.slice(0,a.length-1).reverse().map(M=>Kj(M)).filter(M=>M!==null).map(M=>Sf(()=>{let L=M.guards.map(B=>{let X=wp(M.node)??f,se=zh(B,X),ge=i5(se)?se.canActivateChild(d,s):Ma(X,()=>se(d,s));return Il(ge).pipe(As())});return Gt(L).pipe(Nh())}));return Gt(r).pipe(Nh())}function p5(s,a,f,d,_){let r=a&&a.routeConfig?a.routeConfig.canDeactivate:null;if(!r||r.length===0)return Gt(!0);let M=r.map(L=>{let B=wp(a)??_,X=zh(L,B),se=o5(X)?X.canDeactivate(s,a,f,d):Ma(B,()=>X(s,a,f,d));return Il(se).pipe(As())});return Gt(M).pipe(Nh())}function m5(s,a,f,d){let _=a.canLoad;if(_===void 0||_.length===0)return Gt(!0);let r=_.map(M=>{let L=zh(M,s),B=n5(L)?L.canLoad(a,f):Ma(s,()=>L(a,f));return Il(B)});return Gt(r).pipe(Nh(),vR(d))}function vR(s){return Tx(Wr(a=>{if(Fh(a))throw mR(s,a)}),Ht(a=>a===!0))}function g5(s,a,f,d){let _=a.canMatch;if(!_||_.length===0)return Gt(!0);let r=_.map(M=>{let L=zh(M,s),B=s5(L)?L.canMatch(a,f):Ma(s,()=>L(a,f));return Il(B)});return Gt(r).pipe(Nh(),vR(d))}var xp=class{constructor(a){this.segmentGroup=a||null}},Ry=class extends Error{constructor(a){super(),this.urlTree=a}};function Rh(s){return hl(new xp(s))}function _5(s){return hl(new qt(4e3,!1))}function y5(s){return hl(gR(!1,co.GuardRejected))}var yw=class{constructor(a,f){this.urlSerializer=a,this.urlTree=f}lineralizeSegments(a,f){let d=[],_=f.root;for(;;){if(d=d.concat(_.segments),_.numberOfChildren===0)return Gt(d);if(_.numberOfChildren>1||!_.children[fn])return _5(a.redirectTo);_=_.children[fn]}}applyRedirectCommands(a,f,d){let _=this.applyRedirectCreateUrlTree(f,this.urlSerializer.parse(f),a,d);if(f.startsWith("/"))throw new Ry(_);return _}applyRedirectCreateUrlTree(a,f,d,_){let r=this.createSegmentGroup(a,f.root,d,_);return new wl(r,this.createQueryParams(f.queryParams,this.urlTree.queryParams),f.fragment)}createQueryParams(a,f){let d={};return Object.entries(a).forEach(([_,r])=>{if(typeof r=="string"&&r.startsWith(":")){let L=r.substring(1);d[_]=f[L]}else d[_]=r}),d}createSegmentGroup(a,f,d,_){let r=this.createSegments(a,f.segments,d,_),M={};return Object.entries(f.children).forEach(([L,B])=>{M[L]=this.createSegmentGroup(a,B,d,_)}),new Jn(r,M)}createSegments(a,f,d,_){return f.map(r=>r.path.startsWith(":")?this.findPosParam(a,r,_):this.findOrReturn(r,d))}findPosParam(a,f,d){let _=d[f.path.substring(1)];if(!_)throw new qt(4001,!1);return _}findOrReturn(a,f){let d=0;for(let _ of f){if(_.path===a.path)return f.splice(d),_;d++}return a}},vw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function v5(s,a,f,d,_){let r=Cw(s,a,f);return r.matched?(d=Zj(a,d),g5(d,a,f,_).pipe(Ht(M=>M===!0?r:It({},vw)))):Gt(r)}function Cw(s,a,f){if(a.path==="**")return x5(f);if(a.path==="")return a.pathMatch==="full"&&(s.hasChildren()||f.length>0)?It({},vw):{matched:!0,consumedSegments:[],remainingSegments:f,parameters:{},positionalParamSegments:{}};let _=(a.matcher||gj)(f,s,a);if(!_)return It({},vw);let r={};Object.entries(_.posParams??{}).forEach(([L,B])=>{r[L]=B.path});let M=_.consumed.length>0?It(It({},r),_.consumed[_.consumed.length-1].parameters):r;return{matched:!0,consumedSegments:_.consumed,remainingSegments:f.slice(_.consumed.length),parameters:M,positionalParamSegments:_.posParams??{}}}function x5(s){return{matched:!0,parameters:s.length>0?K2(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function Y2(s,a,f,d){return f.length>0&&E5(s,f,d)?{segmentGroup:new Jn(a,w5(d,new Jn(f,s.children))),slicedSegments:[]}:f.length===0&&T5(s,f,d)?{segmentGroup:new Jn(s.segments,b5(s,f,d,s.children)),slicedSegments:f}:{segmentGroup:new Jn(s.segments,s.children),slicedSegments:f}}function b5(s,a,f,d){let _={};for(let r of f)if(Oy(s,a,r)&&!d[Bs(r)]){let M=new Jn([],{});_[Bs(r)]=M}return It(It({},d),_)}function w5(s,a){let f={};f[fn]=a;for(let d of s)if(d.path===""&&Bs(d)!==fn){let _=new Jn([],{});f[Bs(d)]=_}return f}function E5(s,a,f){return f.some(d=>Oy(s,a,d)&&Bs(d)!==fn)}function T5(s,a,f){return f.some(d=>Oy(s,a,d))}function Oy(s,a,f){return(s.hasChildren()||a.length>0)&&f.pathMatch==="full"?!1:f.path===""}function I5(s,a,f,d){return Bs(s)!==d&&(d===fn||!Oy(a,f,s))?!1:Cw(a,s,f).matched}function D5(s,a,f){return a.length===0&&!s.children[f]}var xw=class{};function M5(s,a,f,d,_,r,M="emptyOnly"){return new bw(s,a,f,d,_,M,r).recognize()}var S5=31,bw=class{constructor(a,f,d,_,r,M,L){this.injector=a,this.configLoader=f,this.rootComponentType=d,this.config=_,this.urlTree=r,this.paramsInheritanceStrategy=M,this.urlSerializer=L,this.applyRedirects=new yw(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(a){return new qt(4002,`'${a.segmentGroup}'`)}recognize(){let a=Y2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(a).pipe(Ht(f=>{let d=new yp([],Object.freeze({}),Object.freeze(It({},this.urlTree.queryParams)),this.urlTree.fragment,{},fn,this.rootComponentType,null,{}),_=new lo(d,f),r=new Cy("",_),M=Lj(d,[],this.urlTree.queryParams,this.urlTree.fragment);return M.queryParams=this.urlTree.queryParams,r.url=this.urlSerializer.serialize(M),this.inheritParamsAndData(r._root,null),{state:r,tree:M}}))}match(a){return this.processSegmentGroup(this.injector,this.config,a,fn).pipe(zi(d=>{if(d instanceof Ry)return this.urlTree=d.urlTree,this.match(d.urlTree.root);throw d instanceof xp?this.noMatchError(d):d}))}inheritParamsAndData(a,f){let d=a.value,_=Tw(d,f,this.paramsInheritanceStrategy);d.params=Object.freeze(_.params),d.data=Object.freeze(_.data),a.children.forEach(r=>this.inheritParamsAndData(r,d))}processSegmentGroup(a,f,d,_){return d.segments.length===0&&d.hasChildren()?this.processChildren(a,f,d):this.processSegment(a,f,d,d.segments,_,!0).pipe(Ht(r=>r instanceof lo?[r]:[]))}processChildren(a,f,d){let _=[];for(let r of Object.keys(d.children))r==="primary"?_.unshift(r):_.push(r);return vr(_).pipe(Da(r=>{let M=d.children[r],L=Xj(f,r);return this.processSegmentGroup(a,L,M,r)}),Cf((r,M)=>(r.push(...M),r)),fl(null),Fx(),Er(r=>{if(r===null)return Rh(d);let M=xR(r);return C5(M),Gt(M)}))}processSegment(a,f,d,_,r,M){return vr(f).pipe(Da(L=>this.processSegmentAgainstRoute(L._injector??a,f,L,d,_,r,M).pipe(zi(B=>{if(B instanceof xp)return Gt(null);throw B}))),As(L=>!!L),zi(L=>{if(yR(L))return D5(d,_,r)?Gt(new xw):Rh(d);throw L}))}processSegmentAgainstRoute(a,f,d,_,r,M,L){return I5(d,_,r,M)?d.redirectTo===void 0?this.matchSegmentAgainstRoute(a,_,d,r,M):this.allowRedirects&&L?this.expandSegmentAgainstRouteUsingRedirect(a,_,f,d,r,M):Rh(_):Rh(_)}expandSegmentAgainstRouteUsingRedirect(a,f,d,_,r,M){let{matched:L,consumedSegments:B,positionalParamSegments:X,remainingSegments:se}=Cw(f,_,r);if(!L)return Rh(f);_.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>S5&&(this.allowRedirects=!1));let ge=this.applyRedirects.applyRedirectCommands(B,_.redirectTo,X);return this.applyRedirects.lineralizeSegments(_,ge).pipe(Er(Oe=>this.processSegment(a,d,f,Oe.concat(se),M,!1)))}matchSegmentAgainstRoute(a,f,d,_,r){let M=v5(f,d,_,a,this.urlSerializer);return d.path==="**"&&(f.children={}),M.pipe(ao(L=>L.matched?(a=d._injector??a,this.getChildConfig(a,d,_).pipe(ao(({routes:B})=>{let X=d._loadedInjector??a,{consumedSegments:se,remainingSegments:ge,parameters:Oe}=L,at=new yp(se,Oe,Object.freeze(It({},this.urlTree.queryParams)),this.urlTree.fragment,R5(d),Bs(d),d.component??d._loadedComponent??null,d,P5(d)),{segmentGroup:Dt,slicedSegments:Vt}=Y2(f,se,ge,B);if(Vt.length===0&&Dt.hasChildren())return this.processChildren(X,B,Dt).pipe(Ht(St=>St===null?null:new lo(at,St)));if(B.length===0&&Vt.length===0)return Gt(new lo(at,[]));let kt=Bs(d)===r;return this.processSegment(X,B,Dt,Vt,kt?fn:r,!0).pipe(Ht(St=>new lo(at,St instanceof lo?[St]:[])))}))):Rh(f)))}getChildConfig(a,f,d){return f.children?Gt({routes:f.children,injector:a}):f.loadChildren?f._loadedRoutes!==void 0?Gt({routes:f._loadedRoutes,injector:f._loadedInjector}):m5(a,f,d,this.urlSerializer).pipe(Er(_=>_?this.configLoader.loadChildren(a,f).pipe(Wr(r=>{f._loadedRoutes=r.routes,f._loadedInjector=r.injector})):y5(f))):Gt({routes:[],injector:a})}};function C5(s){s.sort((a,f)=>a.value.outlet===fn?-1:f.value.outlet===fn?1:a.value.outlet.localeCompare(f.value.outlet))}function A5(s){let a=s.value.routeConfig;return a&&a.path===""}function xR(s){let a=[],f=new Set;for(let d of s){if(!A5(d)){a.push(d);continue}let _=a.find(r=>d.value.routeConfig===r.value.routeConfig);_!==void 0?(_.children.push(...d.children),f.add(_)):a.push(d)}for(let d of f){let _=xR(d.children);a.push(new lo(d.value,_))}return a.filter(d=>!f.has(d))}function R5(s){return s.data||{}}function P5(s){return s.resolve||{}}function O5(s,a,f,d,_,r){return Er(M=>M5(s,a,f,d,M.extractedUrl,_,r).pipe(Ht(({state:L,tree:B})=>Wn(It({},M),{targetSnapshot:L,urlAfterRedirects:B}))))}function k5(s,a){return Er(f=>{let{targetSnapshot:d,guards:{canActivateChecks:_}}=f;if(!_.length)return Gt(f);let r=new Set(_.map(B=>B.route)),M=new Set;for(let B of r)if(!M.has(B))for(let X of bR(B))M.add(X);let L=0;return vr(M).pipe(Da(B=>r.has(B)?L5(B,d,s,a):(B.data=Tw(B,B.parent,s).resolve,Gt(void 0))),Wr(()=>L++),lh(1),Er(B=>L===M.size?Gt(f):ii))})}function bR(s){let a=s.children.map(f=>bR(f)).flat();return[s,...a]}function L5(s,a,f,d){let _=s.routeConfig,r=s._resolve;return _?.title!==void 0&&!fR(_)&&(r[bp]=_.title),F5(r,s,a,d).pipe(Ht(M=>(s._resolvedData=M,s.data=Tw(s,s.parent,f).resolve,null)))}function F5(s,a,f,d){let _=Jb(s);if(_.length===0)return Gt({});let r={};return vr(_).pipe(Er(M=>N5(s[M],a,f,d).pipe(As(),Wr(L=>{r[M]=L}))),lh(1),Ox(r),zi(M=>yR(M)?ii:hl(M)))}function N5(s,a,f,d){let _=wp(a)??d,r=zh(s,_),M=r.resolve?r.resolve(a,f):Ma(_,()=>r(a,f));return Il(M)}function Xb(s){return ao(a=>{let f=s(a);return f?vr(f).pipe(Ht(()=>a)):Gt(a)})}var wR=(()=>{let a=class a{buildTitle(d){let _,r=d.root;for(;r!==void 0;)_=this.getResolvedTitleForRoute(r)??_,r=r.children.find(M=>M.outlet===fn);return _}getResolvedTitleForRoute(d){return d.data[bp]}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(z5),providedIn:"root"});let s=a;return s})(),z5=(()=>{let a=class a extends wR{constructor(d){super(),this.title=d}updateTitle(d){let _=this.buildTitle(d);_!==void 0&&this.title.setTitle(_)}};a.\u0275fac=function(_){return new(_||a)(Rt(H2))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Aw=new _t("",{providedIn:"root",factory:()=>({})}),Rw=new _t(""),B5=(()=>{let a=class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=nt(Tb)}loadComponent(d){if(this.componentLoaders.get(d))return this.componentLoaders.get(d);if(d._loadedComponent)return Gt(d._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(d);let _=Il(d.loadComponent()).pipe(Ht(ER),Wr(M=>{this.onLoadEndListener&&this.onLoadEndListener(d),d._loadedComponent=M}),ml(()=>{this.componentLoaders.delete(d)})),r=new oh(_,()=>new wr).pipe(ih());return this.componentLoaders.set(d,r),r}loadChildren(d,_){if(this.childrenLoaders.get(_))return this.childrenLoaders.get(_);if(_._loadedRoutes)return Gt({routes:_._loadedRoutes,injector:_._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(_);let M=j5(_,this.compiler,d,this.onLoadEndListener).pipe(ml(()=>{this.childrenLoaders.delete(_)})),L=new oh(M,()=>new wr).pipe(ih());return this.childrenLoaders.set(_,L),L}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function j5(s,a,f,d){return Il(s.loadChildren()).pipe(Ht(ER),Er(_=>_ instanceof Uf||Array.isArray(_)?Gt(_):vr(a.compileModuleAsync(_))),Ht(_=>{d&&d(s);let r,M,L=!1;return Array.isArray(_)?(M=_,L=!0):(r=_.create(f).injector,M=r.get(Rw,[],{optional:!0,self:!0}).flat()),{routes:M.map(Sw),injector:r}}))}function V5(s){return s&&typeof s=="object"&&"default"in s}function ER(s){return V5(s)?s.default:s}var Pw=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(U5),providedIn:"root"});let s=a;return s})(),U5=(()=>{let a=class a{shouldProcessUrl(d){return!0}extract(d){return d}merge(d,_){return d}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),$5=new _t("");var G5=(()=>{let a=class a{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new wr,this.transitionAbortSubject=new wr,this.configLoader=nt(B5),this.environmentInjector=nt(Vi),this.urlSerializer=nt(Ew),this.rootContexts=nt(Py),this.location=nt(ep),this.inputBindingEnabled=nt(Mw,{optional:!0})!==null,this.titleStrategy=nt(wR),this.options=nt(Aw,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=nt(Pw),this.createViewTransition=nt($5,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Gt(void 0),this.rootComponentType=null;let d=r=>this.events.next(new sw(r)),_=r=>this.events.next(new aw(r));this.configLoader.onLoadEndListener=_,this.configLoader.onLoadStartListener=d}complete(){this.transitions?.complete()}handleNavigationRequest(d){let _=++this.navigationId;this.transitions?.next(Wn(It(It({},this.transitions.value),d),{id:_}))}setupNavigations(d,_,r){return this.transitions=new Rr({id:0,currentUrlTree:_,currentRawUrl:_,extractedUrl:this.urlHandlingStrategy.extract(_),urlAfterRedirects:this.urlHandlingStrategy.extract(_),rawUrl:_,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:hp,restoredState:null,currentSnapshot:r.snapshot,targetSnapshot:null,currentRouterState:r,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(oi(M=>M.id!==0),Ht(M=>Wn(It({},M),{extractedUrl:this.urlHandlingStrategy.extract(M.rawUrl)})),ao(M=>{let L=!1,B=!1;return Gt(M).pipe(ao(X=>{if(this.navigationId>M.id)return this.cancelNavigationTransition(M,"",co.SupersededByNewNavigation),ii;this.currentTransition=M,this.currentNavigation={id:X.id,initialUrl:X.rawUrl,extractedUrl:X.extractedUrl,trigger:X.source,extras:X.extras,previousNavigation:this.lastSuccessfulNavigation?Wn(It({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let se=!d.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),ge=X.extras.onSameUrlNavigation??d.onSameUrlNavigation;if(!se&&ge!=="reload"){let Oe="";return this.events.next(new jc(X.id,this.urlSerializer.serialize(X.rawUrl),Oe,tw.IgnoredSameUrlNavigation)),X.resolve(null),ii}if(this.urlHandlingStrategy.shouldProcessUrl(X.rawUrl))return Gt(X).pipe(ao(Oe=>{let at=this.transitions?.getValue();return this.events.next(new pp(Oe.id,this.urlSerializer.serialize(Oe.extractedUrl),Oe.source,Oe.restoredState)),at!==this.transitions?.getValue()?ii:Promise.resolve(Oe)}),O5(this.environmentInjector,this.configLoader,this.rootComponentType,d.config,this.urlSerializer,this.paramsInheritanceStrategy),Wr(Oe=>{M.targetSnapshot=Oe.targetSnapshot,M.urlAfterRedirects=Oe.urlAfterRedirects,this.currentNavigation=Wn(It({},this.currentNavigation),{finalUrl:Oe.urlAfterRedirects});let at=new Dy(Oe.id,this.urlSerializer.serialize(Oe.extractedUrl),this.urlSerializer.serialize(Oe.urlAfterRedirects),Oe.targetSnapshot);this.events.next(at)}));if(se&&this.urlHandlingStrategy.shouldProcessUrl(X.currentRawUrl)){let{id:Oe,extractedUrl:at,source:Dt,restoredState:Vt,extras:kt}=X,St=new pp(Oe,this.urlSerializer.serialize(at),Dt,Vt);this.events.next(St);let Fn=hR(this.rootComponentType).snapshot;return this.currentTransition=M=Wn(It({},X),{targetSnapshot:Fn,urlAfterRedirects:at,extras:Wn(It({},kt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=at,Gt(M)}else{let Oe="";return this.events.next(new jc(X.id,this.urlSerializer.serialize(X.extractedUrl),Oe,tw.IgnoredByUrlHandlingStrategy)),X.resolve(null),ii}}),Wr(X=>{let se=new nw(X.id,this.urlSerializer.serialize(X.extractedUrl),this.urlSerializer.serialize(X.urlAfterRedirects),X.targetSnapshot);this.events.next(se)}),Ht(X=>(this.currentTransition=M=Wn(It({},X),{guards:Jj(X.targetSnapshot,X.currentSnapshot,this.rootContexts)}),M)),a5(this.environmentInjector,X=>this.events.next(X)),Wr(X=>{if(M.guardsResult=X.guardsResult,Fh(X.guardsResult))throw mR(this.urlSerializer,X.guardsResult);let se=new rw(X.id,this.urlSerializer.serialize(X.extractedUrl),this.urlSerializer.serialize(X.urlAfterRedirects),X.targetSnapshot,!!X.guardsResult);this.events.next(se)}),oi(X=>X.guardsResult?!0:(this.cancelNavigationTransition(X,"",co.GuardRejected),!1)),Xb(X=>{if(X.guards.canActivateChecks.length)return Gt(X).pipe(Wr(se=>{let ge=new iw(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ge)}),ao(se=>{let ge=!1;return Gt(se).pipe(k5(this.paramsInheritanceStrategy,this.environmentInjector),Wr({next:()=>ge=!0,complete:()=>{ge||this.cancelNavigationTransition(se,"",co.NoDataFromResolver)}}))}),Wr(se=>{let ge=new ow(se.id,this.urlSerializer.serialize(se.extractedUrl),this.urlSerializer.serialize(se.urlAfterRedirects),se.targetSnapshot);this.events.next(ge)}))}),Xb(X=>{let se=ge=>{let Oe=[];ge.routeConfig?.loadComponent&&!ge.routeConfig._loadedComponent&&Oe.push(this.configLoader.loadComponent(ge.routeConfig).pipe(Wr(at=>{ge.component=at}),Ht(()=>{})));for(let at of ge.children)Oe.push(...se(at));return Oe};return t_(se(X.targetSnapshot.root)).pipe(fl(null),Wo(1))}),Xb(()=>this.afterPreactivation()),ao(()=>{let{currentSnapshot:X,targetSnapshot:se}=M,ge=this.createViewTransition?.(this.environmentInjector,X.root,se.root);return ge?vr(ge).pipe(Ht(()=>M)):Gt(M)}),Ht(X=>{let se=$j(d.routeReuseStrategy,X.targetSnapshot,X.currentRouterState);return this.currentTransition=M=Wn(It({},X),{targetRouterState:se}),this.currentNavigation.targetRouterState=se,M}),Wr(()=>{this.events.next(new gp)}),Yj(this.rootContexts,d.routeReuseStrategy,X=>this.events.next(X),this.inputBindingEnabled),Wo(1),Wr({next:X=>{L=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new El(X.id,this.urlSerializer.serialize(X.extractedUrl),this.urlSerializer.serialize(X.urlAfterRedirects))),this.titleStrategy?.updateTitle(X.targetRouterState.snapshot),X.resolve(!0)},complete:()=>{L=!0}}),jx(this.transitionAbortSubject.pipe(Wr(X=>{throw X}))),ml(()=>{!L&&!B&&this.cancelNavigationTransition(M,"",co.SupersededByNewNavigation),this.currentTransition?.id===M.id&&(this.currentNavigation=null,this.currentTransition=null)}),zi(X=>{if(B=!0,_R(X))this.events.next(new Tl(M.id,this.urlSerializer.serialize(M.extractedUrl),X.message,X.cancellationCode)),qj(X)?this.events.next(new _p(X.url)):M.resolve(!1);else{this.events.next(new mp(M.id,this.urlSerializer.serialize(M.extractedUrl),X,M.targetSnapshot??void 0));try{M.resolve(d.errorHandler(X))}catch(se){this.options.resolveNavigationPromiseOnError?M.resolve(!1):M.reject(se)}}return ii}))}))}cancelNavigationTransition(d,_,r){let M=new Tl(d.id,this.urlSerializer.serialize(d.extractedUrl),_,r);this.events.next(M),d.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function H5(s){return s!==hp}var q5=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(W5),providedIn:"root"});let s=a;return s})(),ww=class{shouldDetach(a){return!1}store(a,f){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,f){return a.routeConfig===f.routeConfig}},W5=(()=>{let a=class a extends ww{};a.\u0275fac=(()=>{let d;return function(r){return(d||(d=qf(a)))(r||a)}})(),a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),TR=(()=>{let a=class a{};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:()=>nt(Z5),providedIn:"root"});let s=a;return s})(),Z5=(()=>{let a=class a extends TR{constructor(){super(...arguments),this.location=nt(ep),this.urlSerializer=nt(Ew),this.options=nt(Aw,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=nt(Pw),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new wl,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=hR(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(d){return this.location.subscribe(_=>{_.type==="popstate"&&d(_.url,_.state)})}handleRouterEvent(d,_){if(d instanceof pp)this.stateMemento=this.createStateMemento();else if(d instanceof jc)this.rawUrlTree=_.initialUrl;else if(d instanceof Dy){if(this.urlUpdateStrategy==="eager"&&!_.extras.skipLocationChange){let r=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl);this.setBrowserUrl(r,_)}}else d instanceof gp?(this.currentUrlTree=_.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(_.finalUrl,_.initialUrl),this.routerState=_.targetRouterState,this.urlUpdateStrategy==="deferred"&&(_.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,_))):d instanceof Tl&&(d.code===co.GuardRejected||d.code===co.NoDataFromResolver)?this.restoreHistory(_):d instanceof mp?this.restoreHistory(_,!0):d instanceof El&&(this.lastSuccessfulId=d.id,this.currentPageId=this.browserPageId)}setBrowserUrl(d,_){let r=this.urlSerializer.serialize(d);if(this.location.isCurrentPathEqualTo(r)||_.extras.replaceUrl){let M=this.browserPageId,L=It(It({},_.extras.state),this.generateNgRouterState(_.id,M));this.location.replaceState(r,"",L)}else{let M=It(It({},_.extras.state),this.generateNgRouterState(_.id,this.browserPageId+1));this.location.go(r,"",M)}}restoreHistory(d,_=!1){if(this.canceledNavigationResolution==="computed"){let r=this.browserPageId,M=this.currentPageId-r;M!==0?this.location.historyGo(M):this.currentUrlTree===d.finalUrl&&M===0&&(this.resetState(d),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(_&&this.resetState(d),this.resetUrlToCurrentUrlTree())}resetState(d){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,d.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(d,_){return this.canceledNavigationResolution==="computed"?{navigationId:d,\u0275routerPageId:_}:{navigationId:d}}};a.\u0275fac=(()=>{let d;return function(r){return(d||(d=qf(a)))(r||a)}})(),a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),cp=function(s){return s[s.COMPLETE=0]="COMPLETE",s[s.FAILED=1]="FAILED",s[s.REDIRECTING=2]="REDIRECTING",s}(cp||{});function X5(s,a){s.events.pipe(oi(f=>f instanceof El||f instanceof Tl||f instanceof mp||f instanceof jc),Ht(f=>f instanceof El||f instanceof jc?cp.COMPLETE:(f instanceof Tl?f.code===co.Redirect||f.code===co.SupersededByNewNavigation:!1)?cp.REDIRECTING:cp.FAILED),oi(f=>f!==cp.REDIRECTING),Wo(1)).subscribe(()=>{a()})}function Y5(s){throw s}var J5={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},K5={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Ow=(()=>{let a=class a{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=nt(ty),this.stateManager=nt(TR),this.options=nt(Aw,{optional:!0})||{},this.pendingTasks=nt(bh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=nt(G5),this.urlSerializer=nt(Ew),this.location=nt(ep),this.urlHandlingStrategy=nt(Pw),this._events=new wr,this.errorHandler=this.options.errorHandler||Y5,this.navigated=!1,this.routeReuseStrategy=nt(q5),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=nt(Rw,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!nt(Mw,{optional:!0}),this.eventsSubscription=new Ar,this.isNgZoneEnabled=nt(xr)instanceof xr&&xr.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:d=>{this.console.warn(d)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let d=this.navigationTransitions.events.subscribe(_=>{try{let r=this.navigationTransitions.currentTransition,M=this.navigationTransitions.currentNavigation;if(r!==null&&M!==null){if(this.stateManager.handleRouterEvent(_,M),_ instanceof Tl&&_.code!==co.Redirect&&_.code!==co.SupersededByNewNavigation)this.navigated=!0;else if(_ instanceof El)this.navigated=!0;else if(_ instanceof _p){let L=this.urlHandlingStrategy.merge(_.url,r.currentRawUrl),B={info:r.extras.info,skipLocationChange:r.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||H5(r.source)};this.scheduleNavigation(L,hp,null,B,{resolve:r.resolve,reject:r.reject,promise:r.promise})}}eV(_)&&this._events.next(_)}catch(r){this.navigationTransitions.transitionAbortSubject.next(r)}});this.eventsSubscription.add(d)}resetRootComponentType(d){this.routerState.root.component=d,this.navigationTransitions.rootComponentType=d}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),hp,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((d,_)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(d,"popstate",_)},0)})}navigateToSyncWithBrowser(d,_,r){let M={replaceUrl:!0},L=r?.navigationId?r:null;if(r){let X=It({},r);delete X.navigationId,delete X.\u0275routerPageId,Object.keys(X).length!==0&&(M.state=X)}let B=this.parseUrl(d);this.scheduleNavigation(B,_,L,M)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(d){this.config=d.map(Sw),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(d,_={}){let{relativeTo:r,queryParams:M,fragment:L,queryParamsHandling:B,preserveFragment:X}=_,se=X?this.currentUrlTree.fragment:L,ge=null;switch(B){case"merge":ge=It(It({},this.currentUrlTree.queryParams),M);break;case"preserve":ge=this.currentUrlTree.queryParams;break;default:ge=M||null}ge!==null&&(ge=this.removeEmptyProps(ge));let Oe;try{let at=r?r.snapshot:this.routerState.snapshot.root;Oe=aR(at)}catch{(typeof d[0]!="string"||!d[0].startsWith("/"))&&(d=[]),Oe=this.currentUrlTree.root}return lR(Oe,d,ge,se??null)}navigateByUrl(d,_={skipLocationChange:!1}){let r=Fh(d)?d:this.parseUrl(d),M=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(M,hp,null,_)}navigate(d,_={skipLocationChange:!1}){return Q5(d),this.navigateByUrl(this.createUrlTree(d,_),_)}serializeUrl(d){return this.urlSerializer.serialize(d)}parseUrl(d){try{return this.urlSerializer.parse(d)}catch{return this.urlSerializer.parse("/")}}isActive(d,_){let r;if(_===!0?r=It({},J5):_===!1?r=It({},K5):r=_,Fh(d))return q2(this.currentUrlTree,d,r);let M=this.parseUrl(d);return q2(this.currentUrlTree,M,r)}removeEmptyProps(d){return Object.entries(d).reduce((_,[r,M])=>(M!=null&&(_[r]=M),_),{})}scheduleNavigation(d,_,r,M,L){if(this.disposed)return Promise.resolve(!1);let B,X,se;L?(B=L.resolve,X=L.reject,se=L.promise):se=new Promise((Oe,at)=>{B=Oe,X=at});let ge=this.pendingTasks.add();return X5(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ge))}),this.navigationTransitions.handleNavigationRequest({source:_,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:d,extras:M,resolve:B,reject:X,promise:se,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),se.catch(Oe=>Promise.reject(Oe))}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Q5(s){for(let a=0;a<s.length;a++)if(s[a]==null)throw new qt(4008,!1)}function eV(s){return!(s instanceof gp)&&!(s instanceof _p)}var IR=(()=>{let a=class a{constructor(d,_,r,M,L,B){this.router=d,this.route=_,this.tabIndexAttribute=r,this.renderer=M,this.el=L,this.locationStrategy=B,this.href=null,this.commands=null,this.onChanges=new wr,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let X=L.nativeElement.tagName?.toLowerCase();this.isAnchorElement=X==="a"||X==="area",this.isAnchorElement?this.subscription=d.events.subscribe(se=>{se instanceof El&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(d){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",d)}ngOnChanges(d){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(d){d!=null?(this.commands=Array.isArray(d)?d:[d],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(d,_,r,M,L){let B=this.urlTree;if(B===null||this.isAnchorElement&&(d!==0||_||r||M||L||typeof this.target=="string"&&this.target!="_self"))return!0;let X={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(B,X),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let d=this.urlTree;this.href=d!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(d)):null;let _=this.href===null?null:xA(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",_)}applyAttributeValue(d,_){let r=this.renderer,M=this.el.nativeElement;_!==null?r.setAttribute(M,d,_):r.removeAttribute(M,d)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};a.\u0275fac=function(_){return new(_||a)(br(Ow),br(Vc),rb("tabindex"),br(Xf),br(vh),br(Ch))},a.\u0275dir=Ac({type:a,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(_,r){_&1&&Oc("click",function(L){return r.onClick(L.button,L.ctrlKey,L.shiftKey,L.altKey,L.metaKey)}),_&2&&bb("target",r.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[To.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Jf],skipLocationChange:[To.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Jf],replaceUrl:[To.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Jf],routerLink:"routerLink"},standalone:!0,features:[vb,Gf]});let s=a;return s})();var tV=new _t("");function DR(s,...a){return ts([{provide:Rw,multi:!0,useValue:s},[],{provide:Vc,useFactory:nV,deps:[Ow]},{provide:ny,multi:!0,useFactory:rV},a.map(f=>f.\u0275providers)])}function nV(s){return s.routerState.root}function rV(){let s=nt(yh);return a=>{let f=s.get(Ih);if(a!==f.components[0])return;let d=s.get(Ow),_=s.get(iV);s.get(oV)===1&&d.initialNavigation(),s.get(sV,null,wn.Optional)?.setUpPreloading(),s.get(tV,null,wn.Optional)?.init(),d.resetRootComponentType(f.componentTypes[0]),_.closed||(_.next(),_.complete(),_.unsubscribe())}}var iV=new _t("",{factory:()=>new wr}),oV=new _t("",{providedIn:"root",factory:()=>1});var sV=new _t("");var tE={};mF(tE,{getFeatures:()=>AU,getToolkit:()=>RU});function kw(s,a){let f=!a?.manualCleanup;f&&!a?.injector&&kC(kw);let d=f?a?.injector?.get(Wf)??nt(Wf):null,_;a?.requireSync?_=yb({kind:0}):_=yb({kind:1,value:a?.initialValue});let r=s.subscribe({next:M=>_.set({kind:1,value:M}),error:M=>{if(a?.rejectErrors)throw M;_.set({kind:2,error:M})}});return d?.onDestroy(r.unsubscribe.bind(r)),ry(()=>{let M=_();switch(M.kind){case 1:return M.value;case 2:throw M.error;case 0:throw new qt(601,"`toSignal()` called with `requireSync` but `Observable` did not emit synchronously.")}})}var zw={};function Uw(s,a){if(zw[s]=(zw[s]||0)+1,typeof a=="function")return Lw(s,(...d)=>Wn(It({},a(...d)),{type:s}));switch(a?a._as:"empty"){case"empty":return Lw(s,()=>({type:s}));case"props":return Lw(s,d=>Wn(It({},d),{type:s}));default:throw new Error("Unexpected config.")}}function Dl(){return{_as:"props",_p:void 0}}function Lw(s,a){return Object.defineProperty(a,"type",{value:s,writable:!1})}function aV(s){return s.charAt(0).toUpperCase()+s.substring(1)}function lV(s){return s.charAt(0).toLowerCase()+s.substring(1)}function By(s){let{source:a,events:f}=s;return Object.keys(f).reduce((d,_)=>Wn(It({},d),{[cV(_)]:Uw(uV(a,_),f[_])}),{})}function UR(){return Dl()}function cV(s){return s.trim().split(" ").map((a,f)=>f===0?lV(a):aV(a)).join("")}function uV(s,a){return`[${s}] ${a}`}var $R="@ngrx/store/init",Bh=(()=>{let a=class a extends Rr{constructor(){super({type:$R})}next(d){if(typeof d=="function")throw new TypeError(`
        Dispatch expected an object, instead it received a function.
        If you're using the createAction function, make sure to invoke the function
        before dispatching the action. For example, someAction should be someAction().`);if(typeof d>"u")throw new TypeError("Actions must be objects");if(typeof d.type>"u")throw new TypeError("Actions must have a type property");super.next(d)}complete(){}ngOnDestroy(){super.complete()}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),hV=[Bh],GR=new _t("@ngrx/store Internal Root Guard"),MR=new _t("@ngrx/store Internal Initial State"),$w=new _t("@ngrx/store Initial State"),HR=new _t("@ngrx/store Reducer Factory"),SR=new _t("@ngrx/store Internal Reducer Factory Provider"),qR=new _t("@ngrx/store Initial Reducers"),Fw=new _t("@ngrx/store Internal Initial Reducers"),CR=new _t("@ngrx/store Store Features"),AR=new _t("@ngrx/store Internal Store Reducers"),Nw=new _t("@ngrx/store Internal Feature Reducers"),RR=new _t("@ngrx/store Internal Feature Configs"),WR=new _t("@ngrx/store Internal Store Features"),PR=new _t("@ngrx/store Internal Feature Reducers Token"),ZR=new _t("@ngrx/store Feature Reducers"),OR=new _t("@ngrx/store User Provided Meta Reducers"),ky=new _t("@ngrx/store Meta Reducers"),kR=new _t("@ngrx/store Internal Resolved Meta Reducers"),LR=new _t("@ngrx/store User Runtime Checks Config"),FR=new _t("@ngrx/store Internal User Runtime Checks Config"),Tp=new _t("@ngrx/store Internal Runtime Checks"),Gw=new _t("@ngrx/store Check if Action types are unique"),Ip=new _t("@ngrx/store Root Store Provider"),Ly=new _t("@ngrx/store Feature State Provider");function Ml(s,a={}){let f=Object.keys(s),d={};for(let r=0;r<f.length;r++){let M=f[r];typeof s[M]=="function"&&(d[M]=s[M])}let _=Object.keys(d);return function(M,L){M=M===void 0?a:M;let B=!1,X={};for(let se=0;se<_.length;se++){let ge=_[se],Oe=d[ge],at=M[ge],Dt=Oe(at,L);X[ge]=Dt,B=B||Dt!==at}return B?X:M}}function dV(s,a){return Object.keys(s).filter(f=>f!==a).reduce((f,d)=>Object.assign(f,{[d]:s[d]}),{})}function XR(...s){return function(a){if(s.length===0)return a;let f=s[s.length-1];return s.slice(0,-1).reduceRight((_,r)=>r(_),f(a))}}function YR(s,a){return Array.isArray(a)&&a.length>0&&(s=XR.apply(null,[...a,s])),(f,d)=>{let _=s(f);return(r,M)=>(r=r===void 0?d:r,_(r,M))}}function fV(s){let a=Array.isArray(s)&&s.length>0?XR(...s):f=>f;return(f,d)=>(f=a(f),(_,r)=>(_=_===void 0?d:_,f(_,r)))}var Dp=class extends yn{},Fy=class extends Bh{},pV="@ngrx/store/update-reducers",Ny=(()=>{let a=class a extends Rr{get currentReducers(){return this.reducers}constructor(d,_,r,M){super(M(r,_)),this.dispatcher=d,this.initialState=_,this.reducers=r,this.reducerFactory=M}addFeature(d){this.addFeatures([d])}addFeatures(d){let _=d.reduce((r,{reducers:M,reducerFactory:L,metaReducers:B,initialState:X,key:se})=>{let ge=typeof M=="function"?fV(B)(M,X):YR(L,B)(M,X);return r[se]=ge,r},{});this.addReducers(_)}removeFeature(d){this.removeFeatures([d])}removeFeatures(d){this.removeReducers(d.map(_=>_.key))}addReducer(d,_){this.addReducers({[d]:_})}addReducers(d){this.reducers=It(It({},this.reducers),d),this.updateReducers(Object.keys(d))}removeReducer(d){this.removeReducers([d])}removeReducers(d){d.forEach(_=>{this.reducers=dV(this.reducers,_)}),this.updateReducers(d)}updateReducers(d){this.next(this.reducerFactory(this.reducers,this.initialState)),this.dispatcher.next({type:pV,features:d})}ngOnDestroy(){this.complete()}};a.\u0275fac=function(_){return new(_||a)(Rt(Fy),Rt($w),Rt(qR),Rt(HR))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),mV=[Ny,{provide:Dp,useExisting:Ny},{provide:Fy,useExisting:Bh}],Mp=(()=>{let a=class a extends wr{ngOnDestroy(){this.complete()}};a.\u0275fac=(()=>{let d;return function(r){return(d||(d=qf(a)))(r||a)}})(),a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),gV=[Mp],zy=class extends yn{},NR=(()=>{let a=class a extends Rr{constructor(d,_,r,M){super(M);let B=d.pipe(vc(Sx)).pipe(Vx(_)),X={state:M},se=B.pipe(Cf(_V,X));this.stateSubscription=se.subscribe(({state:ge,action:Oe})=>{this.next(ge),r.next(Oe)}),this.state=kw(this,{manualCleanup:!0,requireSync:!0})}ngOnDestroy(){this.stateSubscription.unsubscribe(),this.complete()}};a.INIT=$R,a.\u0275fac=function(_){return new(_||a)(Rt(Bh),Rt(Dp),Rt(Mp),Rt($w))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})();function _V(s={state:void 0},[a,f]){let{state:d}=s;return{state:f(d,a),action:a}}var yV=[NR,{provide:zy,useExisting:NR}],is=(()=>{let a=class a extends yn{constructor(d,_,r){super(),this.actionsObserver=_,this.reducerManager=r,this.source=d,this.state=d.state}select(d,..._){return xV.call(null,d,..._)(this)}selectSignal(d,_){return ry(()=>d(this.state()),_)}lift(d){let _=new a(this,this.actionsObserver,this.reducerManager);return _.operator=d,_}dispatch(d){this.actionsObserver.next(d)}next(d){this.actionsObserver.next(d)}error(d){this.actionsObserver.error(d)}complete(){this.actionsObserver.complete()}addReducer(d,_){this.reducerManager.addReducer(d,_)}removeReducer(d){this.reducerManager.removeReducer(d)}};a.\u0275fac=function(_){return new(_||a)(Rt(zy),Rt(Bh),Rt(Ny))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac});let s=a;return s})(),vV=[is];function xV(s,a,...f){return function(_){let r;if(typeof s=="string"){let M=[a,...f].filter(Boolean);r=_.pipe(zx(s,...M))}else if(typeof s=="function")r=_.pipe(Ht(M=>s(M,a)));else throw new TypeError(`Unexpected type '${typeof s}' in select operator, expected 'string' or 'function'`);return r.pipe(Lx())}}var Hw="https://ngrx.io/guide/store/configuration/runtime-checks";function zR(s){return s===void 0}function BR(s){return s===null}function JR(s){return Array.isArray(s)}function bV(s){return typeof s=="string"}function wV(s){return typeof s=="boolean"}function EV(s){return typeof s=="number"}function KR(s){return typeof s=="object"&&s!==null}function TV(s){return KR(s)&&!JR(s)}function IV(s){if(!TV(s))return!1;let a=Object.getPrototypeOf(s);return a===Object.prototype||a===null}function Bw(s){return typeof s=="function"}function DV(s){return Bw(s)&&s.hasOwnProperty("\u0275cmp")}function MV(s,a){return Object.prototype.hasOwnProperty.call(s,a)}function jR(s,a){return s===a}function SV(s,a,f){for(let d=0;d<s.length;d++)if(!f(s[d],a[d]))return!0;return!1}function QR(s,a=jR,f=jR){let d=null,_=null,r;function M(){d=null,_=null}function L(se=void 0){r={result:se}}function B(){r=void 0}function X(){if(r!==void 0)return r.result;if(!d)return _=s.apply(null,arguments),d=arguments,_;if(!SV(arguments,d,a))return _;let se=s.apply(null,arguments);return d=arguments,f(_,se)?_:(_=se,se)}return{memoized:X,reset:M,setResult:L,clearResult:B}}function Sp(...s){return AV(QR)(...s)}function CV(s,a,f,d){if(f===void 0){let r=a.map(M=>M(s));return d.memoized.apply(null,r)}let _=a.map(r=>r(s,f));return d.memoized.apply(null,[..._,f])}function AV(s,a={stateFn:CV}){return function(...f){let d=f;if(Array.isArray(d[0])){let[se,...ge]=d;d=[...se,...ge]}else d.length===1&&RV(d[0])&&(d=PV(d[0]));let _=d.slice(0,d.length-1),r=d[d.length-1],M=_.filter(se=>se.release&&typeof se.release=="function"),L=s(function(...se){return r.apply(null,se)}),B=QR(function(se,ge){return a.stateFn.apply(null,[se,_,ge,L])});function X(){B.reset(),L.reset(),M.forEach(se=>se.release())}return Object.assign(B.memoized,{release:X,projector:L.memoized,setResult:B.setResult,clearResult:B.clearResult})}}function RV(s){return!!s&&typeof s=="object"&&Object.values(s).every(a=>typeof a=="function")}function PV(s){let a=Object.values(s),f=Object.keys(s),d=(..._)=>f.reduce((r,M,L)=>Wn(It({},r),{[M]:_[L]}),{});return[...a,d]}function OV(s){return s instanceof _t?nt(s):s}function kV(s,a){return a.map((f,d)=>{if(s[d]instanceof _t){let _=nt(s[d]);return{key:f.key,reducerFactory:_.reducerFactory?_.reducerFactory:Ml,metaReducers:_.metaReducers?_.metaReducers:[],initialState:_.initialState}}return f})}function LV(s){return s.map(a=>a instanceof _t?nt(a):a)}function eP(s){return typeof s=="function"?s():s}function FV(s,a){return s.concat(a)}function NV(){if(nt(is,{optional:!0,skipSelf:!0}))throw new TypeError("The root Store has been provided more than once. Feature modules should provide feature states instead.");return"guarded"}function zV(s,a){return function(f,d){let _=a.action(d)?jw(d):d,r=s(f,_);return a.state()?jw(r):r}}function jw(s){Object.freeze(s);let a=Bw(s);return Object.getOwnPropertyNames(s).forEach(f=>{if(!f.startsWith("\u0275")&&MV(s,f)&&(!a||f!=="caller"&&f!=="callee"&&f!=="arguments")){let d=s[f];(KR(d)||Bw(d))&&!Object.isFrozen(d)&&jw(d)}}),s}function BV(s,a){return function(f,d){if(a.action(d)){let r=Vw(d);VR(r,"action")}let _=s(f,d);if(a.state()){let r=Vw(_);VR(r,"state")}return _}}function Vw(s,a=[]){return(zR(s)||BR(s))&&a.length===0?{path:["root"],value:s}:Object.keys(s).reduce((d,_)=>{if(d)return d;let r=s[_];return DV(r)?d:zR(r)||BR(r)||EV(r)||wV(r)||bV(r)||JR(r)?!1:IV(r)?Vw(r,[...a,_]):{path:[...a,_],value:r}},!1)}function VR(s,a){if(s===!1)return;let f=s.path.join("."),d=new Error(`Detected unserializable ${a} at "${f}". ${Hw}#strict${a}serializability`);throw d.value=s.value,d.unserializablePath=f,d}function jV(s,a){return function(f,d){if(a.action(d)&&!xr.isInAngularZone())throw new Error(`Action '${d.type}' running outside NgZone. ${Hw}#strictactionwithinngzone`);return s(f,d)}}function VV(s){return c2()?It({strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!0,strictActionImmutability:!0,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1},s):{strictStateSerializability:!1,strictActionSerializability:!1,strictStateImmutability:!1,strictActionImmutability:!1,strictActionWithinNgZone:!1,strictActionTypeUniqueness:!1}}function UV({strictActionSerializability:s,strictStateSerializability:a}){return f=>s||a?BV(f,{action:d=>s&&!qw(d),state:()=>a}):f}function $V({strictActionImmutability:s,strictStateImmutability:a}){return f=>s||a?zV(f,{action:d=>s&&!qw(d),state:()=>a}):f}function qw(s){return s.type.startsWith("@ngrx")}function GV({strictActionWithinNgZone:s}){return a=>s?jV(a,{action:f=>s&&!qw(f)}):a}function HV(s){return[{provide:FR,useValue:s},{provide:LR,useFactory:qV,deps:[FR]},{provide:Tp,deps:[LR],useFactory:VV},{provide:ky,multi:!0,deps:[Tp],useFactory:$V},{provide:ky,multi:!0,deps:[Tp],useFactory:UV},{provide:ky,multi:!0,deps:[Tp],useFactory:GV}]}function tP(){return[{provide:Gw,multi:!0,deps:[Tp],useFactory:WV}]}function qV(s){return s}function WV(s){if(!s.strictActionTypeUniqueness)return;let a=Object.entries(zw).filter(([,f])=>f>1).map(([f])=>f);if(a.length)throw new Error(`Action types are registered more than once, ${a.map(f=>`"${f}"`).join(", ")}. ${Hw}#strictactiontypeuniqueness`)}function nP(s,a,f={}){return ts([...QV(s,a,f),KV])}function ZV(s={},a={}){return[{provide:GR,useFactory:NV},{provide:MR,useValue:a.initialState},{provide:$w,useFactory:eP,deps:[MR]},{provide:Fw,useValue:s},{provide:AR,useExisting:s instanceof _t?s:Fw},{provide:qR,deps:[Fw,[new N1(AR)]],useFactory:OV},{provide:OR,useValue:a.metaReducers?a.metaReducers:[]},{provide:kR,deps:[ky,OR],useFactory:FV},{provide:SR,useValue:a.reducerFactory?a.reducerFactory:Ml},{provide:HR,deps:[SR,kR],useFactory:YR},hV,mV,gV,yV,vV,HV(a.runtimeChecks),tP()]}function XV(){nt(Bh),nt(Dp),nt(Mp),nt(is),nt(GR,{optional:!0}),nt(Gw,{optional:!0})}var YV=[{provide:Ip,useFactory:XV},{provide:Jo,multi:!0,useFactory(){return()=>nt(Ip)}}];function rP(s,a){return ts([...ZV(s,a),YV])}function JV(){nt(Ip);let s=nt(WR),a=nt(ZR),f=nt(Ny);nt(Gw,{optional:!0});let d=s.map((_,r)=>{let L=a.shift()[r];return Wn(It({},_),{reducers:L,initialState:eP(_.initialState)})});f.addFeatures(d)}var KV=[{provide:Ly,useFactory:JV},{provide:Jo,multi:!0,useFactory(){return()=>nt(Ly)}}];function QV(s,a,f={}){return[{provide:RR,multi:!0,useValue:s instanceof Object?{}:f},{provide:CR,multi:!0,useValue:{key:s instanceof Object?s.name:s,reducerFactory:!(f instanceof _t)&&f.reducerFactory?f.reducerFactory:Ml,metaReducers:!(f instanceof _t)&&f.metaReducers?f.metaReducers:[],initialState:!(f instanceof _t)&&f.initialState?f.initialState:void 0}},{provide:WR,deps:[RR,CR],useFactory:kV},{provide:Nw,multi:!0,useValue:s instanceof Object?s.reducer:a},{provide:PR,multi:!0,useExisting:a instanceof _t?a:Nw},{provide:ZR,multi:!0,deps:[Nw,[new N1(PR)]],useFactory:LV},tP()]}function Cp(...s){let a=s.pop(),f=s.map(d=>d.type);return{reducer:a,types:f}}function Ap(s,...a){let f=new Map;for(let d of a)for(let _ of d.types){let r=f.get(_);if(r){let M=(L,B)=>d.reducer(r(L,B),B);f.set(_,M)}else f.set(_,d.reducer)}return function(d=s,_){let r=f.get(_.type);return r?r(d,_):d}}var eU={dispatch:!0,functional:!1,useEffectsErrorHandler:!0},jy="__@ngrx/effects_create__";function Zw(s,a={}){let f=a.functional?s:s(),d=It(It({},eU),a);return Object.defineProperty(f,jy,{value:d}),f}function tU(s){return Object.getOwnPropertyNames(s).filter(d=>s[d]&&s[d].hasOwnProperty(jy)?s[d][jy].hasOwnProperty("dispatch"):!1).map(d=>{let _=s[d][jy];return It({propertyName:d},_)})}function nU(s){return tU(s)}function iP(s){return Object.getPrototypeOf(s)}function rU(s){return!!s.constructor&&s.constructor.name!=="Object"&&s.constructor.name!=="Function"}function oP(s){return typeof s=="function"}function iU(s){return s.filter(oP)}function oU(s,a,f){let d=iP(s),r=!!d&&d.constructor.name!=="Object"?d.constructor.name:null,M=nU(s).map(({propertyName:L,dispatch:B,useEffectsErrorHandler:X})=>{let se=typeof s[L]=="function"?s[L]():s[L],ge=X?f(se,a):se;return B===!1?ge.pipe(Px()):ge.pipe(Nx()).pipe(Ht(at=>({effect:s[L],notification:at,propertyName:L,sourceName:r,sourceInstance:s})))});return n_(...M)}var sU=10;function sP(s,a,f=sU){return s.pipe(zi(d=>(a&&a.handleError(d),f<=1?s:sP(s,a,f-1))))}var Xw=(()=>{let a=class a extends yn{constructor(d){super(),d&&(this.source=d)}lift(d){let _=new a;return _.source=this,_.operator=d,_}};a.\u0275fac=function(_){return new(_||a)(Rt(Mp))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function Yw(...s){return oi(a=>s.some(f=>typeof f=="string"?f===a.type:f.type===a.type))}var t9=new _t("@ngrx/effects Internal Root Guard"),n9=new _t("@ngrx/effects User Provided Effects"),r9=new _t("@ngrx/effects Internal Root Effects"),i9=new _t("@ngrx/effects Internal Root Effects Instances"),o9=new _t("@ngrx/effects Internal Feature Effects"),s9=new _t("@ngrx/effects Internal Feature Effects Instance Groups"),aU=new _t("@ngrx/effects Effects Error Handler",{providedIn:"root",factory:()=>sP}),lU="@ngrx/effects/init",cU=Uw(lU);function uU(s,a){if(s.notification.kind==="N"){let f=s.notification.value;!hU(f)&&a.handleError(new Error(`Effect ${dU(s)} dispatched an invalid action: ${fU(f)}`))}}function hU(s){return typeof s!="function"&&s&&s.type&&typeof s.type=="string"}function dU({propertyName:s,sourceInstance:a,sourceName:f}){let d=typeof a[s]=="function";return!!f?`"${f}.${String(s)}${d?"()":""}"`:`"${String(s)}()"`}function fU(s){try{return JSON.stringify(s)}catch{return s}}var pU="ngrxOnIdentifyEffects";function mU(s){return Jw(s,pU)}var gU="ngrxOnRunEffects";function _U(s){return Jw(s,gU)}var yU="ngrxOnInitEffects";function vU(s){return Jw(s,yU)}function Jw(s,a){return s&&a in s&&typeof s[a]=="function"}var aP=(()=>{let a=class a extends wr{constructor(d,_){super(),this.errorHandler=d,this.effectsErrorHandler=_}addEffects(d){this.next(d)}toActions(){return this.pipe(i_(d=>rU(d)?iP(d):d),Er(d=>d.pipe(i_(xU))),Er(d=>{let _=d.pipe(pl(M=>bU(this.errorHandler,this.effectsErrorHandler)(M)),Ht(M=>(uU(M,this.errorHandler),M.notification)),oi(M=>M.kind==="N"&&M.value!=null),kx()),r=d.pipe(Wo(1),oi(vU),Ht(M=>M.ngrxOnInitEffects()));return n_(_,r)}))}};a.\u0275fac=function(_){return new(_||a)(Rt(es),Rt(aU))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function xU(s){return mU(s)?s.ngrxOnIdentifyEffects():""}function bU(s,a){return f=>{let d=oU(f,s,a);return _U(f)?f.ngrxOnRunEffects(d):d}}var wU=(()=>{let a=class a{get isStarted(){return!!this.effectsSubscription}constructor(d,_){this.effectSources=d,this.store=_,this.effectsSubscription=null}start(){this.effectsSubscription||(this.effectsSubscription=this.effectSources.toActions().subscribe(this.store))}ngOnDestroy(){this.effectsSubscription&&(this.effectsSubscription.unsubscribe(),this.effectsSubscription=null)}};a.\u0275fac=function(_){return new(_||a)(Rt(aP),Rt(is))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function lP(...s){let a=s.flat(),f=iU(a);return ts([f,{provide:Jo,multi:!0,useValue:()=>{nt(Ip),nt(Ly,{optional:!0});let d=nt(wU),_=nt(aP),r=!d.isStarted;r&&d.start();for(let M of a){let L=oP(M)?nt(M):M;_.addEffects(L)}r&&nt(is).dispatch(cU())}}])}var EU="1",TU={id:"1",title:"create"},IU={id:"2",title:"delete"},DU={id:"3",title:"choose"},MU={id:"4",title:"edit"},SU={id:"5",title:"move"},CU=[TU,IU,DU,MU,SU],Vy=[{id:"1",title:"Polygon editor"},{id:"2",title:"Feature 2"},{id:"3",title:"Feature 3"},{id:"4",title:"Feature 4"},{id:"5",title:"Feature 5"},{id:"6",title:"Feature 6"},{id:"7",title:"Feature 7"}],Kw={featureId:EU,tools:CU},Uy={featureId:"",tools:[]},cP={id:"",title:""},uP={id:"",title:""};var Qw=(()=>{let a=class a{getFeatures(){return Gt(Vy)}getToolkit(d){return Gt(d.id===Kw.featureId?Kw:Uy)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Co=By({source:"Editor",events:{"Get Features":UR(),"Get Toolkit":Dl(),"Select Feature":Dl(),"Select Tool":Dl()}}),jh=By({source:"Editor API",events:{"Set Features":Dl(),"Set Toolkit":Dl()}}),eE=By({source:"Error",events:{Error:Dl()}});var AU=Zw((s=nt(Xw),a=nt(Qw))=>s.pipe(Yw(Co.getFeatures),pl(()=>a.getFeatures().pipe(Ht(f=>jh.setFeatures({featuresProp:f})),zi(f=>Gt(eE.error({errorMsg:f.message})))))),{functional:!0}),RU=Zw((s=nt(Xw),a=nt(Qw))=>s.pipe(Yw(Co.getToolkit),pl(f=>a.getToolkit(f.featureProp).pipe(Ht(d=>jh.setToolkit({toolkitProp:d})),zi(d=>Gt(eE.error({errorMsg:d.message})))))),{functional:!0});var Ti={production:!1,mapboxToken:"pk.eyJ1|joibWFyb29uZWRpb251liwiYSI6|mNqdmp0MzB1azBpcDAzem1naHZwMjNndGlifQ.65nvvRg9QeFUV2c6b9W4Vw",yandexToken:"e04fe284-1ada-4a54-9346-cc5ce529fee7",moscowLng:37.6,moscowLat:55.7,appState:"appState",state:"state",mainRoute:"",mapboxRoute:"mapbox",tableRoute:"table",unknownRoute:"**"};var Gy=_F(dP());var $y=s=>s.appState.editorState,fP=Sp($y,s=>s.features),pP=Sp($y,s=>s.toolkit),mP=Sp($y,s=>s.selectedFeature),gP=Sp($y,s=>s.selectedTool);var PU=s=>({"!bg-orange-600":s});function OU(s,a){if(s&1){let f=K_();si(0,"div",2),kc(1,"async"),Oc("click",function(){let _=j_(f).$implicit,r=Eh();return V_(r.selectFeature(_))}),Ns(2),ai()}if(s&2){let f=a.$implicit,d=Eh();Mo("ngClass",ey(4,PU,f===Lc(1,2,d.selectedFeature$))),rs(2),wb(f.title)}}var _P=(()=>{let a=class a{constructor(d){this.store=d,this.features$=this.store.select(fP),this.selectedFeature$=this.store.select(mP)}ngOnInit(){this.store.dispatch(Co.getFeatures())}selectFeature(d){this.store.dispatch(Co.selectFeature({featureProp:d})),this.store.dispatch(Co.getToolkit({featureProp:d}))}};a.\u0275fac=function(_){return new(_||a)(br(is))},a.\u0275cmp=Ui({type:a,selectors:[["app-editor"]],standalone:!0,features:[$i],decls:3,vars:3,consts:[[1,"absolute","top-1/2","-translate-y-1/2","select-none"],["class","h-8 py-1 px-2 bg-black/60 hover:bg-black/40 text-white cursor-pointer first:rounded-tr-xl last:rounded-br-xl",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"h-8","py-1","px-2","bg-black/60","hover:bg-black/40","text-white","cursor-pointer","first:rounded-tr-xl","last:rounded-br-xl",3,"click","ngClass"]],template:function(_,r){_&1&&(si(0,"div",0),wh(1,OU,3,6,"div",1),kc(2,"async"),ai()),_&2&&(rs(),Mo("ngForOf",Lc(2,1,r.features$)))},dependencies:[ly,cy,ay]});let s=a;return s})();var kU=s=>({"!bg-orange-600":s});function LU(s,a){if(s&1){let f=K_();si(0,"div",4),kc(1,"async"),Oc("click",function(){let _=j_(f).$implicit,r=Eh(2);return V_(r.selectTool(_))}),Ns(2),kc(3,"titlecase"),ai()}if(s&2){let f=a.$implicit,d=Eh(2);Mo("ngClass",ey(6,kU,f===Lc(1,2,d.selectedTool$))),rs(2),Q_("",Lc(3,4,f.title)," ")}}function FU(s,a){if(s&1&&(si(0,"div",2),wh(1,LU,4,8,"div",3),ai()),s&2){let f=a.ngIf;rs(),Mo("ngForOf",f.tools)}}var yP=(()=>{let a=class a{constructor(d){this.store=d,this.toolkit$=this.store.select(pP),this.selectedTool$=this.store.select(gP)}selectTool(d){this.store.dispatch(Co.selectTool({toolProp:d}))}};a.\u0275fac=function(_){return new(_||a)(br(is))},a.\u0275cmp=Ui({type:a,selectors:[["app-toolkit"]],standalone:!0,features:[$i],decls:3,vars:3,consts:[[1,"absolute","left-1/2","-translate-x-1/2","select-none"],["class","flex",4,"ngIf"],[1,"flex"],["class","py-1 px-2 bg-black/60 hover:bg-black/40 text-white cursor-pointer first:rounded-bl-xl last:rounded-br-xl",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"py-1","px-2","bg-black/60","hover:bg-black/40","text-white","cursor-pointer","first:rounded-bl-xl","last:rounded-br-xl",3,"click","ngClass"]],template:function(_,r){_&1&&(si(0,"div",0),wh(1,FU,2,1,"div",1),kc(2,"async"),ai()),_&2&&(rs(),Mo("ngIf",Lc(2,1,r.toolkit$)))},dependencies:[ly,cy,w2,ay,T2]});let s=a;return s})();var vP=(()=>{let a=class a{constructor(){}ngOnInit(){Gy.default.accessToken="pk.eyJ1IjoibWFyb29uZWRpb25lIiwiYSI6ImNqdmp0MzB1azBpcDAzem1naHZwMjNndGIifQ.65nvvRg9QeFUV2c6b9W4Vw",new Gy.default.Map({container:"map",style:"mapbox://styles/mapbox/streets-v12",center:[Ti.moscowLng,Ti.moscowLat],zoom:9}).addControl(new Gy.default.FullscreenControl)}};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ui({type:a,selectors:[["app-mapbox-page"]],standalone:!0,features:[$i],decls:3,vars:0,consts:[["id","map",1,"absolute","top-[4vw]","left-0","bottom-0","right-0"]],template:function(_,r){_&1&&Pc(0,"div",0)(1,"app-editor")(2,"app-toolkit")},dependencies:[_P,yP]});let s=a;return s})();var xP=(()=>{let a=class a{constructor(d){this.http=d}getVariants(d){return this.http.get("https://suggests.rasp.yandex.net/all_suggests?format=old&part="+d)}getSuggests(d){return this.http.get("https://api.mapbox.com/search/searchbox/v1/suggest?q="+d)}getStations(){return this.http.get("https://api.rasp.yandex.net/v3.0/search/?apikey=e04fe284-1ada-4a54-9346-cc5ce529fee7&format=json&from=c146&to=c213&lang=ru_RU&page=1&date=2024-03-16")}};a.\u0275fac=function(_){return new(_||a)(Rt(Nb))},a.\u0275prov=Ot({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var iE=(()=>{let a=class a{constructor(d){this.tableApiService=d,this.tableApiService.getStations().subscribe(_=>console.log(_))}};a.\u0275fac=function(_){return new(_||a)(br(xP))},a.\u0275cmp=Ui({type:a,selectors:[["app-table-page"]],standalone:!0,features:[$i],decls:2,vars:0,template:function(_,r){_&1&&(si(0,"p"),Ns(1,"table-page works!"),ai())}});let s=a;return s})();var bP=[{path:Ti.mainRoute,component:iE},{path:Ti.mapboxRoute,component:vP},{path:Ti.tableRoute,component:iE},{path:Ti.unknownRoute,redirectTo:Ti.mainRoute}];var zU=Ap(Vy,Cp(jh.setFeatures,(s,{featuresProp:a})=>a)),BU=Ap(Uy,Cp(jh.setToolkit,(s,{toolkitProp:a})=>a)),jU=Ap(cP,Cp(Co.selectFeature,(s,{featureProp:a})=>a)),VU=Ap(uP,Cp(Co.selectTool,(s,{toolProp:a})=>a)),wP=Ml({features:zU,toolkit:BU,selectedFeature:jU,selectedTool:VU});var oE=Ml({editorState:wP}),VX=Ml({appState:oE});var EP=(s,a)=>{let f=s.clone({headers:s.headers.append("Authorization",Ti.yandexToken)});return a(s)};var UU=[nP(Ti.appState,oE)],$U=[tE],TP={providers:[UU,DR(bP),rP(),L2(F2([EP])),lP($U)]};var IP=(()=>{let a=class a{constructor(){this.environment=Ti}};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ui({type:a,selectors:[["app-nav"]],standalone:!0,features:[$i],decls:8,vars:3,consts:[[1,"flex","justify-between","items-center","px-[10vw]","h-[4vw]","bg-gray-600","text-4xl","text-orange-400","select-none"],[1,"cursor-pointer","hover:text-orange-600",3,"routerLink"],[1,"flex","gap-[2vw]","text-2xl","*:cursor-pointer"],[1,"hover:text-orange-600",3,"routerLink"]],template:function(_,r){_&1&&(si(0,"div",0)(1,"div",1),Ns(2,"\u0413\u043B\u0430\u0432\u043D\u0430\u044F"),ai(),si(3,"div",2)(4,"div",3),Ns(5,"\u041A\u0430\u0440\u0442\u0430"),ai(),si(6,"div",3),Ns(7,"\u0420\u0430\u0441\u043F\u0438\u0441\u0430\u043D\u0438\u0435"),ai()()()),_&2&&(rs(),Mo("routerLink",r.environment.mainRoute),rs(3),Mo("routerLink",r.environment.mapboxRoute),rs(2),Mo("routerLink",r.environment.tableRoute))},dependencies:[IR]});let s=a;return s})();var DP=(()=>{let a=class a{constructor(){this.title="Map"}};a.\u0275fac=function(_){return new(_||a)},a.\u0275cmp=Ui({type:a,selectors:[["app-root"]],standalone:!0,features:[$i],decls:3,vars:0,consts:[[1,"h-[100vh]","w-[100vw]"]],template:function(_,r){_&1&&(si(0,"div",0),Pc(1,"app-nav")(2,"router-outlet"),ai())},dependencies:[Dw,IP]});let s=a;return s})();G2(DP,TP).catch(s=>console.error(s));
